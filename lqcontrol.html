

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>57. LQ控制：基础 &#8212; Python中级数量经济学</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/quantecon-book-theme.css?digest=bd0785fbb14d8d2bd4d9ae501d79ed8d3bc089ec" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>


    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/scripts/quantecon-book-theme.js?digest=d9faaf6c4b57726f74ba012412af1f5681bdff87"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-J0SMYR4SG3"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-J0SMYR4SG3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"argmax": "arg\\,max", "argmin": "arg\\,min"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lqcontrol';</script>
    <link rel="canonical" href="https://python.quantecon-zh-cn.org/lqcontrol.html" />
    <link rel="shortcut icon" href="_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="58. LQ控制的拉格朗日方法" href="lagrangian_lqdp.html" />
    <link rel="prev" title="56. 贝叶斯与频率主义决策规则的比较" href="navy_captain.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和编写的数量经济建模讲座。 />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="LQ控制：基础"/>
<meta name="twitter:description" content="本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和编写的数量经济建模讲座。">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="LQ控制：基础" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://python.quantecon-zh-cn.org/lqcontrol.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和编写的数量经济建模讲座。" />
<meta property="og:site_name" content="Python中级数量经济学" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>

<!-- Override QuantEcon theme colors -->

    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=lqcontrol>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">57.1. 概述</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">57.2. 引言</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">57.2.1. 运动规律</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">57.2.1.1. 示例1</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#lq-hhp">57.2.1.2. 示例2</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">57.2.2. 偏好</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">57.2.2.1. 示例1</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">57.2.2.2. 示例2</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">57.3. 最优性 – 有限时域</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">57.3.1. 目标函数</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lq-cp">57.3.2. 信息</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">57.3.3. 解决方案</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">57.4. 实现</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lq-mfpa">57.4.1. 一个应用</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">57.5. 扩展和评论</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">57.5.1. 时变参数</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lq-cpt">57.5.2. 添加交叉乘积项</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lq-ih">57.5.3. 无限期限</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lq-cert-eq">57.5.4. 确定性等价</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">57.6. 进一步应用</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lq-nsi">57.6.1. 应用1：与年龄相关的收入过程</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lq-nsi2">57.6.2. 应用2：包含退休的永久收入模型</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lqc-mwac">57.6.3. 应用3：具有调整成本的垄断</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id32">57.7. 练习</a></li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo-large.png" class="logo logo-img" alt="logo"></a>
                                    
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">Python中级数量经济学</a></p>

                        <p class="qe-page__header-subheading">LQ控制：基础</p>

                    </div>
                    <!-- length 2, since its a string and empty dict has length 2 - {} -->
                        <p class="qe-page__header-authors" font-size="18">
                            
                                
                                    <a href="http://www.tomsargent.com/" target="_blank"><span>托马斯·萨金特（Thomas J. Sargent）</span></a>
                                
                            
                                
                                    and <a href="https://johnstachurski.net/" target="_blank"><span>约翰·斯塔胡斯基（John Stachurski）</span></a>
                                
                            
                        </p>


                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <section class="tex2jax_ignore mathjax_ignore" id="lq">
<h1><a class="toc-backref" href="#id33"><span class="section-number">57. </span>LQ控制：基础</a><a class="headerlink" href="#lq" title="Permalink to this heading">#</a></h1>
<div class="contents topic" id="id1">
<span id="index-0"></span><p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#lq" id="id33">LQ控制：基础</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id34">概述</a></p></li>
<li><p><a class="reference internal" href="#id6" id="id35">引言</a></p></li>
<li><p><a class="reference internal" href="#id14" id="id36">最优性 – 有限时域</a></p></li>
<li><p><a class="reference internal" href="#id18" id="id37">实现</a></p></li>
<li><p><a class="reference internal" href="#id22" id="id38">扩展和评论</a></p></li>
<li><p><a class="reference internal" href="#id28" id="id39">进一步应用</a></p></li>
<li><p><a class="reference internal" href="#id32" id="id40">练习</a></p></li>
</ul>
</li>
</ul>
</div>
<p>除了Anaconda中已有的库外，本讲座还需要以下库：</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>quantecon
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: quantecon in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (0.8.0)
Requirement already satisfied: numba&gt;=0.49.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from quantecon) (0.60.0)
Requirement already satisfied: numpy&gt;=1.17.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from quantecon) (1.26.4)
Requirement already satisfied: requests in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from quantecon) (2.32.3)
Requirement already satisfied: scipy&gt;=1.5.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from quantecon) (1.13.1)
Requirement already satisfied: sympy in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from quantecon) (1.13.2)
Requirement already satisfied: llvmlite&lt;0.44,&gt;=0.43.0dev0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from numba&gt;=0.49.0-&gt;quantecon) (0.43.0)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from requests-&gt;quantecon) (3.3.2)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from requests-&gt;quantecon) (3.7)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from requests-&gt;quantecon) (2.2.3)
Requirement already satisfied: certifi&gt;=2017.4.17 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from requests-&gt;quantecon) (2024.8.30)
Requirement already satisfied: mpmath&lt;1.4,&gt;=1.1.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from sympy-&gt;quantecon) (1.3.0)
</pre></div>
</div>
</div>
</details>
</div>
<section id="id2">
<h2><a class="toc-backref" href="#id34"><span class="section-number">57.1. </span>概述</a><a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<p>线性二次（LQ）控制指的是一类在几乎所有科学领域都有应用的动态优化问题。</p>
<p>本讲座介绍LQ控制及其经济应用。</p>
<p>我们将会看到，LQ系统具有简单的结构，使其成为处理各种经济问题的优秀工具。</p>
<p>此外，虽然线性二次结构具有局限性，但实际上它比最初看起来要灵活得多。</p>
<p>这些主题在下文中会反复出现。</p>
<p>从数学角度来看，LQ控制问题与<a class="reference internal" href="kalman.html"><span class="doc">卡尔曼滤波</span></a>密切相关</p>
<ul class="simple">
<li><p>线性二次控制问题和卡尔曼滤波问题的递归表述都涉及矩阵<strong>黎卡提方程</strong>。</p></li>
<li><p>线性控制和线性滤波问题的经典表述使用类似的矩阵分解（参见<a class="reference external" href="https://python-advanced.quantecon.org/lu_tricks.html">这节课</a>和<a class="reference external" href="https://python-advanced.quantecon.org/classical_filtering.html">这节课</a>）。</p></li>
</ul>
<p>在阅读以下内容时，了解这些内容会很有帮助：</p>
<ul class="simple">
<li><p>矩阵运算</p></li>
<li><p>随机变量向量</p></li>
<li><p>动态规划和贝尔曼方程（参见<a class="reference external" href="https://quantecon.github.io/lecture-intro.zh-cn/short_path.html" title="(in Python)"><span class="xref std std-doc">这节课</span></a>和<a class="reference internal" href="optgrowth.html"><span class="doc">这节课</span></a>）</p></li>
</ul>
<p>关于LQ控制的更多阅读材料，请参见：</p>
<ul class="simple">
<li><p><span id="id3">[<a class="reference internal" href="zreferences.html#id186" title="L Ljungqvist and T J Sargent. Recursive Macroeconomic Theory. MIT Press, 4 edition, 2018.">Ljungqvist and Sargent, 2018</a>]</span>，第5章</p></li>
<li><p><span id="id4">[<a class="reference internal" href="zreferences.html#id170" title="L P Hansen and T J Sargent. Robustness. Princeton University Press, 2008.">Hansen and Sargent, 2008</a>]</span>，第4章</p></li>
<li><p><span id="id5">[<a class="reference internal" href="zreferences.html#id172" title="O Hernandez-Lerma and J B Lasserre. Discrete-Time Markov Control Processes: Basic Optimality Criteria. Number Vol 1 in Applications of Mathematics Stochastic Modelling and Applied Probability. Springer, 1996.">Hernandez-Lerma and Lasserre, 1996</a>]</span>，3.5节</p></li>
</ul>
<p>为了专注于计算，我们将较长的证明留给这些参考资料（同时尽可能提供直观解释）。</p>
<p>让我们从一些导入开始：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="n">FONTPATH</span> <span class="o">=</span> <span class="s2">&quot;fonts/SourceHanSerifSC-SemiBold.otf&quot;</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">fontManager</span><span class="o">.</span><span class="n">addfont</span><span class="p">(</span><span class="n">FONTPATH</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source Han Serif SC&#39;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1">#设置默认图形大小</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">quantecon</span> <span class="kn">import</span> <span class="n">LQ</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id6">
<h2><a class="toc-backref" href="#id35"><span class="section-number">57.2. </span>引言</a><a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h2>
<p>LQ中的”线性”部分指的是状态的线性运动规律，而”二次”部分则指的是偏好。</p>
<p>让我们先从前者开始，然后讨论后者，最后将它们组合成一个优化问题。</p>
<section id="id7">
<h3><span class="section-number">57.2.1. </span>运动规律<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h3>
<p>设<span class="math notranslate nohighlight">\(x_t\)</span>是描述某个经济系统状态的向量。</p>
<p>假设<span class="math notranslate nohighlight">\(x_t\)</span>遵循以下线性运动规律</p>
<div class="math notranslate nohighlight" id="equation-lq-lom">
<span class="eqno">(57.1)<a class="headerlink" href="#equation-lq-lom" title="Permalink to this equation">#</a></span>\[x_{t+1} = A x_t + B u_t + C w_{t+1},
\qquad t = 0, 1, 2, \ldots\]</div>
<p>这里</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(u_t\)</span>是一个”控制”向量，包含了决策者面对当前状态<span class="math notranslate nohighlight">\(x_t\)</span>时可用的选择</p></li>
<li><p><span class="math notranslate nohighlight">\(\{w_t\}\)</span>是一个不相关的零均值冲击过程，满足<span class="math notranslate nohighlight">\(\mathbb E w_t w_t' = I\)</span>，其中右边是单位矩阵</p></li>
</ul>
<p>关于维度</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x_t\)</span>是<span class="math notranslate nohighlight">\(n \times 1\)</span>维，<span class="math notranslate nohighlight">\(A\)</span>是<span class="math notranslate nohighlight">\(n \times n\)</span>维</p></li>
<li><p><span class="math notranslate nohighlight">\(u_t\)</span>是<span class="math notranslate nohighlight">\(k \times 1\)</span>维，<span class="math notranslate nohighlight">\(B\)</span>是<span class="math notranslate nohighlight">\(n \times k\)</span>维</p></li>
<li><p><span class="math notranslate nohighlight">\(w_t\)</span>是<span class="math notranslate nohighlight">\(j \times 1\)</span>维，<span class="math notranslate nohighlight">\(C\)</span>是<span class="math notranslate nohighlight">\(n \times j\)</span>维</p></li>
</ul>
<section id="id8">
<h4><span class="section-number">57.2.1.1. </span>示例1<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h4>
<p>考虑一个家庭预算约束，表示为</p>
<div class="math notranslate nohighlight">
\[a_{t+1} + c_t = (1 + r) a_t + y_t
\]</div>
<p>这里<span class="math notranslate nohighlight">\(a_t\)</span>是资产，<span class="math notranslate nohighlight">\(r\)</span>是固定利率，<span class="math notranslate nohighlight">\(c_t\)</span>是当前消费，<span class="math notranslate nohighlight">\(y_t\)</span>是当前非金融收入。</p>
<p>如果我们假设<span class="math notranslate nohighlight">\(\{ y_t \}\)</span>是序列不相关的且服从<span class="math notranslate nohighlight">\(N(0, \sigma^2)\)</span>分布，那么，令<span class="math notranslate nohighlight">\(\{ w_t \}\)</span>为标准正态分布，我们可以将系统写作</p>
<div class="math notranslate nohighlight">
\[
a_{t+1} = (1 + r) a_t - c_t + \sigma w_{t+1}
\]</div>
<p>这显然是<a class="reference internal" href="#equation-lq-lom">(57.1)</a>的一个特例，其中资产是状态变量，消费是控制变量。</p>
</section>
<section id="lq-hhp">
<span id="id9"></span><h4><span class="section-number">57.2.1.2. </span>示例2<a class="headerlink" href="#lq-hhp" title="Permalink to this heading">#</a></h4>
<p>前一个模型的一个不现实的特征是非金融收入的均值为零且经常为负。</p>
<p>这个问题可以通过添加一个足够大的均值来轻松解决。</p>
<p>因此在这个例子中，我们令<span class="math notranslate nohighlight">\(y_t = \sigma w_{t+1} + \mu\)</span>，其中<span class="math notranslate nohighlight">\(\mu\)</span>是某个正实数。</p>
<p>另一个值得引入的改变（我们很快就会明白原因）是将控制变量从消费改为消费与某个”理想”数量<span class="math notranslate nohighlight">\(\bar c\)</span>的偏差。</p>
<p>(大多数参数化情况下，<span class="math notranslate nohighlight">\(\bar c\)</span> 相对于每个时期可获得的消费量来说都很大，因此家庭希望增加消费。)</p>
<p>因此，我们现在将控制变量设为 <span class="math notranslate nohighlight">\(u_t := c_t - \bar c\)</span>。</p>
<p>用这些变量表示，预算约束 <span class="math notranslate nohighlight">\(a_{t+1} = (1 + r) a_t - c_t + y_t\)</span> 变为</p>
<div class="math notranslate nohighlight" id="equation-lq-lomwc">
<span class="eqno">(57.2)<a class="headerlink" href="#equation-lq-lomwc" title="Permalink to this equation">#</a></span>\[a_{t+1} = (1 + r) a_t - u_t - \bar c + \sigma w_{t+1} + \mu\]</div>
<p>我们如何将这个新系统写成方程 <a class="reference internal" href="#equation-lq-lom">(57.1)</a> 的形式？</p>
<p>如果像前面的例子一样，我们把 <span class="math notranslate nohighlight">\(a_t\)</span> 作为状态变量，那么我们会遇到一个问题：
运动方程右侧包含一些常数项。</p>
<p>这意味着我们处理的是一个<em>仿射</em>函数，而不是线性函数
(回顾 <a class="reference internal" href="linear_algebra.html#la-linear-map"><span class="std std-ref">这个讨论</span></a>)。</p>
<p>幸运的是，我们可以通过添加一个额外的状态变量来轻松解决这个问题。</p>
<p>具体来说，如果我们写成</p>
<div class="math notranslate nohighlight" id="equation-lq-lowmc">
<span class="eqno">(57.3)<a class="headerlink" href="#equation-lq-lowmc" title="Permalink to this equation">#</a></span>\[ \begin{align}\begin{aligned}\begin{split}\left(
\begin{array}{c}
a_{t+1} \\
1
\end{array}\end{split}\\\begin{split}\right) =
\left(
\begin{array}{cc}
1 + r &amp; -\bar c + \mu \\
0     &amp; 1
\end{array}
\right)
\left(
\begin{array}{c}
a_t \\
1
\end{array}
\right) +
\left(
\begin{array}{c}
-1 \\
0
\end{array}
\right)
u_t +
\left(
\begin{array}{c}
\sigma \\
0
\end{array}
\right)
w_{t+1}\end{split}\end{aligned}\end{align} \]</div>
<p>第一行等价于<a class="reference internal" href="#equation-lq-lomwc">(57.2)</a>。</p>
<p>此外，该模型现在是线性的，可以通过设定以下参数写成<a class="reference internal" href="#equation-lq-lom">(57.1)</a>的形式</p>
<div class="math notranslate nohighlight" id="equation-lq-lowmc2">
<span class="eqno">(57.4)<a class="headerlink" href="#equation-lq-lowmc2" title="Permalink to this equation">#</a></span>\[\begin{split}x_t :=
\left(
\begin{array}{c}
a_t \\
1
\end{array}
\right),
\quad
A :=
\left(
\begin{array}{cc}
1 + r &amp; -\bar c + \mu \\
0     &amp; 1
\end{array}
\right),
\quad
B :=
\left(
\begin{array}{c}
-1 \\
0
\end{array}
\right),
\quad
C :=
\left(
\begin{array}{c}
\sigma \\
0
\end{array}
\right)\end{split}\]</div>
<p>实际上，我们通过增加另一个状态变量获得了线性特性。</p>
</section>
</section>
<section id="id10">
<h3><span class="section-number">57.2.2. </span>偏好<a class="headerlink" href="#id10" title="Permalink to this heading">#</a></h3>
<p>在LQ模型中，目标是最小化损失流，其中时间t的损失由以下二次表达式给出</p>
<div class="math notranslate nohighlight" id="equation-lq-pref-flow">
<span class="eqno">(57.5)<a class="headerlink" href="#equation-lq-pref-flow" title="Permalink to this equation">#</a></span>\[x_t' R x_t + u_t' Q u_t\]</div>
<ul class="simple">
<li><p>假设 <span class="math notranslate nohighlight">\(R\)</span> 是 <span class="math notranslate nohighlight">\(n \times n\)</span> 的对称非负定矩阵。</p></li>
<li><p>假设 <span class="math notranslate nohighlight">\(Q\)</span> 是 <span class="math notranslate nohighlight">\(k \times k\)</span> 的对称正定矩阵。</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>实际上，对于许多经济问题，可以放宽对 <span class="math notranslate nohighlight">\(R\)</span> 和 <span class="math notranslate nohighlight">\(Q\)</span> 的正定性条件。只需要 <span class="math notranslate nohighlight">\(R\)</span> 和 <span class="math notranslate nohighlight">\(Q\)</span> 的某些子矩阵是非负定的即可。详见 <span id="id11">[<a class="reference internal" href="zreferences.html#id170" title="L P Hansen and T J Sargent. Robustness. Princeton University Press, 2008.">Hansen and Sargent, 2008</a>]</span>。</p>
</div>
<section id="id12">
<h4><span class="section-number">57.2.2.1. </span>示例1<a class="headerlink" href="#id12" title="Permalink to this heading">#</a></h4>
<p>一个满足这些假设的非常简单的例子是将 <span class="math notranslate nohighlight">\(R\)</span> 和 <span class="math notranslate nohighlight">\(Q\)</span> 取为单位矩阵，这样当前损失为</p>
<div class="math notranslate nohighlight">
\[
x_t' I x_t + u_t' I u_t = \| x_t \|^2 + \| u_t \|^2
\]</div>
<p>因此，对于状态和控制而言，损失都被度量为与原点的平方距离。</p>
<p>（实际上，一般情况 <a class="reference internal" href="#equation-lq-pref-flow">(57.5)</a> 也可以用这种方式理解，但 <span class="math notranslate nohighlight">\(R\)</span> 和 <span class="math notranslate nohighlight">\(Q\)</span> 定义了其他 - 非欧几里得 - 与零向量的”距离”概念。）</p>
<p>直观上，我们通常可以将状态 <span class="math notranslate nohighlight">\(x_t\)</span> 理解为偏离目标的程度，例如</p>
<ul class="simple">
<li><p>通货膨胀偏离某个目标水平的程度</p></li>
<li><p>企业资本存量偏离某个理想数量的程度</p></li>
</ul>
<p>目标是使状态接近目标值，同时节约地使用控制变量。</p>
</section>
<section id="id13">
<h4><span class="section-number">57.2.2.2. </span>示例2<a class="headerlink" href="#id13" title="Permalink to this heading">#</a></h4>
<p>在<a class="reference internal" href="#lq-hhp"><span class="std std-ref">之前研究的家庭问题</span></a>中，设定<span class="math notranslate nohighlight">\(R=0\)</span>和<span class="math notranslate nohighlight">\(Q=1\)</span>得到的偏好为</p>
<div class="math notranslate nohighlight">
\[
x_t' R x_t + u_t' Q u_t = u_t^2 = (c_t - \bar c)^2
\]</div>
<p>在这种设定下，家庭当前的损失是消费与理想水平<span class="math notranslate nohighlight">\(\bar c\)</span>的平方差。</p>
</section>
</section>
</section>
<section id="id14">
<h2><a class="toc-backref" href="#id36"><span class="section-number">57.3. </span>最优性 – 有限时域</a><a class="headerlink" href="#id14" title="Permalink to this heading">#</a></h2>
<p id="index-1">让我们现在明确我们要考虑的优化问题，并看看如何解决它。</p>
<section id="id15">
<h3><span class="section-number">57.3.1. </span>目标函数<a class="headerlink" href="#id15" title="Permalink to this heading">#</a></h3>
<p>我们将从有限时域情况开始，终止时间为<span class="math notranslate nohighlight">\(T \in \mathbb N\)</span>。</p>
<p>在这种情况下，目标是选择一系列控制变量<span class="math notranslate nohighlight">\(\{u_0, \ldots, u_{T-1}\}\)</span>来最小化目标函数</p>
<div class="math notranslate nohighlight" id="equation-lq-object">
<span class="eqno">(57.6)<a class="headerlink" href="#equation-lq-object" title="Permalink to this equation">#</a></span>\[ \begin{align}\begin{aligned}\mathbb E \,
\left\{\\\sum_{t=0}^{T-1} \beta^t (x_t' R x_t + u_t' Q u_t) + \beta^T x_T' R_f x_T
\right\}\end{aligned}\end{align} \]</div>
<p>受制于运动方程<a class="reference internal" href="#equation-lq-lom">(57.1)</a>和初始状态<span class="math notranslate nohighlight">\(x_0\)</span>。</p>
<p>这里引入的新对象是<span class="math notranslate nohighlight">\(\beta\)</span>和矩阵<span class="math notranslate nohighlight">\(R_f\)</span>。</p>
<p>标量<span class="math notranslate nohighlight">\(\beta\)</span>是折现因子，而<span class="math notranslate nohighlight">\(x' R_f x\)</span>给出与状态<span class="math notranslate nohighlight">\(x\)</span>相关的终端损失。</p>
<p>注释：</p>
<ul class="simple">
<li><p>我们假设<span class="math notranslate nohighlight">\(R_f\)</span>是<span class="math notranslate nohighlight">\(n \times n\)</span>的、对称且非负定的矩阵。</p></li>
<li><p>我们允许<span class="math notranslate nohighlight">\(\beta = 1\)</span>，因此包含了未折现的情况。</p></li>
<li><p><span class="math notranslate nohighlight">\(x_0\)</span>本身可能是随机的，在这种情况下，我们要求它与冲击序列<span class="math notranslate nohighlight">\(w_1, \ldots, w_T\)</span>相互独立。</p></li>
</ul>
</section>
<section id="lq-cp">
<span id="id16"></span><h3><span class="section-number">57.3.2. </span>信息<a class="headerlink" href="#lq-cp" title="Permalink to this heading">#</a></h3>
<p>到目前为止，我们还忽略了一个约束，即解决这个LQ问题的决策者只知道现在和过去，而不知道未来。</p>
<p>为了说明这一点，考虑控制序列<span class="math notranslate nohighlight">\(\{u_0, \ldots, u_{T-1}\}\)</span>。</p>
<p>在选择这些控制时，决策者可以考虑冲击的影响</p>
<p>系统中的 <span class="math notranslate nohighlight">\(\{w_1, \ldots, w_T\}\)</span>。</p>
<p>然而，通常假设（在此也将假设）时刻 <span class="math notranslate nohighlight">\(t\)</span> 的控制 <span class="math notranslate nohighlight">\(u_t\)</span> 只能基于过去和当前的冲击来做出。</p>
<p>用高深的<a class="reference external" href="https://en.wikipedia.org/wiki/Measure_%28mathematics%29">测度论</a>术语来说，就是 <span class="math notranslate nohighlight">\(u_t\)</span> 必须对由 <span class="math notranslate nohighlight">\(x_0, w_1, w_2, \ldots, w_t\)</span> 生成的 <span class="math notranslate nohighlight">\(\sigma\)</span>-代数可测。</p>
<p>这实际上等价于说 <span class="math notranslate nohighlight">\(u_t\)</span> 可以写成形式 <span class="math notranslate nohighlight">\(u_t = g_t(x_0, w_1, w_2, \ldots, w_t)\)</span>，其中 <span class="math notranslate nohighlight">\(g_t\)</span> 是某个 Borel 可测函数。</p>
<p>（几乎所有在应用中有用的函数都是 Borel 可测的，所以从直观上理解，你可以把最后那句话理解为”对某个函数 <span class="math notranslate nohighlight">\(g_t\)</span>”）</p>
<p>现在注意到 <span class="math notranslate nohighlight">\(x_t\)</span> 最终将取决于 <span class="math notranslate nohighlight">\(x_0, w_1, w_2, \ldots, w_t\)</span> 的实现值。</p>
<p>事实上，<span class="math notranslate nohighlight">\(x_t\)</span> 总结了决策者为了最优设置控制所需的所有历史冲击信息。</p>
<p>更准确地说，可以证明任何最优控制 <span class="math notranslate nohighlight">\(u_t\)</span> 都可以表示为仅与当前状态相关的函数。</p>
<p>因此，在接下来的内容中，我们将注意力限制在形如 <span class="math notranslate nohighlight">\(u_t = g_t(x_t)\)</span> 的控制策略（即函数）上。</p>
<p>实际上，前面的讨论适用于所有标准动态规划问题。</p>
<p>LQ情况的特殊之处在于——正如我们即将看到的——最优的 <span class="math notranslate nohighlight">\(u_t\)</span> 原来是 <span class="math notranslate nohighlight">\(x_t\)</span> 的线性函数。</p>
</section>
<section id="id17">
<h3><span class="section-number">57.3.3. </span>解决方案<a class="headerlink" href="#id17" title="Permalink to this heading">#</a></h3>
<p>为了解决有限时域LQ问题，我们可以使用基于向后归纳的动态规划策略，这在概念上类似于<a class="reference external" href="https://quantecon.github.io/lecture-intro.zh-cn/short_path.html" title="(in Python)"><span class="xref std std-doc">本讲座</span></a>中采用的方法。</p>
<p>由于很快就会明白的原因，我们首先引入符号 <span class="math notranslate nohighlight">\(J_T(x) = x' R_f x\)</span>。</p>
<p>现在考虑决策者在倒数第二个时期的问题。</p>
<p>具体来说，假设时间为<span class="math notranslate nohighlight">\(T-1\)</span>，且状态为<span class="math notranslate nohighlight">\(x_{T-1}\)</span>。</p>
<p>决策者必须权衡当前损失和（折现的）最终损失，因此需要求解</p>
<div class="math notranslate nohighlight">
\[
\min_u \{
x_{T-1}' R x_{T-1} + u' Q u + \beta \,
\mathbb E J_T(A x_{T-1} + B u + C w_T)
\}
\]</div>
<p>在这个阶段，定义以下函数会比较方便</p>
<div class="math notranslate nohighlight" id="equation-lq-lsm">
<span class="eqno">(57.7)<a class="headerlink" href="#equation-lq-lsm" title="Permalink to this equation">#</a></span>\[J_{T-1} (x) =
\min_u \{
x' R x + u' Q u + \beta \,
\mathbb E J_T(A x + B u + C w_T)
\}\]</div>
<p>函数<span class="math notranslate nohighlight">\(J_{T-1}\)</span>被称为<span class="math notranslate nohighlight">\(T-1\)</span>时期的价值函数，而<span class="math notranslate nohighlight">\(J_{T-1}(x)\)</span>可以被理解为从<span class="math notranslate nohighlight">\(T-1\)</span>时期状态<span class="math notranslate nohighlight">\(x\)</span>开始，当决策者采取最优行为时的总”未来损失”。</p>
<p>现在让我们回到<span class="math notranslate nohighlight">\(T-2\)</span>时期。</p>
<p>对于<span class="math notranslate nohighlight">\(T-2\)</span>时期的决策者来说，<span class="math notranslate nohighlight">\(J_{T-1}(x)\)</span>的作用类似于终端损失<span class="math notranslate nohighlight">\(J_T(x) = x' R_f x\)</span>对<span class="math notranslate nohighlight">\(T-1\)</span>时期决策者的作用。</p>
<p>也就是说，<span class="math notranslate nohighlight">\(J_{T-1}(x)\)</span> 概括了转移到状态 <span class="math notranslate nohighlight">\(x\)</span> 所关联的未来损失。</p>
<p>决策者选择她的控制 <span class="math notranslate nohighlight">\(u\)</span> 来权衡当前损失和未来损失，其中</p>
<ul class="simple">
<li><p>下一期的状态是 <span class="math notranslate nohighlight">\(x_{T-1} = Ax_{T-2} + B u + C w_{T-1}\)</span>，因此取决于当前控制的选择。</p></li>
<li><p>进入状态 <span class="math notranslate nohighlight">\(x_{T-1}\)</span> 的”成本”是 <span class="math notranslate nohighlight">\(J_{T-1}(x_{T-1})\)</span>。</p></li>
</ul>
<p>因此她的问题是</p>
<div class="math notranslate nohighlight">
\[
\min_u
\{
x_{T-2}' R x_{T-2} + u' Q u + \beta \,
\mathbb E J_{T-1}(Ax_{T-2} + B u + C w_{T-1})
\}
\]</div>
<p>令</p>
<div class="math notranslate nohighlight">
\[
J_{T-2} (x)
= \min_u
\{
x' R x + u' Q u + \beta \,
\mathbb E J_{T-1}(Ax + B u + C w_{T-1})
\}
\]</div>
<p>现在向后归纳的模式已经很清楚了。</p>
<p>具体来说，我们通过以下方式定义一系列价值函数 <span class="math notranslate nohighlight">\(\{J_0, \ldots, J_T\}\)</span></p>
<div class="math notranslate nohighlight">
\[
J_{t-1} (x)
= \min_u
\{
x' R x + u' Q u + \beta \,
\mathbb E J_{t}(Ax + B u + C w_t)
\}
\quad \text{和} \quad
J_T(x) = x' R_f x
\]</div>
<p>第一个等式是动态规划理论中的贝尔曼方程，专门用于有限时域LQ问题。</p>
<p>现在我们有了<span class="math notranslate nohighlight">\(\{J_0, \ldots, J_T\}\)</span>，我们可以获得最优控制。</p>
<p>作为第一步，让我们看看价值函数是什么样的。</p>
<p>事实证明，每个<span class="math notranslate nohighlight">\(J_t\)</span>都具有形式<span class="math notranslate nohighlight">\(J_t(x) = x' P_t x + d_t\)</span>，其中<span class="math notranslate nohighlight">\(P_t\)</span>是一个<span class="math notranslate nohighlight">\(n \times n\)</span>矩阵，而<span class="math notranslate nohighlight">\(d_t\)</span>是一个常数。</p>
<p>我们可以通过归纳法证明这一点，从<span class="math notranslate nohighlight">\(P_T := R_f\)</span>和<span class="math notranslate nohighlight">\(d_T = 0\)</span>开始。</p>
<p>使用这个符号，<a class="reference internal" href="#equation-lq-lsm">(57.7)</a>变为</p>
<div class="math notranslate nohighlight" id="equation-lq-fswb">
<span class="eqno">(57.8)<a class="headerlink" href="#equation-lq-fswb" title="Permalink to this equation">#</a></span>\[J_{T-1} (x) =
\min_u \{
x' R x + u' Q u + \beta \,
\mathbb E (A x + B u + C w_T)' P_T (A x + B u + C w_T)
\}\]</div>
<p>为了得到最小值，我们可以对右边项关于<span class="math notranslate nohighlight">\(u\)</span>求导，并令其等于零。</p>
<p>应用<a class="reference internal" href="linear_algebra.html#la-mcalc"><span class="std std-ref">矩阵微积分</span></a>的相关规则，得到</p>
<div class="math notranslate nohighlight" id="equation-lq-oc0">
<span class="eqno">(57.9)<a class="headerlink" href="#equation-lq-oc0" title="Permalink to this equation">#</a></span>\[u  = - (Q + \beta B' P_T B)^{-1} \beta B' P_T A x\]</div>
<p>将此代回<a class="reference internal" href="#equation-lq-fswb">(57.8)</a>并重新整理得到</p>
<div class="math notranslate nohighlight">
\[J_{T-1} (x) = x' P_{T-1} x + d_{T-1}
\]</div>
<p>其中</p>
<div class="math notranslate nohighlight" id="equation-lq-finr">
<span class="eqno">(57.10)<a class="headerlink" href="#equation-lq-finr" title="Permalink to this equation">#</a></span>\[P_{T-1} = R - \beta^2 A' P_T B (Q + \beta B' P_T B)^{-1} B' P_T A +
\beta A' P_T A\]</div>
<p>且</p>
<div class="math notranslate nohighlight" id="equation-lq-finrd">
<span class="eqno">(57.11)<a class="headerlink" href="#equation-lq-finrd" title="Permalink to this equation">#</a></span>\[d_{T-1} := \beta \mathop{\mathrm{trace}}(C' P_T C)\]</div>
<p>(这个代数运算是一个很好的练习 — 我们把它留给你。)</p>
<p>如果我们继续按这种方式向后推导，很快就会清楚 <span class="math notranslate nohighlight">\(J_t (x) = x' P_t x + d_t\)</span> 如我们所说，其中 <span class="math notranslate nohighlight">\(\{P_t\}\)</span> 和 <span class="math notranslate nohighlight">\(\{d_t\}\)</span> 满足递归式</p>
<div class="math notranslate nohighlight" id="equation-lq-pr">
<span class="eqno">(57.12)<a class="headerlink" href="#equation-lq-pr" title="Permalink to this equation">#</a></span>\[P_{t-1} = R - \beta^2 A' P_t B (Q + \beta B' P_t B)^{-1} B' P_t A +
\beta A' P_t A
\quad \text{其中} \quad
P_T = R_f\]</div>
<p>和</p>
<div class="math notranslate nohighlight" id="equation-lq-dd">
<span class="eqno">(57.13)<a class="headerlink" href="#equation-lq-dd" title="Permalink to this equation">#</a></span>\[d_{t-1} = \beta (d_t + \mathop{\mathrm{trace}}(C' P_t C))
\quad \text{其中} \quad
d_T = 0\]</div>
<p>回顾 <a class="reference internal" href="#equation-lq-oc0">(57.9)</a>，这些向后推导步骤的最小化结果为</p>
<div class="math notranslate nohighlight" id="equation-lq-oc">
<span class="eqno">(57.14)<a class="headerlink" href="#equation-lq-oc" title="Permalink to this equation">#</a></span>\[u_t  = - F_t x_t
\quad \text{其中} \quad
F_t := (Q + \beta B' P_{t+1} B)^{-1} \beta B' P_{t+1} A\]</div>
<p>这些是我们<a class="reference internal" href="#lq-cp"><span class="std std-ref">上面讨论过的</span></a>线性最优控制策略。</p>
<p>特别是，由<a class="reference internal" href="#equation-lq-oc">(57.14)</a>和<a class="reference internal" href="#equation-lq-lom">(57.1)</a>给出的控制序列解决了我们的有限时域LQ问题。</p>
<p>更准确地说，序列<span class="math notranslate nohighlight">\(u_0, \ldots, u_{T-1}\)</span>由以下式子给出</p>
<div class="math notranslate nohighlight" id="equation-lq-xud">
<span class="eqno">(57.15)<a class="headerlink" href="#equation-lq-xud" title="Permalink to this equation">#</a></span>\[u_t = - F_t x_t
\quad \text{with} \quad
x_{t+1} = (A - BF_t) x_t + C w_{t+1}\]</div>
<p>对于<span class="math notranslate nohighlight">\(t = 0, \ldots, T-1\)</span>，在我们的约束条件下实现了<a class="reference internal" href="#equation-lq-object">(57.6)</a>的最小值。</p>
</section>
</section>
<section id="id18">
<h2><a class="toc-backref" href="#id37"><span class="section-number">57.4. </span>实现</a><a class="headerlink" href="#id18" title="Permalink to this heading">#</a></h2>
<p>我们将使用<a class="reference external" href="http://quantecon.org/quantecon-py">QuantEcon.py</a>中的<a class="reference external" href="https://github.com/QuantEcon/QuantEcon.py/blob/master/quantecon/lqcontrol.py">lqcontrol.py</a>代码来求解有限和无限时域线性二次控制问题。</p>
<p>在该模块中，各种更新、模拟和不动点方法被封装在一个名为<code class="docutils literal notranslate"><span class="pre">LQ</span></code>的类中，包括</p>
<ul class="simple">
<li><p>实例数据：</p>
<ul>
<li><p>所需参数<span class="math notranslate nohighlight">\(Q, R, A, B\)</span>和可选参数<span class="math notranslate nohighlight">\(C, \beta, T, R_f, N\)</span>用于指定给定的LQ模型</p></li>
</ul>
</li>
<li><p>在无限视界情况下，将 <span class="math notranslate nohighlight">\(T\)</span> 和 <span class="math notranslate nohighlight">\(R_f\)</span> 设为 <code class="docutils literal notranslate"><span class="pre">None</span></code></p></li>
<li><p>在确定性情况下，将 <code class="docutils literal notranslate"><span class="pre">C</span> <span class="pre">=</span> <span class="pre">None</span></code>（或零）</p></li>
<li><p>值函数和策略数据</p>
<ul>
<li><p>有限视界情况下的 <span class="math notranslate nohighlight">\(d_t, P_t, F_t\)</span></p></li>
<li><p>无限视界情况下的 <span class="math notranslate nohighlight">\(d, P, F\)</span></p></li>
</ul>
</li>
<li><p>方法：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">update_values</span></code> — 通过 <a class="reference internal" href="#equation-lq-pr">(57.12)</a>、<a class="reference internal" href="#equation-lq-dd">(57.13)</a> 和 <a class="reference internal" href="#equation-lq-oc">(57.14)</a> 将 <span class="math notranslate nohighlight">\(d_t, P_t, F_t\)</span> 更新为它们在 <span class="math notranslate nohighlight">\(t-1\)</span> 时的值</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stationary_values</span></code> — 计算无限视界情况下的 <span class="math notranslate nohighlight">\(P, d, F\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">compute_sequence</span></code> —- 给定 <span class="math notranslate nohighlight">\(x_0\)</span> 并假设标准正态冲击，模拟 <span class="math notranslate nohighlight">\(x_t, u_t, w_t\)</span> 的动态</p></li>
</ul>
</li>
</ul>
<section id="lq-mfpa">
<span id="id19"></span><h3><span class="section-number">57.4.1. </span>一个应用<a class="headerlink" href="#lq-mfpa" title="Permalink to this heading">#</a></h3>
<p>早期凯恩斯模型假设家庭从当前收入中的边际消费倾向是恒定的。</p>
<p>数据与边际消费倾向的恒定性相矛盾。</p>
<p>作为回应，米尔顿·弗里德曼、弗兰科·莫迪利亚尼等人基于消费者对跨期平滑消费流的偏好构建了模型。</p>
<p>(参见<span id="id20">[<a class="reference internal" href="zreferences.html#id164" title="M. Friedman. A Theory of the Consumption Function. Princeton University Press, 1956.">Friedman, 1956</a>]</span>或<span id="id21">[<a class="reference internal" href="zreferences.html#id199" title="F. Modigliani and R. Brumberg. Utility analysis and the consumption function: An interpretation of cross-section data. In K.K Kurihara, editor, Post-Keynesian Economics. 1954.">Modigliani and Brumberg, 1954</a>]</span>。)</p>
<p>这些模型的一个特点是家庭通过购买和出售金融资产使消费流比收入流更加平滑。</p>
<p><a class="reference internal" href="#lq-hhp"><span class="std std-ref">上述</span></a>家庭储蓄问题体现了这些观点。</p>
<p>家庭的优化问题是选择一个消费序列以最小化</p>
<div class="math notranslate nohighlight" id="equation-lq-pio">
<span class="eqno">(57.16)<a class="headerlink" href="#equation-lq-pio" title="Permalink to this equation">#</a></span>\[\mathbb E \,
\left\{
    \sum_{t=0}^{T-1} \beta^t (c_t - \bar c)^2 + \beta^T q a_T^2
\right\}\]</div>
<p>受预算约束序列<span class="math notranslate nohighlight">\(a_{t+1} = (1 + r) a_t - c_t + y_t, \ t \geq 0\)</span>的限制。</p>
<p>这里<span class="math notranslate nohighlight">\(q\)</span>是一个较大的正常数，其作用是促使消费者在生命末期将债务目标控制为零。</p>
<p>(没有这样的约束，最优选择就是在每个时期选择<span class="math notranslate nohighlight">\(c_t = \bar c\)</span>，相应地让资产进行调整。)</p>
<p>和之前一样，我们设定 <span class="math notranslate nohighlight">\(y_t = \sigma w_{t+1} + \mu\)</span> 和 <span class="math notranslate nohighlight">\(u_t := c_t - \bar c\)</span>，之后约束条件可以写成 <a class="reference internal" href="#equation-lq-lomwc">(57.2)</a> 的形式。</p>
<p>我们看到这个约束条件可以通过设定 <span class="math notranslate nohighlight">\(x_t = (a_t \; 1)'\)</span> 并使用 <a class="reference internal" href="#equation-lq-lowmc2">(57.4)</a> 中的定义，转化为 LQ 形式 <span class="math notranslate nohighlight">\(x_{t+1} = Ax_t + Bu_t + Cw_{t+1}\)</span>。</p>
<p>为了与这个状态和控制相匹配，目标函数 <a class="reference internal" href="#equation-lq-pio">(57.16)</a> 可以通过选择以下参数写成 <a class="reference internal" href="#equation-lq-object">(57.6)</a> 的形式：</p>
<div class="math notranslate nohighlight">
\[\begin{split}
Q := 1,
\quad
R :=
\left(
\begin{array}{cc}
0 &amp; 0 \\
0 &amp; 0
\end{array}
\right),
\quad \text{和} \quad
R_f :=
\left(
\begin{array}{cc}
q &amp; 0 \\
0 &amp; 0
\end{array}
\right)
\end{split}\]</div>
<p>现在问题已经表达为 LQ 形式，我们可以通过应用 <a class="reference internal" href="#equation-lq-pr">(57.12)</a> 和 <a class="reference internal" href="#equation-lq-oc">(57.14)</a> 来求解。</p>
<p>在生成冲击序列 <span class="math notranslate nohighlight">\(w_1, \ldots, w_T\)</span> 之后，资产和消费的动态可以通过 <a class="reference internal" href="#equation-lq-xud">(57.15)</a> 来模拟。</p>
<p>下图是使用参数 <span class="math notranslate nohighlight">\(r = 0.05, \beta = 1 / (1+ r)\)</span> 计算得出的，</p>
<p>\bar c = 2，\mu = 1，\sigma = 0.25，T = 45<span class="math notranslate nohighlight">\( 和 \)</span>q = 10^6$。</p>
<p>冲击 <span class="math notranslate nohighlight">\(\{w_t\}\)</span> 被设定为独立同分布的标准正态分布。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 模型参数</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">β</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">45</span>
<span class="n">c_bar</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">σ</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">μ</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">q</span> <span class="o">=</span> <span class="mf">1e6</span>

<span class="c1"># 构建为LQ问题</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">Rf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">Rf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">,</span> <span class="o">-</span><span class="n">c_bar</span> <span class="o">+</span> <span class="n">μ</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span>              <span class="mi">1</span><span class="p">]]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span> <span class="mi">0</span><span class="p">]]</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="n">σ</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

<span class="c1"># 计算解并模拟</span>
<span class="n">lq</span> <span class="o">=</span> <span class="n">LQ</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">β</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">Rf</span><span class="o">=</span><span class="n">Rf</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">xp</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="n">wp</span> <span class="o">=</span> <span class="n">lq</span><span class="o">.</span><span class="n">compute_sequence</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>

<span class="c1"># 转换回资产、消费和收入</span>
<span class="n">assets</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>           <span class="c1"># a_t</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">+</span> <span class="n">c_bar</span>    <span class="c1"># c_t</span>
<span class="n">income</span> <span class="o">=</span> <span class="n">σ</span> <span class="o">*</span> <span class="n">wp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">μ</span>  <span class="c1"># y_t</span>

<span class="c1"># 绘制结果</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">.102</span><span class="p">)</span>
<span class="n">legend_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">,</span> <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;expand&#39;</span><span class="p">}</span>
<span class="n">p_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">}</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">income</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;非金融收入&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;消费&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">income</span> <span class="o">-</span> <span class="n">μ</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;累计未预期收入&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">assets</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;资产&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;时间&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_args</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/df109d24a57dd679a2e6dec305783482cf0036300dc743a3d81b31caa76b2259.png" src="_images/df109d24a57dd679a2e6dec305783482cf0036300dc743a3d81b31caa76b2259.png" />
</div>
</div>
<p>顶部面板显示了模拟中消费 <span class="math notranslate nohighlight">\(c_t\)</span> 和收入 <span class="math notranslate nohighlight">\(y_t\)</span> 的时间路径。</p>
<p>正如消费平滑讨论中所预期的那样，消费的时间路径比收入的时间路径要平滑得多。</p>
<p>（但请注意，在生命周期末期，消费变得更加不规则，这是因为零期末资产要求对消费选择的影响更大。）</p>
<p>图中的第二个面板显示，资产 <span class="math notranslate nohighlight">\(a_t\)</span> 的时间路径与累积未预期收入密切相关，后者定义为</p>
<div class="math notranslate nohighlight">
\[
z_t := \sum_{j=0}^t \sigma w_t
\]</div>
<p>一个关键信息是，未预期的意外收益会被储蓄而不是消费，而未预期的负面冲击则通过减少资产来应对。</p>
<p>（同样，由于零期末资产要求，这种关系在生命周期末期也会被打破。）</p>
<p>这些结果对参数变化相对稳健。</p>
<p>例如，让我们把 <span class="math notranslate nohighlight">\(\beta\)</span> 从 <span class="math notranslate nohighlight">\(1 / (1 + r) \approx 0.952\)</span> 增加到 <span class="math notranslate nohighlight">\(0.96\)</span>，同时保持其他参数不变。</p>
<p>这个消费者比之前的更有耐心，因此对后期消费值赋予相对更大的权重。</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 计算解并模拟</span>
<span class="n">lq</span> <span class="o">=</span> <span class="n">LQ</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.96</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">Rf</span><span class="o">=</span><span class="n">Rf</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">xp</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="n">wp</span> <span class="o">=</span> <span class="n">lq</span><span class="o">.</span><span class="n">compute_sequence</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>

<span class="c1"># 转换回资产、消费和收入</span>
<span class="n">assets</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>           <span class="c1"># a_t</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">+</span> <span class="n">c_bar</span>    <span class="c1"># c_t</span>
<span class="n">income</span> <span class="o">=</span> <span class="n">σ</span> <span class="o">*</span> <span class="n">wp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">μ</span>  <span class="c1"># y_t</span>

<span class="c1"># 绘制结果</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">.102</span><span class="p">)</span>
<span class="n">legend_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">,</span> <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;expand&#39;</span><span class="p">}</span>
<span class="n">p_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">}</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">income</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;非金融收入&quot;</span><span class="p">,</span>
             <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;消费&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">income</span> <span class="o">-</span> <span class="n">μ</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s2">&quot;累计未预期收入&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">assets</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;资产&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;时间&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_args</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4454dcdb3539d0e560c11a090f1e024998f29a39a1679d1baee49d9bb03c467a.png" src="_images/4454dcdb3539d0e560c11a090f1e024998f29a39a1679d1baee49d9bb03c467a.png" />
</div>
</div>
<p>现在我们有一个缓慢上升的消费流，以及在中期出现驼峰形状的资产积累来为不断增长的消费提供资金。</p>
<p>然而，基本特征保持不变：相对于收入而言，消费是平滑的，且资产与累积的未预期收入呈强烈的正相关。</p>
</section>
</section>
<section id="id22">
<h2><a class="toc-backref" href="#id38"><span class="section-number">57.5. </span>扩展和评论</a><a class="headerlink" href="#id22" title="Permalink to this heading">#</a></h2>
<p>让我们现在考虑上述LQ问题的一些标准扩展。</p>
<section id="id23">
<h3><span class="section-number">57.5.1. </span>时变参数<a class="headerlink" href="#id23" title="Permalink to this heading">#</a></h3>
<p>在某些情况下，允许<span class="math notranslate nohighlight">\(A, B, C, R\)</span>和<span class="math notranslate nohighlight">\(Q\)</span>依赖于<span class="math notranslate nohighlight">\(t\)</span>可能是可取的。</p>
<p>为了简单起见，我们在下面的实现中选择不处理这个扩展。</p>
<p>然而，这种一般性的损失并不像你最初想象的那么大。</p>
<p>事实上，我们可以通过适当选择状态变量来处理许多具有时变参数的模型。</p>
<p>一个说明在<a class="reference internal" href="#lq-nsi"><span class="std std-ref">下面</span></a>给出。</p>
<p>要了解更多示例和更系统的处理方法，请参见<span id="id24">[<a class="reference internal" href="zreferences.html#id169" title="L P Hansen and T J Sargent. Recursive Models of Dynamic Linear Economies. The Gorman Lectures in Economics. Princeton University Press, 2013.">Hansen and Sargent, 2013</a>]</span>第2.4节。</p>
</section>
<section id="lq-cpt">
<span id="id25"></span><h3><span class="section-number">57.5.2. </span>添加交叉乘积项<a class="headerlink" href="#lq-cpt" title="Permalink to this heading">#</a></h3>
<p>在某些LQ问题中，偏好包含一个交叉乘积项<span class="math notranslate nohighlight">\(u_t' N x_t\)</span>，使得目标函数变为</p>
<div class="math notranslate nohighlight" id="equation-lq-object-cp">
<span class="eqno">(57.17)<a class="headerlink" href="#equation-lq-object-cp" title="Permalink to this equation">#</a></span>\[\mathbb E \,
\left\{
    \sum_{t=0}^{T-1} \beta^t (x_t' R x_t + u_t' Q u_t + 2 u_t' N x_t) + \beta^T x_T' R_f x_T
\right\}\]</div>
<p>我们的结果可以直接扩展到这种情况。</p>
<p><a class="reference internal" href="#equation-lq-pr">(57.12)</a>中的序列<span class="math notranslate nohighlight">\(\{P_t\}\)</span>变为</p>
<div class="math notranslate nohighlight" id="equation-lq-pr-cp">
<span class="eqno">(57.18)<a class="headerlink" href="#equation-lq-pr-cp" title="Permalink to this equation">#</a></span>\[P_{t-1} = R - (\beta B' P_t A + N)'
(Q + \beta B' P_t B)^{-1} (\beta B' P_t A + N) +
\beta A' P_t A
\quad \text{with } \quad
P_T = R_f\]</div>
<p><a class="reference internal" href="#equation-lq-oc">(57.14)</a>中的策略修改为</p>
<div class="math notranslate nohighlight" id="equation-lq-oc-cp">
<span class="eqno">(57.19)<a class="headerlink" href="#equation-lq-oc-cp" title="Permalink to this equation">#</a></span>\[u_t  = - F_t x_t
\quad \text{where} \quad
F_t := (Q + \beta B' P_{t+1} B)^{-1} (\beta B' P_{t+1} A + N)\]</div>
<p>序列<span class="math notranslate nohighlight">\(\{d_t\}\)</span>与<a class="reference internal" href="#equation-lq-dd">(57.13)</a>中保持不变。</p>
<p>我们让感兴趣的读者自行验证这些结果（计算过程虽然冗长但并不特别困难）。</p>
</section>
<section id="lq-ih">
<span id="id26"></span><h3><span class="section-number">57.5.3. </span>无限期限<a class="headerlink" href="#lq-ih" title="Permalink to this heading">#</a></h3>
<p id="index-2">最后，我们考虑无限视界情况，带有<a class="reference internal" href="#lq-cpt"><span class="std std-ref">交叉项</span></a>，动态方程不变，目标函数为</p>
<div class="math notranslate nohighlight" id="equation-lq-object-ih">
<span class="eqno">(57.20)<a class="headerlink" href="#equation-lq-object-ih" title="Permalink to this equation">#</a></span>\[\mathbb E \,
\left\{
    \sum_{t=0}^{\infty} \beta^t (x_t' R x_t + u_t' Q u_t + 2 u_t' N x_t)
\right\}\]</div>
<p>在无限视界情况下，最优策略只有在时间本身是状态向量<span class="math notranslate nohighlight">\(x_t\)</span>的一个分量时才会依赖于时间。</p>
<p>换句话说，存在一个固定矩阵<span class="math notranslate nohighlight">\(F\)</span>，使得对所有<span class="math notranslate nohighlight">\(t\)</span>都有<span class="math notranslate nohighlight">\(u_t = -F x_t\)</span>。</p>
<p>决策规则随时间保持不变是直观的——毕竟，决策者在每个阶段都面临相同的无限视界，只是当前状态在变化。</p>
<p>不出所料，<span class="math notranslate nohighlight">\(P\)</span>和<span class="math notranslate nohighlight">\(d\)</span>也是常数。</p>
<p>稳态矩阵<span class="math notranslate nohighlight">\(P\)</span>是<a class="reference external" href="https://en.wikipedia.org/wiki/Algebraic_Riccati_equation">离散时间代数黎卡提方程</a>的解。</p>
<div class="math notranslate nohighlight" id="equation-lq-pr-ih">
<span id="riccati-equation"></span><span class="eqno">(57.21)<a class="headerlink" href="#equation-lq-pr-ih" title="Permalink to this equation">#</a></span>\[P = R - (\beta B' P A + N)'
(Q + \beta B' P B)^{-1} (\beta B' P A + N) +
\beta A' P A\]</div>
<p>方程 <a class="reference internal" href="#equation-lq-pr-ih">(57.21)</a> 也被称为 <em>LQ 贝尔曼方程</em>，将给定的 <span class="math notranslate nohighlight">\(P\)</span> 映射到 <a class="reference internal" href="#equation-lq-pr-ih">(57.21)</a> 右侧的映射被称为 <em>LQ 贝尔曼算子</em>。</p>
<p>这个模型的平稳最优策略是</p>
<div class="math notranslate nohighlight" id="equation-lq-oc-ih">
<span class="eqno">(57.22)<a class="headerlink" href="#equation-lq-oc-ih" title="Permalink to this equation">#</a></span>\[u  = - F x
\quad \text{其中} \quad
F = (Q + \beta B' P B)^{-1} (\beta B' P A + N)\]</div>
<p><a class="reference internal" href="#equation-lq-dd">(57.13)</a> 中的序列 <span class="math notranslate nohighlight">\(\{d_t\}\)</span> 被常数值替代</p>
<div class="math notranslate nohighlight" id="equation-lq-dd-ih">
<span class="eqno">(57.23)<a class="headerlink" href="#equation-lq-dd-ih" title="Permalink to this equation">#</a></span>\[d
:= \mathop{\mathrm{trace}}(C' P C) \frac{\beta}{1 - \beta}\]</div>
<p>状态按照时间齐次过程 <span class="math notranslate nohighlight">\(x_{t+1} = (A - BF) x_t + C w_{t+1}\)</span> 演化。</p>
<p>一个无限期问题的例子将在<a class="reference internal" href="#lqc-mwac"><span class="std std-ref">下文</span></a> 中讨论。</p>
</section>
<section id="lq-cert-eq">
<span id="id27"></span><h3><span class="section-number">57.5.4. </span>确定性等价<a class="headerlink" href="#lq-cert-eq" title="Permalink to this heading">#</a></h3>
<p>上述类别的线性二次控制问题具有<em>确定性等价</em>的性质。</p>
<p>我们的意思是，最优策略 <span class="math notranslate nohighlight">\(F\)</span> 不受指定冲击过程的参数 <span class="math notranslate nohighlight">\(C\)</span> 的影响。</p>
<p>这一点可以通过检查 <a class="reference internal" href="#equation-lq-oc-ih">(57.22)</a> 或 <a class="reference internal" href="#equation-lq-oc-cp">(57.19)</a> 来确认。</p>
<p>因此，在求解最优行为时我们可以忽略不确定性，而在研究最优状态动态时再将其纳入考虑。</p>
</section>
</section>
<section id="id28">
<h2><a class="toc-backref" href="#id39"><span class="section-number">57.6. </span>进一步应用</a><a class="headerlink" href="#id28" title="Permalink to this heading">#</a></h2>
<section id="lq-nsi">
<span id="id29"></span><h3><span class="section-number">57.6.1. </span>应用1：与年龄相关的收入过程<a class="headerlink" href="#lq-nsi" title="Permalink to this heading">#</a></h3>
<p><a class="reference internal" href="#lq-mfpa"><span class="std std-ref">此前</span></a> 我们研究了一个产生消费平滑的永久收入模型。</p>
<p>该模型一个不切实际的特点是假设随机收入过程的均值不依赖于消费者的年龄。</p>
<p>一个更现实的收入曲线是在职业生涯早期上升，在中期达到顶峰，可能在后期下降，并在退休期间下降更多。</p>
<p>在本节中，我们将使用年龄的多项式函数，将这种上升和下降模拟为一个对称的倒”U”形。</p>
<p>和之前一样，消费者试图最小化</p>
<div class="math notranslate nohighlight" id="equation-lq-pip">
<span class="eqno">(57.24)<a class="headerlink" href="#equation-lq-pip" title="Permalink to this equation">#</a></span>\[\mathbb E \,
\left\{
    \sum_{t=0}^{T-1} \beta^t (c_t - \bar c)^2 + \beta^T q a_T^2
\right\}\]</div>
<p>满足约束条件 <span class="math notranslate nohighlight">\(a_{t+1} = (1 + r) a_t - c_t + y_t, \ t \geq 0\)</span>。</p>
<p>对于收入，我们现在取 <span class="math notranslate nohighlight">\(y_t = p(t) + \sigma w_{t+1}\)</span>，其中 <span class="math notranslate nohighlight">\(p(t) := m_0 + m_1 t + m_2 t^2\)</span>。</p>
<p>(在<a class="reference internal" href="#lq-nsi2"><span class="std std-ref">下一节</span></a>中，我们将使用一些技巧来实现一个更复杂的模型。)</p>
<p>系数 <span class="math notranslate nohighlight">\(m_0, m_1, m_2\)</span> 的选择使得 <span class="math notranslate nohighlight">\(p(0)=0, p(T/2) = \mu,\)</span> 且 <span class="math notranslate nohighlight">\(p(T)=0\)</span>。</p>
<p>你可以确认规格 <span class="math notranslate nohighlight">\(m_0 = 0, m_1 = T \mu / (T/2)^2, m_2 = - \mu / (T/2)^2\)</span> 满足这些约束。</p>
<p>要将其转化为LQ设定，考虑预算约束，它变为</p>
<div class="math notranslate nohighlight" id="equation-lq-hib">
<span class="eqno">(57.25)<a class="headerlink" href="#equation-lq-hib" title="Permalink to this equation">#</a></span>\[a_{t+1} = (1 + r) a_t - u_t - \bar c + m_1 t + m_2 t^2 + \sigma w_{t+1}\]</div>
<p>由于 <span class="math notranslate nohighlight">\(a_{t+1}\)</span> 是 <span class="math notranslate nohighlight">\((a_t, 1, t, t^2)\)</span> 的线性函数，这提示我们将这四个变量作为状态向量 <span class="math notranslate nohighlight">\(x_t\)</span>。</p>
<p>一旦选定了合适的状态和控制（回想 <span class="math notranslate nohighlight">\(u_t = c_t - \bar c\)</span>）</p>
<p>完成这些设置后，其余规格就相对容易确定了。</p>
<p>因此，对于动态系统，我们设定</p>
<div class="math notranslate nohighlight" id="equation-lq-lowmc3">
<span class="eqno">(57.26)<a class="headerlink" href="#equation-lq-lowmc3" title="Permalink to this equation">#</a></span>\[\begin{split}x_t :=
\left(
\begin{array}{c}
a_t \\
1 \\
t \\
t^2
\end{array}
\right),
\quad
A :=
\left(
\begin{array}{cccc}
1 + r &amp; -\bar c &amp; m_1 &amp; m_2 \\
0     &amp; 1       &amp; 0   &amp; 0   \\
0     &amp; 1       &amp; 1   &amp; 0   \\
0     &amp; 1       &amp; 2   &amp; 1
\end{array}
\right),
\quad
B :=
\left(
\begin{array}{c}
-1 \\
0 \\
0 \\
0
\end{array}
\right),
\quad
C :=
\left(
\begin{array}{c}
\sigma \\
0 \\
0 \\
0
\end{array}
\right)\end{split}\]</div>
<p>如果你使用这个规格展开表达式 <span class="math notranslate nohighlight">\(x_{t+1} = A x_t + B u_t + C w_{t+1}\)</span>，你会发现资产按照期望的方式遵循<a class="reference internal" href="#equation-lq-hib">(57.25)</a>，且其他状态变量也会适当更新。</p>
<p>为了实现偏好规格<a class="reference internal" href="#equation-lq-pip">(57.24)</a>，我们取</p>
<div class="math notranslate nohighlight" id="equation-lq-4sp">
<span class="eqno">(57.27)<a class="headerlink" href="#equation-lq-4sp" title="Permalink to this equation">#</a></span>\[ \begin{align}\begin{aligned}\begin{split}Q := 1,
\quad
R :=
\left(
\begin{array}{cccc}
0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0
\end{array}
\right)\end{split}\\\begin{split}\quad \text{和} \quad
R_f :=
\left(
\begin{array}{cccc}
q &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0
\end{array}
\right)\end{split}\end{aligned}\end{align} \]</div>
<p>下图显示了使用<code class="docutils literal notranslate"><span class="pre">lqcontrol.py</span></code>中的<code class="docutils literal notranslate"><span class="pre">compute_sequence</span></code>方法计算的消费和资产的模拟结果，初始资产设为零。</p>
<figure class="align-default" id="solution-lqc-ex1-fig">
<img alt="_images/solution_lqc_ex1.png" src="_images/solution_lqc_ex1.png" />
</figure>
<p>再次可以看到，平滑消费是样本路径的一个主要特征。</p>
<p>资产路径展现出与标准生命周期理论相一致的动态特征。</p>
<p><a class="reference internal" href="#lqc_ex1"><span class="std std-numref">Exercise 57.1</span></a>给出了此处使用的完整参数集，并要求你复现该图。</p>
</section>
<section id="lq-nsi2">
<span id="id30"></span><h3><span class="section-number">57.6.2. </span>应用2：包含退休的永久收入模型<a class="headerlink" href="#lq-nsi2" title="Permalink to this heading">#</a></h3>
<p>在<a class="reference internal" href="#lq-nsi"><span class="std std-ref">前一个应用</span></a>中，我们使用多项式生成了一个倒U形的收入动态，并将其置于LQ框架中。</p>
<p>可以说，这个收入过程仍然包含一些不切实际的特征。</p>
<p>更常见的收入模式是</p>
<ol class="arabic simple">
<li><p>收入在工作生涯中增长，围绕着上升趋势波动，在晚年增长趋势趋于平缓</p></li>
<li><p>退休后，收入较低但相对稳定（非金融收入）</p></li>
</ol>
<p>令<span class="math notranslate nohighlight">\(K\)</span>为退休日期，我们可以用以下方式表达这些收入动态</p>
<div class="math notranslate nohighlight" id="equation-lq-cases">
<span class="eqno">(57.28)<a class="headerlink" href="#equation-lq-cases" title="Permalink to this equation">#</a></span>\[\begin{split}y_t =
\begin{cases}
p(t) + \sigma w_{t+1} &amp; \quad \text{if } t \leq K  \\
s                     &amp; \quad \text{otherwise }
\end{cases}\end{split}\]</div>
<p>这里</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(p(t) := m_1 t + m_2 t^2\)</span>，其中系数<span class="math notranslate nohighlight">\(m_1, m_2\)</span>的选择使得<span class="math notranslate nohighlight">\(p(K) = \mu\)</span>且<span class="math notranslate nohighlight">\(p(0) = p(2K)=0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(s\)</span>是退休收入</p></li>
</ul>
<p>我们假设偏好保持不变，由<a class="reference internal" href="#equation-lq-pio">(57.16)</a>给出。</p>
<p>预算约束也保持不变，由<span class="math notranslate nohighlight">\(a_{t+1} = (1 + r) a_t - c_t + y_t\)</span>给出。</p>
<p>我们的目标是解决这个问题，并使用本讲中描述的LQ技术模拟路径。</p>
<p>事实上，这是一个不简单的问题，因为在 <span class="math notranslate nohighlight">\(K\)</span> 处动态方程<a class="reference internal" href="#equation-lq-cases">(57.28)</a>的拐点使得很难将运动规律表示为固定系数的线性系统。</p>
<p>然而，我们仍然可以通过适当地连接两个组成部分的LQ问题来使用我们的LQ方法。</p>
<p>这两个LQ问题分别描述了消费者在工作期间(<code class="docutils literal notranslate"><span class="pre">lq_working</span></code>)和退休期间(<code class="docutils literal notranslate"><span class="pre">lq_retired</span></code>)的行为。</p>
<p>(这是可行的，因为在生命的这两个不同阶段，各自的收入过程[多项式趋势和常数]都符合LQ框架。)</p>
<p>基本思路是，尽管整个问题不是单一的时不变LQ问题，但它仍然是一个动态规划问题，因此我们可以在每个阶段使用适当的贝尔曼方程。</p>
<p>基于这个逻辑，我们可以：</p>
<ol class="arabic simple">
<li><p>通过常规的向后归纳程序求解<code class="docutils literal notranslate"><span class="pre">lq_retired</span></code>，从退休结束时向退休开始时迭代。</p></li>
<li><p>将通过此过程生成的退休初始值函数作为终端条件 <span class="math notranslate nohighlight">\(R_f\)</span>，输入到 <code class="docutils literal notranslate"><span class="pre">lq_working</span></code> 规范中。</p></li>
<li><p>从这个选定的 <span class="math notranslate nohighlight">\(R_f\)</span> 开始，通过向后归纳法求解 <code class="docutils literal notranslate"><span class="pre">lq_working</span></code>，一直迭代回工作生涯开始时。</p></li>
</ol>
<p>这个过程给出了整个生命周期的值函数序列和最优策略。</p>
<p>下图显示了基于这个程序的一个模拟结果。</p>
<figure class="align-default" id="solution-lqc-ex2-fig">
<img alt="_images/solution_lqc_ex2.png" src="_images/solution_lqc_ex2.png" />
</figure>
<p>模拟中使用的完整参数集在<a class="reference internal" href="#lqc_ex2"><span class="std std-numref">Exercise 57.2</span></a>中讨论，那里要求你重现这个图形。</p>
<p>再次强调，在模拟中可以观察到的主要特征是消费平滑。</p>
<p>资产路径与标准生命周期理论相符，表现为生命早期的负储蓄，随后转为储蓄。</p>
<p>资产在退休时达到峰值，之后逐渐下降。</p>
</section>
<section id="lqc-mwac">
<span id="id31"></span><h3><span class="section-number">57.6.3. </span>应用3：具有调整成本的垄断<a class="headerlink" href="#lqc-mwac" title="Permalink to this heading">#</a></h3>
<p>考虑一个面临随机逆需求函数的垄断者</p>
<div class="math notranslate nohighlight">
\[
p_t = a_0 - a_1 q_t + d_t
\]</div>
<p>这里<span class="math notranslate nohighlight">\(q_t\)</span>是产量，需求冲击<span class="math notranslate nohighlight">\(d_t\)</span>遵循</p>
<div class="math notranslate nohighlight">
\[
d_{t+1} = \rho d_t + \sigma w_{t+1}
\]</div>
<p>其中<span class="math notranslate nohighlight">\(\{w_t\}\)</span>是独立同分布的标准正态分布。</p>
<p>垄断者最大化当前和未来利润的期望贴现和</p>
<div class="math notranslate nohighlight" id="equation-lq-object-mp">
<span class="eqno">(57.29)<a class="headerlink" href="#equation-lq-object-mp" title="Permalink to this equation">#</a></span>\[\mathbb E \,
\left\{
    \sum_{t=0}^{\infty} \beta^t
    \pi_t
\right\}
\quad \text{where} \quad
\pi_t := p_t q_t - c q_t - \gamma (q_{t+1} - q_t)^2\]</div>
<p>这里</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\gamma (q_{t+1} - q_t)^2\)</span>表示调整成本</p></li>
<li><p><span class="math notranslate nohighlight">\(c\)</span>是平均生产成本</p></li>
</ul>
<p>这可以被表述为一个LQ问题，然后求解和模拟，
但首先让我们研究这个问题并试图获得一些直观认识。</p>
<p>思考这个问题的一种方式是考虑如果<span class="math notranslate nohighlight">\(\gamma = 0\)</span>会发生什么。</p>
<p>没有调整成本就没有跨期权衡，所以
垄断者将在每个时期选择产量以最大化当期利润。</p>
<p>不难证明利润最大化的产出为</p>
<div class="math notranslate nohighlight">
\[
\bar q_t := \frac{a_0 - c + d_t}{2 a_1}
\]</div>
<p>根据这个讨论，对于一般的<span class="math notranslate nohighlight">\(\gamma\)</span>值，我们可以预期：</p>
<ul class="simple">
<li><p>如果<span class="math notranslate nohighlight">\(\gamma\)</span>接近零，那么<span class="math notranslate nohighlight">\(q_t\)</span>会相对紧密地跟踪<span class="math notranslate nohighlight">\(\bar q_t\)</span>的时间路径。</p></li>
<li><p>如果<span class="math notranslate nohighlight">\(\gamma\)</span>较大，那么<span class="math notranslate nohighlight">\(q_t\)</span>会比<span class="math notranslate nohighlight">\(\bar q_t\)</span>更平滑，因为垄断者试图避免调整成本。</p></li>
</ul>
<p>这种直觉是正确的。</p>
<p>以下图表显示了通过求解相应的LQ问题所产生的模拟结果。</p>
<p>这些图表之间的参数唯一区别是<span class="math notranslate nohighlight">\(\gamma\)</span>的大小</p>
<figure class="align-default">
<img alt="_images/solution_lqc_ex3_g1.png" src="_images/solution_lqc_ex3_g1.png" />
</figure>
<figure class="align-default">
<img alt="_images/solution_lqc_ex3_g10.png" src="_images/solution_lqc_ex3_g10.png" />
</figure>
<figure class="align-default">
<img alt="_images/solution_lqc_ex3_g50.png" src="_images/solution_lqc_ex3_g50.png" />
</figure>
<p>为了生成这些图表，我们将垄断者问题转换为LQ问题。</p>
<p>这种转换的关键在于选择正确的状态 — 这有点像一门艺术。</p>
<p>这里我们取<span class="math notranslate nohighlight">\(x_t = (\bar q_t \;\, q_t \;\, 1)'\)</span>，而控制变量选择为<span class="math notranslate nohighlight">\(u_t = q_{t+1} - q_t\)</span>。</p>
<p>我们还对利润函数做了轻微调整。</p>
<p>在<a class="reference internal" href="#equation-lq-object-mp">(57.29)</a>中，当期利润为<span class="math notranslate nohighlight">\(\pi_t := p_t q_t - c q_t - \gamma (q_{t+1} - q_t)^2\)</span>。</p>
<p>现在让我们在<a class="reference internal" href="#equation-lq-object-mp">(57.29)</a>中用<span class="math notranslate nohighlight">\(\hat \pi_t := \pi_t - a_1 \bar q_t^2\)</span>替换<span class="math notranslate nohighlight">\(\pi_t\)</span>。</p>
<p>这对解决方案没有影响，因为<span class="math notranslate nohighlight">\(a_1 \bar q_t^2\)</span>不依赖于控制变量。</p>
<p>（实际上，我们只是在<a class="reference internal" href="#equation-lq-object-mp">(57.29)</a>中添加了一个常数项，而优化器不受常数项影响。）</p>
<p>进行这种替换的原因是，正如你将能够验证的那样，<span class="math notranslate nohighlight">\(\hat \pi_t\)</span>可以简化为简单的二次形式</p>
<div class="math notranslate nohighlight">
\[
\hat \pi_t = -a_1 (q_t - \bar q_t)^2 - \gamma u_t^2
\]</div>
<p>在转换为最小化问题后（通过取负），目标函数变为</p>
<div class="math notranslate nohighlight" id="equation-lq-object-mp2">
<span class="eqno">(57.30)<a class="headerlink" href="#equation-lq-object-mp2" title="Permalink to this equation">#</a></span>\[ \begin{align}\begin{aligned}\min
\mathbb E \,\\\sum_{t=0}^{\infty} \beta^t
\left\{
    a_1 ( q_t - \bar q_t)^2 + \gamma u_t^2
\right\}\end{aligned}\end{align} \]</div>
<p>现在找到 <span class="math notranslate nohighlight">\(R\)</span> 和 <span class="math notranslate nohighlight">\(Q\)</span> 使得<a class="reference internal" href="#equation-lq-object-mp2">(57.30)</a>可以写成<a class="reference internal" href="#equation-lq-object-ih">(57.20)</a>的形式相对简单。</p>
<p>此外，通过写出状态每个元素的动态方程，可以找到<a class="reference internal" href="#equation-lq-lom">(57.1)</a>中的矩阵 <span class="math notranslate nohighlight">\(A, B\)</span> 和 <span class="math notranslate nohighlight">\(C\)</span>。</p>
<p><a class="reference internal" href="#lqc_ex3"><span class="std std-numref">Exercise 57.3</span></a>要求你完成这个过程，并重现前面的图表。</p>
</section>
</section>
<section id="id32">
<h2><a class="toc-backref" href="#id40"><span class="section-number">57.7. </span>练习</a><a class="headerlink" href="#id32" title="Permalink to this heading">#</a></h2>
<div class="exercise admonition" id="lqc_ex1">

<p class="admonition-title"><span class="caption-number">Exercise 57.1 </span></p>
<section id="exercise-content">
<p>复现上面<a class="reference internal" href="#solution-lqc-ex1-fig"><span class="std std-ref">所示</span></a>的多项式收入图。</p>
<p>参数为 <span class="math notranslate nohighlight">\(r = 0.05, \beta = 1 / (1 + r), \bar c = 1.5,  \mu = 2, \sigma = 0.15, T = 50\)</span> 和 <span class="math notranslate nohighlight">\(q = 10^4\)</span>。</p>
</section>
</div>
<div class="solution dropdown admonition" id="lqcontrol-solution-1">

<p class="admonition-title">Solution to<a class="reference internal" href="#lqc_ex1"> Exercise 57.1</a></p>
<section id="solution-content">
<p>这是一个解决方案。</p>
<p>我们使用一些高级绘图命令来获得特定的样式 — 你可以使用更简单的命令。</p>
<p>这个模型是一个具有驼峰形收入的LQ永久收入/生命周期模型</p>
<div class="math notranslate nohighlight">
\[
y_t = m_1 t + m_2 t^2 + \sigma w_{t+1}
\]</div>
<p>其中 <span class="math notranslate nohighlight">\(\{w_t\}\)</span> 是独立同分布的 <span class="math notranslate nohighlight">\(N(0, 1)\)</span> 随机变量，系数 <span class="math notranslate nohighlight">\(m_1\)</span> 和 <span class="math notranslate nohighlight">\(m_2\)</span> 的选择使得 <span class="math notranslate nohighlight">\(p(t) = m_1 t + m_2 t^2\)</span> 呈现倒 U 形，且满足：</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(p(0) = 0, p(T/2) = \mu\)</span>，以及</p></li>
<li><p><span class="math notranslate nohighlight">\(p(T) = 0\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 模型参数</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">β</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">c_bar</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">σ</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">μ</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">q</span> <span class="o">=</span> <span class="mf">1e4</span>
<span class="n">m1</span> <span class="o">=</span> <span class="n">T</span> <span class="o">*</span> <span class="p">(</span><span class="n">μ</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">m2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">μ</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># 构建为 LQ 问题</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">Rf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">Rf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">,</span> <span class="o">-</span><span class="n">c_bar</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">1</span><span class="p">]]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">]]</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="n">σ</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

<span class="c1"># 计算解并模拟</span>
<span class="n">lq</span> <span class="o">=</span> <span class="n">LQ</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">β</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">Rf</span><span class="o">=</span><span class="n">Rf</span><span class="p">)</span>
<span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">xp</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="n">wp</span> <span class="o">=</span> <span class="n">lq</span><span class="o">.</span><span class="n">compute_sequence</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>

<span class="c1"># 将结果转换回资产、消费和收入</span>
<span class="n">ap</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>               <span class="c1"># 资产</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">+</span> <span class="n">c_bar</span>    <span class="c1"># 消费</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">income</span> <span class="o">=</span> <span class="n">σ</span> <span class="o">*</span> <span class="n">wp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">m1</span> <span class="o">*</span> <span class="n">time</span> <span class="o">+</span> <span class="n">m2</span> <span class="o">*</span> <span class="n">time</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># 收入</span>


<span class="c1"># 绘制结果</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">.102</span><span class="p">)</span>
<span class="n">legend_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">,</span> <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;expand&#39;</span><span class="p">}</span>
<span class="n">p_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">}</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">income</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;非金融收入&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;消费&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">ap</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;资产&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;时间&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_args</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/af1dde820d61520e2af61c4dada34f8ccfb9ad538e2f861820ecab577aa0a203.png" src="_images/af1dde820d61520e2af61c4dada34f8ccfb9ad538e2f861820ecab577aa0a203.png" />
</div>
</div>
</section>
</div>
<div class="exercise admonition" id="lqc_ex2">

<p class="admonition-title"><span class="caption-number">Exercise 57.2 </span></p>
<section id="exercise-content">
<p>复现上面<a class="reference internal" href="#solution-lqc-ex2-fig"><span class="std std-ref">所示的工作和退休图表</span></a>。</p>
<p>参数为 <span class="math notranslate nohighlight">\(r = 0.05, \beta = 1 / (1 + r), \bar c = 4,  \mu = 4, \sigma = 0.35, K = 40, T = 60, s = 1\)</span> 和 <span class="math notranslate nohighlight">\(q = 10^4\)</span>。</p>
<p>要理解整体过程,请仔细阅读包含该图表的章节。</p>
<div class="dropdown admonition hint">
<p class="admonition-title">Hint</p>
<p>首先,为了使我们的方法有效,我们必须确保两个LQ问题具有相同的状态变量和控制变量。</p>
<p>与之前的应用一样,控制变量可以设置为 <span class="math notranslate nohighlight">\(u_t = c_t - \bar c\)</span>。</p>
<p>对于<code class="docutils literal notranslate"><span class="pre">lq_working</span></code>, <span class="math notranslate nohighlight">\(x_t, A, B, C\)</span> 可以按照<a class="reference internal" href="#equation-lq-lowmc3">(57.26)</a>中的方式选择。</p>
<ul class="simple">
<li><p>请记住,选择 <span class="math notranslate nohighlight">\(m_1, m_2\)</span> 使得 <span class="math notranslate nohighlight">\(p(K) = \mu\)</span> 且 <span class="math notranslate nohighlight">\(p(2K)=0\)</span>。</p></li>
</ul>
<p>对于<code class="docutils literal notranslate"><span class="pre">lq_retired</span></code>,使用相同的 <span class="math notranslate nohighlight">\(x_t\)</span> 和 <span class="math notranslate nohighlight">\(u_t\)</span> 定义,但修改 <span class="math notranslate nohighlight">\(A, B, C\)</span> 以对应固定收入 <span class="math notranslate nohighlight">\(y_t = s\)</span>。</p>
<p>对于<code class="docutils literal notranslate"><span class="pre">lq_retired</span></code>,按照<a class="reference internal" href="#equation-lq-4sp">(57.27)</a>设置偏好。</p>
<p>对于<code class="docutils literal notranslate"><span class="pre">lq_working</span></code>,偏好相同,除了 <span class="math notranslate nohighlight">\(R_f\)</span> 应该</p>
<p>被退休时期通过迭代<code class="docutils literal notranslate"><span class="pre">lq_retired</span></code>得到的最终值函数所替代。</p>
<p>通过仔细处理,可以将这两个独立模型的模拟结果拼接在一起生成完整的模拟。</p>
</div>
</section>
</div>
<div class="solution dropdown admonition" id="lqcontrol-solution-3">

<p class="admonition-title">Solution to<a class="reference internal" href="#lqc_ex2"> Exercise 57.2</a></p>
<section id="solution-content">
<p>这是一个永久收入/生命周期模型,工作期间收入呈多项式增长,退休后收入固定。</p>
<p>该模型通过组合两个LQ规划问题来求解,正如讲座中所述。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 模型参数</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">β</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">K</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">c_bar</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">σ</span> <span class="o">=</span> <span class="mf">0.35</span>
<span class="n">μ</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">q</span> <span class="o">=</span> <span class="mf">1e4</span>
<span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">m1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">μ</span><span class="o">/</span><span class="n">K</span>
<span class="n">m2</span> <span class="o">=</span> <span class="o">-</span><span class="n">μ</span><span class="o">/</span><span class="n">K</span><span class="o">**</span><span class="mi">2</span>

<span class="c1"># 构建LQ问题1(退休期)</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">Rf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">Rf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">,</span> <span class="n">s</span> <span class="o">-</span> <span class="n">c_bar</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>             <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">]]</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

<span class="c1"># 为退休人员初始化LQ实例</span>
<span class="n">lq_retired</span> <span class="o">=</span> <span class="n">LQ</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">β</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="o">-</span><span class="n">K</span><span class="p">,</span> <span class="n">Rf</span><span class="o">=</span><span class="n">Rf</span><span class="p">)</span>
<span class="c1"># 迭代回退休开始时,记录最终值函数</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="n">K</span><span class="p">):</span>
    <span class="n">lq_retired</span><span class="o">.</span><span class="n">update_values</span><span class="p">()</span>
<span class="n">Rf2</span> <span class="o">=</span> <span class="n">lq_retired</span><span class="o">.</span><span class="n">P</span>

<span class="c1"># 构建LQ问题2(工作期)</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">,</span> <span class="o">-</span><span class="n">c_bar</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>          <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">1</span><span class="p">]]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span> <span class="mi">0</span><span class="p">]]</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="n">σ</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

<span class="c1"># 使用lq_retired的终值Rf设置工作期LQ实例</span>
<span class="n">lq_working</span> <span class="o">=</span> <span class="n">LQ</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">β</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">Rf</span><span class="o">=</span><span class="n">Rf2</span><span class="p">)</span>

<span class="c1"># 模拟工作期状态/控制路径</span>
<span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">xp_w</span><span class="p">,</span> <span class="n">up_w</span><span class="p">,</span> <span class="n">wp_w</span> <span class="o">=</span> <span class="n">lq_working</span><span class="o">.</span><span class="n">compute_sequence</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="c1"># 模拟退休期路径(注意初始条件)</span>
<span class="n">xp_r</span><span class="p">,</span> <span class="n">up_r</span><span class="p">,</span> <span class="n">wp_r</span> <span class="o">=</span> <span class="n">lq_retired</span><span class="o">.</span><span class="n">compute_sequence</span><span class="p">(</span><span class="n">xp_w</span><span class="p">[:,</span> <span class="n">K</span><span class="p">])</span>

<span class="c1"># 将结果转换回资产、消费和收入</span>
<span class="n">xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">xp_w</span><span class="p">,</span> <span class="n">xp_r</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]))</span>
<span class="n">assets</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>                  <span class="c1"># 资产</span>

<span class="n">up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">up_w</span><span class="p">,</span> <span class="n">up_r</span><span class="p">))</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">up</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">+</span> <span class="n">c_bar</span>           <span class="c1"># 消费</span>

<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">income_w</span> <span class="o">=</span> <span class="n">σ</span> <span class="o">*</span> <span class="n">wp_w</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">m1</span> <span class="o">*</span> <span class="n">time</span> <span class="o">+</span> <span class="n">m2</span> <span class="o">*</span> <span class="n">time</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># 收入</span>
<span class="n">income_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="n">K</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="n">income</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">income_w</span><span class="p">,</span> <span class="n">income_r</span><span class="p">))</span>

<span class="c1"># 绘制结果</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">.102</span><span class="p">)</span>
<span class="n">legend_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">,</span> <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;expand&#39;</span><span class="p">}</span>
<span class="n">p_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">}</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">income</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;非金融收入&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">c</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;消费&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">assets</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;资产&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">p_args</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;时间&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_args</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/52b13cca38c77a23788f403022f2a978fce9a549e0752b988ee8cbd1ea7eb530.png" src="_images/52b13cca38c77a23788f403022f2a978fce9a549e0752b988ee8cbd1ea7eb530.png" />
</div>
</div>
</section>
</div>
<div class="exercise admonition" id="lqc_ex3">

<p class="admonition-title"><span class="caption-number">Exercise 57.3 </span></p>
<section id="exercise-content">
<p>复现上述垄断者应用中的图形 <a class="reference internal" href="#lqc-mwac"><span class="std std-ref">given above</span></a>。</p>
<p>参数设置为 <span class="math notranslate nohighlight">\(a_0 = 5, a_1 = 0.5, \sigma = 0.15, \rho = 0.9,
\beta = 0.95\)</span> 和 <span class="math notranslate nohighlight">\(c = 2\)</span>，而 <span class="math notranslate nohighlight">\(\gamma\)</span> 在1到50之间变化
(参见图形)。</p>
</section>
</div>
<div class="solution dropdown admonition" id="lqcontrol-solution-5">

<p class="admonition-title">Solution to<a class="reference internal" href="#lqc_ex3"> Exercise 57.3</a></p>
<section id="solution-content">
<p>第一个任务是找到定义LQ问题的矩阵 <span class="math notranslate nohighlight">\(A, B, C, Q, R\)</span>。</p>
<p>回顾一下 <span class="math notranslate nohighlight">\(x_t = (\bar q_t \;\, q_t \;\, 1)'\)</span>，而
<span class="math notranslate nohighlight">\(u_t = q_{t+1} - q_t\)</span>。</p>
<p>令 <span class="math notranslate nohighlight">\(m_0 := (a_0 - c) / 2a_1\)</span> 且 <span class="math notranslate nohighlight">\(m_1 := 1 / 2 a_1\)</span>，我们
可以写成 <span class="math notranslate nohighlight">\(\bar q_t = m_0 + m_1 d_t\)</span>，然后经过一些
推导</p>
<div class="math notranslate nohighlight">
\[
\bar q_{t+1} = m_0 (1 - \rho) + \rho \bar q_t + m_1 \sigma w_{t+1}
\]</div>
<p>根据我们对 <span class="math notranslate nohighlight">\(u_t\)</span> 的定义，<span class="math notranslate nohighlight">\(q_t\)</span> 的动态方程为
<span class="math notranslate nohighlight">\(q_{t+1} = q_t + u_t\)</span>。</p>
<p>使用这些事实，你应该能够构建正确的
<span class="math notranslate nohighlight">\(A, B, C\)</span> 矩阵（然后与下面解决方案代码中的矩阵进行对照）。</p>
<p>通过检查目标函数可以找到合适的 <span class="math notranslate nohighlight">\(R, Q\)</span> 矩阵，为方便起见，我们在此重复该目标函数：</p>
<div class="math notranslate nohighlight">
\[
\min
\mathbb E \,
\left\{
    \sum_{t=0}^{\infty} \beta^t
    a_1 ( q_t - \bar q_t)^2 + \gamma u_t^2
\right\}
\]</div>
<p>我们的解决方案代码如下：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 模型参数</span>
<span class="n">a0</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">a1</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">σ</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">ρ</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">γ</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">β</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">120</span>

<span class="c1"># 有用的常数</span>
<span class="n">m0</span> <span class="o">=</span> <span class="p">(</span><span class="n">a0</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a1</span><span class="p">)</span>
<span class="n">m1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a1</span><span class="p">)</span>

<span class="c1"># 构建LQ问题</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">γ</span>
<span class="n">R</span> <span class="o">=</span> <span class="p">[[</span> <span class="n">a1</span><span class="p">,</span> <span class="o">-</span><span class="n">a1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="o">-</span><span class="n">a1</span><span class="p">,</span>  <span class="n">a1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">]]</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ρ</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ρ</span><span class="p">)],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>            <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>            <span class="mi">1</span><span class="p">]]</span>

<span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[[</span><span class="n">m1</span> <span class="o">*</span> <span class="n">σ</span><span class="p">],</span>
     <span class="p">[</span>     <span class="mi">0</span><span class="p">],</span>
     <span class="p">[</span>     <span class="mi">0</span><span class="p">]]</span>

<span class="n">lq</span> <span class="o">=</span> <span class="n">LQ</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">β</span><span class="p">)</span>

<span class="c1"># 模拟状态/控制路径</span>
<span class="n">x0</span> <span class="o">=</span> <span class="p">(</span><span class="n">m0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">xp</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="n">wp</span> <span class="o">=</span> <span class="n">lq</span><span class="o">.</span><span class="n">compute_sequence</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">ts_length</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">q_bar</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">xp</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

<span class="c1"># 绘制模拟结果</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">))</span>

<span class="c1"># 一些复杂的绘图设置 -- 如果你愿意可以简化</span>
<span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">.101</span><span class="p">)</span>
<span class="n">legend_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bbox_to_anchor&#39;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">,</span> <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;expand&#39;</span><span class="p">}</span>
<span class="n">p_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">}</span>

<span class="n">time</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;时间&#39;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">time</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">q_bar</span><span class="p">,</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\bar q_t$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$q_t$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">legend_args</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;动态过程，其中 $\gamma = </span><span class="si">{</span><span class="n">γ</span><span class="si">}</span><span class="s1">$&#39;</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">q_bar</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">s</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;&gt;:52: SyntaxWarning: invalid escape sequence &#39;\g&#39;
&lt;&gt;:52: SyntaxWarning: invalid escape sequence &#39;\g&#39;
/tmp/ipykernel_9644/2441664554.py:52: SyntaxWarning: invalid escape sequence &#39;\g&#39;
  s = f&#39;动态过程，其中 $\gamma = {γ}$&#39;
</pre></div>
</div>
<img alt="_images/6f1bade16235709a65d3dfabb950b54f13e2675f338f3900f1269be489b47d02.png" src="_images/6f1bade16235709a65d3dfabb950b54f13e2675f338f3900f1269be489b47d02.png" />
</div>
</div>
</section>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                    <p>A theme by <a href="https://quantecon.org">QuantEcon</a></p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  工具与技术
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="sir_model.html">
   1. 新冠病毒建模
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_algebra.html">
   2. 线性代数
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="qr_decomp.html">
   3. QR分解
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="eig_circulant.html">
   4. 循环矩阵
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="svd_intro.html">
   5. 奇异值分解（SVD）
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="var_dmd.html">
   6. 向量自回归和动态模态分解
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="newton_method.html">
   7. 使用牛顿法求解经济模型
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  基础统计学
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="prob_matrix.html">
   8. 基础概率论与矩阵
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lln_clt.html">
   9. 大数定律 和 中心极限定理
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="prob_meaning.html">
   10. 概率的两种含义
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multi_hyper.html">
   11. 多元超几何分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multivariate_normal.html">
   12. 多元正态分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hoist_failure.html">
   13. 故障树不确定性
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="back_prop.html">
   14. 人工神经网络简介
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rand_resp.html">
   15. 随机化回应调查
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="util_rand_resp.html">
   16. Expected Utilities of Random Responses
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  线性规划
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="opt_transport.html">
   17. 最优传输
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="von_neumann_model.html">
   18. 冯·诺依曼增长模型（及其推广）
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  动态系统导论
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="finite_markov.html">
   19. 有限马尔可夫链
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="inventory_dynamics.html">
   20. 库存动态
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_models.html">
   21. 线性状态空间模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="samuelson.html">
   22. 萨缪尔森乘数-加速器模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kesten_processes.html">
   23. Kesten过程与企业动态
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wealth_dynamics.html">
   24. 财富分配动态
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman.html">
   25. 卡尔曼滤波初探
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman_2.html">
   26. 卡尔曼滤波器的另一个视角
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  搜索
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model.html">
   27. 工作搜寻 I: McCall搜寻模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model_with_separation.html">
   28. 工作搜寻 II：搜寻与离职
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_fitted_vfi.html">
   29. 求职搜索 III: 拟合值函数迭代
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_correlated.html">
   30. 工作搜寻 IV：相关工资报价
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="career.html">
   31. 职业搜索 V：职业选择建模
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="jv.html">
   32. 在职搜索 VI：在职搜索
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_q.html">
   33. 求职搜索 VII：McCall工人的Q学习
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  消费、储蓄与资本
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_1.html">
   34. Cass-Koopmans模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_2.html">
   35. Cass-Koopmans竞争均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_fiscal.html">
   36. 带扭曲性税收的Cass-Koopmans模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ak2.html">
   37. 重叠世代模型中的转换
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_problem.html">
   38. 蛋糕食用问题 I：最优储蓄导论
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_numerical.html">
   39. 蛋糕食用问题 II：数值方法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth.html">
   40. 最优增长 I：随机最优增长模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth_fast.html">
   41. 最优增长 II：使用Numba加速代码
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coleman_policy_iter.html">
   42. 最优增长 III：时间迭代
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="egm_policy_iter.html">
   43. 最优增长 IV：内生网格法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp.html">
   44. 收入波动问题 I：基本模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp_advanced.html">
   45. 收入波动问题 II：资产随机收益
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  贝叶斯定律
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="bayes_nonconj.html">
   46. 非共轭先验
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_bayes.html">
   47. AR(1)参数的后验分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_turningpts.html">
   48. 预测 AR(1) 过程
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  信息论
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="odu.html">
   49. 求职搜索 VII: 带学习的搜索
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_ratio_process.html">
   50. 似然比过程
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="imp_sample.html">
   51. 计算似然比过程的均值
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wald_friedman.html">
   52. 让弥尔顿·弗里德曼困惑的问题
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exchangeable.html">
   53. 可交换性和贝叶斯更新
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_bayes.html">
   54. 似然比过程和贝叶斯学习
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mix_model.html">
   55. 错误模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="navy_captain.html">
   56. 贝叶斯与频率主义决策规则的比较
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  LQ控制
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   57. LQ控制：基础
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lagrangian_lqdp.html">
   58. LQ控制的拉格朗日方法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cross_product_trick.html">
   59. 消除交叉项
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income.html">
   60. 永久收入模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income_cons.html">
   61. 永久收入 II：线性二次方法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lq_inventories.html">
   62. 通过库存实现生产平滑
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  多主体模型
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lake_model.html">
   63. 就业和失业的湖泊模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rational_expectations.html">
   64. 理性预期均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="re_with_feedback.html">
   65. 线性理性预期模型中的稳定性
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_perf.html">
   66. 马尔可夫完美均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="uncertainty_traps.html">
   67. 不确定性陷阱
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="aiyagari.html">
   68. 艾亚加里模型
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  资产定价与金融
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="markov_asset.html">
   69. 资产定价：有限状态模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ge_arrow.html">
   70. 带有阿罗证券的竞争均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="harrison_kreps.html">
   71. 异质信念与泡沫
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  数据与实证
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="pandas_panel.html">
   72. 面板数据的Pandas使用
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ols.html">
   73. Python线性回归
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mle.html">
   74. 最大似然估计
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  拍卖
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="two_auctions.html">
   75. 一价和二价拍卖
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="house_auction.html">
   76. 多种商品分配机制
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  其他
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   77. 故障排除
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   78. 参考文献
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   79. 执行统计
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                </ul>

                <ul class="qe-toolbar__links">
                    <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off" accesskey="k">
                            <i data-feather="search" id="search-icon"></i>
                        </form>
                    </li>
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/lqcontrol.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li data-tippy-content="Download PDF" onClick="window.print()"><i data-feather="file"></i></li>
                    <!--
                    # Enable if looking for link to specific document hosted on GitHub
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst/lqcontrol.md" download><i data-feather="github"></i></a></li>
                    -->
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://colab.research.google.com/github/QuantEcon/lecture-python.zh-cn.notebooks/blob/main/lqcontrol.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-python.zh-cn.notebooks" data-urlpath="tree/lecture-python.zh-cn.notebooks/lqcontrol.ipynb" data-branch=main>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://colab.research.google.com/github/QuantEcon/lecture-python.zh-cn.notebooks/blob/main/lqcontrol.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "lqcontrol";
                const repoURL = "https://github.com/QuantEcon/lecture-python.zh-cn.notebooks";
                const urlPath = "tree/lecture-python.zh-cn.notebooks/lqcontrol.ipynb";
                const branch = "main"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>