

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>72. 面板数据的Pandas使用 &#8212; Python中级数量经济学</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/quantecon-book-theme.css?digest=bd0785fbb14d8d2bd4d9ae501d79ed8d3bc089ec" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>


    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/scripts/quantecon-book-theme.js?digest=d9faaf6c4b57726f74ba012412af1f5681bdff87"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-J0SMYR4SG3"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-J0SMYR4SG3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'pandas_panel';</script>
    <link rel="canonical" href="https://python.quantecon-zh-cn.org/pandas_panel.html" />
    <link rel="shortcut icon" href="_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="73. Python线性回归" href="ols.html" />
    <link rel="prev" title="71. 异质信念与泡沫" href="harrison_kreps.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和编写的数量经济建模讲座。 />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="面板数据的Pandas使用"/>
<meta name="twitter:description" content="本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和编写的数量经济建模讲座。">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="面板数据的Pandas使用" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://python.quantecon-zh-cn.org/pandas_panel.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和编写的数量经济建模讲座。" />
<meta property="og:site_name" content="Python中级数量经济学" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>

<!-- Override QuantEcon theme colors -->

    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=pandas_panel>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">72.1. 概述</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">72.2. 切片和重塑数据</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">72.3. 合并数据框和填充空值</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">72.4. 数据分组和汇总</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">72.5. 总结</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">72.6. 练习</a></li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo-large.png" class="logo logo-img" alt="logo"></a>
                                    
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">Python中级数量经济学</a></p>

                        <p class="qe-page__header-subheading">面板数据的Pandas使用</p>

                    </div>
                    <!-- length 2, since its a string and empty dict has length 2 - {} -->
                        <p class="qe-page__header-authors" font-size="18">
                            
                                
                                    <a href="http://www.tomsargent.com/" target="_blank"><span>托马斯·萨金特（Thomas J. Sargent）</span></a>
                                
                            
                                
                                    and <a href="https://johnstachurski.net/" target="_blank"><span>约翰·斯塔胡斯基（John Stachurski）</span></a>
                                
                            
                        </p>


                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <section class="tex2jax_ignore mathjax_ignore" id="pandas">
<h1><a class="toc-backref" href="#id8"><span class="section-number">72. </span><span class="target" id="index-0"></span>面板数据的Pandas使用</a><a class="headerlink" href="#pandas" title="Permalink to this heading">#</a></h1>
<div class="contents topic" id="id1">
<span id="index-1"></span><p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#pandas" id="id8">面板数据的Pandas使用</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id9">概述</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id10">切片和重塑数据</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id11">合并数据框和填充空值</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id12">数据分组和汇总</a></p></li>
<li><p><a class="reference internal" href="#id6" id="id13">总结</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id14">练习</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="id2">
<h2><a class="toc-backref" href="#id9"><span class="section-number">72.1. </span>概述</a><a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<p>在<a class="reference external" href="https://python-programming.quantecon.org/pandas.html">之前关于pandas的讲座</a>中，我们学习了如何处理简单的数据集。</p>
<p>计量经济学家经常需要处理更复杂的数据集，比如面板数据。</p>
<p>常见任务包括：</p>
<ul class="simple">
<li><p>导入数据、清理数据以及在多个轴上重塑数据。</p></li>
<li><p>从面板数据中选择时间序列或横截面数据。</p></li>
<li><p>对数据进行分组和汇总。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">pandas</span></code>（源自’panel’和’data’）包含强大且易用的工具，专门用于解决这类问题。</p>
<p>在接下来的内容中，我们将使用来自OECD的实际最低工资面板数据集来创建：</p>
<ul class="simple">
<li><p>数据多个维度的汇总统计</p></li>
<li><p>数据集中各国平均最低工资的时间序列</p></li>
<li><p>按大洲划分的工资核密度估计</p></li>
</ul>
<p>我们将首先从CSV文件中读取长格式面板数据，并使用<code class="docutils literal notranslate"><span class="pre">pivot_table</span></code>重塑生成的<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>来构建<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>。</p>
<p>使用pandas的<code class="docutils literal notranslate"><span class="pre">merge</span></code>函数将为我们的<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>添加额外的详细信息，并使用<code class="docutils literal notranslate"><span class="pre">groupby</span></code>函数对数据进行汇总。</p>
</section>
<section id="id3">
<h2><a class="toc-backref" href="#id10"><span class="section-number">72.2. </span>切片和重塑数据</a><a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h2>
<p>我们将读取来自OECD的32个国家的实际最低工资数据集，并将其赋值给<code class="docutils literal notranslate"><span class="pre">realwage</span></code>。</p>
<p>数据集可通过以下链接访问：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url1</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/QuantEcon/lecture-python/master/source/_static/lecture_specific/pandas_panel/realwage.csv&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># 为了查看目的显示6列</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<span class="c1"># 将小数点位数减少到2位</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>

<span class="n">realwage</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>让我们看看我们有什么可以使用的数据</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>  <span class="c1"># 显示前5行</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>Time</th>
      <th>Country</th>
      <th>Series</th>
      <th>Pay period</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>2006-01-01</td>
      <td>Ireland</td>
      <td>In 2015 constant prices at 2015 USD PPPs</td>
      <td>Annual</td>
      <td>17,132.44</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2007-01-01</td>
      <td>Ireland</td>
      <td>In 2015 constant prices at 2015 USD PPPs</td>
      <td>Annual</td>
      <td>18,100.92</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>2008-01-01</td>
      <td>Ireland</td>
      <td>In 2015 constant prices at 2015 USD PPPs</td>
      <td>Annual</td>
      <td>17,747.41</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>2009-01-01</td>
      <td>Ireland</td>
      <td>In 2015 constant prices at 2015 USD PPPs</td>
      <td>Annual</td>
      <td>18,580.14</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>2010-01-01</td>
      <td>Ireland</td>
      <td>In 2015 constant prices at 2015 USD PPPs</td>
      <td>Annual</td>
      <td>18,755.83</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>数据目前是长格式的，当数据有多个维度时这种格式难以分析。</p>
<p>我们将使用<code class="docutils literal notranslate"><span class="pre">pivot_table</span></code>创建宽格式面板，并使用<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>来处理高维数据。</p>
<p><code class="docutils literal notranslate"><span class="pre">pivot_table</span></code>的参数需要指定数据（values）、索引和我们想要在结果数据框中的列。</p>
<p>通过在columns参数中传入一个列表，我们可以在列轴上创建一个<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage</span> <span class="o">=</span> <span class="n">realwage</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span>
                                <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
                                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="s1">&#39;Series&#39;</span><span class="p">,</span> <span class="s1">&#39;Pay period&#39;</span><span class="p">])</span>
<span class="n">realwage</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Country</th>
      <th colspan="3" halign="left">Australia</th>
      <th>...</th>
      <th colspan="3" halign="left">United States</th>
    </tr>
    <tr>
      <th>Series</th>
      <th colspan="2" halign="left">In 2015 constant prices at 2015 USD PPPs</th>
      <th>In 2015 constant prices at 2015 USD exchange rates</th>
      <th>...</th>
      <th>In 2015 constant prices at 2015 USD PPPs</th>
      <th colspan="2" halign="left">In 2015 constant prices at 2015 USD exchange rates</th>
    </tr>
    <tr>
      <th>Pay period</th>
      <th>Annual</th>
      <th>Hourly</th>
      <th>Annual</th>
      <th>...</th>
      <th>Hourly</th>
      <th>Annual</th>
      <th>Hourly</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2006-01-01</th>
      <td>20,410.65</td>
      <td>10.33</td>
      <td>23,826.64</td>
      <td>...</td>
      <td>6.05</td>
      <td>12,594.40</td>
      <td>6.05</td>
    </tr>
    <tr>
      <th>2007-01-01</th>
      <td>21,087.57</td>
      <td>10.67</td>
      <td>24,616.84</td>
      <td>...</td>
      <td>6.24</td>
      <td>12,974.40</td>
      <td>6.24</td>
    </tr>
    <tr>
      <th>2008-01-01</th>
      <td>20,718.24</td>
      <td>10.48</td>
      <td>24,185.70</td>
      <td>...</td>
      <td>6.78</td>
      <td>14,097.56</td>
      <td>6.78</td>
    </tr>
    <tr>
      <th>2009-01-01</th>
      <td>20,984.77</td>
      <td>10.62</td>
      <td>24,496.84</td>
      <td>...</td>
      <td>7.58</td>
      <td>15,756.42</td>
      <td>7.58</td>
    </tr>
    <tr>
      <th>2010-01-01</th>
      <td>20,879.33</td>
      <td>10.57</td>
      <td>24,373.76</td>
      <td>...</td>
      <td>7.88</td>
      <td>16,391.31</td>
      <td>7.88</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 128 columns</p>
</div></div></div>
</div>
<p>为了更容易地过滤我们的时间序列数据，接下来我们将把索引转换为<code class="docutils literal notranslate"><span class="pre">DateTimeIndex</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">realwage</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">realwage</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.indexes.datetimes.DatetimeIndex
</pre></div>
</div>
</div>
</div>
<p>这些列包含多层级索引，称为<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>，各层级按层次结构排序（国家 &gt; 系列 &gt; 支付周期）。</p>
<p><code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>是在pandas中管理面板数据最简单和最灵活的方式。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">realwage</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.indexes.multi.MultiIndex
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FrozenList([&#39;Country&#39;, &#39;Series&#39;, &#39;Pay period&#39;])
</pre></div>
</div>
</div>
</div>
<p>和之前一样，我们可以选择国家（我们的<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>的最高层级）</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage</span><span class="p">[</span><span class="s1">&#39;United States&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Series</th>
      <th colspan="2" halign="left">In 2015 constant prices at 2015 USD PPPs</th>
      <th colspan="2" halign="left">In 2015 constant prices at 2015 USD exchange rates</th>
    </tr>
    <tr>
      <th>Pay period</th>
      <th>Annual</th>
      <th>Hourly</th>
      <th>Annual</th>
      <th>Hourly</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2006-01-01</th>
      <td>12,594.40</td>
      <td>6.05</td>
      <td>12,594.40</td>
      <td>6.05</td>
    </tr>
    <tr>
      <th>2007-01-01</th>
      <td>12,974.40</td>
      <td>6.24</td>
      <td>12,974.40</td>
      <td>6.24</td>
    </tr>
    <tr>
      <th>2008-01-01</th>
      <td>14,097.56</td>
      <td>6.78</td>
      <td>14,097.56</td>
      <td>6.78</td>
    </tr>
    <tr>
      <th>2009-01-01</th>
      <td>15,756.42</td>
      <td>7.58</td>
      <td>15,756.42</td>
      <td>7.58</td>
    </tr>
    <tr>
      <th>2010-01-01</th>
      <td>16,391.31</td>
      <td>7.88</td>
      <td>16,391.31</td>
      <td>7.88</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>在本讲中，我们将经常使用<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>的堆叠和取消堆叠来将数据框重塑成所需的格式。</p>
<p><code class="docutils literal notranslate"><span class="pre">.stack()</span></code>将列<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>的最低层级旋转到行索引（<code class="docutils literal notranslate"><span class="pre">.unstack()</span></code>的作用方向相反 - 你可以试试看）</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_11573/743219372.py:1: FutureWarning: The previous implementation of stack is deprecated and will be removed in a future version of pandas. See the What&#39;s New notes for pandas 2.1.0 for details. Specify future_stack=True to adopt the new implementation and silence this warning.
  realwage.stack().head()
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Country</th>
      <th colspan="2" halign="left">Australia</th>
      <th>Belgium</th>
      <th>...</th>
      <th>United Kingdom</th>
      <th colspan="2" halign="left">United States</th>
    </tr>
    <tr>
      <th></th>
      <th>Series</th>
      <th>In 2015 constant prices at 2015 USD PPPs</th>
      <th>In 2015 constant prices at 2015 USD exchange rates</th>
      <th>In 2015 constant prices at 2015 USD PPPs</th>
      <th>...</th>
      <th>In 2015 constant prices at 2015 USD exchange rates</th>
      <th>In 2015 constant prices at 2015 USD PPPs</th>
      <th>In 2015 constant prices at 2015 USD exchange rates</th>
    </tr>
    <tr>
      <th>Time</th>
      <th>Pay period</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">2006-01-01</th>
      <th>Annual</th>
      <td>20,410.65</td>
      <td>23,826.64</td>
      <td>21,042.28</td>
      <td>...</td>
      <td>20,376.32</td>
      <td>12,594.40</td>
      <td>12,594.40</td>
    </tr>
    <tr>
      <th>Hourly</th>
      <td>10.33</td>
      <td>12.06</td>
      <td>10.09</td>
      <td>...</td>
      <td>9.81</td>
      <td>6.05</td>
      <td>6.05</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2007-01-01</th>
      <th>Annual</th>
      <td>21,087.57</td>
      <td>24,616.84</td>
      <td>21,310.05</td>
      <td>...</td>
      <td>20,954.13</td>
      <td>12,974.40</td>
      <td>12,974.40</td>
    </tr>
    <tr>
      <th>Hourly</th>
      <td>10.67</td>
      <td>12.46</td>
      <td>10.22</td>
      <td>...</td>
      <td>10.07</td>
      <td>6.24</td>
      <td>6.24</td>
    </tr>
    <tr>
      <th>2008-01-01</th>
      <th>Annual</th>
      <td>20,718.24</td>
      <td>24,185.70</td>
      <td>21,416.96</td>
      <td>...</td>
      <td>20,902.87</td>
      <td>14,097.56</td>
      <td>14,097.56</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 64 columns</p>
</div></div></div>
</div>
<p>我们也可以传入一个参数来选择我们想要堆叠的层级</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;Country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_11573/1205496966.py:1: FutureWarning: The previous implementation of stack is deprecated and will be removed in a future version of pandas. See the What&#39;s New notes for pandas 2.1.0 for details. Specify future_stack=True to adopt the new implementation and silence this warning.
  realwage.stack(level=&#39;Country&#39;).head()
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Series</th>
      <th colspan="2" halign="left">In 2015 constant prices at 2015 USD PPPs</th>
      <th colspan="2" halign="left">In 2015 constant prices at 2015 USD exchange rates</th>
    </tr>
    <tr>
      <th></th>
      <th>Pay period</th>
      <th>Annual</th>
      <th>Hourly</th>
      <th>Annual</th>
      <th>Hourly</th>
    </tr>
    <tr>
      <th>Time</th>
      <th>Country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">2006-01-01</th>
      <th>Australia</th>
      <td>20,410.65</td>
      <td>10.33</td>
      <td>23,826.64</td>
      <td>12.06</td>
    </tr>
    <tr>
      <th>Belgium</th>
      <td>21,042.28</td>
      <td>10.09</td>
      <td>20,228.74</td>
      <td>9.70</td>
    </tr>
    <tr>
      <th>Brazil</th>
      <td>3,310.51</td>
      <td>1.41</td>
      <td>2,032.87</td>
      <td>0.87</td>
    </tr>
    <tr>
      <th>Canada</th>
      <td>13,649.69</td>
      <td>6.56</td>
      <td>14,335.12</td>
      <td>6.89</td>
    </tr>
    <tr>
      <th>Chile</th>
      <td>5,201.65</td>
      <td>2.22</td>
      <td>3,333.76</td>
      <td>1.42</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>使用<code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>可以轻松选择特定的时间段。</p>
<p>选择一年并堆叠<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>的两个较低层级，可以创建我们面板数据的横截面</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2015&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_11573/1065142626.py:1: FutureWarning: The previous implementation of stack is deprecated and will be removed in a future version of pandas. See the What&#39;s New notes for pandas 2.1.0 for details. Specify future_stack=True to adopt the new implementation and silence this warning.
  realwage.loc[&#39;2015&#39;].stack(level=(1, 2)).transpose().head()
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Time</th>
      <th colspan="4" halign="left">2015-01-01</th>
    </tr>
    <tr>
      <th>Series</th>
      <th colspan="2" halign="left">In 2015 constant prices at 2015 USD PPPs</th>
      <th colspan="2" halign="left">In 2015 constant prices at 2015 USD exchange rates</th>
    </tr>
    <tr>
      <th>Pay period</th>
      <th>Annual</th>
      <th>Hourly</th>
      <th>Annual</th>
      <th>Hourly</th>
    </tr>
    <tr>
      <th>Country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Australia</th>
      <td>21,715.53</td>
      <td>10.99</td>
      <td>25,349.90</td>
      <td>12.83</td>
    </tr>
    <tr>
      <th>Belgium</th>
      <td>21,588.12</td>
      <td>10.35</td>
      <td>20,753.48</td>
      <td>9.95</td>
    </tr>
    <tr>
      <th>Brazil</th>
      <td>4,628.63</td>
      <td>2.00</td>
      <td>2,842.28</td>
      <td>1.21</td>
    </tr>
    <tr>
      <th>Canada</th>
      <td>16,536.83</td>
      <td>7.95</td>
      <td>17,367.24</td>
      <td>8.35</td>
    </tr>
    <tr>
      <th>Chile</th>
      <td>6,633.56</td>
      <td>2.80</td>
      <td>4,251.49</td>
      <td>1.81</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>在本讲座剩余部分，我们将使用一个数据框，其中包含不同国家和时间段的每小时实际最低工资数据，以2015年美元计价。</p>
<p>要创建我们的筛选数据框（<code class="docutils literal notranslate"><span class="pre">realwage_f</span></code>），我们可以使用<code class="docutils literal notranslate"><span class="pre">xs</span></code>方法在保持更高层级（本例中为国家）的同时，选择多重索引中较低层级的值。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage_f</span> <span class="o">=</span> <span class="n">realwage</span><span class="o">.</span><span class="n">xs</span><span class="p">((</span><span class="s1">&#39;Hourly&#39;</span><span class="p">,</span> <span class="s1">&#39;In 2015 constant prices at 2015 USD exchange rates&#39;</span><span class="p">),</span>
                         <span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Pay period&#39;</span><span class="p">,</span> <span class="s1">&#39;Series&#39;</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">realwage_f</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Country</th>
      <th>Australia</th>
      <th>Belgium</th>
      <th>Brazil</th>
      <th>...</th>
      <th>Turkey</th>
      <th>United Kingdom</th>
      <th>United States</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2006-01-01</th>
      <td>12.06</td>
      <td>9.70</td>
      <td>0.87</td>
      <td>...</td>
      <td>2.27</td>
      <td>9.81</td>
      <td>6.05</td>
    </tr>
    <tr>
      <th>2007-01-01</th>
      <td>12.46</td>
      <td>9.82</td>
      <td>0.92</td>
      <td>...</td>
      <td>2.26</td>
      <td>10.07</td>
      <td>6.24</td>
    </tr>
    <tr>
      <th>2008-01-01</th>
      <td>12.24</td>
      <td>9.87</td>
      <td>0.96</td>
      <td>...</td>
      <td>2.22</td>
      <td>10.04</td>
      <td>6.78</td>
    </tr>
    <tr>
      <th>2009-01-01</th>
      <td>12.40</td>
      <td>10.21</td>
      <td>1.03</td>
      <td>...</td>
      <td>2.28</td>
      <td>10.15</td>
      <td>7.58</td>
    </tr>
    <tr>
      <th>2010-01-01</th>
      <td>12.34</td>
      <td>10.05</td>
      <td>1.08</td>
      <td>...</td>
      <td>2.30</td>
      <td>9.96</td>
      <td>7.88</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 32 columns</p>
</div></div></div>
</div>
</section>
<section id="id4">
<h2><a class="toc-backref" href="#id11"><span class="section-number">72.3. </span>合并数据框和填充空值</a><a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h2>
<p>与SQL等关系型数据库类似，pandas内置了合并数据集的方法。</p>
<p>使用来自<a class="reference external" href="https://www.worlddata.info/downloads/">WorldData.info</a>的国家信息，我们将使用<code class="docutils literal notranslate"><span class="pre">merge</span></code>函数将每个国家所属的大洲添加到<code class="docutils literal notranslate"><span class="pre">realwage_f</span></code>中。</p>
<p>可以通过以下链接访问数据集：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url2</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/QuantEcon/lecture-python/master/source/_static/lecture_specific/pandas_panel/countries.csv&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">worlddata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url2</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<span class="n">worlddata</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country (en)</th>
      <th>Country (de)</th>
      <th>Country (local)</th>
      <th>...</th>
      <th>Deathrate</th>
      <th>Life expectancy</th>
      <th>Url</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>Afghanistan</td>
      <td>Afganistan/Afqanestan</td>
      <td>...</td>
      <td>13.70</td>
      <td>51.30</td>
      <td>https://www.laenderdaten.info/Asien/Afghanista...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Egypt</td>
      <td>Ägypten</td>
      <td>Misr</td>
      <td>...</td>
      <td>4.70</td>
      <td>72.70</td>
      <td>https://www.laenderdaten.info/Afrika/Aegypten/...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Åland Islands</td>
      <td>Ålandinseln</td>
      <td>Åland</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>https://www.laenderdaten.info/Europa/Aland/ind...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Albania</td>
      <td>Albanien</td>
      <td>Shqipëria</td>
      <td>...</td>
      <td>6.70</td>
      <td>78.30</td>
      <td>https://www.laenderdaten.info/Europa/Albanien/...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Algeria</td>
      <td>Algerien</td>
      <td>Al-Jaza’ir/Algérie</td>
      <td>...</td>
      <td>4.30</td>
      <td>76.80</td>
      <td>https://www.laenderdaten.info/Afrika/Algerien/...</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 17 columns</p>
</div></div></div>
</div>
<p>首先，我们将从<code class="docutils literal notranslate"><span class="pre">worlddata</span></code>中只选择国家和大洲变量，并将列名重命名为’Country’</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">worlddata</span> <span class="o">=</span> <span class="n">worlddata</span><span class="p">[[</span><span class="s1">&#39;Country (en)&#39;</span><span class="p">,</span> <span class="s1">&#39;Continent&#39;</span><span class="p">]]</span>
<span class="n">worlddata</span> <span class="o">=</span> <span class="n">worlddata</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Country (en)&#39;</span><span class="p">:</span> <span class="s1">&#39;Country&#39;</span><span class="p">})</span>
<span class="n">worlddata</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Continent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Egypt</td>
      <td>Africa</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Åland Islands</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Albania</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Algeria</td>
      <td>Africa</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>我们想要将新的数据框<code class="docutils literal notranslate"><span class="pre">worlddata</span></code>与<code class="docutils literal notranslate"><span class="pre">realwage_f</span></code>合并。</p>
<p>pandas的<code class="docutils literal notranslate"><span class="pre">merge</span></code>函数允许通过行将数据框连接在一起。</p>
<p>我们的数据框将使用国家名称进行合并，这需要我们使用<code class="docutils literal notranslate"><span class="pre">realwage_f</span></code>的转置，以便两个数据框中的行都对应于国家名称。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage_f</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Time</th>
      <th>2006-01-01</th>
      <th>2007-01-01</th>
      <th>2008-01-01</th>
      <th>...</th>
      <th>2014-01-01</th>
      <th>2015-01-01</th>
      <th>2016-01-01</th>
    </tr>
    <tr>
      <th>Country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Australia</th>
      <td>12.06</td>
      <td>12.46</td>
      <td>12.24</td>
      <td>...</td>
      <td>12.67</td>
      <td>12.83</td>
      <td>12.98</td>
    </tr>
    <tr>
      <th>Belgium</th>
      <td>9.70</td>
      <td>9.82</td>
      <td>9.87</td>
      <td>...</td>
      <td>10.01</td>
      <td>9.95</td>
      <td>9.76</td>
    </tr>
    <tr>
      <th>Brazil</th>
      <td>0.87</td>
      <td>0.92</td>
      <td>0.96</td>
      <td>...</td>
      <td>1.21</td>
      <td>1.21</td>
      <td>1.24</td>
    </tr>
    <tr>
      <th>Canada</th>
      <td>6.89</td>
      <td>6.96</td>
      <td>7.24</td>
      <td>...</td>
      <td>8.22</td>
      <td>8.35</td>
      <td>8.48</td>
    </tr>
    <tr>
      <th>Chile</th>
      <td>1.42</td>
      <td>1.45</td>
      <td>1.44</td>
      <td>...</td>
      <td>1.76</td>
      <td>1.81</td>
      <td>1.91</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 11 columns</p>
</div></div></div>
</div>
<p>我们可以使用左连接、右连接、内连接或外连接来合并我们的数据集：</p>
<ul class="simple">
<li><p>左连接只包含左侧数据集中的国家</p></li>
<li><p>右连接只包含右侧数据集中的国家</p></li>
<li><p>外连接包含左侧和右侧数据集中的任一国家</p></li>
<li><p>内连接只包含左右数据集共有的国家</p></li>
</ul>
<p>默认情况下，<code class="docutils literal notranslate"><span class="pre">merge</span></code>将使用内连接。</p>
<p>在这里，我们将传入<code class="docutils literal notranslate"><span class="pre">how='left'</span></code>以保留<code class="docutils literal notranslate"><span class="pre">realwage_f</span></code>中的所有国家，但丢弃在<code class="docutils literal notranslate"><span class="pre">worlddata</span></code>中没有对应数据项<code class="docutils literal notranslate"><span class="pre">realwage_f</span></code>的国家。</p>
<p>这在下图中用红色阴影部分表示</p>
<figure class="align-default">
<img alt="_images/venn_diag.png" src="_images/venn_diag.png" />
</figure>
<p>我们还需要指定每个数据框中国家名称的位置，这将作为合并数据框的”键”。</p>
<p>我们的”左”数据框（<code class="docutils literal notranslate"><span class="pre">realwage_f.transpose()</span></code>）在索引中包含国家，所以我们设置<code class="docutils literal notranslate"><span class="pre">left_index=True</span></code>。</p>
<p>我们的’right’数据框（<code class="docutils literal notranslate"><span class="pre">worlddata</span></code>）在’Country’列中包含国家名称，所以我们设置<code class="docutils literal notranslate"><span class="pre">right_on='Country'</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">realwage_f</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">worlddata</span><span class="p">,</span>
                  <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;Country&#39;</span><span class="p">)</span>
<span class="n">merged</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>2006-01-01 00:00:00</th>
      <th>2007-01-01 00:00:00</th>
      <th>2008-01-01 00:00:00</th>
      <th>...</th>
      <th>2016-01-01 00:00:00</th>
      <th>Country</th>
      <th>Continent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>17.00</th>
      <td>12.06</td>
      <td>12.46</td>
      <td>12.24</td>
      <td>...</td>
      <td>12.98</td>
      <td>Australia</td>
      <td>Australia</td>
    </tr>
    <tr>
      <th>23.00</th>
      <td>9.70</td>
      <td>9.82</td>
      <td>9.87</td>
      <td>...</td>
      <td>9.76</td>
      <td>Belgium</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>32.00</th>
      <td>0.87</td>
      <td>0.92</td>
      <td>0.96</td>
      <td>...</td>
      <td>1.24</td>
      <td>Brazil</td>
      <td>South America</td>
    </tr>
    <tr>
      <th>100.00</th>
      <td>6.89</td>
      <td>6.96</td>
      <td>7.24</td>
      <td>...</td>
      <td>8.48</td>
      <td>Canada</td>
      <td>North America</td>
    </tr>
    <tr>
      <th>38.00</th>
      <td>1.42</td>
      <td>1.45</td>
      <td>1.44</td>
      <td>...</td>
      <td>1.91</td>
      <td>Chile</td>
      <td>South America</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 13 columns</p>
</div></div></div>
</div>
<p>在 <code class="docutils literal notranslate"><span class="pre">realwage_f</span></code> 中出现但在 <code class="docutils literal notranslate"><span class="pre">worlddata</span></code> 中未出现的国家，其 Continent 列将显示 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>。</p>
<p>要检查是否发生这种情况，我们可以在 continent 列上使用 <code class="docutils literal notranslate"><span class="pre">.isnull()</span></code> 并过滤合并后的数据框</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="p">[</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>2006-01-01 00:00:00</th>
      <th>2007-01-01 00:00:00</th>
      <th>2008-01-01 00:00:00</th>
      <th>...</th>
      <th>2016-01-01 00:00:00</th>
      <th>Country</th>
      <th>Continent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>NaN</th>
      <td>3.42</td>
      <td>3.74</td>
      <td>3.87</td>
      <td>...</td>
      <td>5.28</td>
      <td>Korea</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>NaN</th>
      <td>0.23</td>
      <td>0.45</td>
      <td>0.39</td>
      <td>...</td>
      <td>0.55</td>
      <td>Russian Federation</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>NaN</th>
      <td>1.50</td>
      <td>1.64</td>
      <td>1.71</td>
      <td>...</td>
      <td>2.08</td>
      <td>Slovak Republic</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 13 columns</p>
</div></div></div>
</div>
<p>我们有三个缺失值！</p>
<p>处理 NaN 值的一个选项是创建一个包含这些国家及其各自大洲的字典。</p>
<p><code class="docutils literal notranslate"><span class="pre">.map()</span></code> 将会把 <code class="docutils literal notranslate"><span class="pre">merged['Country']</span></code> 中的国家与字典中的大洲进行匹配。</p>
<p>注意那些不在我们字典中的国家是如何被映射为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code> 的</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">missing_continents</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Korea&#39;</span><span class="p">:</span> <span class="s1">&#39;Asia&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Russian Federation&#39;</span><span class="p">:</span> <span class="s1">&#39;Europe&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Slovak Republic&#39;</span><span class="p">:</span> <span class="s1">&#39;Europe&#39;</span><span class="p">}</span>

<span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">missing_continents</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17.00        NaN
23.00        NaN
32.00        NaN
100.00       NaN
38.00        NaN
108.00       NaN
41.00        NaN
225.00       NaN
53.00        NaN
58.00        NaN
45.00        NaN
68.00        NaN
233.00       NaN
86.00        NaN
88.00        NaN
91.00        NaN
NaN         Asia
117.00       NaN
122.00       NaN
123.00       NaN
138.00       NaN
153.00       NaN
151.00       NaN
174.00       NaN
175.00       NaN
NaN       Europe
NaN       Europe
198.00       NaN
200.00       NaN
227.00       NaN
241.00       NaN
240.00       NaN
Name: Country, dtype: object
</pre></div>
</div>
</div>
</div>
<p>我们不想用这个映射覆盖整个系列。</p>
<p><code class="docutils literal notranslate"><span class="pre">.fillna()</span></code> 只会用映射填充 <code class="docutils literal notranslate"><span class="pre">merged['Continent']</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">NaN</span></code> 值，而保持列中的其他值不变</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">missing_continents</span><span class="p">))</span>

<span class="c1"># 检查大洲是否正确映射</span>

<span class="n">merged</span><span class="p">[</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Korea&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>2006-01-01 00:00:00</th>
      <th>2007-01-01 00:00:00</th>
      <th>2008-01-01 00:00:00</th>
      <th>...</th>
      <th>2016-01-01 00:00:00</th>
      <th>Country</th>
      <th>Continent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>NaN</th>
      <td>3.42</td>
      <td>3.74</td>
      <td>3.87</td>
      <td>...</td>
      <td>5.28</td>
      <td>Korea</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 13 columns</p>
</div></div></div>
</div>
<p>我们还要把美洲合并成一个大洲 - 这样可以让我们后面的可视化效果更好看。</p>
<p>为此，我们将使用<code class="docutils literal notranslate"><span class="pre">.replace()</span></code>并遍历一个包含我们想要替换的大洲值的列表</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">replace</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Central America&#39;</span><span class="p">,</span> <span class="s1">&#39;North America&#39;</span><span class="p">,</span> <span class="s1">&#39;South America&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">country</span> <span class="ow">in</span> <span class="n">replace</span><span class="p">:</span>
    <span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">to_replace</span><span class="o">=</span><span class="n">country</span><span class="p">,</span>
                                <span class="n">value</span><span class="o">=</span><span class="s1">&#39;America&#39;</span><span class="p">,</span>
                                <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_11573/2897028784.py:4: FutureWarning: A value is trying to be set on a copy of a DataFrame or Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never work because the intermediate object on which we are setting values always behaves as a copy.

For example, when doing &#39;df[col].method(value, inplace=True)&#39;, try using &#39;df.method({col: value}, inplace=True)&#39; or df[col] = df[col].method(value) instead, to perform the operation inplace on the original object.


  merged[&#39;Continent&#39;].replace(to_replace=country,
</pre></div>
</div>
</div>
</div>
<p>现在我们已经将所有想要的数据都放在一个<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>中，我们将把它重新整形成带有<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>的面板形式。</p>
<p>我们还应该使用<code class="docutils literal notranslate"><span class="pre">.sort_index()</span></code>来确保对索引进行排序，这样我们之后可以高效地筛选数据框。</p>
<p>默认情况下，层级将按照从上到下的顺序排序</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Continent&#39;</span><span class="p">,</span> <span class="s1">&#39;Country&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">merged</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>2006-01-01</th>
      <th>2007-01-01</th>
      <th>2008-01-01</th>
      <th>...</th>
      <th>2014-01-01</th>
      <th>2015-01-01</th>
      <th>2016-01-01</th>
    </tr>
    <tr>
      <th>Continent</th>
      <th>Country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">America</th>
      <th>Brazil</th>
      <td>0.87</td>
      <td>0.92</td>
      <td>0.96</td>
      <td>...</td>
      <td>1.21</td>
      <td>1.21</td>
      <td>1.24</td>
    </tr>
    <tr>
      <th>Canada</th>
      <td>6.89</td>
      <td>6.96</td>
      <td>7.24</td>
      <td>...</td>
      <td>8.22</td>
      <td>8.35</td>
      <td>8.48</td>
    </tr>
    <tr>
      <th>Chile</th>
      <td>1.42</td>
      <td>1.45</td>
      <td>1.44</td>
      <td>...</td>
      <td>1.76</td>
      <td>1.81</td>
      <td>1.91</td>
    </tr>
    <tr>
      <th>Colombia</th>
      <td>1.01</td>
      <td>1.02</td>
      <td>1.01</td>
      <td>...</td>
      <td>1.13</td>
      <td>1.13</td>
      <td>1.12</td>
    </tr>
    <tr>
      <th>Costa Rica</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>2.41</td>
      <td>2.56</td>
      <td>2.63</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 11 columns</p>
</div></div></div>
</div>
<p>在合并过程中，我们丢失了<code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>，因为我们合并的列不是日期时间格式的</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([2006-01-01 00:00:00, 2007-01-01 00:00:00, 2008-01-01 00:00:00,
       2009-01-01 00:00:00, 2010-01-01 00:00:00, 2011-01-01 00:00:00,
       2012-01-01 00:00:00, 2013-01-01 00:00:00, 2014-01-01 00:00:00,
       2015-01-01 00:00:00, 2016-01-01 00:00:00],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>现在我们已经将合并的列设置为索引，我们可以使用<code class="docutils literal notranslate"><span class="pre">.to_datetime()</span></code>重新创建一个<code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">merged</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">merged</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatetimeIndex([&#39;2006-01-01&#39;, &#39;2007-01-01&#39;, &#39;2008-01-01&#39;, &#39;2009-01-01&#39;,
               &#39;2010-01-01&#39;, &#39;2011-01-01&#39;, &#39;2012-01-01&#39;, &#39;2013-01-01&#39;,
               &#39;2014-01-01&#39;, &#39;2015-01-01&#39;, &#39;2016-01-01&#39;],
              dtype=&#39;datetime64[ns]&#39;, name=&#39;Time&#39;, freq=None)
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>在行轴上运行更加顺畅，所以我们将对<code class="docutils literal notranslate"><span class="pre">merged</span></code>进行转置</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">merged</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Continent</th>
      <th colspan="3" halign="left">America</th>
      <th>...</th>
      <th colspan="3" halign="left">Europe</th>
    </tr>
    <tr>
      <th>Country</th>
      <th>Brazil</th>
      <th>Canada</th>
      <th>Chile</th>
      <th>...</th>
      <th>Slovenia</th>
      <th>Spain</th>
      <th>United Kingdom</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2006-01-01</th>
      <td>0.87</td>
      <td>6.89</td>
      <td>1.42</td>
      <td>...</td>
      <td>3.92</td>
      <td>3.99</td>
      <td>9.81</td>
    </tr>
    <tr>
      <th>2007-01-01</th>
      <td>0.92</td>
      <td>6.96</td>
      <td>1.45</td>
      <td>...</td>
      <td>3.88</td>
      <td>4.10</td>
      <td>10.07</td>
    </tr>
    <tr>
      <th>2008-01-01</th>
      <td>0.96</td>
      <td>7.24</td>
      <td>1.44</td>
      <td>...</td>
      <td>3.96</td>
      <td>4.14</td>
      <td>10.04</td>
    </tr>
    <tr>
      <th>2009-01-01</th>
      <td>1.03</td>
      <td>7.67</td>
      <td>1.52</td>
      <td>...</td>
      <td>4.08</td>
      <td>4.32</td>
      <td>10.15</td>
    </tr>
    <tr>
      <th>2010-01-01</th>
      <td>1.08</td>
      <td>7.94</td>
      <td>1.56</td>
      <td>...</td>
      <td>4.81</td>
      <td>4.30</td>
      <td>9.96</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 32 columns</p>
</div></div></div>
</div>
</section>
<section id="id5">
<h2><a class="toc-backref" href="#id12"><span class="section-number">72.4. </span>数据分组和汇总</a><a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h2>
<p>对于理解大型面板数据集来说，数据分组和汇总特别有用。</p>
<p>一种简单的数据汇总方法是在数据框上调用<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/intro_tutorials/06_calculate_statistics.html">聚合方法</a>，比如<code class="docutils literal notranslate"><span class="pre">.mean()</span></code>或<code class="docutils literal notranslate"><span class="pre">.max()</span></code>。</p>
<p>例如，我们可以计算2006年至2016年期间每个国家的平均实际最低工资（默认是按行聚合）</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Continent  Country      
America    Brazil          1.09
           Canada          7.82
           Chile           1.62
           Colombia        1.07
           Costa Rica      2.53
           Mexico          0.53
           United States   7.15
Asia       Israel          5.95
           Japan           6.18
           Korea           4.22
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>使用这个数据系列，我们可以绘制数据集中每个国家过去十年的平均实际最低工资</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="n">FONTPATH</span> <span class="o">=</span> <span class="s2">&quot;fonts/SourceHanSerifSC-SemiBold.otf&quot;</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">fontManager</span><span class="o">.</span><span class="n">addfont</span><span class="p">(</span><span class="n">FONTPATH</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source Han Serif SC&#39;</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span>
                                                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;2006-2016年平均实际最低工资&quot;</span><span class="p">)</span>

<span class="c1"># 设置国家标签</span>
<span class="n">country_labels</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">country_labels</span><span class="p">)),</span> <span class="n">country_labels</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;国家&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 22269 (\N{CJK UNIFIED IDEOGRAPH-56FD}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 23478 (\N{CJK UNIFIED IDEOGRAPH-5BB6}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24180 (\N{CJK UNIFIED IDEOGRAPH-5E74}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24179 (\N{CJK UNIFIED IDEOGRAPH-5E73}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 22343 (\N{CJK UNIFIED IDEOGRAPH-5747}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 23454 (\N{CJK UNIFIED IDEOGRAPH-5B9E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 38469 (\N{CJK UNIFIED IDEOGRAPH-9645}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 26368 (\N{CJK UNIFIED IDEOGRAPH-6700}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20302 (\N{CJK UNIFIED IDEOGRAPH-4F4E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24037 (\N{CJK UNIFIED IDEOGRAPH-5DE5}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 36164 (\N{CJK UNIFIED IDEOGRAPH-8D44}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/55cadc5bf67002b3a0f1677a1d115979872540bdad71d7477f9b44e179a3655b.png" src="_images/55cadc5bf67002b3a0f1677a1d115979872540bdad71d7477f9b44e179a3655b.png" />
</div>
</div>
<p>通过向<code class="docutils literal notranslate"><span class="pre">.mean()</span></code>传入<code class="docutils literal notranslate"><span class="pre">axis=1</span></code>参数可以对列进行聚合（得到所有国家随时间变化的平均最低工资）</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time
2006-01-01   4.69
2007-01-01   4.84
2008-01-01   4.90
2009-01-01   5.08
2010-01-01   5.11
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>我们可以将这个时间序列绘制成折线图</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;2006 - 2016年平均实际最低工资&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;2015年美元&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;年份&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24180 (\N{CJK UNIFIED IDEOGRAPH-5E74}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20221 (\N{CJK UNIFIED IDEOGRAPH-4EFD}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 32654 (\N{CJK UNIFIED IDEOGRAPH-7F8E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20803 (\N{CJK UNIFIED IDEOGRAPH-5143}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24179 (\N{CJK UNIFIED IDEOGRAPH-5E73}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 22343 (\N{CJK UNIFIED IDEOGRAPH-5747}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 23454 (\N{CJK UNIFIED IDEOGRAPH-5B9E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 38469 (\N{CJK UNIFIED IDEOGRAPH-9645}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 26368 (\N{CJK UNIFIED IDEOGRAPH-6700}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20302 (\N{CJK UNIFIED IDEOGRAPH-4F4E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24037 (\N{CJK UNIFIED IDEOGRAPH-5DE5}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 36164 (\N{CJK UNIFIED IDEOGRAPH-8D44}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24180 (\N{CJK UNIFIED IDEOGRAPH-5E74}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20221 (\N{CJK UNIFIED IDEOGRAPH-4EFD}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 32654 (\N{CJK UNIFIED IDEOGRAPH-7F8E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20803 (\N{CJK UNIFIED IDEOGRAPH-5143}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24179 (\N{CJK UNIFIED IDEOGRAPH-5E73}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 22343 (\N{CJK UNIFIED IDEOGRAPH-5747}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 23454 (\N{CJK UNIFIED IDEOGRAPH-5B9E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 38469 (\N{CJK UNIFIED IDEOGRAPH-9645}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 26368 (\N{CJK UNIFIED IDEOGRAPH-6700}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20302 (\N{CJK UNIFIED IDEOGRAPH-4F4E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24037 (\N{CJK UNIFIED IDEOGRAPH-5DE5}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 36164 (\N{CJK UNIFIED IDEOGRAPH-8D44}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24180 (\N{CJK UNIFIED IDEOGRAPH-5E74}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20221 (\N{CJK UNIFIED IDEOGRAPH-4EFD}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 32654 (\N{CJK UNIFIED IDEOGRAPH-7F8E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20803 (\N{CJK UNIFIED IDEOGRAPH-5143}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24179 (\N{CJK UNIFIED IDEOGRAPH-5E73}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 22343 (\N{CJK UNIFIED IDEOGRAPH-5747}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 23454 (\N{CJK UNIFIED IDEOGRAPH-5B9E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 38469 (\N{CJK UNIFIED IDEOGRAPH-9645}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 26368 (\N{CJK UNIFIED IDEOGRAPH-6700}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20302 (\N{CJK UNIFIED IDEOGRAPH-4F4E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24037 (\N{CJK UNIFIED IDEOGRAPH-5DE5}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 36164 (\N{CJK UNIFIED IDEOGRAPH-8D44}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/330d11fb62dbe8de7b268ec7474a9d910176f5bef875bc462533af87a5ed871a.png" src="_images/330d11fb62dbe8de7b268ec7474a9d910176f5bef875bc462533af87a5ed871a.png" />
</div>
</div>
<p>我们也可以指定<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>的一个层级（在列轴上）来进行聚合</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;Continent&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_11573/646686994.py:1: FutureWarning: DataFrame.groupby with axis=1 is deprecated. Do `frame.T.groupby(...)` without axis instead.
  merged.groupby(level=&#39;Continent&#39;, axis=1).mean().head()
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Continent</th>
      <th>America</th>
      <th>Asia</th>
      <th>Australia</th>
      <th>Europe</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2006-01-01</th>
      <td>2.80</td>
      <td>4.29</td>
      <td>10.25</td>
      <td>4.80</td>
    </tr>
    <tr>
      <th>2007-01-01</th>
      <td>2.85</td>
      <td>4.44</td>
      <td>10.73</td>
      <td>4.94</td>
    </tr>
    <tr>
      <th>2008-01-01</th>
      <td>2.99</td>
      <td>4.45</td>
      <td>10.76</td>
      <td>4.99</td>
    </tr>
    <tr>
      <th>2009-01-01</th>
      <td>3.23</td>
      <td>4.53</td>
      <td>10.97</td>
      <td>5.16</td>
    </tr>
    <tr>
      <th>2010-01-01</th>
      <td>3.34</td>
      <td>4.53</td>
      <td>10.95</td>
      <td>5.17</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>我们可以将每个大洲的平均最低工资绘制成时间序列图</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;Continent&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;平均实际最低工资&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;2015年美元&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;年份&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_11573/1721731087.py:1: FutureWarning: DataFrame.groupby with axis=1 is deprecated. Do `frame.T.groupby(...)` without axis instead.
  merged.groupby(level=&#39;Continent&#39;, axis=1).mean().plot()
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24180 (\N{CJK UNIFIED IDEOGRAPH-5E74}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20221 (\N{CJK UNIFIED IDEOGRAPH-4EFD}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 32654 (\N{CJK UNIFIED IDEOGRAPH-7F8E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20803 (\N{CJK UNIFIED IDEOGRAPH-5143}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24179 (\N{CJK UNIFIED IDEOGRAPH-5E73}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 22343 (\N{CJK UNIFIED IDEOGRAPH-5747}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 23454 (\N{CJK UNIFIED IDEOGRAPH-5B9E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 38469 (\N{CJK UNIFIED IDEOGRAPH-9645}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 26368 (\N{CJK UNIFIED IDEOGRAPH-6700}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20302 (\N{CJK UNIFIED IDEOGRAPH-4F4E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24037 (\N{CJK UNIFIED IDEOGRAPH-5DE5}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 36164 (\N{CJK UNIFIED IDEOGRAPH-8D44}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24180 (\N{CJK UNIFIED IDEOGRAPH-5E74}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20221 (\N{CJK UNIFIED IDEOGRAPH-4EFD}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 32654 (\N{CJK UNIFIED IDEOGRAPH-7F8E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20803 (\N{CJK UNIFIED IDEOGRAPH-5143}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24179 (\N{CJK UNIFIED IDEOGRAPH-5E73}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 22343 (\N{CJK UNIFIED IDEOGRAPH-5747}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 23454 (\N{CJK UNIFIED IDEOGRAPH-5B9E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 38469 (\N{CJK UNIFIED IDEOGRAPH-9645}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 26368 (\N{CJK UNIFIED IDEOGRAPH-6700}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20302 (\N{CJK UNIFIED IDEOGRAPH-4F4E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24037 (\N{CJK UNIFIED IDEOGRAPH-5DE5}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 36164 (\N{CJK UNIFIED IDEOGRAPH-8D44}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24180 (\N{CJK UNIFIED IDEOGRAPH-5E74}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20221 (\N{CJK UNIFIED IDEOGRAPH-4EFD}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 32654 (\N{CJK UNIFIED IDEOGRAPH-7F8E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20803 (\N{CJK UNIFIED IDEOGRAPH-5143}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24179 (\N{CJK UNIFIED IDEOGRAPH-5E73}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 22343 (\N{CJK UNIFIED IDEOGRAPH-5747}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 23454 (\N{CJK UNIFIED IDEOGRAPH-5B9E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 38469 (\N{CJK UNIFIED IDEOGRAPH-9645}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 26368 (\N{CJK UNIFIED IDEOGRAPH-6700}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20302 (\N{CJK UNIFIED IDEOGRAPH-4F4E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24037 (\N{CJK UNIFIED IDEOGRAPH-5DE5}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 36164 (\N{CJK UNIFIED IDEOGRAPH-8D44}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/a697dd211a224eddea1f73af593964cac5442e3008d5399bb32760e75149fea4.png" src="_images/a697dd211a224eddea1f73af593964cac5442e3008d5399bb32760e75149fea4.png" />
</div>
</div>
<p>为了绘图目的，我们将去掉澳大利亚这个大洲</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Australia&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;Continent&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">merged</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;Continent&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;平均实际最低工资&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;2015年美元&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;年份&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_11573/3197233217.py:2: FutureWarning: DataFrame.groupby with axis=1 is deprecated. Do `frame.T.groupby(...)` without axis instead.
  merged.groupby(level=&#39;Continent&#39;, axis=1).mean().plot()
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24180 (\N{CJK UNIFIED IDEOGRAPH-5E74}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20221 (\N{CJK UNIFIED IDEOGRAPH-4EFD}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 32654 (\N{CJK UNIFIED IDEOGRAPH-7F8E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20803 (\N{CJK UNIFIED IDEOGRAPH-5143}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24179 (\N{CJK UNIFIED IDEOGRAPH-5E73}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 22343 (\N{CJK UNIFIED IDEOGRAPH-5747}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 23454 (\N{CJK UNIFIED IDEOGRAPH-5B9E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 38469 (\N{CJK UNIFIED IDEOGRAPH-9645}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 26368 (\N{CJK UNIFIED IDEOGRAPH-6700}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20302 (\N{CJK UNIFIED IDEOGRAPH-4F4E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24037 (\N{CJK UNIFIED IDEOGRAPH-5DE5}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 36164 (\N{CJK UNIFIED IDEOGRAPH-8D44}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24180 (\N{CJK UNIFIED IDEOGRAPH-5E74}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20221 (\N{CJK UNIFIED IDEOGRAPH-4EFD}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 32654 (\N{CJK UNIFIED IDEOGRAPH-7F8E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20803 (\N{CJK UNIFIED IDEOGRAPH-5143}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24179 (\N{CJK UNIFIED IDEOGRAPH-5E73}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 22343 (\N{CJK UNIFIED IDEOGRAPH-5747}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 23454 (\N{CJK UNIFIED IDEOGRAPH-5B9E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 38469 (\N{CJK UNIFIED IDEOGRAPH-9645}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 26368 (\N{CJK UNIFIED IDEOGRAPH-6700}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20302 (\N{CJK UNIFIED IDEOGRAPH-4F4E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24037 (\N{CJK UNIFIED IDEOGRAPH-5DE5}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 36164 (\N{CJK UNIFIED IDEOGRAPH-8D44}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24180 (\N{CJK UNIFIED IDEOGRAPH-5E74}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20221 (\N{CJK UNIFIED IDEOGRAPH-4EFD}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 32654 (\N{CJK UNIFIED IDEOGRAPH-7F8E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20803 (\N{CJK UNIFIED IDEOGRAPH-5143}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24179 (\N{CJK UNIFIED IDEOGRAPH-5E73}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 22343 (\N{CJK UNIFIED IDEOGRAPH-5747}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 23454 (\N{CJK UNIFIED IDEOGRAPH-5B9E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 38469 (\N{CJK UNIFIED IDEOGRAPH-9645}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 26368 (\N{CJK UNIFIED IDEOGRAPH-6700}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20302 (\N{CJK UNIFIED IDEOGRAPH-4F4E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24037 (\N{CJK UNIFIED IDEOGRAPH-5DE5}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 36164 (\N{CJK UNIFIED IDEOGRAPH-8D44}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/a7a46ec36ead309b750204d3194744c33706a4c1ad2aaf29efb1aed395658e8d.png" src="_images/a7a46ec36ead309b750204d3194744c33706a4c1ad2aaf29efb1aed395658e8d.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">.describe()</span></code> 可以快速获取一些常见的统计摘要数据</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_11573/4288984536.py:1: FutureWarning: The previous implementation of stack is deprecated and will be removed in a future version of pandas. See the What&#39;s New notes for pandas 2.1.0 for details. Specify future_stack=True to adopt the new implementation and silence this warning.
  merged.stack().describe()
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Continent</th>
      <th>America</th>
      <th>Asia</th>
      <th>Europe</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>69.00</td>
      <td>44.00</td>
      <td>200.00</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>3.19</td>
      <td>4.70</td>
      <td>5.15</td>
    </tr>
    <tr>
      <th>std</th>
      <td>3.02</td>
      <td>1.56</td>
      <td>3.82</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.52</td>
      <td>2.22</td>
      <td>0.23</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.03</td>
      <td>3.37</td>
      <td>2.02</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.44</td>
      <td>5.48</td>
      <td>3.54</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>6.96</td>
      <td>5.95</td>
      <td>9.70</td>
    </tr>
    <tr>
      <th>max</th>
      <td>8.48</td>
      <td>6.65</td>
      <td>12.39</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>这是使用 <code class="docutils literal notranslate"><span class="pre">groupby</span></code> 的简化方法。</p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">groupby</span></code> 通常遵循”拆分-应用-合并”的过程：</p>
<ul class="simple">
<li><p>拆分：数据根据一个或多个键进行分组</p></li>
<li><p>应用：在每个组上独立调用函数</p></li>
<li><p>合并：函数调用的结果被合并到新的数据结构中</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">groupby</span></code> 方法实现了这个过程的第一步，创建一个新的 <code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code> 对象，将数据拆分成组。</p>
<p>让我们再次按大洲拆分 <code class="docutils literal notranslate"><span class="pre">merged</span></code>，这次使用 <code class="docutils literal notranslate"><span class="pre">groupby</span></code> 函数，并将结果对象命名为 <code class="docutils literal notranslate"><span class="pre">grouped</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;Continent&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grouped</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_11573/920372348.py:1: FutureWarning: DataFrame.groupby with axis=1 is deprecated. Do `frame.T.groupby(...)` without axis instead.
  grouped = merged.groupby(level=&#39;Continent&#39;, axis=1)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x7f57e1673710&gt;
</pre></div>
</div>
</div>
</div>
<p>在对象上调用聚合方法会将函数应用于每个组，其结果会被合并到一个新的数据结构中。</p>
<p>例如，我们可以使用<code class="docutils literal notranslate"><span class="pre">.size()</span></code>返回数据集中每个大洲的国家数量。</p>
<p>在这种情况下，我们的新数据结构是一个<code class="docutils literal notranslate"><span class="pre">Series</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grouped</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Continent
America     7
Asia        4
Europe     19
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>通过调用 <code class="docutils literal notranslate"><span class="pre">.get_group()</span></code> 来返回单个组中的国家，我们可以为每个大洲创建2016年实际最低工资分布的核密度估计。</p>
<p><code class="docutils literal notranslate"><span class="pre">grouped.groups.keys()</span></code> 将返回 <code class="docutils literal notranslate"><span class="pre">groupby</span></code> 对象中的键</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">continents</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="k">for</span> <span class="n">continent</span> <span class="ow">in</span> <span class="n">continents</span><span class="p">:</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">grouped</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">continent</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2015&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="n">continent</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Real minimum wages in 2015&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;US dollars&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/31b29bdc8cf95b8c48bc031e710bc8ffb21f7fef7e0b87eb47bc3b34953b0259.png" src="_images/31b29bdc8cf95b8c48bc031e710bc8ffb21f7fef7e0b87eb47bc3b34953b0259.png" />
</div>
</div>
</section>
<section id="id6">
<h2><a class="toc-backref" href="#id13"><span class="section-number">72.5. </span>总结</a><a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h2>
<p>本讲座介绍了pandas的一些高级特性，包括多重索引、合并、分组和绘图。</p>
<p>在面板数据分析中可能有用的其他工具包括<a class="reference external" href="https://docs.xarray.dev/en/stable/">xarray</a>，这是一个将pandas扩展到N维数据结构的Python包。</p>
</section>
<section id="id7">
<h2><a class="toc-backref" href="#id14"><span class="section-number">72.6. </span>练习</a><a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h2>
<div class="exercise admonition" id="pp_ex1">

<p class="admonition-title"><span class="caption-number">Exercise 72.1 </span></p>
<section id="exercise-content">
<p>在这些练习中，你将使用来自<a class="reference external" href="https://ec.europa.eu/eurostat/data/database">Eurostat</a>的欧洲按年龄和性别划分的就业率数据集。</p>
<p>可以通过以下链接访问数据集：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url3</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/QuantEcon/lecture-python/master/source/_static/lecture_specific/pandas_panel/employ.csv&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>读取 CSV 文件会返回一个长格式的面板数据集。使用 <code class="docutils literal notranslate"><span class="pre">.pivot_table()</span></code> 构建一个带有 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 列的宽格式数据框。</p>
<p>首先探索数据框和 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 层级中可用的变量。</p>
<p>编写一个程序，快速返回 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 中的所有值。</p>
</section>
</div>
<div class="solution dropdown admonition" id="pandas_panel-solution-1">

<p class="admonition-title">Solution to<a class="reference internal" href="#pp_ex1"> Exercise 72.1</a></p>
<section id="solution-content">
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">employ</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url3</span><span class="p">)</span>
<span class="n">employ</span> <span class="o">=</span> <span class="n">employ</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span>
                            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DATE&#39;</span><span class="p">],</span>
                            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;UNIT&#39;</span><span class="p">,</span><span class="s1">&#39;AGE&#39;</span><span class="p">,</span> <span class="s1">&#39;SEX&#39;</span><span class="p">,</span> <span class="s1">&#39;INDIC_EM&#39;</span><span class="p">,</span> <span class="s1">&#39;GEO&#39;</span><span class="p">])</span>
<span class="n">employ</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">employ</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1"># 确保日期为 datetime 格式</span>
<span class="n">employ</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>UNIT</th>
      <th colspan="3" halign="left">Percentage of total population</th>
      <th>...</th>
      <th colspan="3" halign="left">Thousand persons</th>
    </tr>
    <tr>
      <th>AGE</th>
      <th colspan="3" halign="left">From 15 to 24 years</th>
      <th>...</th>
      <th colspan="3" halign="left">From 55 to 64 years</th>
    </tr>
    <tr>
      <th>SEX</th>
      <th colspan="3" halign="left">Females</th>
      <th>...</th>
      <th colspan="3" halign="left">Total</th>
    </tr>
    <tr>
      <th>INDIC_EM</th>
      <th colspan="3" halign="left">Active population</th>
      <th>...</th>
      <th colspan="3" halign="left">Total employment (resident population concept - LFS)</th>
    </tr>
    <tr>
      <th>GEO</th>
      <th>Austria</th>
      <th>Belgium</th>
      <th>Bulgaria</th>
      <th>...</th>
      <th>Switzerland</th>
      <th>Turkey</th>
      <th>United Kingdom</th>
    </tr>
    <tr>
      <th>DATE</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2007-01-01</th>
      <td>56.00</td>
      <td>31.60</td>
      <td>26.00</td>
      <td>...</td>
      <td>NaN</td>
      <td>1,282.00</td>
      <td>4,131.00</td>
    </tr>
    <tr>
      <th>2008-01-01</th>
      <td>56.20</td>
      <td>30.80</td>
      <td>26.10</td>
      <td>...</td>
      <td>NaN</td>
      <td>1,354.00</td>
      <td>4,204.00</td>
    </tr>
    <tr>
      <th>2009-01-01</th>
      <td>56.20</td>
      <td>29.90</td>
      <td>24.80</td>
      <td>...</td>
      <td>NaN</td>
      <td>1,449.00</td>
      <td>4,193.00</td>
    </tr>
    <tr>
      <th>2010-01-01</th>
      <td>54.00</td>
      <td>29.80</td>
      <td>26.60</td>
      <td>...</td>
      <td>640.00</td>
      <td>1,583.00</td>
      <td>4,186.00</td>
    </tr>
    <tr>
      <th>2011-01-01</th>
      <td>54.80</td>
      <td>29.80</td>
      <td>24.80</td>
      <td>...</td>
      <td>661.00</td>
      <td>1,760.00</td>
      <td>4,164.00</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 1440 columns</p>
</div></div></div>
</div>
<p>由于这是一个大型数据集，因此探索可用的层级和变量很有用</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">employ</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FrozenList([&#39;UNIT&#39;, &#39;AGE&#39;, &#39;SEX&#39;, &#39;INDIC_EM&#39;, &#39;GEO&#39;])
</pre></div>
</div>
</div>
</div>
<p>可以通过循环快速获取层级中的变量</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">employ</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">employ</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>UNIT Index([&#39;Percentage of total population&#39;, &#39;Thousand persons&#39;], dtype=&#39;object&#39;, name=&#39;UNIT&#39;)
AGE Index([&#39;From 15 to 24 years&#39;, &#39;From 25 to 54 years&#39;, &#39;From 55 to 64 years&#39;], dtype=&#39;object&#39;, name=&#39;AGE&#39;)
SEX Index([&#39;Females&#39;, &#39;Males&#39;, &#39;Total&#39;], dtype=&#39;object&#39;, name=&#39;SEX&#39;)
INDIC_EM Index([&#39;Active population&#39;, &#39;Total employment (resident population concept - LFS)&#39;], dtype=&#39;object&#39;, name=&#39;INDIC_EM&#39;)
GEO Index([&#39;Austria&#39;, &#39;Belgium&#39;, &#39;Bulgaria&#39;, &#39;Croatia&#39;, &#39;Cyprus&#39;, &#39;Czech Republic&#39;,
       &#39;Denmark&#39;, &#39;Estonia&#39;, &#39;Euro area (17 countries)&#39;,
       &#39;Euro area (18 countries)&#39;, &#39;Euro area (19 countries)&#39;,
       &#39;European Union (15 countries)&#39;, &#39;European Union (27 countries)&#39;,
       &#39;European Union (28 countries)&#39;, &#39;Finland&#39;,
       &#39;Former Yugoslav Republic of Macedonia, the&#39;, &#39;France&#39;,
       &#39;France (metropolitan)&#39;,
       &#39;Germany (until 1990 former territory of the FRG)&#39;, &#39;Greece&#39;, &#39;Hungary&#39;,
       &#39;Iceland&#39;, &#39;Ireland&#39;, &#39;Italy&#39;, &#39;Latvia&#39;, &#39;Lithuania&#39;, &#39;Luxembourg&#39;,
       &#39;Malta&#39;, &#39;Netherlands&#39;, &#39;Norway&#39;, &#39;Poland&#39;, &#39;Portugal&#39;, &#39;Romania&#39;,
       &#39;Slovakia&#39;, &#39;Slovenia&#39;, &#39;Spain&#39;, &#39;Sweden&#39;, &#39;Switzerland&#39;, &#39;Turkey&#39;,
       &#39;United Kingdom&#39;],
      dtype=&#39;object&#39;, name=&#39;GEO&#39;)
</pre></div>
</div>
</div>
</div>
</section>
</div>
<div class="exercise admonition" id="pp_ex2">

<p class="admonition-title"><span class="caption-number">Exercise 72.2 </span></p>
<section id="exercise-content">
<p>筛选上述数据框，仅包含以’活动人口’百分比表示的就业数据。</p>
<p>使用<code class="docutils literal notranslate"><span class="pre">seaborn</span></code>创建一个按年龄组和性别分组的2015年就业率箱线图。</p>
<div class="dropdown admonition hint">
<p class="admonition-title">Hint</p>
<p><code class="docutils literal notranslate"><span class="pre">GEO</span></code>包含地区和国家。</p>
</div>
</section>
</div>
<div class="solution dropdown admonition" id="pandas_panel-solution-3">

<p class="admonition-title">Solution to<a class="reference internal" href="#pp_ex2"> Exercise 72.2</a></p>
<section id="solution-content">
<p>为了方便按国家筛选，将<code class="docutils literal notranslate"><span class="pre">GEO</span></code>调整到最上层并对<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>进行排序</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">employ</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">employ</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">employ</span> <span class="o">=</span> <span class="n">employ</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>我们需要删除<code class="docutils literal notranslate"><span class="pre">GEO</span></code>中一些不是国家的项目。</p>
<p>一个快速去除欧盟地区的方法是使用列表推导式来查找<code class="docutils literal notranslate"><span class="pre">GEO</span></code>中以’Euro’开头的层级值。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geo_list</span> <span class="o">=</span> <span class="n">employ</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;GEO&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">countries</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">geo_list</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Euro&#39;</span><span class="p">)]</span>
<span class="n">employ</span> <span class="o">=</span> <span class="n">employ</span><span class="p">[</span><span class="n">countries</span><span class="p">]</span>
<span class="n">employ</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;GEO&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Austria&#39;, &#39;Belgium&#39;, &#39;Bulgaria&#39;, &#39;Croatia&#39;, &#39;Cyprus&#39;, &#39;Czech Republic&#39;,
       &#39;Denmark&#39;, &#39;Estonia&#39;, &#39;Finland&#39;,
       &#39;Former Yugoslav Republic of Macedonia, the&#39;, &#39;France&#39;,
       &#39;France (metropolitan)&#39;,
       &#39;Germany (until 1990 former territory of the FRG)&#39;, &#39;Greece&#39;, &#39;Hungary&#39;,
       &#39;Iceland&#39;, &#39;Ireland&#39;, &#39;Italy&#39;, &#39;Latvia&#39;, &#39;Lithuania&#39;, &#39;Luxembourg&#39;,
       &#39;Malta&#39;, &#39;Netherlands&#39;, &#39;Norway&#39;, &#39;Poland&#39;, &#39;Portugal&#39;, &#39;Romania&#39;,
       &#39;Slovakia&#39;, &#39;Slovenia&#39;, &#39;Spain&#39;, &#39;Sweden&#39;, &#39;Switzerland&#39;, &#39;Turkey&#39;,
       &#39;United Kingdom&#39;],
      dtype=&#39;object&#39;, name=&#39;GEO&#39;)
</pre></div>
</div>
</div>
</div>
<p>从数据框中仅选择活动人口中的就业百分比</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">employ_f</span> <span class="o">=</span> <span class="n">employ</span><span class="o">.</span><span class="n">xs</span><span class="p">((</span><span class="s1">&#39;Percentage of total population&#39;</span><span class="p">,</span> <span class="s1">&#39;Active population&#39;</span><span class="p">),</span>
                     <span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;UNIT&#39;</span><span class="p">,</span> <span class="s1">&#39;INDIC_EM&#39;</span><span class="p">),</span>
                     <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">employ_f</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>GEO</th>
      <th colspan="3" halign="left">Austria</th>
      <th>...</th>
      <th colspan="3" halign="left">United Kingdom</th>
    </tr>
    <tr>
      <th>AGE</th>
      <th colspan="3" halign="left">From 15 to 24 years</th>
      <th>...</th>
      <th colspan="3" halign="left">From 55 to 64 years</th>
    </tr>
    <tr>
      <th>SEX</th>
      <th>Females</th>
      <th>Males</th>
      <th>Total</th>
      <th>...</th>
      <th>Females</th>
      <th>Males</th>
      <th>Total</th>
    </tr>
    <tr>
      <th>DATE</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2007-01-01</th>
      <td>56.00</td>
      <td>62.90</td>
      <td>59.40</td>
      <td>...</td>
      <td>49.90</td>
      <td>68.90</td>
      <td>59.30</td>
    </tr>
    <tr>
      <th>2008-01-01</th>
      <td>56.20</td>
      <td>62.90</td>
      <td>59.50</td>
      <td>...</td>
      <td>50.20</td>
      <td>69.80</td>
      <td>59.80</td>
    </tr>
    <tr>
      <th>2009-01-01</th>
      <td>56.20</td>
      <td>62.90</td>
      <td>59.50</td>
      <td>...</td>
      <td>50.60</td>
      <td>70.30</td>
      <td>60.30</td>
    </tr>
    <tr>
      <th>2010-01-01</th>
      <td>54.00</td>
      <td>62.60</td>
      <td>58.30</td>
      <td>...</td>
      <td>51.10</td>
      <td>69.20</td>
      <td>60.00</td>
    </tr>
    <tr>
      <th>2011-01-01</th>
      <td>54.80</td>
      <td>63.60</td>
      <td>59.20</td>
      <td>...</td>
      <td>51.30</td>
      <td>68.40</td>
      <td>59.70</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 306 columns</p>
</div></div></div>
</div>
<p>在创建分组箱形图之前删除”总计”值</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">employ_f</span> <span class="o">=</span> <span class="n">employ_f</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Total&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;SEX&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">box</span> <span class="o">=</span> <span class="n">employ_f</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2015&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;AGE&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;SEX&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">box</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;husl&quot;</span><span class="p">),</span> <span class="n">showfliers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;人口百分比 (%)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;欧洲就业情况 (2015)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20154 (\N{CJK UNIFIED IDEOGRAPH-4EBA}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 21475 (\N{CJK UNIFIED IDEOGRAPH-53E3}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 30334 (\N{CJK UNIFIED IDEOGRAPH-767E}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20998 (\N{CJK UNIFIED IDEOGRAPH-5206}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 27604 (\N{CJK UNIFIED IDEOGRAPH-6BD4}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 27431 (\N{CJK UNIFIED IDEOGRAPH-6B27}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 27954 (\N{CJK UNIFIED IDEOGRAPH-6D32}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 23601 (\N{CJK UNIFIED IDEOGRAPH-5C31}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 19994 (\N{CJK UNIFIED IDEOGRAPH-4E1A}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 24773 (\N{CJK UNIFIED IDEOGRAPH-60C5}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
/home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 20917 (\N{CJK UNIFIED IDEOGRAPH-51B5}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/79d38d8ae705e4ee8c6ec7c94cc22d3479408a64cc80cff728a989cc4fff2f90.png" src="_images/79d38d8ae705e4ee8c6ec7c94cc22d3479408a64cc80cff728a989cc4fff2f90.png" />
</div>
</div>
</section>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                    <p>A theme by <a href="https://quantecon.org">QuantEcon</a></p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  工具与技术
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="sir_model.html">
   1. 新冠病毒建模
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_algebra.html">
   2. 线性代数
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="qr_decomp.html">
   3. QR分解
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="eig_circulant.html">
   4. 循环矩阵
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="svd_intro.html">
   5. 奇异值分解（SVD）
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="var_dmd.html">
   6. 向量自回归和动态模态分解
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="newton_method.html">
   7. 使用牛顿法求解经济模型
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  基础统计学
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="prob_matrix.html">
   8. 基础概率论与矩阵
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lln_clt.html">
   9. 大数定律 和 中心极限定理
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="prob_meaning.html">
   10. 概率的两种含义
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multi_hyper.html">
   11. 多元超几何分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multivariate_normal.html">
   12. 多元正态分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hoist_failure.html">
   13. 故障树不确定性
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="back_prop.html">
   14. 人工神经网络简介
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rand_resp.html">
   15. 随机化回应调查
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="util_rand_resp.html">
   16. 随机回答的期望效用
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  线性规划
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="opt_transport.html">
   17. 最优传输
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="von_neumann_model.html">
   18. 冯·诺依曼增长模型（及其推广）
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  动态系统导论
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="finite_markov.html">
   19. 有限马尔可夫链
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="inventory_dynamics.html">
   20. 库存动态
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_models.html">
   21. 线性状态空间模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="samuelson.html">
   22. 萨缪尔森乘数-加速器模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kesten_processes.html">
   23. Kesten过程与企业动态
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wealth_dynamics.html">
   24. 财富分布动态
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman.html">
   25. 初见卡尔曼滤波器
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman_2.html">
   26. 卡尔曼滤波器进阶
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  搜索
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model.html">
   27. 求职搜索 I: McCall搜寻模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model_with_separation.html">
   28. 求职搜索 II：搜寻与离职
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_fitted_vfi.html">
   29. 求职搜索 III: 拟合值函数迭代
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_correlated.html">
   30. 求职搜索 IV：相关工资报价
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="career.html">
   31. 求职搜索 V：职业选择建模
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="jv.html">
   32. 求职搜索 VI：在职搜索
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_q.html">
   33. 求职搜索 VII：McCall劳动者的Q学习
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  消费、储蓄与资本
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_1.html">
   34. Cass-Koopmans模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_2.html">
   35. Cass-Koopmans竞争均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_fiscal.html">
   36. 带扭曲性税收的Cass-Koopmans模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ak2.html">
   37. 重叠世代模型中的转换
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_problem.html">
   38. 蛋糕食用问题 I：最优储蓄导论
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_numerical.html">
   39. 蛋糕食用问题 II：数值方法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth.html">
   40. 最优增长 I：随机最优增长模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth_fast.html">
   41. 最优增长 II：使用Numba加速代码
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coleman_policy_iter.html">
   42. 最优增长 III：时间迭代
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="egm_policy_iter.html">
   43. 最优增长 IV：内生网格法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp.html">
   44. 收入波动问题 I：基本模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp_advanced.html">
   45. 收入波动问题 II：资产随机收益
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  贝叶斯定律
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="bayes_nonconj.html">
   46. 非共轭先验
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_bayes.html">
   47. AR(1)参数的后验分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_turningpts.html">
   48. 预测 AR(1) 过程
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  信息论
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="odu.html">
   49. 求职搜索 VII: 带学习的搜索
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_ratio_process.html">
   50. 似然比过程
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="imp_sample.html">
   51. 计算似然比过程的均值
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wald_friedman.html">
   52. 让弥尔顿·弗里德曼困惑的问题
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exchangeable.html">
   53. 可交换性和贝叶斯更新
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_bayes.html">
   54. 似然比过程和贝叶斯学习
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mix_model.html">
   55. 错误模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="navy_captain.html">
   56. 贝叶斯与频率主义决策规则的比较
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  LQ控制
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lqcontrol.html">
   57. LQ控制：基础
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lagrangian_lqdp.html">
   58. LQ控制的拉格朗日方法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cross_product_trick.html">
   59. 消除交叉项
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income.html">
   60. 永久收入模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income_cons.html">
   61. 永久收入 II：线性二次方法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lq_inventories.html">
   62. 通过库存实现生产平滑
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  多主体模型
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lake_model.html">
   63. 就业和失业的湖泊模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rational_expectations.html">
   64. 理性预期均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="re_with_feedback.html">
   65. 线性理性预期模型中的稳定性
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_perf.html">
   66. 马尔可夫完美均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="uncertainty_traps.html">
   67. 不确定性陷阱
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="aiyagari.html">
   68. 艾亚加里模型
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  资产定价与金融
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="markov_asset.html">
   69. 资产定价：有限状态模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ge_arrow.html">
   70. 带有阿罗证券的竞争均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="harrison_kreps.html">
   71. 异质信念与泡沫
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  数据与实证
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   72. 面板数据的Pandas使用
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ols.html">
   73. Python线性回归
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mle.html">
   74. 最大似然估计
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  拍卖
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="two_auctions.html">
   75. 一价和二价拍卖
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="house_auction.html">
   76. 多种商品分配机制
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  其他
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   77. 故障排除
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   78. 参考文献
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   79. 执行统计
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                </ul>

                <ul class="qe-toolbar__links">
                    <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off" accesskey="k">
                            <i data-feather="search" id="search-icon"></i>
                        </form>
                    </li>
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/pandas_panel.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li data-tippy-content="Download PDF" onClick="window.print()"><i data-feather="file"></i></li>
                    <!--
                    # Enable if looking for link to specific document hosted on GitHub
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst/pandas_panel.md" download><i data-feather="github"></i></a></li>
                    -->
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://colab.research.google.com/github/QuantEcon/lecture-python.zh-cn.notebooks/blob/main/pandas_panel.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-python.zh-cn.notebooks" data-urlpath="tree/lecture-python.zh-cn.notebooks/pandas_panel.ipynb" data-branch=main>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://colab.research.google.com/github/QuantEcon/lecture-python.zh-cn.notebooks/blob/main/pandas_panel.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "pandas_panel";
                const repoURL = "https://github.com/QuantEcon/lecture-python.zh-cn.notebooks";
                const urlPath = "tree/lecture-python.zh-cn.notebooks/pandas_panel.ipynb";
                const branch = "main"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>