
<!DOCTYPE html>


<html lang="zh-CN" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>79. 用Pandas处理面板数据 &#8212; Python中级数量经济学</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" href="_static/styles/quantecon-book-theme.css?digest=3bd9fcddbe64f63e07c8604843d1cc622a07b430" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css?v=982b99e0" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css?v=b4b7a797" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>


    <script src="_static/documentation_options.js?v=946197a6"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="_static/scripts/quantecon-book-theme.js?digest=30f7c850c5b005eca2ad6e48893cd350a6c6c4c2"></script>
    <script src="_static/scripts/jquery.js?v=5d32c60e"></script>
    <script src="_static/scripts/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="_static/translations.js?v=beaddf03"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-J0SMYR4SG3"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-J0SMYR4SG3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-J0SMYR4SG3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'pandas_panel';</script>
    <link rel="canonical" href="https://python.quantecon-zh-cn.org/pandas_panel.html" />
    <link rel="icon" href="_static/lectures-favicon.ico"/>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="80. Python线性回归" href="ols.html" />
    <link rel="prev" title="78. 异质信念与泡沫" href="harrison_kreps.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和编写的数量经济建模讲座。 />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="用Pandas处理面板数据"/>
<meta name="twitter:description" content="本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和编写的数量经济建模讲座。">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="用Pandas处理面板数据" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://python.quantecon-zh-cn.org/pandas_panel.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和编写的数量经济建模讲座。" />
<meta property="og:site_name" content="Python中级数量经济学" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>

<!-- Override QuantEcon theme colors -->

    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=pandas_panel>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">79.1. 概述</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">79.2. 切片和重塑数据</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nan">79.3. 合并数据框和填充空值（NaN 值）</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">79.4. 数据分组和汇总</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">79.5. 总结</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">79.6. 练习</a></li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo-large.png" class="logo logo-img" alt="logo"></a>
                                    
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/en/stable/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">Python中级数量经济学</a></p>

                        <p class="qe-page__header-subheading">用Pandas处理面板数据</p>

                    </div>
                    <!-- length 2, since its a string and empty dict has length 2 - {} -->
                        <p class="qe-page__header-authors" font-size="18">
                            
                                
                                    <a href="http://www.tomsargent.com/" target="_blank"><span>托马斯·萨金特（Thomas J. Sargent）</span></a>
                                
                            
                                
                                    and <a href="https://johnstachurski.net/" target="_blank"><span>约翰·斯塔胡斯基（John Stachurski）</span></a>
                                
                            
                        </p>


                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <section class="tex2jax_ignore mathjax_ignore" id="pandas">
<h1><a class="toc-backref" href="#id7" role="doc-backlink"><span class="section-number">79. </span><span class="target" id="index-0"></span>用Pandas处理面板数据</a><a class="headerlink" href="#pandas" title="Link to this heading">#</a></h1>
<nav class="contents" id="id1">
<span id="index-1"></span><p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#pandas" id="id7">用Pandas处理面板数据</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id8">概述</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id9">切片和重塑数据</a></p></li>
<li><p><a class="reference internal" href="#nan" id="id10">合并数据框和填充空值（NaN 值）</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id11">数据分组和汇总</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id12">总结</a></p></li>
<li><p><a class="reference internal" href="#id6" id="id13">练习</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="id2">
<h2><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">79.1. </span>概述</a><a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p>在<a class="reference external" href="https://python-programming.quantecon.org/pandas.html">之前关于pandas的讲座</a>中，我们学习了如何处理简单的数据集。</p>
<p>计量经济学家经常需要处理更复杂的数据集，比如面板数据。</p>
<p>常见的任务包括：</p>
<ul class="simple">
<li><p>导入数据、清理数据以及在多个轴上重塑数据。</p></li>
<li><p>从面板数据中提取时间序列数据或横截面数据。</p></li>
<li><p>对数据进行分组和汇总。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">pandas</span></code>（源自’panel’和’data’这两个词）包含强大且易用的工具，专门用于解决这类问题。</p>
<p>在接下来的内容中，我们将使用来自OECD的实际最低工资面板数据集来创建：</p>
<ul class="simple">
<li><p>数据在多个维度上的汇总统计</p></li>
<li><p>数据集中各国平均最低工资的时间序列</p></li>
<li><p>按大洲划分的工资核密度估计</p></li>
</ul>
<p>首先，我们将从CSV文件中读取长格式面板数据，并使用<code class="docutils literal notranslate"><span class="pre">pivot_table</span></code>重塑生成的<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>来构建<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>。</p>
<p>使用pandas的<code class="docutils literal notranslate"><span class="pre">merge</span></code>函数将为我们的<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>添加额外的详细信息，并使用<code class="docutils literal notranslate"><span class="pre">groupby</span></code>函数对数据进行汇总。</p>
</section>
<section id="id3">
<h2><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">79.2. </span>切片和重塑数据</a><a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<p>我们将读取来自OECD的32个国家的实际最低工资数据集，并将其赋值给<code class="docutils literal notranslate"><span class="pre">realwage</span></code>。</p>
<p>数据集可通过以下链接访问：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url1</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/QuantEcon/lecture-python/master/source/_static/lecture_specific/pandas_panel/realwage.csv&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># 为便于查看，显示数据集前6列</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<span class="c1"># 将小数点位数减少到2位</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>

<span class="n">realwage</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>让我们看看我们有什么可以使用的数据</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>  <span class="c1"># 显示前5行</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>Time</th>
      <th>Country</th>
      <th>Series</th>
      <th>Pay period</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>2006-01-01</td>
      <td>Ireland</td>
      <td>In 2015 constant prices at 2015 USD PPPs</td>
      <td>Annual</td>
      <td>17,132.44</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2007-01-01</td>
      <td>Ireland</td>
      <td>In 2015 constant prices at 2015 USD PPPs</td>
      <td>Annual</td>
      <td>18,100.92</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>2008-01-01</td>
      <td>Ireland</td>
      <td>In 2015 constant prices at 2015 USD PPPs</td>
      <td>Annual</td>
      <td>17,747.41</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>2009-01-01</td>
      <td>Ireland</td>
      <td>In 2015 constant prices at 2015 USD PPPs</td>
      <td>Annual</td>
      <td>18,580.14</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>2010-01-01</td>
      <td>Ireland</td>
      <td>In 2015 constant prices at 2015 USD PPPs</td>
      <td>Annual</td>
      <td>18,755.83</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>数据目前是长格式的，当数据有多个维度时，使用这种格式难以进行分析。</p>
<p>我们将使用<code class="docutils literal notranslate"><span class="pre">pivot_table</span></code>来创建宽格式面板，并使用<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>来处理高维数据。</p>
<p><code class="docutils literal notranslate"><span class="pre">pivot_table</span></code>的参数需要指定数据值（values）、索引和在结果数据框中我们所需的列名。</p>
<p>通过在columns参数中传入一个列表，我们可以在列轴上创建一个<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage</span> <span class="o">=</span> <span class="n">realwage</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span>
                                <span class="n">index</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
                                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="s1">&#39;Series&#39;</span><span class="p">,</span> <span class="s1">&#39;Pay period&#39;</span><span class="p">])</span>
<span class="n">realwage</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Country</th>
      <th colspan="3" halign="left">Australia</th>
      <th>...</th>
      <th colspan="3" halign="left">United States</th>
    </tr>
    <tr>
      <th>Series</th>
      <th colspan="2" halign="left">In 2015 constant prices at 2015 USD PPPs</th>
      <th>In 2015 constant prices at 2015 USD exchange rates</th>
      <th>...</th>
      <th>In 2015 constant prices at 2015 USD PPPs</th>
      <th colspan="2" halign="left">In 2015 constant prices at 2015 USD exchange rates</th>
    </tr>
    <tr>
      <th>Pay period</th>
      <th>Annual</th>
      <th>Hourly</th>
      <th>Annual</th>
      <th>...</th>
      <th>Hourly</th>
      <th>Annual</th>
      <th>Hourly</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2006-01-01</th>
      <td>20,410.65</td>
      <td>10.33</td>
      <td>23,826.64</td>
      <td>...</td>
      <td>6.05</td>
      <td>12,594.40</td>
      <td>6.05</td>
    </tr>
    <tr>
      <th>2007-01-01</th>
      <td>21,087.57</td>
      <td>10.67</td>
      <td>24,616.84</td>
      <td>...</td>
      <td>6.24</td>
      <td>12,974.40</td>
      <td>6.24</td>
    </tr>
    <tr>
      <th>2008-01-01</th>
      <td>20,718.24</td>
      <td>10.48</td>
      <td>24,185.70</td>
      <td>...</td>
      <td>6.78</td>
      <td>14,097.56</td>
      <td>6.78</td>
    </tr>
    <tr>
      <th>2009-01-01</th>
      <td>20,984.77</td>
      <td>10.62</td>
      <td>24,496.84</td>
      <td>...</td>
      <td>7.58</td>
      <td>15,756.42</td>
      <td>7.58</td>
    </tr>
    <tr>
      <th>2010-01-01</th>
      <td>20,879.33</td>
      <td>10.57</td>
      <td>24,373.76</td>
      <td>...</td>
      <td>7.88</td>
      <td>16,391.31</td>
      <td>7.88</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 128 columns</p>
</div></div></div>
</div>
<p>为了更容易地筛选我们的时间序列数据，接下来我们将把索引转换为<code class="docutils literal notranslate"><span class="pre">DateTimeIndex</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">realwage</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">realwage</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.indexes.datetimes.DatetimeIndex
</pre></div>
</div>
</div>
</div>
<p>该数据框的列包含多层级索引，被称为<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>，各层级按层次结构排序（Country &gt; Series &gt; Pay period）。</p>
<p><code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>是在pandas中管理面板数据最简单且最灵活的方式。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">realwage</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.indexes.multi.MultiIndex
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FrozenList([&#39;Country&#39;, &#39;Series&#39;, &#39;Pay period&#39;])
</pre></div>
</div>
</div>
</div>
<p>和之前一样，我们可以选择国家（<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>中的最高层级）</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage</span><span class="p">[</span><span class="s1">&#39;United States&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Series</th>
      <th colspan="2" halign="left">In 2015 constant prices at 2015 USD PPPs</th>
      <th colspan="2" halign="left">In 2015 constant prices at 2015 USD exchange rates</th>
    </tr>
    <tr>
      <th>Pay period</th>
      <th>Annual</th>
      <th>Hourly</th>
      <th>Annual</th>
      <th>Hourly</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2006-01-01</th>
      <td>12,594.40</td>
      <td>6.05</td>
      <td>12,594.40</td>
      <td>6.05</td>
    </tr>
    <tr>
      <th>2007-01-01</th>
      <td>12,974.40</td>
      <td>6.24</td>
      <td>12,974.40</td>
      <td>6.24</td>
    </tr>
    <tr>
      <th>2008-01-01</th>
      <td>14,097.56</td>
      <td>6.78</td>
      <td>14,097.56</td>
      <td>6.78</td>
    </tr>
    <tr>
      <th>2009-01-01</th>
      <td>15,756.42</td>
      <td>7.58</td>
      <td>15,756.42</td>
      <td>7.58</td>
    </tr>
    <tr>
      <th>2010-01-01</th>
      <td>16,391.31</td>
      <td>7.88</td>
      <td>16,391.31</td>
      <td>7.88</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>在本讲中，我们将经常使用<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>的堆叠和取消堆叠来将数据框重塑成所需的格式。</p>
<p><code class="docutils literal notranslate"><span class="pre">.stack()</span></code>将列<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>的最低层级旋转到行索引（<code class="docutils literal notranslate"><span class="pre">.unstack()</span></code>执行反向操作 - 你可以试试看）</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_11323/743219372.py:1: FutureWarning: The previous implementation of stack is deprecated and will be removed in a future version of pandas. See the What&#39;s New notes for pandas 2.1.0 for details. Specify future_stack=True to adopt the new implementation and silence this warning.
  realwage.stack().head()
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Country</th>
      <th colspan="2" halign="left">Australia</th>
      <th>Belgium</th>
      <th>...</th>
      <th>United Kingdom</th>
      <th colspan="2" halign="left">United States</th>
    </tr>
    <tr>
      <th></th>
      <th>Series</th>
      <th>In 2015 constant prices at 2015 USD PPPs</th>
      <th>In 2015 constant prices at 2015 USD exchange rates</th>
      <th>In 2015 constant prices at 2015 USD PPPs</th>
      <th>...</th>
      <th>In 2015 constant prices at 2015 USD exchange rates</th>
      <th>In 2015 constant prices at 2015 USD PPPs</th>
      <th>In 2015 constant prices at 2015 USD exchange rates</th>
    </tr>
    <tr>
      <th>Time</th>
      <th>Pay period</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">2006-01-01</th>
      <th>Annual</th>
      <td>20,410.65</td>
      <td>23,826.64</td>
      <td>21,042.28</td>
      <td>...</td>
      <td>20,376.32</td>
      <td>12,594.40</td>
      <td>12,594.40</td>
    </tr>
    <tr>
      <th>Hourly</th>
      <td>10.33</td>
      <td>12.06</td>
      <td>10.09</td>
      <td>...</td>
      <td>9.81</td>
      <td>6.05</td>
      <td>6.05</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2007-01-01</th>
      <th>Annual</th>
      <td>21,087.57</td>
      <td>24,616.84</td>
      <td>21,310.05</td>
      <td>...</td>
      <td>20,954.13</td>
      <td>12,974.40</td>
      <td>12,974.40</td>
    </tr>
    <tr>
      <th>Hourly</th>
      <td>10.67</td>
      <td>12.46</td>
      <td>10.22</td>
      <td>...</td>
      <td>10.07</td>
      <td>6.24</td>
      <td>6.24</td>
    </tr>
    <tr>
      <th>2008-01-01</th>
      <th>Annual</th>
      <td>20,718.24</td>
      <td>24,185.70</td>
      <td>21,416.96</td>
      <td>...</td>
      <td>20,902.87</td>
      <td>14,097.56</td>
      <td>14,097.56</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 64 columns</p>
</div></div></div>
</div>
<p>我们也可以传入一个参数来选择我们想要堆叠的层级</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;Country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_11323/1205496966.py:1: FutureWarning: The previous implementation of stack is deprecated and will be removed in a future version of pandas. See the What&#39;s New notes for pandas 2.1.0 for details. Specify future_stack=True to adopt the new implementation and silence this warning.
  realwage.stack(level=&#39;Country&#39;).head()
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Series</th>
      <th colspan="2" halign="left">In 2015 constant prices at 2015 USD PPPs</th>
      <th colspan="2" halign="left">In 2015 constant prices at 2015 USD exchange rates</th>
    </tr>
    <tr>
      <th></th>
      <th>Pay period</th>
      <th>Annual</th>
      <th>Hourly</th>
      <th>Annual</th>
      <th>Hourly</th>
    </tr>
    <tr>
      <th>Time</th>
      <th>Country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">2006-01-01</th>
      <th>Australia</th>
      <td>20,410.65</td>
      <td>10.33</td>
      <td>23,826.64</td>
      <td>12.06</td>
    </tr>
    <tr>
      <th>Belgium</th>
      <td>21,042.28</td>
      <td>10.09</td>
      <td>20,228.74</td>
      <td>9.70</td>
    </tr>
    <tr>
      <th>Brazil</th>
      <td>3,310.51</td>
      <td>1.41</td>
      <td>2,032.87</td>
      <td>0.87</td>
    </tr>
    <tr>
      <th>Canada</th>
      <td>13,649.69</td>
      <td>6.56</td>
      <td>14,335.12</td>
      <td>6.89</td>
    </tr>
    <tr>
      <th>Chile</th>
      <td>5,201.65</td>
      <td>2.22</td>
      <td>3,333.76</td>
      <td>1.42</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>使用<code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>可以轻松选择特定的时间段。</p>
<p>选择一年并堆叠<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>的两个较低层级，可以创建我们面板数据的横截面。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2015&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_11323/1065142626.py:1: FutureWarning: The previous implementation of stack is deprecated and will be removed in a future version of pandas. See the What&#39;s New notes for pandas 2.1.0 for details. Specify future_stack=True to adopt the new implementation and silence this warning.
  realwage.loc[&#39;2015&#39;].stack(level=(1, 2)).transpose().head()
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Time</th>
      <th colspan="4" halign="left">2015-01-01</th>
    </tr>
    <tr>
      <th>Series</th>
      <th colspan="2" halign="left">In 2015 constant prices at 2015 USD PPPs</th>
      <th colspan="2" halign="left">In 2015 constant prices at 2015 USD exchange rates</th>
    </tr>
    <tr>
      <th>Pay period</th>
      <th>Annual</th>
      <th>Hourly</th>
      <th>Annual</th>
      <th>Hourly</th>
    </tr>
    <tr>
      <th>Country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Australia</th>
      <td>21,715.53</td>
      <td>10.99</td>
      <td>25,349.90</td>
      <td>12.83</td>
    </tr>
    <tr>
      <th>Belgium</th>
      <td>21,588.12</td>
      <td>10.35</td>
      <td>20,753.48</td>
      <td>9.95</td>
    </tr>
    <tr>
      <th>Brazil</th>
      <td>4,628.63</td>
      <td>2.00</td>
      <td>2,842.28</td>
      <td>1.21</td>
    </tr>
    <tr>
      <th>Canada</th>
      <td>16,536.83</td>
      <td>7.95</td>
      <td>17,367.24</td>
      <td>8.35</td>
    </tr>
    <tr>
      <th>Chile</th>
      <td>6,633.56</td>
      <td>2.80</td>
      <td>4,251.49</td>
      <td>1.81</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>在本讲后续内容中，我们将使用按国家和时间维度统计的每小时实际最低工资数据框（计量单位为2015年不变价美元）。</p>
<p>为了创建筛选后的数据框（<code class="docutils literal notranslate"><span class="pre">realwage_f</span></code>），我们可以使用<code class="docutils literal notranslate"><span class="pre">xs</span></code>方法：在保持更高层级索引（本例中为国家）的同时，选择多级索引中较低层级的值。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage_f</span> <span class="o">=</span> <span class="n">realwage</span><span class="o">.</span><span class="n">xs</span><span class="p">((</span><span class="s1">&#39;Hourly&#39;</span><span class="p">,</span> <span class="s1">&#39;In 2015 constant prices at 2015 USD exchange rates&#39;</span><span class="p">),</span>
                         <span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Pay period&#39;</span><span class="p">,</span> <span class="s1">&#39;Series&#39;</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">realwage_f</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Country</th>
      <th>Australia</th>
      <th>Belgium</th>
      <th>Brazil</th>
      <th>...</th>
      <th>Turkey</th>
      <th>United Kingdom</th>
      <th>United States</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2006-01-01</th>
      <td>12.06</td>
      <td>9.70</td>
      <td>0.87</td>
      <td>...</td>
      <td>2.27</td>
      <td>9.81</td>
      <td>6.05</td>
    </tr>
    <tr>
      <th>2007-01-01</th>
      <td>12.46</td>
      <td>9.82</td>
      <td>0.92</td>
      <td>...</td>
      <td>2.26</td>
      <td>10.07</td>
      <td>6.24</td>
    </tr>
    <tr>
      <th>2008-01-01</th>
      <td>12.24</td>
      <td>9.87</td>
      <td>0.96</td>
      <td>...</td>
      <td>2.22</td>
      <td>10.04</td>
      <td>6.78</td>
    </tr>
    <tr>
      <th>2009-01-01</th>
      <td>12.40</td>
      <td>10.21</td>
      <td>1.03</td>
      <td>...</td>
      <td>2.28</td>
      <td>10.15</td>
      <td>7.58</td>
    </tr>
    <tr>
      <th>2010-01-01</th>
      <td>12.34</td>
      <td>10.05</td>
      <td>1.08</td>
      <td>...</td>
      <td>2.30</td>
      <td>9.96</td>
      <td>7.88</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 32 columns</p>
</div></div></div>
</div>
</section>
<section id="nan">
<h2><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">79.3. </span>合并数据框和填充空值（NaN 值）</a><a class="headerlink" href="#nan" title="Link to this heading">#</a></h2>
<p>与SQL等关系型数据库类似，pandas内置了合并数据集的方法。</p>
<p>使用来自<a class="reference external" href="https://www.worlddata.info/downloads/">WorldData.info</a>的国家信息，我们将使用<code class="docutils literal notranslate"><span class="pre">merge</span></code>函数将每个国家所属的大洲添加到<code class="docutils literal notranslate"><span class="pre">realwage_f</span></code>中。</p>
<p>可以通过以下链接访问数据集：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url2</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/QuantEcon/lecture-python/master/source/_static/lecture_specific/pandas_panel/countries.csv&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">worlddata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url2</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<span class="n">worlddata</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country (en)</th>
      <th>Country (de)</th>
      <th>Country (local)</th>
      <th>...</th>
      <th>Deathrate</th>
      <th>Life expectancy</th>
      <th>Url</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>Afghanistan</td>
      <td>Afganistan/Afqanestan</td>
      <td>...</td>
      <td>13.70</td>
      <td>51.30</td>
      <td>https://www.laenderdaten.info/Asien/Afghanista...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Egypt</td>
      <td>Ägypten</td>
      <td>Misr</td>
      <td>...</td>
      <td>4.70</td>
      <td>72.70</td>
      <td>https://www.laenderdaten.info/Afrika/Aegypten/...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Åland Islands</td>
      <td>Ålandinseln</td>
      <td>Åland</td>
      <td>...</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>https://www.laenderdaten.info/Europa/Aland/ind...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Albania</td>
      <td>Albanien</td>
      <td>Shqipëria</td>
      <td>...</td>
      <td>6.70</td>
      <td>78.30</td>
      <td>https://www.laenderdaten.info/Europa/Albanien/...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Algeria</td>
      <td>Algerien</td>
      <td>Al-Jaza’ir/Algérie</td>
      <td>...</td>
      <td>4.30</td>
      <td>76.80</td>
      <td>https://www.laenderdaten.info/Afrika/Algerien/...</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 17 columns</p>
</div></div></div>
</div>
<p>首先，我们将从<code class="docutils literal notranslate"><span class="pre">worlddata</span></code>中只选择国家和大洲变量，并将列名重命名为<code class="docutils literal notranslate"><span class="pre">Country</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">worlddata</span> <span class="o">=</span> <span class="n">worlddata</span><span class="p">[[</span><span class="s1">&#39;Country (en)&#39;</span><span class="p">,</span> <span class="s1">&#39;Continent&#39;</span><span class="p">]]</span>
<span class="n">worlddata</span> <span class="o">=</span> <span class="n">worlddata</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Country (en)&#39;</span><span class="p">:</span> <span class="s1">&#39;Country&#39;</span><span class="p">})</span>
<span class="n">worlddata</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Continent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Egypt</td>
      <td>Africa</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Åland Islands</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Albania</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Algeria</td>
      <td>Africa</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>我们想要将新的数据框<code class="docutils literal notranslate"><span class="pre">worlddata</span></code>与<code class="docutils literal notranslate"><span class="pre">realwage_f</span></code>合并。</p>
<p>pandas的<code class="docutils literal notranslate"><span class="pre">merge</span></code>函数可以通过行将数据框连接在一起。</p>
<p>我们的数据框将使用国家名称进行合并，这需要我们使用数据框<code class="docutils literal notranslate"><span class="pre">realwage_f</span></code>的转置，以便两个数据框中的行都对应于国家名称。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">realwage_f</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Time</th>
      <th>2006-01-01</th>
      <th>2007-01-01</th>
      <th>2008-01-01</th>
      <th>...</th>
      <th>2014-01-01</th>
      <th>2015-01-01</th>
      <th>2016-01-01</th>
    </tr>
    <tr>
      <th>Country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Australia</th>
      <td>12.06</td>
      <td>12.46</td>
      <td>12.24</td>
      <td>...</td>
      <td>12.67</td>
      <td>12.83</td>
      <td>12.98</td>
    </tr>
    <tr>
      <th>Belgium</th>
      <td>9.70</td>
      <td>9.82</td>
      <td>9.87</td>
      <td>...</td>
      <td>10.01</td>
      <td>9.95</td>
      <td>9.76</td>
    </tr>
    <tr>
      <th>Brazil</th>
      <td>0.87</td>
      <td>0.92</td>
      <td>0.96</td>
      <td>...</td>
      <td>1.21</td>
      <td>1.21</td>
      <td>1.24</td>
    </tr>
    <tr>
      <th>Canada</th>
      <td>6.89</td>
      <td>6.96</td>
      <td>7.24</td>
      <td>...</td>
      <td>8.22</td>
      <td>8.35</td>
      <td>8.48</td>
    </tr>
    <tr>
      <th>Chile</th>
      <td>1.42</td>
      <td>1.45</td>
      <td>1.44</td>
      <td>...</td>
      <td>1.76</td>
      <td>1.81</td>
      <td>1.91</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 11 columns</p>
</div></div></div>
</div>
<p>我们可以使用左连接（left）、右连接（right）、内连接（inner）或外连接（outer）来合并我们的数据集：</p>
<ul class="simple">
<li><p>左连接（left）只包含左侧数据集中的国家</p></li>
<li><p>右连接（right）只包含右侧数据集中的国家</p></li>
<li><p>内连接（inner）只包含左右数据集共有的国家</p></li>
<li><p>外连接（outer）包含左侧和右侧数据集中的任一国家</p></li>
</ul>
<p>默认情况下，<code class="docutils literal notranslate"><span class="pre">merge</span></code>将使用内连接（inner）。</p>
<p>在这个案例中，我们将传入<code class="docutils literal notranslate"><span class="pre">how='left'</span></code>以保留<code class="docutils literal notranslate"><span class="pre">realwage_f</span></code>中的所有国家，但丢弃<code class="docutils literal notranslate"><span class="pre">worlddata</span></code>中不能和<code class="docutils literal notranslate"><span class="pre">realwage_f</span></code>相匹配的国家。</p>
<p>这在下图中用红色阴影部分表示</p>
<figure class="align-default">
<img alt="_images/venn_diag.png" src="_images/venn_diag.png" />
</figure>
<p>我们还需要指定每个数据框中国家名称的位置，这将作为合并数据框的”键（key）”。</p>
<p>我们的”左”（left）数据框（<code class="docutils literal notranslate"><span class="pre">realwage_f.transpose()</span></code>）在索引中包含国家，所以我们设置<code class="docutils literal notranslate"><span class="pre">left_index=True</span></code>。</p>
<p>我们的”右”（right）数据框（<code class="docutils literal notranslate"><span class="pre">worlddata</span></code>）在’Country’列中包含国家名称，所以我们设置<code class="docutils literal notranslate"><span class="pre">right_on='Country'</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">realwage_f</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">worlddata</span><span class="p">,</span>
                  <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;Country&#39;</span><span class="p">)</span>
<span class="n">merged</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>2006-01-01 00:00:00</th>
      <th>2007-01-01 00:00:00</th>
      <th>2008-01-01 00:00:00</th>
      <th>...</th>
      <th>2016-01-01 00:00:00</th>
      <th>Country</th>
      <th>Continent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>17.00</th>
      <td>12.06</td>
      <td>12.46</td>
      <td>12.24</td>
      <td>...</td>
      <td>12.98</td>
      <td>Australia</td>
      <td>Australia</td>
    </tr>
    <tr>
      <th>23.00</th>
      <td>9.70</td>
      <td>9.82</td>
      <td>9.87</td>
      <td>...</td>
      <td>9.76</td>
      <td>Belgium</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>32.00</th>
      <td>0.87</td>
      <td>0.92</td>
      <td>0.96</td>
      <td>...</td>
      <td>1.24</td>
      <td>Brazil</td>
      <td>South America</td>
    </tr>
    <tr>
      <th>100.00</th>
      <td>6.89</td>
      <td>6.96</td>
      <td>7.24</td>
      <td>...</td>
      <td>8.48</td>
      <td>Canada</td>
      <td>North America</td>
    </tr>
    <tr>
      <th>38.00</th>
      <td>1.42</td>
      <td>1.45</td>
      <td>1.44</td>
      <td>...</td>
      <td>1.91</td>
      <td>Chile</td>
      <td>South America</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 13 columns</p>
</div></div></div>
</div>
<p>在 <code class="docutils literal notranslate"><span class="pre">realwage_f</span></code> 中出现但在 <code class="docutils literal notranslate"><span class="pre">worlddata</span></code> 中未出现的国家，其 <code class="docutils literal notranslate"><span class="pre">Continent</span></code> 列将显示 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>。</p>
<p>要检查是否发生这种情况，我们可以在 <code class="docutils literal notranslate"><span class="pre">Continent</span></code> 列上使用 <code class="docutils literal notranslate"><span class="pre">.isnull()</span></code> 并过滤合并后的数据框</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="p">[</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>2006-01-01 00:00:00</th>
      <th>2007-01-01 00:00:00</th>
      <th>2008-01-01 00:00:00</th>
      <th>...</th>
      <th>2016-01-01 00:00:00</th>
      <th>Country</th>
      <th>Continent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>NaN</th>
      <td>3.42</td>
      <td>3.74</td>
      <td>3.87</td>
      <td>...</td>
      <td>5.28</td>
      <td>Korea</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>NaN</th>
      <td>0.23</td>
      <td>0.45</td>
      <td>0.39</td>
      <td>...</td>
      <td>0.55</td>
      <td>Russian Federation</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>NaN</th>
      <td>1.50</td>
      <td>1.64</td>
      <td>1.71</td>
      <td>...</td>
      <td>2.08</td>
      <td>Slovak Republic</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 13 columns</p>
</div></div></div>
</div>
<p>我们有三个缺失值！</p>
<p>处理 NaN 值的一个方式是创建一个包含这些国家及其对应大洲的字典。</p>
<p><code class="docutils literal notranslate"><span class="pre">.map()</span></code> 将会把 <code class="docutils literal notranslate"><span class="pre">merged['Country']</span></code> 中的国家与字典中的大洲进行匹配。</p>
<p>注意那些不在我们字典中的国家是如何被映射为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code> 的</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">missing_continents</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Korea&#39;</span><span class="p">:</span> <span class="s1">&#39;Asia&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Russian Federation&#39;</span><span class="p">:</span> <span class="s1">&#39;Europe&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Slovak Republic&#39;</span><span class="p">:</span> <span class="s1">&#39;Europe&#39;</span><span class="p">}</span>

<span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">missing_continents</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17.00        NaN
23.00        NaN
32.00        NaN
100.00       NaN
38.00        NaN
108.00       NaN
41.00        NaN
225.00       NaN
53.00        NaN
58.00        NaN
45.00        NaN
68.00        NaN
233.00       NaN
86.00        NaN
88.00        NaN
91.00        NaN
NaN         Asia
117.00       NaN
122.00       NaN
123.00       NaN
138.00       NaN
153.00       NaN
151.00       NaN
174.00       NaN
175.00       NaN
NaN       Europe
NaN       Europe
198.00       NaN
200.00       NaN
227.00       NaN
241.00       NaN
240.00       NaN
Name: Country, dtype: object
</pre></div>
</div>
</div>
</div>
<p>我们不想用这个映射覆盖整个序列。</p>
<p><code class="docutils literal notranslate"><span class="pre">.fillna()</span></code> 只会用映射值填充 <code class="docutils literal notranslate"><span class="pre">merged['Continent']</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">NaN</span></code> 值，同时保持列中的其他值不变</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">missing_continents</span><span class="p">))</span>

<span class="c1"># 检查大洲是否被正确映射</span>
<span class="n">merged</span><span class="p">[</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Korea&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>2006-01-01 00:00:00</th>
      <th>2007-01-01 00:00:00</th>
      <th>2008-01-01 00:00:00</th>
      <th>...</th>
      <th>2016-01-01 00:00:00</th>
      <th>Country</th>
      <th>Continent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>NaN</th>
      <td>3.42</td>
      <td>3.74</td>
      <td>3.87</td>
      <td>...</td>
      <td>5.28</td>
      <td>Korea</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
<p>1 rows × 13 columns</p>
</div></div></div>
</div>
<p>我们把美洲合并成一个大洲 – 这样可以让我们后面的可视化效果更好。</p>
<p>为此，我们将使用<code class="docutils literal notranslate"><span class="pre">.replace()</span></code>并遍历一个包含我们想要替换的大洲的值的列表</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">replace</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Central America&#39;</span><span class="p">,</span> <span class="s1">&#39;North America&#39;</span><span class="p">,</span> <span class="s1">&#39;South America&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">country</span> <span class="ow">in</span> <span class="n">replace</span><span class="p">:</span>
    <span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                                <span class="p">{</span><span class="n">country</span><span class="p">:</span><span class="s1">&#39;America&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>现在我们已经将所有想要的数据都放在一个<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>中，我们将把它重新整形成带有<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>的面板形式。</p>
<p>我们还应该使用<code class="docutils literal notranslate"><span class="pre">.sort_index()</span></code>来确保对索引进行排序，这样我们之后可以高效地筛选数据框。</p>
<p>默认情况下，层级将按照从上到下的顺序排序</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Continent&#39;</span><span class="p">,</span> <span class="s1">&#39;Country&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">merged</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>2006-01-01</th>
      <th>2007-01-01</th>
      <th>2008-01-01</th>
      <th>...</th>
      <th>2014-01-01</th>
      <th>2015-01-01</th>
      <th>2016-01-01</th>
    </tr>
    <tr>
      <th>Continent</th>
      <th>Country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">America</th>
      <th>Brazil</th>
      <td>0.87</td>
      <td>0.92</td>
      <td>0.96</td>
      <td>...</td>
      <td>1.21</td>
      <td>1.21</td>
      <td>1.24</td>
    </tr>
    <tr>
      <th>Canada</th>
      <td>6.89</td>
      <td>6.96</td>
      <td>7.24</td>
      <td>...</td>
      <td>8.22</td>
      <td>8.35</td>
      <td>8.48</td>
    </tr>
    <tr>
      <th>Chile</th>
      <td>1.42</td>
      <td>1.45</td>
      <td>1.44</td>
      <td>...</td>
      <td>1.76</td>
      <td>1.81</td>
      <td>1.91</td>
    </tr>
    <tr>
      <th>Colombia</th>
      <td>1.01</td>
      <td>1.02</td>
      <td>1.01</td>
      <td>...</td>
      <td>1.13</td>
      <td>1.13</td>
      <td>1.12</td>
    </tr>
    <tr>
      <th>Costa Rica</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>2.41</td>
      <td>2.56</td>
      <td>2.63</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 11 columns</p>
</div></div></div>
</div>
<p>在合并过程中，我们丢失了<code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>，因为我们合并的列不是日期时间格式的</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([2006-01-01 00:00:00, 2007-01-01 00:00:00, 2008-01-01 00:00:00,
       2009-01-01 00:00:00, 2010-01-01 00:00:00, 2011-01-01 00:00:00,
       2012-01-01 00:00:00, 2013-01-01 00:00:00, 2014-01-01 00:00:00,
       2015-01-01 00:00:00, 2016-01-01 00:00:00],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>现在我们已经将合并的列设置为索引，我们可以使用<code class="docutils literal notranslate"><span class="pre">.to_datetime()</span></code>重新创建一个<code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">merged</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">merged</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatetimeIndex([&#39;2006-01-01&#39;, &#39;2007-01-01&#39;, &#39;2008-01-01&#39;, &#39;2009-01-01&#39;,
               &#39;2010-01-01&#39;, &#39;2011-01-01&#39;, &#39;2012-01-01&#39;, &#39;2013-01-01&#39;,
               &#39;2014-01-01&#39;, &#39;2015-01-01&#39;, &#39;2016-01-01&#39;],
              dtype=&#39;datetime64[ns]&#39;, name=&#39;Time&#39;, freq=None)
</pre></div>
</div>
</div>
</div>
<p>一般来说<code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>在行轴上运作起来更加顺畅，所以我们将对<code class="docutils literal notranslate"><span class="pre">merged</span></code>进行转置</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">merged</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Continent</th>
      <th colspan="3" halign="left">America</th>
      <th>...</th>
      <th colspan="3" halign="left">Europe</th>
    </tr>
    <tr>
      <th>Country</th>
      <th>Brazil</th>
      <th>Canada</th>
      <th>Chile</th>
      <th>...</th>
      <th>Slovenia</th>
      <th>Spain</th>
      <th>United Kingdom</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2006-01-01</th>
      <td>0.87</td>
      <td>6.89</td>
      <td>1.42</td>
      <td>...</td>
      <td>3.92</td>
      <td>3.99</td>
      <td>9.81</td>
    </tr>
    <tr>
      <th>2007-01-01</th>
      <td>0.92</td>
      <td>6.96</td>
      <td>1.45</td>
      <td>...</td>
      <td>3.88</td>
      <td>4.10</td>
      <td>10.07</td>
    </tr>
    <tr>
      <th>2008-01-01</th>
      <td>0.96</td>
      <td>7.24</td>
      <td>1.44</td>
      <td>...</td>
      <td>3.96</td>
      <td>4.14</td>
      <td>10.04</td>
    </tr>
    <tr>
      <th>2009-01-01</th>
      <td>1.03</td>
      <td>7.67</td>
      <td>1.52</td>
      <td>...</td>
      <td>4.08</td>
      <td>4.32</td>
      <td>10.15</td>
    </tr>
    <tr>
      <th>2010-01-01</th>
      <td>1.08</td>
      <td>7.94</td>
      <td>1.56</td>
      <td>...</td>
      <td>4.81</td>
      <td>4.30</td>
      <td>9.96</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 32 columns</p>
</div></div></div>
</div>
</section>
<section id="id4">
<h2><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">79.4. </span>数据分组和汇总</a><a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<p>对于理解大型面板数据集来说，数据分组和汇总特别有用。</p>
<p>一种简单的数据汇总方法是在数据框上调用<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/intro_tutorials/06_calculate_statistics.html">聚合方法</a>，比如<code class="docutils literal notranslate"><span class="pre">.mean()</span></code>或<code class="docutils literal notranslate"><span class="pre">.max()</span></code>。</p>
<p>例如，我们可以计算2006年至2016年期间每个国家的平均实际最低工资（默认是按行聚合）</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Continent  Country      
America    Brazil          1.09
           Canada          7.82
           Chile           1.62
           Colombia        1.07
           Costa Rica      2.53
           Mexico          0.53
           United States   7.15
Asia       Israel          5.95
           Japan           6.18
           Korea           4.22
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>使用这个数据序列，我们可以绘制数据集中每个国家过去十年的平均实际最低工资</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="n">FONTPATH</span> <span class="o">=</span> <span class="s2">&quot;fonts/SourceHanSerifSC-SemiBold.otf&quot;</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">fontManager</span><span class="o">.</span><span class="n">addfont</span><span class="p">(</span><span class="n">FONTPATH</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source Han Serif SC&#39;</span><span class="p">]</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="s1">&#39;Source Han Serif SC&#39;</span><span class="p">)</span>

<span class="c1"># 导入中文国家名称</span>
<span class="n">map_url</span><span class="o">=</span><span class="s1">&#39;https://raw.githubusercontent.com/QuantEcon/lecture-python.zh-cn/refs/heads/main/lectures/_static/country_map.csv&#39;</span>
<span class="n">country_map</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">map_url</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;English&#39;</span><span class="p">)[</span><span class="s1">&#39;Chinese&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;Continent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Time</th>
      <th>2006-01-01</th>
      <th>2007-01-01</th>
      <th>2008-01-01</th>
      <th>...</th>
      <th>2014-01-01</th>
      <th>2015-01-01</th>
      <th>2016-01-01</th>
    </tr>
    <tr>
      <th>Continent</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>America</th>
      <td>2.80</td>
      <td>2.85</td>
      <td>2.99</td>
      <td>...</td>
      <td>3.22</td>
      <td>3.26</td>
      <td>3.30</td>
    </tr>
    <tr>
      <th>Asia</th>
      <td>4.29</td>
      <td>4.44</td>
      <td>4.45</td>
      <td>...</td>
      <td>4.86</td>
      <td>5.10</td>
      <td>5.44</td>
    </tr>
    <tr>
      <th>Australia</th>
      <td>10.25</td>
      <td>10.73</td>
      <td>10.76</td>
      <td>...</td>
      <td>11.25</td>
      <td>11.52</td>
      <td>11.73</td>
    </tr>
    <tr>
      <th>Europe</th>
      <td>4.80</td>
      <td>4.94</td>
      <td>4.99</td>
      <td>...</td>
      <td>5.17</td>
      <td>5.48</td>
      <td>5.57</td>
    </tr>
  </tbody>
</table>
<p>4 rows × 11 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
          <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span>
          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;2006-2016年平均实际最低工资&quot;</span><span class="p">)</span>

<span class="c1"># 设置国家标签</span>
<span class="n">country_labels</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
    <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;Country&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># 将国家名称从英文转换为中文</span>
<span class="n">country_labels_cn</span> <span class="o">=</span> <span class="p">[</span><span class="n">country_map</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> 
                     <span class="ow">in</span> <span class="n">country_labels</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">country_labels</span><span class="p">)),</span> <span class="n">country_labels_cn</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;国家&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c237a728a98e652bcffd5a12b4ca9513deba835988d2353d56b54baf5e280515.png" src="_images/c237a728a98e652bcffd5a12b4ca9513deba835988d2353d56b54baf5e280515.png" />
</div>
</div>
<p>通过向<code class="docutils literal notranslate"><span class="pre">.mean()</span></code>传入<code class="docutils literal notranslate"><span class="pre">axis=1</span></code>参数可以对列进行聚合（得到所有国家随时间变化的平均最低工资）</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time
2006-01-01   4.69
2007-01-01   4.84
2008-01-01   4.90
2009-01-01   5.08
2010-01-01   5.11
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>我们可以将这个时间序列绘制成折线图</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;2006 - 2016年平均实际最低工资&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;2015年美元&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;年份&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/79fc87e41cb17e5fd36201214c27f6ccb02bdd0227ce4c11d87b7e1252a3431d.png" src="_images/79fc87e41cb17e5fd36201214c27f6ccb02bdd0227ce4c11d87b7e1252a3431d.png" />
</div>
</div>
<p>我们也可以指定<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>的一个层级（在列轴上）来进行聚合</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;Continent&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Time</th>
      <th>2006-01-01</th>
      <th>2007-01-01</th>
      <th>2008-01-01</th>
      <th>...</th>
      <th>2014-01-01</th>
      <th>2015-01-01</th>
      <th>2016-01-01</th>
    </tr>
    <tr>
      <th>Continent</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>America</th>
      <td>2.80</td>
      <td>2.85</td>
      <td>2.99</td>
      <td>...</td>
      <td>3.22</td>
      <td>3.26</td>
      <td>3.30</td>
    </tr>
    <tr>
      <th>Asia</th>
      <td>4.29</td>
      <td>4.44</td>
      <td>4.45</td>
      <td>...</td>
      <td>4.86</td>
      <td>5.10</td>
      <td>5.44</td>
    </tr>
    <tr>
      <th>Australia</th>
      <td>10.25</td>
      <td>10.73</td>
      <td>10.76</td>
      <td>...</td>
      <td>11.25</td>
      <td>11.52</td>
      <td>11.73</td>
    </tr>
    <tr>
      <th>Europe</th>
      <td>4.80</td>
      <td>4.94</td>
      <td>4.99</td>
      <td>...</td>
      <td>5.17</td>
      <td>5.48</td>
      <td>5.57</td>
    </tr>
  </tbody>
</table>
<p>4 rows × 11 columns</p>
</div></div></div>
</div>
<p>我们可以将每个大洲的平均最低工资绘制成时间序列图</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">continent_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Asia&#39;</span><span class="p">:</span><span class="s1">&#39;亚洲&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;Europe&#39;</span><span class="p">:</span><span class="s1">&#39;欧洲&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;America&#39;</span><span class="p">:</span><span class="s1">&#39;美洲&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Australia&#39;</span><span class="p">:</span><span class="s1">&#39;大洋洲&#39;</span><span class="p">}</span>

<span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">T</span>
       <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;Continent&#39;</span><span class="p">)</span> 
       <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
       <span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">continent_map</span><span class="p">)</span>                           
<span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;平均实际最低工资&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;2015年美元&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;年份&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;大洲&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6892024da3dd62be985756e88efbd100f3051290f363c7e5015897bb5d53285e.png" src="_images/6892024da3dd62be985756e88efbd100f3051290f363c7e5015897bb5d53285e.png" />
</div>
</div>
<p>出于绘图目的，我们将去掉澳大利亚这个大洲</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Australia&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;Continent&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">T</span>
      <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;Continent&#39;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
      <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">continent_map</span><span class="p">)</span>
      <span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;平均实际最低工资&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;大洲&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;2015年美元&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;年份&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/efee172cbaee14b97a6ead7d4d34f2100c97142de6d27ffb789da2b1f958e408.png" src="_images/efee172cbaee14b97a6ead7d4d34f2100c97142de6d27ffb789da2b1f958e408.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">.describe()</span></code> 可以快速获取一些常见的描述性统计量的汇总结果</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_11323/4288984536.py:1: FutureWarning: The previous implementation of stack is deprecated and will be removed in a future version of pandas. See the What&#39;s New notes for pandas 2.1.0 for details. Specify future_stack=True to adopt the new implementation and silence this warning.
  merged.stack().describe()
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Continent</th>
      <th>America</th>
      <th>Asia</th>
      <th>Europe</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>69.00</td>
      <td>44.00</td>
      <td>200.00</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>3.19</td>
      <td>4.70</td>
      <td>5.15</td>
    </tr>
    <tr>
      <th>std</th>
      <td>3.02</td>
      <td>1.56</td>
      <td>3.82</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.52</td>
      <td>2.22</td>
      <td>0.23</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.03</td>
      <td>3.37</td>
      <td>2.02</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.44</td>
      <td>5.48</td>
      <td>3.54</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>6.96</td>
      <td>5.95</td>
      <td>9.70</td>
    </tr>
    <tr>
      <th>max</th>
      <td>8.48</td>
      <td>6.65</td>
      <td>12.39</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>让我们更深入地了解 <code class="docutils literal notranslate"><span class="pre">groupby</span></code> 的工作原理。</p>
<p><code class="docutils literal notranslate"><span class="pre">groupby</span></code> 操作遵循一个称为”拆分-应用-合并”的模式:</p>
<ol class="arabic simple">
<li><p>首先，数据会按照指定的一个或多个键被拆分成多个组</p></li>
<li><p>然后，对每个组分别执行相同的操作或计算</p></li>
<li><p>最后，将所有组的结果合并成一个新的数据结构</p></li>
</ol>
<p>这种模式使我们能够对数据子集进行灵活的分组分析。</p>
<p><code class="docutils literal notranslate"><span class="pre">groupby</span></code> 方法实现了这个过程的第一步，创建一个新的 <code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code> 对象，将数据拆分成组。</p>
<p>让我们再次按大洲拆分 <code class="docutils literal notranslate"><span class="pre">merged</span></code>，这次使用 <code class="docutils literal notranslate"><span class="pre">groupby</span></code> 函数，并将生成的对象命名为 <code class="docutils literal notranslate"><span class="pre">grouped</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;Continent&#39;</span><span class="p">)</span>
<span class="n">grouped</span><span class="o">.</span><span class="n">keys</span>
</pre></div>
</div>
</div>
</div>
<p>在对象上调用<code class="docutils literal notranslate"><span class="pre">groupby</span></code>方法时，该函数会被应用于每个组，运算结果会被合并到一个新的数据结构中。</p>
<p>例如，我们可以使用<code class="docutils literal notranslate"><span class="pre">.size()</span></code>返回数据集中每个大洲的国家数量。</p>
<p>在这种情况下，我们的新数据结构是一个<code class="docutils literal notranslate"><span class="pre">Series</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grouped</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Continent
America     7
Asia        4
Europe     19
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>通过调用 <code class="docutils literal notranslate"><span class="pre">.get_group()</span></code> 来返回单个组中的国家，我们可以为每个大洲创建2016年实际最低工资分布的核密度估计。</p>
<p><code class="docutils literal notranslate"><span class="pre">grouped.groups.keys()</span></code> 将返回 <code class="docutils literal notranslate"><span class="pre">groupby</span></code> 对象中的键</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">continents</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="k">for</span> <span class="n">continent</span> <span class="ow">in</span> <span class="n">continents</span><span class="p">:</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">grouped</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">continent</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2015&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(),</span> 
                <span class="n">label</span><span class="o">=</span><span class="n">continent_map</span><span class="p">[</span><span class="n">continent</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;2015年实际最低工资&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;美元&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;密度&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6fd8a90d32d9fc5abca3efc871215c1972168cf30a1a2221926cc1a5e7bf6213.png" src="_images/6fd8a90d32d9fc5abca3efc871215c1972168cf30a1a2221926cc1a5e7bf6213.png" />
</div>
</div>
</section>
<section id="id5">
<h2><a class="toc-backref" href="#id12" role="doc-backlink"><span class="section-number">79.5. </span>总结</a><a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<p>本讲座介绍了pandas的一些高级特性，包括多级索引、合并、分组和绘图。</p>
<p>在面板数据分析中，其他可能有用的工具包括<a class="reference external" href="https://docs.xarray.dev/en/stable/">xarray</a>，这是一个将pandas扩展到N维数据结构的Python包。</p>
</section>
<section id="id6">
<h2><a class="toc-backref" href="#id13" role="doc-backlink"><span class="section-number">79.6. </span>练习</a><a class="headerlink" href="#id6" title="Link to this heading">#</a></h2>
<div class="exercise admonition" id="pp_ex1">

<p class="admonition-title"><span class="caption-number">Exercise 79.1 </span></p>
<section id="exercise-content">
<p>在这些练习中，你将使用来自<a class="reference external" href="https://ec.europa.eu/eurostat/data/database">Eurostat</a>的按年龄和性别划分的欧洲就业率数据集。</p>
<p>可以通过以下链接访问数据集：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url3</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/QuantEcon/lecture-python/master/source/_static/lecture_specific/pandas_panel/employ.csv&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>读取 CSV 文件会返回一个长格式的面板数据集。使用 <code class="docutils literal notranslate"><span class="pre">.pivot_table()</span></code> 构建一个带有 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 列的宽格式数据框。</p>
<p>首先探究数据框和 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 层级中可用的变量。</p>
<p>编写一个程序，快速返回 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 中的所有值。</p>
</section>
</div>
<div class="solution dropdown admonition" id="pandas_panel-solution-1">

<p class="admonition-title">Solution to<a class="reference internal" href="#pp_ex1"> Exercise 79.1</a></p>
<section id="solution-content">
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">employ</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url3</span><span class="p">)</span>
<span class="n">employ</span> <span class="o">=</span> <span class="n">employ</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span>
                            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DATE&#39;</span><span class="p">],</span>
                            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;UNIT&#39;</span><span class="p">,</span><span class="s1">&#39;AGE&#39;</span><span class="p">,</span> <span class="s1">&#39;SEX&#39;</span><span class="p">,</span> <span class="s1">&#39;INDIC_EM&#39;</span><span class="p">,</span> <span class="s1">&#39;GEO&#39;</span><span class="p">])</span>
<span class="n">employ</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">employ</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1"># 确保日期为 datetime 格式</span>
<span class="n">employ</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>UNIT</th>
      <th colspan="3" halign="left">Percentage of total population</th>
      <th>...</th>
      <th colspan="3" halign="left">Thousand persons</th>
    </tr>
    <tr>
      <th>AGE</th>
      <th colspan="3" halign="left">From 15 to 24 years</th>
      <th>...</th>
      <th colspan="3" halign="left">From 55 to 64 years</th>
    </tr>
    <tr>
      <th>SEX</th>
      <th colspan="3" halign="left">Females</th>
      <th>...</th>
      <th colspan="3" halign="left">Total</th>
    </tr>
    <tr>
      <th>INDIC_EM</th>
      <th colspan="3" halign="left">Active population</th>
      <th>...</th>
      <th colspan="3" halign="left">Total employment (resident population concept - LFS)</th>
    </tr>
    <tr>
      <th>GEO</th>
      <th>Austria</th>
      <th>Belgium</th>
      <th>Bulgaria</th>
      <th>...</th>
      <th>Switzerland</th>
      <th>Turkey</th>
      <th>United Kingdom</th>
    </tr>
    <tr>
      <th>DATE</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2007-01-01</th>
      <td>56.00</td>
      <td>31.60</td>
      <td>26.00</td>
      <td>...</td>
      <td>NaN</td>
      <td>1,282.00</td>
      <td>4,131.00</td>
    </tr>
    <tr>
      <th>2008-01-01</th>
      <td>56.20</td>
      <td>30.80</td>
      <td>26.10</td>
      <td>...</td>
      <td>NaN</td>
      <td>1,354.00</td>
      <td>4,204.00</td>
    </tr>
    <tr>
      <th>2009-01-01</th>
      <td>56.20</td>
      <td>29.90</td>
      <td>24.80</td>
      <td>...</td>
      <td>NaN</td>
      <td>1,449.00</td>
      <td>4,193.00</td>
    </tr>
    <tr>
      <th>2010-01-01</th>
      <td>54.00</td>
      <td>29.80</td>
      <td>26.60</td>
      <td>...</td>
      <td>640.00</td>
      <td>1,583.00</td>
      <td>4,186.00</td>
    </tr>
    <tr>
      <th>2011-01-01</th>
      <td>54.80</td>
      <td>29.80</td>
      <td>24.80</td>
      <td>...</td>
      <td>661.00</td>
      <td>1,760.00</td>
      <td>4,164.00</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 1440 columns</p>
</div></div></div>
</div>
<p>由于这是一个大型数据集，因此探索可用的层级和变量很有用</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">employ</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FrozenList([&#39;UNIT&#39;, &#39;AGE&#39;, &#39;SEX&#39;, &#39;INDIC_EM&#39;, &#39;GEO&#39;])
</pre></div>
</div>
</div>
</div>
<p>可以通过循环快速获取层级中的变量</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">employ</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">employ</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>UNIT Index([&#39;Percentage of total population&#39;, &#39;Thousand persons&#39;], dtype=&#39;object&#39;, name=&#39;UNIT&#39;)
AGE Index([&#39;From 15 to 24 years&#39;, &#39;From 25 to 54 years&#39;, &#39;From 55 to 64 years&#39;], dtype=&#39;object&#39;, name=&#39;AGE&#39;)
SEX Index([&#39;Females&#39;, &#39;Males&#39;, &#39;Total&#39;], dtype=&#39;object&#39;, name=&#39;SEX&#39;)
INDIC_EM Index([&#39;Active population&#39;, &#39;Total employment (resident population concept - LFS)&#39;], dtype=&#39;object&#39;, name=&#39;INDIC_EM&#39;)
GEO Index([&#39;Austria&#39;, &#39;Belgium&#39;, &#39;Bulgaria&#39;, &#39;Croatia&#39;, &#39;Cyprus&#39;, &#39;Czech Republic&#39;,
       &#39;Denmark&#39;, &#39;Estonia&#39;, &#39;Euro area (17 countries)&#39;,
       &#39;Euro area (18 countries)&#39;, &#39;Euro area (19 countries)&#39;,
       &#39;European Union (15 countries)&#39;, &#39;European Union (27 countries)&#39;,
       &#39;European Union (28 countries)&#39;, &#39;Finland&#39;,
       &#39;Former Yugoslav Republic of Macedonia, the&#39;, &#39;France&#39;,
       &#39;France (metropolitan)&#39;,
       &#39;Germany (until 1990 former territory of the FRG)&#39;, &#39;Greece&#39;, &#39;Hungary&#39;,
       &#39;Iceland&#39;, &#39;Ireland&#39;, &#39;Italy&#39;, &#39;Latvia&#39;, &#39;Lithuania&#39;, &#39;Luxembourg&#39;,
       &#39;Malta&#39;, &#39;Netherlands&#39;, &#39;Norway&#39;, &#39;Poland&#39;, &#39;Portugal&#39;, &#39;Romania&#39;,
       &#39;Slovakia&#39;, &#39;Slovenia&#39;, &#39;Spain&#39;, &#39;Sweden&#39;, &#39;Switzerland&#39;, &#39;Turkey&#39;,
       &#39;United Kingdom&#39;],
      dtype=&#39;object&#39;, name=&#39;GEO&#39;)
</pre></div>
</div>
</div>
</div>
</section>
</div>
<div class="exercise admonition" id="pp_ex2">

<p class="admonition-title"><span class="caption-number">Exercise 79.2 </span></p>
<section id="exercise-content">
<p>筛选上述数据框，仅保留以’活动人口’百分比表示的就业数据。</p>
<p>使用<code class="docutils literal notranslate"><span class="pre">seaborn</span></code>绘制一个按年龄和性别分组的2015年就业率箱线图。</p>
<div class="dropdown admonition hint">
<p class="admonition-title">提示</p>
<p><code class="docutils literal notranslate"><span class="pre">GEO</span></code>包含地区和国家。</p>
</div>
</section>
</div>
<div class="solution dropdown admonition" id="pandas_panel-solution-3">

<p class="admonition-title">Solution to<a class="reference internal" href="#pp_ex2"> Exercise 79.2</a></p>
<section id="solution-content">
<p>为了更方便地按国家筛选，将<code class="docutils literal notranslate"><span class="pre">GEO</span></code>调整到最上层并对<code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>进行排序</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">employ</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">employ</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">employ</span> <span class="o">=</span> <span class="n">employ</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>我们需要删除<code class="docutils literal notranslate"><span class="pre">GEO</span></code>中一些不是国家的项。</p>
<p>一个快速去除欧盟地区的方法是使用列表推导式来查找<code class="docutils literal notranslate"><span class="pre">GEO</span></code>中以’Euro’开头的层级值。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geo_list</span> <span class="o">=</span> <span class="n">employ</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;GEO&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">countries</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">geo_list</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Euro&#39;</span><span class="p">)]</span>
<span class="n">employ</span> <span class="o">=</span> <span class="n">employ</span><span class="p">[</span><span class="n">countries</span><span class="p">]</span>
<span class="n">employ</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;GEO&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Austria&#39;, &#39;Belgium&#39;, &#39;Bulgaria&#39;, &#39;Croatia&#39;, &#39;Cyprus&#39;, &#39;Czech Republic&#39;,
       &#39;Denmark&#39;, &#39;Estonia&#39;, &#39;Finland&#39;,
       &#39;Former Yugoslav Republic of Macedonia, the&#39;, &#39;France&#39;,
       &#39;France (metropolitan)&#39;,
       &#39;Germany (until 1990 former territory of the FRG)&#39;, &#39;Greece&#39;, &#39;Hungary&#39;,
       &#39;Iceland&#39;, &#39;Ireland&#39;, &#39;Italy&#39;, &#39;Latvia&#39;, &#39;Lithuania&#39;, &#39;Luxembourg&#39;,
       &#39;Malta&#39;, &#39;Netherlands&#39;, &#39;Norway&#39;, &#39;Poland&#39;, &#39;Portugal&#39;, &#39;Romania&#39;,
       &#39;Slovakia&#39;, &#39;Slovenia&#39;, &#39;Spain&#39;, &#39;Sweden&#39;, &#39;Switzerland&#39;, &#39;Turkey&#39;,
       &#39;United Kingdom&#39;],
      dtype=&#39;object&#39;, name=&#39;GEO&#39;)
</pre></div>
</div>
</div>
</div>
<p>仅选择数据框中活动人口的就业百分比</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">employ_f</span> <span class="o">=</span> <span class="n">employ</span><span class="o">.</span><span class="n">xs</span><span class="p">((</span><span class="s1">&#39;Percentage of total population&#39;</span><span class="p">,</span> <span class="s1">&#39;Active population&#39;</span><span class="p">),</span>
                     <span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;UNIT&#39;</span><span class="p">,</span> <span class="s1">&#39;INDIC_EM&#39;</span><span class="p">),</span>
                     <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">employ_f</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>GEO</th>
      <th colspan="3" halign="left">Austria</th>
      <th>...</th>
      <th colspan="3" halign="left">United Kingdom</th>
    </tr>
    <tr>
      <th>AGE</th>
      <th colspan="3" halign="left">From 15 to 24 years</th>
      <th>...</th>
      <th colspan="3" halign="left">From 55 to 64 years</th>
    </tr>
    <tr>
      <th>SEX</th>
      <th>Females</th>
      <th>Males</th>
      <th>Total</th>
      <th>...</th>
      <th>Females</th>
      <th>Males</th>
      <th>Total</th>
    </tr>
    <tr>
      <th>DATE</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2007-01-01</th>
      <td>56.00</td>
      <td>62.90</td>
      <td>59.40</td>
      <td>...</td>
      <td>49.90</td>
      <td>68.90</td>
      <td>59.30</td>
    </tr>
    <tr>
      <th>2008-01-01</th>
      <td>56.20</td>
      <td>62.90</td>
      <td>59.50</td>
      <td>...</td>
      <td>50.20</td>
      <td>69.80</td>
      <td>59.80</td>
    </tr>
    <tr>
      <th>2009-01-01</th>
      <td>56.20</td>
      <td>62.90</td>
      <td>59.50</td>
      <td>...</td>
      <td>50.60</td>
      <td>70.30</td>
      <td>60.30</td>
    </tr>
    <tr>
      <th>2010-01-01</th>
      <td>54.00</td>
      <td>62.60</td>
      <td>58.30</td>
      <td>...</td>
      <td>51.10</td>
      <td>69.20</td>
      <td>60.00</td>
    </tr>
    <tr>
      <th>2011-01-01</th>
      <td>54.80</td>
      <td>63.60</td>
      <td>59.20</td>
      <td>...</td>
      <td>51.30</td>
      <td>68.40</td>
      <td>59.70</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 306 columns</p>
</div></div></div>
</div>
<p>在绘制分组箱形图之前删除”总计”值</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">employ_f</span> <span class="o">=</span> <span class="n">employ_f</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Total&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;SEX&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">box</span> <span class="o">=</span> <span class="n">employ_f</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;2015&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">box</span><span class="p">[</span><span class="s1">&#39;SEX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s1">&#39;SEX&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;Males&#39;</span><span class="p">:</span> <span class="s1">&#39;男性&#39;</span><span class="p">,</span> <span class="s1">&#39;Females&#39;</span><span class="p">:</span> <span class="s1">&#39;女性&#39;</span><span class="p">})</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;AGE&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;SEX&quot;</span><span class="p">,</span> 
            <span class="n">data</span><span class="o">=</span><span class="n">box</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;husl&quot;</span><span class="p">),</span> 
            <span class="n">showfliers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;性别&#39;</span><span class="p">,</span> 
           <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

<span class="n">age_labels</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;From 15 to 24 years&#39;</span><span class="p">:</span> <span class="s1">&#39;15-24岁&#39;</span><span class="p">,</span>
    <span class="s1">&#39;From 25 to 54 years&#39;</span><span class="p">:</span> <span class="s1">&#39;25-54岁&#39;</span><span class="p">,</span>
    <span class="s1">&#39;From 55 to 64 years&#39;</span><span class="p">:</span> <span class="s1">&#39;55-64岁&#39;</span><span class="p">,</span>
    <span class="s1">&#39;From 65 to 74 years&#39;</span><span class="p">:</span> <span class="s1">&#39;65-74岁&#39;</span>
<span class="p">}</span>

<span class="n">xtick_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">age_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">get_text</span><span class="p">(),</span> 
                <span class="n">label</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span> 
                <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()]</span>
<span class="n">xticks</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">xtick_labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;年龄&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;人口百分比 (%)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;欧洲就业情况 (2015)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/90fd2c66d5d5ce78f039f80b1fd2bfaa3012c0a25dde1b3bd01e0c755637282a.png" src="_images/90fd2c66d5d5ce78f039f80b1fd2bfaa3012c0a25dde1b3bd01e0c755637282a.png" />
</div>
</div>
</section>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                    <p>A theme by <a href="https://quantecon.org">QuantEcon</a></p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  基础工具
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="sir_model.html">
   1. 新冠病毒建模
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_algebra.html">
   2. 线性代数
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="qr_decomp.html">
   3. QR分解
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="eig_circulant.html">
   4. 循环矩阵
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="svd_intro.html">
   5. 奇异值分解
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="var_dmd.html">
   6. 向量自回归和动态模态分解
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="newton_method.html">
   7. 使用牛顿法求解经济模型
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  基础统计学
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="prob_matrix.html">
   8. 基础概率论与矩阵
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stats_examples.html">
   9. 一些概率分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lln_clt.html">
   10. 大数定律 和 中心极限定理
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="prob_meaning.html">
   11. 概率的两种含义
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multi_hyper.html">
   12. 多元超几何分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multivariate_normal.html">
   13. 多元正态分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hoist_failure.html">
   14. 故障树不确定性
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="back_prop.html">
   15. 人工神经网络简介
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rand_resp.html">
   16. 随机化回应调查
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="util_rand_resp.html">
   17. 随机回答的期望效用
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  贝叶斯定律
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="bayes_nonconj.html">
   18. 非共轭先验
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_bayes.html">
   19. AR(1)参数的后验分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_turningpts.html">
   20. 预测 AR(1) 过程
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  统计与信息论
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="divergence_measures.html">
   21. 统计散度度量
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_ratio_process.html">
   22. 似然比过程
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_ratio_process_2.html">
   23. 异质信念与金融市场
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_var.html">
   24. VAR模型的似然过程
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="imp_sample.html">
   25. 似然比过程的均值
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wald_friedman.html">
   26. 让弥尔顿·弗里德曼困惑的问题
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wald_friedman_2.html">
   27. 用贝叶斯方法解决弗里德曼和瓦尔德问题
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exchangeable.html">
   28. 可交换性和贝叶斯更新
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_bayes.html">
   29. 似然比过程和贝叶斯学习
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mix_model.html">
   30. 错误模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="navy_captain.html">
   31. 贝叶斯与频率主义决策规则的比较
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  线性规划
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="opt_transport.html">
   32. 最优传输
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="von_neumann_model.html">
   33. 冯·诺依曼增长模型（及其推广）
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  动态系统导论
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="finite_markov.html">
   34. 有限马尔可夫链
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="inventory_dynamics.html">
   35. 库存动态
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_models.html">
   36. 线性状态空间模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="samuelson.html">
   37. 萨缪尔森乘数-加速器模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kesten_processes.html">
   38. Kesten过程与企业动态
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wealth_dynamics.html">
   39. 财富分布动态
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman.html">
   40. 初见卡尔曼滤波器
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman_2.html">
   41. 卡尔曼滤波器进阶
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  搜索
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model.html">
   42. 工作搜寻 I: McCall搜寻模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model_with_separation.html">
   43. 工作搜寻 II：搜寻与离职
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_fitted_vfi.html">
   44. 工作搜寻 III: 拟合值函数迭代
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_correlated.html">
   45. 工作搜寻 IV：相关工资报价
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="career.html">
   46. 工作搜寻 V：职业选择建模
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="jv.html">
   47. 工作搜寻 VI：在职搜索
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_q.html">
   48. 工作搜寻 VII：McCall劳动者的Q学习
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="odu.html">
   49. 工作搜寻 VII: 带学习的搜索
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  消费、储蓄与资本
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_1.html">
   50. Cass-Koopmans模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_2.html">
   51. Cass-Koopmans竞争均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_fiscal.html">
   52. 带扭曲性税收的Cass-Koopmans模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_fiscal_2.html">
   53. 带扭曲性税收的双国模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ak2.html">
   54. 代际交叠模型中的转型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_problem.html">
   55. 吃蛋糕问题 I：最优储蓄导论
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_numerical.html">
   56. 吃蛋糕问题 II：数值方法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth.html">
   57. 最优增长 I：随机最优增长模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth_fast.html">
   58. 最优增长 II：使用Numba加速代码
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coleman_policy_iter.html">
   59. 最优增长 III：时间迭代
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="egm_policy_iter.html">
   60. 最优增长 IV：内生网格法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp.html">
   61. 收入波动问题 I：基本模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp_advanced.html">
   62. 收入波动问题 II：资产随机收益
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  LQ控制
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lqcontrol.html">
   63. LQ控制：基础
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lagrangian_lqdp.html">
   64. LQ控制的拉格朗日方法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cross_product_trick.html">
   65. 消除交叉项
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income.html">
   66. 永久收入模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income_cons.html">
   67. 永久收入 II：线性二次方法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lq_inventories.html">
   68. 通过库存实现生产平滑
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  多主体模型
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lake_model.html">
   69. 就业与失业的湖泊模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rational_expectations.html">
   70. 理性预期均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="re_with_feedback.html">
   71. 线性理性预期模型中的稳定性
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_perf.html">
   72. 马尔可夫完美均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="uncertainty_traps.html">
   73. 不确定性陷阱
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="aiyagari.html">
   74. 艾亚加里模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ak_aiyagari.html">
   75. 长寿、异质性个体、世代交叠模型
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  资产定价与金融
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="markov_asset.html">
   76. 资产定价：有限状态模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ge_arrow.html">
   77. 带有阿罗证券的竞争均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="harrison_kreps.html">
   78. 异质信念与泡沫
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  数据与实证
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   79. 用Pandas处理面板数据
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ols.html">
   80. Python线性回归
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mle.html">
   81. 最大似然估计
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  拍卖
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="two_auctions.html">
   82. 一价和二价拍卖
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="house_auction.html">
   83. 多种商品分配机制
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  其他
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   84. 故障排除
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   85. 参考文献
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   86. 执行统计
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                </ul>

                <ul class="qe-toolbar__links">
                    <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off" accesskey="k">
                            <i data-feather="search" id="search-icon"></i>
                        </form>
                    </li>
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/pandas_panel.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li data-tippy-content="Download PDF" onClick="window.print()"><i data-feather="file"></i></li>
                    <!--
                    # Enable if looking for link to specific document hosted on GitHub
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst/pandas_panel.md" download><i data-feather="github"></i></a></li>
                    -->
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://colab.research.google.com/github/QuantEcon/lecture-python.zh-cn.notebooks/blob/main/pandas_panel.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-python.zh-cn.notebooks" data-urlpath="tree/lecture-python.zh-cn.notebooks/pandas_panel.ipynb" data-branch=main>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://colab.research.google.com/github/QuantEcon/lecture-python.zh-cn.notebooks/blob/main/pandas_panel.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "pandas_panel";
                const repoURL = "https://github.com/QuantEcon/lecture-python.zh-cn.notebooks";
                const urlPath = "tree/lecture-python.zh-cn.notebooks/pandas_panel.ipynb";
                const branch = "main"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>