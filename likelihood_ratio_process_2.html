
<!DOCTYPE html>


<html lang="zh-CN" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>23. 异质信念与金融市场 &#8212; Python中级数量经济学</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" href="_static/styles/quantecon-book-theme.css?digest=a459934d9fea1f60268e46d95e2569a33e1f6ec2" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css?v=982b99e0" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css?v=b4b7a797" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>


    <script src="_static/documentation_options.js?v=946197a6"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="_static/scripts/quantecon-book-theme.js?digest=06ebc90d5139b434c2742937a4ef3b185cb93e2f"></script>
    <script src="_static/scripts/jquery.js?v=5d32c60e"></script>
    <script src="_static/scripts/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="_static/translations.js?v=beaddf03"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-J0SMYR4SG3"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-J0SMYR4SG3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-J0SMYR4SG3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"tex": {"macros": {"argmax": "arg\\,max", "argmin": "arg\\,min"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'likelihood_ratio_process_2';</script>
    <link rel="canonical" href="https://python.quantecon-zh-cn.org/likelihood_ratio_process_2.html" />
    <link rel="icon" href="_static/lectures-favicon.ico"/>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="24. VAR模型的似然过程" href="likelihood_var.html" />
    <link rel="prev" title="22. 似然比过程" href="likelihood_ratio_process.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和编写的数量经济建模讲座。 />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="异质信念与金融市场"/>
<meta name="twitter:description" content="本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和编写的数量经济建模讲座。">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="异质信念与金融市场" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://python.quantecon-zh-cn.org/likelihood_ratio_process_2.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和编写的数量经济建模讲座。" />
<meta property="og:site_name" content="Python中级数量经济学" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>

<!-- Override QuantEcon theme colors -->

    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=likelihood_ratio_process_2>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">23.1. 概述</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">23.2. 回顾：似然比过程</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#blumeeasley">23.3. Blume和Easley的设定</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">23.4. 自然和个体的信念</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">23.5. 社会主义风险分担安排</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">23.6. 社会规划者的分配问题</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ldots">23.7. 如果你这么聪明，<span class="math notranslate nohighlight">\(\ldots\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">23.8. 竞争均衡价格</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">23.9. 模拟</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">23.10. 相关讲座</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">23.11. 练习</a></li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo-large.png" class="logo logo-img" alt="logo"></a>
                                    
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/en/stable/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">Python中级数量经济学</a></p>

                        <p class="qe-page__header-subheading">异质信念与金融市场</p>

                    </div>
                    <!-- length 2, since its a string and empty dict has length 2 - {} -->
                        <p class="qe-page__header-authors" font-size="18">
                            
                                
                                    <a href="http://www.tomsargent.com/" target="_blank"><span>托马斯·萨金特（Thomas J. Sargent）</span></a>
                                
                            
                                
                                    and <a href="https://johnstachurski.net/" target="_blank"><span>约翰·斯塔胡斯基（John Stachurski）</span></a>
                                
                            
                        </p>


                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1><a class="toc-backref" href="#id19" role="doc-backlink"><span class="section-number">23. </span>异质信念与金融市场</a><a class="headerlink" href="#id1" title="Link to this heading">#</a></h1>
<nav class="contents" id="id2">
<p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id1" id="id19">异质信念与金融市场</a></p>
<ul>
<li><p><a class="reference internal" href="#id3" id="id20">概述</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id21">回顾：似然比过程</a></p></li>
<li><p><a class="reference internal" href="#blumeeasley" id="id22">Blume和Easley的设定</a></p></li>
<li><p><a class="reference internal" href="#id9" id="id23">自然和个体的信念</a></p></li>
<li><p><a class="reference internal" href="#id10" id="id24">社会主义风险分担安排</a></p></li>
<li><p><a class="reference internal" href="#id11" id="id25">社会规划者的分配问题</a></p></li>
<li><p><a class="reference internal" href="#ldots" id="id26">如果你这么聪明，<span class="math notranslate nohighlight">\(\ldots\)</span></a></p></li>
<li><p><a class="reference internal" href="#id14" id="id27">竞争均衡价格</a></p></li>
<li><p><a class="reference internal" href="#id15" id="id28">模拟</a></p></li>
<li><p><a class="reference internal" href="#id16" id="id29">相关讲座</a></p></li>
<li><p><a class="reference internal" href="#id18" id="id30">练习</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="id3">
<h2><a class="toc-backref" href="#id20" role="doc-backlink"><span class="section-number">23.1. </span>概述</a><a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<p>似然比过程是Lawrence Blume和David Easley回答他们提出的问题”如果你那么聪明，为什么不富有？”的基础 <span id="id4">[<a class="reference internal" href="zreferences.html#id9" title="Lawrence Blume and David Easley. If you're so smart, why aren't you rich? belief selection in complete and incomplete markets. Econometrica, 74(4):929–966, 2006.">Blume and Easley, 2006</a>]</span>。</p>
<p>Blume和Easley构建了正式模型，研究关于风险收入过程概率的不同观点如何影响结果，以及如何反映在个人用来分享和对冲风险的股票、债券和保险政策的价格中。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><span id="id5">[<a class="reference internal" href="zreferences.html#id8" title="Armen A Alchian. Uncertainty, evolution, and economic theory. Journal of political economy, 58(3):211–221, 1950.">Alchian, 1950</a>]</span>和<span id="id6">[<a class="reference internal" href="zreferences.html#id7" title="Milton Friedman. Essays in positive economics. University of Chicago press, 1953.">Friedman, 1953</a>]</span>推测，通过奖励具有更现实概率模型的交易者，金融证券的竞争市场将财富置于信息更充分的交易者手中，并有助于使风险资产的价格反映现实的概率评估。</p>
</div>
<p>在这里，我们将提供一个示例来说明Blume和Easley分析的基本组成部分。</p>
<p>我们将只关注他们对完全市场环境的分析，在这种环境中可以进行所有可想象的风险证券交易。</p>
<p>我们将研究两种替代安排：</p>
<ul class="simple">
<li><p>完全的社会主义制度，在这种制度下，个人每期都将消费品的禀赋交给中央计划者，然后由计划者独裁式地分配这些商品</p></li>
<li><p>分散的竞争市场体系，在这种体系中，自私的价格接受者在竞争市场中自愿相互交易</p></li>
</ul>
<p>福利经济学的基本定理将适用，并向我们保证这两种安排最终会产生完全相同的消费品分配结果，<strong>前提是</strong>社会计划者分配了一组适当的<strong>帕累托权重</strong>。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>你可以在<a class="reference internal" href="cass_koopmans_1.html"><span class="doc">这篇关于规划问题的讲座</span></a>和<a class="reference internal" href="cass_koopmans_2.html"><span class="doc">这篇关于相关竞争均衡的讲座</span></a>中了解现代宏观经济模型如何应用这两个福利定理。<a class="reference internal" href="ge_arrow.html"><span class="doc">这篇quantecon讲座</span></a>介绍了具有同质信念的完全市场模型的递归表述。</p>
</div>
<p>让我们首先导入一些Python工具。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">FONTPATH</span> <span class="o">=</span> <span class="s2">&quot;fonts/SourceHanSerifSC-SemiBold.otf&quot;</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">fontManager</span><span class="o">.</span><span class="n">addfont</span><span class="p">(</span><span class="n">FONTPATH</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source Han Serif SC&#39;</span><span class="p">]</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numba</span><span class="w"> </span><span class="kn">import</span> <span class="n">vectorize</span><span class="p">,</span> <span class="n">jit</span><span class="p">,</span> <span class="n">prange</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">gamma</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">quad</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">FONTPATH</span> <span class="o">=</span> <span class="s2">&quot;fonts/SourceHanSerifSC-SemiBold.otf&quot;</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">fontManager</span><span class="o">.</span><span class="n">addfont</span><span class="p">(</span><span class="n">FONTPATH</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source Han Serif SC&#39;</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="ne">NameError</span>: name &#39;mpl&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="id7">
<h2><a class="toc-backref" href="#id21" role="doc-backlink"><span class="section-number">23.2. </span>回顾：似然比过程</a><a class="headerlink" href="#id7" title="Link to this heading">#</a></h2>
<p>让我们首先回顾似然比过程的定义和性质。</p>
<p>一个非负随机变量 <span class="math notranslate nohighlight">\(W\)</span> 具有两个概率密度函数之一，要么是 <span class="math notranslate nohighlight">\(f\)</span>，要么是 <span class="math notranslate nohighlight">\(g\)</span>。</p>
<p>在时间开始之前，自然界一劳永逸地决定是从 <span class="math notranslate nohighlight">\(f\)</span> 还是 <span class="math notranslate nohighlight">\(g\)</span> 中进行一系列独立同分布的抽样。</p>
<p>我们有时用 <span class="math notranslate nohighlight">\(q\)</span> 表示自然界永久选择的密度，所以 <span class="math notranslate nohighlight">\(q\)</span> 要么是 <span class="math notranslate nohighlight">\(f\)</span>，要么是 <span class="math notranslate nohighlight">\(g\)</span>，且是永久性的。</p>
<p>自然界知道它永久从哪个密度中抽样，但我们这些观察者并不知道。</p>
<p>我们知道 <span class="math notranslate nohighlight">\(f\)</span> 和 <span class="math notranslate nohighlight">\(g\)</span> 两个密度，但不知道自然界选择了哪个。</p>
<p>但我们想要知道。</p>
<p>为此，我们使用观测值。</p>
<p>我们观察到一个序列 <span class="math notranslate nohighlight">\(\{w_t\}_{t=1}^T\)</span>，包含 <span class="math notranslate nohighlight">\(T\)</span> 个独立同分布的抽样，我们知道这些抽样要么来自 <span class="math notranslate nohighlight">\(f\)</span>，要么来自 <span class="math notranslate nohighlight">\(g\)</span>。</p>
<p>我们想要利用这些观测值来推断自然界选择了 <span class="math notranslate nohighlight">\(f\)</span> 还是 <span class="math notranslate nohighlight">\(g\)</span>。</p>
<p><strong>似然比过程</strong>是完成这项任务的有用工具。</p>
<p>首先，我们定义似然比过程的一个关键组成部分，即时间 <span class="math notranslate nohighlight">\(t\)</span> 的似然比，它是一个随机变量：</p>
<div class="math notranslate nohighlight">
\[
\ell (w_t)=\frac{f\left(w_t\right)}{g\left(w_t\right)},\quad t\geq1.
\]</div>
<p>我们假设 <span class="math notranslate nohighlight">\(f\)</span> 和 <span class="math notranslate nohighlight">\(g\)</span> 在随机变量 <span class="math notranslate nohighlight">\(W\)</span> 的相同可能实现区间上都赋予正概率。</p>
<p>这意味着在 <span class="math notranslate nohighlight">\(g\)</span> 密度下，<span class="math notranslate nohighlight">\(\ell (w_t)= \frac{f\left(w_{t}\right)}{g\left(w_{t}\right)}\)</span> 是一个均值为1的非负随机变量。</p>
<p>序列的<strong>似然比过程</strong>为</p>
<p><span class="math notranslate nohighlight">\(\left\{ w_{t}\right\} _{t=1}^{\infty}\)</span> 定义为</p>
<div class="math notranslate nohighlight">
\[
L\left(w^{t}\right)=\prod_{i=1}^{t} \ell (w_i),
\]</div>
<p>其中 <span class="math notranslate nohighlight">\(w^t=\{ w_1,\dots,w_t\}\)</span> 是直到时间 <span class="math notranslate nohighlight">\(t\)</span> (包括 <span class="math notranslate nohighlight">\(t\)</span>) 的观测历史。</p>
<p>有时为简便起见，我们会写 <span class="math notranslate nohighlight">\(L_t = L(w^t)\)</span>。</p>
<p>注意，似然过程满足以下<em>递归</em>关系</p>
<div class="math notranslate nohighlight">
\[
L(w^t) = \ell (w_t) L (w^{t-1}) .
\]</div>
<p>似然比及其对数是使用 Neyman 和 Pearson 经典频率派方法进行推断的关键工具 <span id="id8">[<a class="reference internal" href="zreferences.html#id263" title="J. Neyman and E. S Pearson. On the problem of the most efficient tests of statistical hypotheses. Phil. Trans. R. Soc. Lond. A. 231 (694–706), pages 289–337, 1933.">Neyman and Pearson, 1933</a>]</span>。</p>
<p>为了帮助我们理解其工作原理，以下 Python 代码将 <span class="math notranslate nohighlight">\(f\)</span> 和 <span class="math notranslate nohighlight">\(g\)</span> 评估为两个不同的 Beta 分布，然后通过从两个概率分布中的一个生成序列 <span class="math notranslate nohighlight">\(w^t\)</span>（例如，从 <span class="math notranslate nohighlight">\(g\)</span> 生成的 IID 抽样序列）来计算和模拟相关的似然比过程。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 两个 Beta 分布的参数</span>
<span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span>

<span class="nd">@vectorize</span>
<span class="k">def</span><span class="w"> </span><span class="nf">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">r</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># 两个密度函数</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">))</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">simulate</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    生成N组T个似然比观测值，</span>
<span class="sd">    以N x T矩阵形式返回。</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">l_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">l_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">g</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">l_arr</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="blumeeasley">
<h2><a class="toc-backref" href="#id22" role="doc-backlink"><span class="section-number">23.3. </span>Blume和Easley的设定</a><a class="headerlink" href="#blumeeasley" title="Link to this heading">#</a></h2>
<p>令随机变量 <span class="math notranslate nohighlight">\(s_t \in (0,1)\)</span> 在时间 <span class="math notranslate nohighlight">\(t =0, 1, 2, \ldots\)</span> 按照具有参数 <span class="math notranslate nohighlight">\(\theta = \{\theta_1, \theta_2\}\)</span> 的相同Beta分布分布。</p>
<p>我们将这个概率密度表示为</p>
<div class="math notranslate nohighlight">
\[
\pi(s_t|\theta)
\]</div>
<p>为了节省空间，下面我们通常会直接写 <span class="math notranslate nohighlight">\(\pi(s_t)\)</span> 而不是 <span class="math notranslate nohighlight">\(\pi(s_t|\theta)\)</span>。</p>
<p>令 <span class="math notranslate nohighlight">\(s_t \equiv y_t^1\)</span> 为我们称为”个体1”在时间 <span class="math notranslate nohighlight">\(t\)</span> 获得的不可储存消费品的禀赋。</p>
<p>令历史 <span class="math notranslate nohighlight">\(s^t = [s_t, s_{t-1}, \ldots, s_0]\)</span> 为具有联合分布的独立同分布随机变量序列</p>
<div class="math notranslate nohighlight">
\[
\pi_t(s^t) = \pi(s_t) \pi(s_{t-1}) \cdots \pi(s_0)
\]</div>
<p>因此在我们的例子中，历史 <span class="math notranslate nohighlight">\(s^t\)</span> 是从时间 <span class="math notranslate nohighlight">\(0\)</span> 到时间 <span class="math notranslate nohighlight">\(t\)</span> 个体 <span class="math notranslate nohighlight">\(1\)</span> 的消费品禀赋的完整记录。</p>
<p>如果个体 <span class="math notranslate nohighlight">\(1\)</span> 独自生活在一个岛上，个体 <span class="math notranslate nohighlight">\(1\)</span> 在时间 <span class="math notranslate nohighlight">\(t\)</span> 的消费 <span class="math notranslate nohighlight">\(c^1(s_t)\)</span> 是</p>
<div class="math notranslate nohighlight">
\[c^1(s_t) = y_t^1 = s_t. \]</div>
<p>但在我们的模型中，个体1并不是孤独的。</p>
</section>
<section id="id9">
<h2><a class="toc-backref" href="#id23" role="doc-backlink"><span class="section-number">23.4. </span>自然和个体的信念</a><a class="headerlink" href="#id9" title="Link to this heading">#</a></h2>
<p>自然从 <span class="math notranslate nohighlight">\(\pi_t(s^t)\)</span> 中抽取独立同分布序列 <span class="math notranslate nohighlight">\(\{s_t\}_{t=0}^\infty\)</span>。</p>
<ul class="simple">
<li><p>所以没有上标的 <span class="math notranslate nohighlight">\(\pi\)</span> 是自然的模型</p></li>
<li><p>但除了自然之外，我们的模型中还有其他实体——我们称之为”个体”的人工个体</p></li>
<li><p>每个个体对 <span class="math notranslate nohighlight">\(t=0, \ldots\)</span> 时的 <span class="math notranslate nohighlight">\(s^t\)</span> 都有一个概率分布序列</p></li>
<li><p>个体 <span class="math notranslate nohighlight">\(i\)</span> 认为自然从 <span class="math notranslate nohighlight">\(\{\pi_t^i(s^t)\}_{t=0}^\infty\)</span> 中抽取独立同分布序列 <span class="math notranslate nohighlight">\(\{s_t\}_{t=0}^\infty\)</span></p></li>
<li><p>除非 <span class="math notranslate nohighlight">\(\pi_t^i(s^t) = \pi_t(s^t)\)</span>，否则个体 <span class="math notranslate nohighlight">\(i\)</span> 是错误的</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><strong>理性预期</strong>模型会对所有个体 <span class="math notranslate nohighlight">\(i\)</span> 设定 <span class="math notranslate nohighlight">\(\pi_t^i(s^t) = \pi_t(s^t)\)</span>。</p>
</div>
<p>有两个个体，分别标记为 <span class="math notranslate nohighlight">\(i=1\)</span> 和 <span class="math notranslate nohighlight">\(i=2\)</span>。</p>
<p>在时间 <span class="math notranslate nohighlight">\(t\)</span>，个体 <span class="math notranslate nohighlight">\(1\)</span> 获得一个不可储存的消费品的禀赋</p>
<div class="math notranslate nohighlight">
\[
y_t^1 = s_t 
\]</div>
<p>而个体 <span class="math notranslate nohighlight">\(2\)</span> 获得禀赋</p>
<div class="math notranslate nohighlight">
\[
y_t^2 = 1 - s_t 
\]</div>
<p>消费品的总禀赋为</p>
<div class="math notranslate nohighlight">
\[
y_t^1 + y_t^2 = 1
\]</div>
<p>这在每个时间点 <span class="math notranslate nohighlight">\(t \geq 0\)</span> 都成立。</p>
<p>在时间 <span class="math notranslate nohighlight">\(t\)</span>，个体 <span class="math notranslate nohighlight">\(i\)</span> 消费 <span class="math notranslate nohighlight">\(c_t^i(s^t)\)</span> 单位的商品。</p>
<p>每期总禀赋为1的(无浪费的)可行分配满足</p>
<div class="math notranslate nohighlight">
\[
c_t^1 + c_t^2 = 1 .
\]</div>
</section>
<section id="id10">
<h2><a class="toc-backref" href="#id24" role="doc-backlink"><span class="section-number">23.5. </span>社会主义风险分担安排</a><a class="headerlink" href="#id10" title="Link to this heading">#</a></h2>
<p>为了分担风险，一个仁慈的社会规划者制定了一个依赖于历史的消费分配，它采用一系列函数的形式</p>
<div class="math notranslate nohighlight">
\[
c_t^i = c_t^i(s^t)
\]</div>
<p>这些函数满足</p>
<div class="math notranslate nohighlight" id="equation-eq-feasibility">
<span class="eqno">(23.1)<a class="headerlink" href="#equation-eq-feasibility" title="Link to this equation">#</a></span>\[
c_t^1(s^t) + c_t^2(s^t) = 1  
\]</div>
<p>对所有 <span class="math notranslate nohighlight">\(s^t\)</span> 和所有 <span class="math notranslate nohighlight">\(t \geq 0\)</span> 成立。</p>
<p>为了设计一个社会最优分配，社会规划者需要知道个体1对禀赋序列的信念以及他们对承担风险的态度。</p>
<p>关于禀赋序列，个体 <span class="math notranslate nohighlight">\(i\)</span> 认为自然从联合密度中独立同分布地抽取序列</p>
<div class="math notranslate nohighlight">
\[
\pi_t^i(s^t) = \pi^i(s_t) \pi^i(s_{t-1}) \cdots \pi^i(s_0)
\]</div>
<p>关于承担风险的态度，个体 <span class="math notranslate nohighlight">\(i\)</span> 有一个单期效用函数</p>
<div class="math notranslate nohighlight">
\[
u(c_t^i) = \ln (c_t^i)
\]</div>
<p>在第<span class="math notranslate nohighlight">\(t\)</span>期的消费边际效用为</p>
<div class="math notranslate nohighlight">
\[
u'(c_t^i) = \frac{1}{c_t^i}
\]</div>
<p>将其对随机禀赋序列的信念和对承担风险的态度结合起来，个体<span class="math notranslate nohighlight">\(i\)</span>的跨期效用函数为</p>
<div class="math notranslate nohighlight" id="equation-eq-objectiveagenti">
<span class="eqno">(23.2)<a class="headerlink" href="#equation-eq-objectiveagenti" title="Link to this equation">#</a></span>\[
V^i = \sum_{t=0}^{\infty} \sum_{s^t} \delta^t u(c_t^i(s^t)) \pi_t^i(s^t) ,
\]</div>
<p>其中<span class="math notranslate nohighlight">\(\delta \in (0,1)\)</span>是跨期贴现因子，<span class="math notranslate nohighlight">\(u(\cdot)\)</span>是严格递增、凹的单期效用函数。</p>
</section>
<section id="id11">
<h2><a class="toc-backref" href="#id25" role="doc-backlink"><span class="section-number">23.6. </span>社会规划者的分配问题</a><a class="headerlink" href="#id11" title="Link to this heading">#</a></h2>
<p>仁慈的独裁者拥有所需的全部信息来选择一个消费分配，以最大化社会福利标准</p>
<div class="math notranslate nohighlight" id="equation-eq-welfarew">
<span class="eqno">(23.3)<a class="headerlink" href="#equation-eq-welfarew" title="Link to this equation">#</a></span>\[
W = \lambda V^1 + (1-\lambda) V^2
\]</div>
<p>其中<span class="math notranslate nohighlight">\(\lambda \in [0,1]\)</span>是帕累托权重，表示规划者对个体<span class="math notranslate nohighlight">\(1\)</span>的偏好程度，而<span class="math notranslate nohighlight">\(1 - \lambda\)</span>是帕累托权重，表示社会规划者对个体<span class="math notranslate nohighlight">\(2\)</span>的偏好程度。</p>
<p>设定<span class="math notranslate nohighlight">\(\lambda = .5\)</span>表示”平等主义”的社会偏好。</p>
<p>注意社会福利标准<a class="reference internal" href="#equation-eq-welfarew">(23.3)</a>如何通过公式<a class="reference internal" href="#equation-eq-objectiveagenti">(23.2)</a>考虑了两个个体的偏好。</p>
<p>这意味着社会规划者知道并尊重：</p>
<ul class="simple">
<li><p>每个个体的单期效用函数<span class="math notranslate nohighlight">\(u(\cdot) = \ln(\cdot)\)</span></p></li>
<li><p>每个个体<span class="math notranslate nohighlight">\(i\)</span>的概率模型<span class="math notranslate nohighlight">\(\{\pi_t^i(s^t)\}_{t=0}^\infty\)</span></p></li>
</ul>
<p>因此，我们预期这些对象将出现在社会规划者分配每期总禀赋的规则中。</p>
<p>对福利标准<a class="reference internal" href="#equation-eq-welfarew">(23.3)</a>在可行性约束<a class="reference internal" href="#equation-eq-feasibility">(23.1)</a>下最大化的一阶必要条件是</p>
<div class="math notranslate nohighlight">
\[\frac{\pi_t^2(s^t)}{\pi_t^1(s^t)} \frac{(1/c_t^2(s^t))}{(1/c_t^1(s^t))} = \frac{\lambda}{1-\lambda}\]</div>
<p>可以重新整理为</p>
<div class="math notranslate nohighlight" id="equation-eq-allocationrule0">
<span class="eqno">(23.4)<a class="headerlink" href="#equation-eq-allocationrule0" title="Link to this equation">#</a></span>\[
\frac{c_t^1(s^t)}{c_t^2(s^t)} = \frac{\lambda}{1-\lambda} l_t(s^t)
\]</div>
<p>其中</p>
<div class="math notranslate nohighlight">
\[ l_t(s^t) = \frac{\pi_t^1(s^t)}{\pi_t^2(s^t)} \]</div>
<p>是个体1的联合密度与个体2的联合密度的似然比。</p>
<p>使用</p>
<div class="math notranslate nohighlight">
\[c_t^1(s^t) + c_t^2(s^t) = 1\]</div>
<p>我们可以将分配规则<a class="reference internal" href="#equation-eq-allocationrule0">(23.4)</a>重写为</p>
<div class="math notranslate nohighlight">
\[\frac{c_t^1(s^t)}{1 - c_t^1(s^t)} = \frac{\lambda}{1-\lambda} l_t(s^t)\]</div>
<p>或</p>
<div class="math notranslate nohighlight">
\[c_t^1(s^t) = \frac{\lambda}{1-\lambda} l_t(s^t)(1 - c_t^1(s^t))\]</div>
<p>这意味着社会规划者的分配规则是</p>
<div class="math notranslate nohighlight" id="equation-eq-allocationrule1">
<span class="eqno">(23.5)<a class="headerlink" href="#equation-eq-allocationrule1" title="Link to this equation">#</a></span>\[
c_t^1(s^t) = \frac{\lambda l_t(s^t)}{1-\lambda + \lambda l_t(s^t)}
\]</div>
<p>如果我们定义一个临时或<strong>延续帕累托权重</strong>过程为</p>
<div class="math notranslate nohighlight">
\[
\lambda_t(s^t) = \frac{\lambda l_t(s^t)}{1-\lambda + \lambda l_t(s^t)},
\]</div>
<p>那么我们可以将社会规划者的分配规则表示为</p>
<div class="math notranslate nohighlight">
\[
c_t^1(s^t) = \lambda_t(s^t) .
\]</div>
</section>
<section id="ldots">
<h2><a class="toc-backref" href="#id26" role="doc-backlink"><span class="section-number">23.7. </span>如果你这么聪明，<span class="math notranslate nohighlight">\(\ldots\)</span></a><a class="headerlink" href="#ldots" title="Link to this heading">#</a></h2>
<p>让我们计算一下对于一些有趣的似然比过程<span class="math notranslate nohighlight">\(l_t(s^t)\)</span>的极限值，其极限分配<a class="reference internal" href="#equation-eq-allocationrule1">(23.5)</a>的值：</p>
<div class="math notranslate nohighlight">
\[l_\infty (s^\infty)= 1; \quad c_\infty^1 = \lambda\]</div>
<ul class="simple">
<li><p>在上述情况下，两个个体同样聪明（或同样不聪明），消费分配在两个个体之间保持在 <span class="math notranslate nohighlight">\(\lambda, 1 - \lambda\)</span> 的分配比例。</p></li>
</ul>
<div class="math notranslate nohighlight">
\[l_\infty (s^\infty) = 0; \quad c_\infty^1 = 0\]</div>
<ul class="simple">
<li><p>在上述情况下，个体2比个体1”更聪明”，个体1在总禀赋中的份额趋近于零。</p></li>
</ul>
<div class="math notranslate nohighlight">
\[l_\infty (s^\infty)= \infty; \quad c_\infty^1 = 1\]</div>
<ul class="simple">
<li><p>在上述情况下，个体1比个体2更聪明，个体1在总禀赋中的份额趋近于1。</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>这三种情况某种程度上告诉我们随着时间推移个体的相对<strong>财富</strong>是如何演变的。</p>
<ul class="simple">
<li><p>当两个个体同样聪明且 <span class="math notranslate nohighlight">\(\lambda \in (0,1)\)</span> 时，个体1的财富份额永远保持在 <span class="math notranslate nohighlight">\(\lambda\)</span>。</p></li>
<li><p>当个体1更聪明且 <span class="math notranslate nohighlight">\(\lambda \in (0,1)\)</span> 时，个体1最终”拥有”全部的延续禀赋，而个体2最终”一无所有”。</p></li>
<li><p>当个体2更聪明且 <span class="math notranslate nohighlight">\(\lambda \in (0,1)\)</span> 时，个体2最终”拥有”全部的延续禀赋，而个体1最终”一无所有”。
延续财富可以在我们引入竞争均衡<strong>价格</strong>体系后被精确定义。</p></li>
</ul>
</div>
<p>很快我们将进行一些模拟，这将进一步阐明可能的结果。</p>
<p>但在此之前，让我们先转向研究社会规划问题的一些”影子价格”，这些价格可以很容易地转换为竞争均衡的”均衡价格”。</p>
<p>这样做将使我们能够将分析与<span id="id12">[<a class="reference internal" href="zreferences.html#id8" title="Armen A Alchian. Uncertainty, evolution, and economic theory. Journal of political economy, 58(3):211–221, 1950.">Alchian, 1950</a>]</span>和<span id="id13">[<a class="reference internal" href="zreferences.html#id7" title="Milton Friedman. Essays in positive economics. University of Chicago press, 1953.">Friedman, 1953</a>]</span>的论点联系起来,即竞争市场过程可以使风险资产的价格更好地反映现实的概率评估。</p>
</section>
<section id="id14">
<h2><a class="toc-backref" href="#id27" role="doc-backlink"><span class="section-number">23.8. </span>竞争均衡价格</a><a class="headerlink" href="#id14" title="Link to this heading">#</a></h2>
<p>一般均衡模型的两个基本福利定理使我们预期,在我们一直研究的社会规划问题的解决方案与具有完整历史或有商品市场的<strong>竞争均衡</strong>配置之间存在联系。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>关于两个福利定理及其历史,请参见 <a class="reference external" href="https://en.wikipedia.org/wiki/Fundamental_theorems_of_welfare_economics">https://en.wikipedia.org/wiki/Fundamental_theorems_of_welfare_economics</a>。
另外,关于经典宏观经济增长模型的应用,请参见<a class="reference internal" href="cass_koopmans_1.html"><span class="doc">这篇关于规划问题的讲座</span></a>和<a class="reference internal" href="cass_koopmans_2.html"><span class="doc">这篇关于相关竞争均衡的讲座</span></a></p>
</div>
<p>这种联系在我们的模型中也存在。</p>
<p>我们现在来简要说明。</p>
<p>在竞争均衡中,不存在独裁式地收集每个人的禀赋然后重新分配的社会规划者。</p>
<p>相反,存在一个在某个时间点举行的全面的集中市场。</p>
<p>有<strong>价格</strong>,价格接受者可以按这些价格买卖他们想要的任何商品。</p>
<p>贸易是多边的,因为存在一个生活在模型之外的”瓦尔拉斯拍卖师”,其工作是验证</p>
<p>每个个体的预算约束都得到满足。</p>
<p>这个预算约束涉及个体的禀赋流总值和消费流总值。</p>
<p>这些价值是根据个体视为既定的价格向量计算的——他们是”价格接受者”，假定他们可以按这些价格买入或卖出任何数量。</p>
<p>假设在时间<span class="math notranslate nohighlight">\(-1\)</span>（即时间<span class="math notranslate nohighlight">\(0\)</span>开始之前），个体<span class="math notranslate nohighlight">\(i\)</span>可以以价格<span class="math notranslate nohighlight">\(p_t(s^t)\)</span>购买一单位在历史<span class="math notranslate nohighlight">\(s^t\)</span>后时间<span class="math notranslate nohighlight">\(t\)</span>的消费<span class="math notranslate nohighlight">\(c_t(s^t)\)</span>。</p>
<p>注意这是一个（很长的）价格<strong>向量</strong>。</p>
<ul class="simple">
<li><p>对每个历史<span class="math notranslate nohighlight">\(s^t\)</span>和每个日期<span class="math notranslate nohighlight">\(t = 0, 1, \ldots, \)</span>都有一个价格<span class="math notranslate nohighlight">\(p_t(s^t)\)</span>。</p></li>
<li><p>所以价格的数量与历史和日期的数量一样多。</p></li>
</ul>
<p>这些价格在经济开始前的时间<span class="math notranslate nohighlight">\(-1\)</span>确定。</p>
<p>市场在时间<span class="math notranslate nohighlight">\(-1\)</span>只开放一次。</p>
<p>在时间<span class="math notranslate nohighlight">\(t =0, 1, 2, \ldots\)</span>执行在时间<span class="math notranslate nohighlight">\(-1\)</span>达成的交易。</p>
<ul class="simple">
<li><p>在背景中，有一个”执行”程序强制个体履行他们在时间<span class="math notranslate nohighlight">\(-1\)</span>同意的交换或”交付”。</p></li>
</ul>
<p>我们想研究个体的信念如何影响均衡价格。</p>
<p>个体<span class="math notranslate nohighlight">\(i\)</span>面临<strong>单一</strong>的跨期预算约束</p>
<div class="math notranslate nohighlight" id="equation-eq-budgeti">
<span class="eqno">(23.6)<a class="headerlink" href="#equation-eq-budgeti" title="Link to this equation">#</a></span>\[
\sum_{t=0}^\infty\sum_{s^t} p_t(s^t) c_t^i (s^t) \leq \sum_{t=0}^\infty\sum_{s^t} p_t(s^t) y_t^i (s^t)
\]</div>
<p>根据预算约束<a class="reference internal" href="#equation-eq-budgeti">(23.6)</a>，交易在以下意义上是<strong>多边的</strong></p>
<ul class="simple">
<li><p>我们可以想象个体 <span class="math notranslate nohighlight">\(i\)</span> 首先出售他的随机禀赋流 <span class="math notranslate nohighlight">\(\{y_t^i (s^t)\}\)</span>，然后用所得收益（即他的”财富”）购买随机消费流 <span class="math notranslate nohighlight">\(\{c_t^i (s^t)\}\)</span>。</p></li>
</ul>
<p>个体 <span class="math notranslate nohighlight">\(i\)</span> 在 <a class="reference internal" href="#equation-eq-budgeti">(23.6)</a> 上设置拉格朗日乘数 <span class="math notranslate nohighlight">\(\mu_i\)</span>，并一次性选择消费计划 <span class="math notranslate nohighlight">\(\{c^i_t(s^t)\}_{t=0}^\infty\)</span> 以最大化目标函数 <a class="reference internal" href="#equation-eq-objectiveagenti">(23.2)</a>，同时受预算约束 <a class="reference internal" href="#equation-eq-budgeti">(23.6)</a> 的限制。</p>
<p>这意味着个体 <span class="math notranslate nohighlight">\(i\)</span> 需要选择多个对象，即对于 <span class="math notranslate nohighlight">\(t = 0, 1, 2, \ldots\)</span> 的所有 <span class="math notranslate nohighlight">\(s^t\)</span> 的 <span class="math notranslate nohighlight">\(c_t^i(s^t)\)</span>。</p>
<p>为方便起见，让我们回顾一下在 <a class="reference internal" href="#equation-eq-objectiveagenti">(23.2)</a> 中定义的目标函数 <span class="math notranslate nohighlight">\(V^i\)</span>：</p>
<div class="math notranslate nohighlight">
\[
V^i = \sum_{t=0}^{\infty} \sum_{s^t} \delta^t u(c_t^i(s^t)) \pi_t^i(s^t)
\]</div>
<p>最大化目标函数 <span class="math notranslate nohighlight">\(V^i\)</span>（在 <a class="reference internal" href="#equation-eq-objectiveagenti">(23.2)</a> 中定义）关于 <span class="math notranslate nohighlight">\(c_t^i(s^t)\)</span> 的一阶必要条件是：</p>
<div class="math notranslate nohighlight">
\[
\delta^t u'(c^i_t(s^t)) \pi_t^i(s^t) = \mu_i p_t(s^t) ,
\]</div>
<p>我们可以重新整理得到：</p>
<div class="math notranslate nohighlight" id="equation-eq-priceequation1">
<span class="eqno">(23.7)<a class="headerlink" href="#equation-eq-priceequation1" title="Link to this equation">#</a></span>\[
p_t(s^t) = \frac{ \delta^t \pi_t^i(s^t)}{\mu_i c^i_t(s^t)}   
\]</div>
<p>对于 <span class="math notranslate nohighlight">\(i=1,2\)</span>。</p>
<p>如果我们将个体1的方程 <a class="reference internal" href="#equation-eq-priceequation1">(23.7)</a> 除以个体2的相应方程，使用 <span class="math notranslate nohighlight">\(c^2_t(s^t) = 1 - c^1_t(s^t)\)</span>，并进行一些代数运算，我们将得到：</p>
<div class="math notranslate nohighlight" id="equation-eq-allocationce">
<span class="eqno">(23.8)<a class="headerlink" href="#equation-eq-allocationce" title="Link to this equation">#</a></span>\[
c_t^1(s^t) = \frac{\mu_1 l_t(s^t)}{\mu_2 + \mu_1 l_t(s^t)} .
\]</div>
<p>我们现在进行一个扩展的”猜测和验证”练习，涉及将我们的竞争均衡中的对象与社会规划问题中的对象进行匹配。</p>
<ul class="simple">
<li><p>我们将规划问题中的消费分配与竞争均衡中的均衡消费分配相匹配</p></li>
<li><p>我们将规划问题中的”影子”价格与竞争均衡价格相匹配</p></li>
</ul>
<p>注意，如果我们设定<span class="math notranslate nohighlight">\(\mu_1 = 1-\lambda\)</span>且<span class="math notranslate nohighlight">\(\mu_2 = \lambda\)</span>，那么公式<a class="reference internal" href="#equation-eq-allocationce">(23.8)</a>就与公式<a class="reference internal" href="#equation-eq-allocationrule1">(23.5)</a>一致。</p>
<ul class="simple">
<li><p>这相当于为价格系统<span class="math notranslate nohighlight">\(\{p_t(s^t)\}_{t=0}^\infty\)</span>选择一个<strong>计价单位</strong>或标准化</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>关于在像我们这样只决定相对价格的模型中，如何选择计价单位来确定绝对价格水平的信息，请参见<a class="reference external" href="https://en.wikipedia.org/wiki/Num%C3%A9raire">https://en.wikipedia.org/wiki/Numéraire</a>。</p>
</div>
<p>如果我们将公式<a class="reference internal" href="#equation-eq-allocationce">(23.8)</a>代入公式<a class="reference internal" href="#equation-eq-priceequation1">(23.7)</a>中的<span class="math notranslate nohighlight">\(c_t^1(s^t)\)</span>并重新整理，我们得到</p>
<div class="math notranslate nohighlight">
\[
p_t(s^t) = \frac{\delta^t}{\lambda(1-\lambda)} \pi_t^2(s^t) \bigl[1 - \lambda + \lambda l_t(s^t)\bigr]
\]</div>
<p>或</p>
<div class="math notranslate nohighlight" id="equation-eq-pformulafinal">
<span class="eqno">(23.9)<a class="headerlink" href="#equation-eq-pformulafinal" title="Link to this equation">#</a></span>\[
p_t(s^t) = \frac{\delta^t}{\lambda(1-\lambda)}  \bigl[(1 - \lambda) \pi_t^2(s^t) + \lambda \pi_t^1(s^t)\bigr]
\]</div>
<p>根据公式<a class="reference internal" href="#equation-eq-pformulafinal">(23.9)</a>，我们有以下可能的极限情况：</p>
<ul class="simple">
<li><p>当 <span class="math notranslate nohighlight">\(l_\infty = 0\)</span> 时，<span class="math notranslate nohighlight">\(c_\infty^1 = 0\)</span>，竞争均衡价格的尾部反映了个体 <span class="math notranslate nohighlight">\(2\)</span> 的概率模型 <span class="math notranslate nohighlight">\(\pi_t^2(s^t)\)</span>，即 <span class="math notranslate nohighlight">\(p_t(s^t) \propto \delta^t \pi_t^2(s^t)\)</span></p></li>
<li><p>当 <span class="math notranslate nohighlight">\(l_\infty = \infty\)</span> 时，<span class="math notranslate nohighlight">\(c_\infty^1 = 1\)</span>，竞争均衡价格的尾部反映了个体 <span class="math notranslate nohighlight">\(1\)</span> 的概率模型 <span class="math notranslate nohighlight">\(\pi_t^1(s^t)\)</span>，即 <span class="math notranslate nohighlight">\(p_t(s^t) \propto \delta^t \pi_t^1(s^t)\)</span></p></li>
<li><p>对于较小的 <span class="math notranslate nohighlight">\(t\)</span>，竞争均衡价格反映了两个个体的概率模型。</p></li>
</ul>
<p>我们将影子价格的验证留给读者，因为它遵循相同的推理过程。</p>
</section>
<section id="id15">
<h2><a class="toc-backref" href="#id28" role="doc-backlink"><span class="section-number">23.9. </span>模拟</a><a class="headerlink" href="#id15" title="Link to this heading">#</a></h2>
<p>现在让我们实现一些模拟，其中个体 <span class="math notranslate nohighlight">\(1\)</span> 相信边际密度</p>
<div class="math notranslate nohighlight">
\[\pi^1(s_t) = f(s_t)\]</div>
<p>而个体 <span class="math notranslate nohighlight">\(2\)</span> 相信边际密度</p>
<div class="math notranslate nohighlight">
\[\pi^2(s_t) = g(s_t)\]</div>
<p>这里 <span class="math notranslate nohighlight">\(f\)</span> 和 <span class="math notranslate nohighlight">\(g\)</span> 是 Beta 分布，类似于我们在本讲座前面章节中使用的分布。</p>
<p>同时，我们假设自然界相信边际密度</p>
<div class="math notranslate nohighlight">
\[
\pi(s_t) = h(s_t)
\]</div>
<p>其中 <span class="math notranslate nohighlight">\(h(s_t)\)</span> 可能是 <span class="math notranslate nohighlight">\(f\)</span> 和 <span class="math notranslate nohighlight">\(g\)</span> 的混合。</p>
<p>首先，我们编写一个函数来计算似然比过程</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_likelihood_ratios</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;计算似然比和累积乘积。&quot;&quot;&quot;</span>
    <span class="n">l_ratios</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">sequences</span><span class="p">)</span> <span class="o">/</span> <span class="n">g</span><span class="p">(</span><span class="n">sequences</span><span class="p">)</span>
    <span class="n">L_cumulative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumprod</span><span class="p">(</span><span class="n">l_ratios</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l_ratios</span><span class="p">,</span> <span class="n">L_cumulative</span>
</pre></div>
</div>
</div>
</div>
<p>让我们通过求积分计算Kullback-Leibler差异。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_KL</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    计算KL散度 KL(f, g)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">integrand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">g</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="n">val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="mf">1e-5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val</span>
</pre></div>
</div>
</div>
</div>
<p>我们还创建一个辅助函数来计算相对于参考分布<span class="math notranslate nohighlight">\(h\)</span>的KL散度</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_KL_h</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    计算相对于参考分布h的KL散度</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Kf</span> <span class="o">=</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="n">Kg</span> <span class="o">=</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Kf</span><span class="p">,</span> <span class="n">Kg</span>
</pre></div>
</div>
</div>
</div>
<p>让我们编写一个Python函数来计算个体1的消费份额</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">simulate_blume_easley</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">f_belief</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">g_belief</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="n">λ</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;模拟Blume-Easley模型的消费份额。&quot;&quot;&quot;</span>
    <span class="n">l_ratios</span><span class="p">,</span> <span class="n">l_cumulative</span> <span class="o">=</span> <span class="n">compute_likelihood_ratios</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">f_belief</span><span class="p">,</span> <span class="n">g_belief</span><span class="p">)</span>
    <span class="n">c1_share</span> <span class="o">=</span> <span class="n">λ</span> <span class="o">*</span> <span class="n">l_cumulative</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">λ</span> <span class="o">+</span> <span class="n">λ</span> <span class="o">*</span> <span class="n">l_cumulative</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l_cumulative</span><span class="p">,</span> <span class="n">c1_share</span>
</pre></div>
</div>
</div>
</div>
<p>现在让我们使用这个函数来生成以下序列：</p>
<ul class="simple">
<li><p>每期自然从 <span class="math notranslate nohighlight">\(f\)</span> 中抽取，或者</p></li>
<li><p>每期自然从 <span class="math notranslate nohighlight">\(g\)</span> 中抽取，或者</p></li>
<li><p>每期自然抛一枚公平硬币来决定是从 <span class="math notranslate nohighlight">\(f\)</span> 还是从 <span class="math notranslate nohighlight">\(g\)</span> 中抽取</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">λ</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="c1"># 自然遵循 f、g 或混合</span>
<span class="n">s_seq_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
<span class="n">s_seq_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">model_choices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span>
<span class="n">s_seq_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
<span class="n">s_seq_h</span><span class="p">[</span><span class="n">model_choices</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">model_choices</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="n">s_seq_h</span><span class="p">[</span><span class="o">~</span><span class="n">model_choices</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">~</span><span class="n">model_choices</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="n">l_cum_f</span><span class="p">,</span> <span class="n">c1_f</span> <span class="o">=</span> <span class="n">simulate_blume_easley</span><span class="p">(</span><span class="n">s_seq_f</span><span class="p">)</span>
<span class="n">l_cum_g</span><span class="p">,</span> <span class="n">c1_g</span> <span class="o">=</span> <span class="n">simulate_blume_easley</span><span class="p">(</span><span class="n">s_seq_g</span><span class="p">)</span>
<span class="n">l_cum_h</span><span class="p">,</span> <span class="n">c1_h</span> <span class="o">=</span> <span class="n">simulate_blume_easley</span><span class="p">(</span><span class="n">s_seq_h</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>在查看下图之前，让我们先来猜一猜，随着时间推移，在我们的三种情况下，个体1或个体2的消费份额会变得越来越大。</p>
<p>为了做出更好的猜测，让我们来可视化这三种情况下的似然比过程的实例。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Nature = f&quot;</span><span class="p">,</span> <span class="s2">&quot;Nature = g&quot;</span><span class="p">,</span> <span class="s2">&quot;Nature = mixture&quot;</span><span class="p">]</span>
<span class="n">data_pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">l_cum_f</span><span class="p">,</span> <span class="n">c1_f</span><span class="p">),</span> <span class="p">(</span><span class="n">l_cum_g</span><span class="p">,</span> <span class="n">c1_g</span><span class="p">),</span> <span class="p">(</span><span class="n">l_cum_h</span><span class="p">,</span> <span class="n">c1_h</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">((</span><span class="n">l_cum</span><span class="p">,</span> <span class="n">c1</span><span class="p">),</span> <span class="n">title</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">,</span> <span class="n">titles</span><span class="p">)):</span>
    <span class="c1"># 似然比</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">l_cum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">l_cum</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;时间&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;似然比 $l_t$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># 消费份额</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c1</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;时间&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;个体1的消费份额&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">λ</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>在左侧面板中，自然选择<span class="math notranslate nohighlight">\(f\)</span>。个体1的消费很快达到<span class="math notranslate nohighlight">\(1\)</span>。</p>
<p>在中间面板中，自然选择<span class="math notranslate nohighlight">\(g\)</span>。个体1的消费比率趋向于<span class="math notranslate nohighlight">\(0\)</span>，但速度不如第一种情况快。</p>
<p>在右侧面板中，自然每期抛硬币。我们看到与左侧面板中的过程非常相似的模式。</p>
<p>顶部面板的图形让我们想起<a class="reference internal" href="likelihood_ratio_process.html#kl-link"><span class="std std-ref">本节</span></a>中的讨论。</p>
<p>我们邀请读者重新访问<a class="reference internal" href="likelihood_ratio_process.html#llr-h"><span class="std std-ref">该节</span></a>并尝试推断<span class="math notranslate nohighlight">\(D_{KL}(f\|g)\)</span>、<span class="math notranslate nohighlight">\(D_{KL}(g\|f)\)</span>、<span class="math notranslate nohighlight">\(D_{KL}(h\|f)\)</span>和<span class="math notranslate nohighlight">\(D_{KL}(h\|g)\)</span>之间的关系。</p>
<p>让我们计算KL散度的值</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shares</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">c1_f</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">c1_g</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">c1_h</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
<span class="n">Kf_g</span><span class="p">,</span> <span class="n">Kg_f</span> <span class="o">=</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">),</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<span class="n">Kf_h</span><span class="p">,</span> <span class="n">Kg_h</span> <span class="o">=</span> <span class="n">compute_KL_h</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final shares: f=</span><span class="si">{</span><span class="n">shares</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, g=</span><span class="si">{</span><span class="n">shares</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, mix=</span><span class="si">{</span><span class="n">shares</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KL divergences: </span><span class="se">\n</span><span class="s2">KL(f,g)=</span><span class="si">{</span><span class="n">Kf_g</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, KL(g,f)=</span><span class="si">{</span><span class="n">Kg_f</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KL(h,f)=</span><span class="si">{</span><span class="n">Kf_h</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, KL(h,g)=</span><span class="si">{</span><span class="n">Kg_h</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>我们发现 <span class="math notranslate nohighlight">\(KL(f,g) &gt; KL(g,f)\)</span> 且 <span class="math notranslate nohighlight">\(KL(h,g) &gt; KL(h,f)\)</span>。</p>
<p>第一个不等式告诉我们，当自然选择 <span class="math notranslate nohighlight">\(f\)</span> 而信念为 <span class="math notranslate nohighlight">\(g\)</span> 时的平均”惊讶度”大于当自然选择 <span class="math notranslate nohighlight">\(g\)</span> 而信念为 <span class="math notranslate nohighlight">\(f\)</span> 时的”惊讶度”。</p>
<p>这解释了我们在上面注意到的前两个面板之间的差异。</p>
<p>第二个不等式告诉我们，个体1的信念分布 <span class="math notranslate nohighlight">\(f\)</span> 比个体2的信念 <span class="math notranslate nohighlight">\(g\)</span> 更接近自然的选择。</p>
<p>为了使这个想法更具体，让我们比较两种情况：</p>
<ul class="simple">
<li><p>个体1的信念分布 <span class="math notranslate nohighlight">\(f\)</span> 接近个体2的信念分布 <span class="math notranslate nohighlight">\(g\)</span>；</p></li>
<li><p>个体1的信念分布 <span class="math notranslate nohighlight">\(f\)</span> 远离个体2的信念分布 <span class="math notranslate nohighlight">\(g\)</span>。</p></li>
</ul>
<p>我们使用下面可视化的两个分布</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_distribution_overlap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x_range</span><span class="p">,</span> <span class="n">f_vals</span><span class="p">,</span> <span class="n">g_vals</span><span class="p">,</span> 
                            <span class="n">f_label</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">g_label</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> 
                            <span class="n">f_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">g_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot two distributions with their overlap region.&quot;&quot;&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">f_vals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">f_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">f_label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">g_vals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">g_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">g_label</span><span class="p">)</span>
    
    <span class="n">overlap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span> <span class="n">g_vals</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">overlap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Overlap&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    
<span class="c1"># Define close and far belief distributions</span>
<span class="n">f_close</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">g_close</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">))</span>

<span class="n">f_far</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">g_far</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">))</span>

<span class="c1"># Visualize the belief distributions</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">x_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="c1"># Close beliefs</span>
<span class="n">f_close_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">f_close</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_range</span><span class="p">]</span>
<span class="n">g_close_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">g_close</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_range</span><span class="p">]</span>
<span class="n">plot_distribution_overlap</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">x_range</span><span class="p">,</span> <span class="n">f_close_vals</span><span class="p">,</span> <span class="n">g_close_vals</span><span class="p">,</span>
                         <span class="n">f_label</span><span class="o">=</span><span class="s1">&#39;f (Beta(1, 1))&#39;</span><span class="p">,</span> <span class="n">g_label</span><span class="o">=</span><span class="s1">&#39;g (Beta(1.1, 1.05))&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Close Beliefs&#39;</span><span class="p">)</span>

<span class="c1"># Far beliefs</span>
<span class="n">f_far_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">f_far</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_range</span><span class="p">]</span>
<span class="n">g_far_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">g_far</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_range</span><span class="p">]</span>
<span class="n">plot_distribution_overlap</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span> <span class="n">x_range</span><span class="p">,</span> <span class="n">f_far_vals</span><span class="p">,</span> <span class="n">g_far_vals</span><span class="p">,</span>
                         <span class="n">f_label</span><span class="o">=</span><span class="s1">&#39;f (Beta(1, 1))&#39;</span><span class="p">,</span> <span class="n">g_label</span><span class="o">=</span><span class="s1">&#39;g (Beta(3, 1.2))&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Far Beliefs&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>让我们绘制与上面相同的代理1的消费比例图。</p>
<p>我们用中位数和百分位数替代模拟路径，使图形更清晰。</p>
<p>观察下面的图形，我们能推断出<span class="math notranslate nohighlight">\(KL(f,g)\)</span>和<span class="math notranslate nohighlight">\(KL(g,f)\)</span>之间的关系吗？</p>
<p>从右侧面板，我们能推断出<span class="math notranslate nohighlight">\(KL(h,g)\)</span>和<span class="math notranslate nohighlight">\(KL(h,f)\)</span>之间的关系吗？</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">nature_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)],</span>
                 <span class="s1">&#39;far&#39;</span><span class="p">:</span>   <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">),</span>   <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)]}</span>
<span class="n">nature_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Nature = f&quot;</span><span class="p">,</span> <span class="s2">&quot;Nature = g&quot;</span><span class="p">,</span> <span class="s2">&quot;Nature = h&quot;</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;close&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;far&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">}</span>

<span class="n">threshold</span> <span class="o">=</span> <span class="mf">1e-5</span>  <span class="c1"># &quot;接近零&quot;的截断值</span>

<span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="p">(</span><span class="n">f_belief</span><span class="p">,</span> <span class="n">g_belief</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span>
                        <span class="p">(</span><span class="n">f_close</span><span class="p">,</span> <span class="n">g_close</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">f_far</span><span class="p">,</span> <span class="n">g_far</span><span class="p">,</span> <span class="s1">&#39;far&#39;</span><span class="p">)]):</span>
    
    <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">nature_label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nature_labels</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">nature_params</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>
        <span class="n">s_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">simulate_blume_easley</span><span class="p">(</span><span class="n">s_seq</span><span class="p">,</span> <span class="n">f_belief</span><span class="p">,</span> <span class="n">g_belief</span><span class="p">,</span> <span class="n">λ</span><span class="p">)</span>
        
        <span class="n">median_c1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">p10</span><span class="p">,</span> <span class="n">p90</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">median_c1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;中位数&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">median_c1</span><span class="p">)),</span> <span class="n">p10</span><span class="p">,</span> <span class="n">p90</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;10-90%&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;时间&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;代理1的份额&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">nature_label</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">λ</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">below</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">median_c1</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">above</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">median_c1</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">-</span><span class="n">threshold</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">below</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">first_zero</span> <span class="o">=</span> <span class="p">(</span><span class="n">below</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">above</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">first_zero</span> <span class="o">=</span> <span class="p">(</span><span class="n">above</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">first_zero</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">first_zero</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">first_zero</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                       <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> 
                       <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;中位数 $\leq$ </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">first_zero</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                       <span class="k">else</span> <span class="sa">fr</span><span class="s1">&#39;中位数 $\geq$ 1-</span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>让我们按照我们的猜测来计算这四个值</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 近距离情况</span>
<span class="n">Kf_g</span><span class="p">,</span> <span class="n">Kg_f</span> <span class="o">=</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">f_close</span><span class="p">,</span> <span class="n">g_close</span><span class="p">),</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">g_close</span><span class="p">,</span> <span class="n">f_close</span><span class="p">)</span>
<span class="n">Kf_h</span><span class="p">,</span> <span class="n">Kg_h</span> <span class="o">=</span> <span class="n">compute_KL_h</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f_close</span><span class="p">,</span> <span class="n">g_close</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KL散度（近距离）：</span><span class="se">\n</span><span class="s2">KL(f,g)=</span><span class="si">{</span><span class="n">Kf_g</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, KL(g,f)=</span><span class="si">{</span><span class="n">Kg_f</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KL(h,f)=</span><span class="si">{</span><span class="n">Kf_h</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, KL(h,g)=</span><span class="si">{</span><span class="n">Kg_h</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 远距离情况</span>
<span class="n">Kf_g</span><span class="p">,</span> <span class="n">Kg_f</span> <span class="o">=</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">f_far</span><span class="p">,</span> <span class="n">g_far</span><span class="p">),</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">g_far</span><span class="p">,</span> <span class="n">f_far</span><span class="p">)</span>
<span class="n">Kf_h</span><span class="p">,</span> <span class="n">Kg_h</span> <span class="o">=</span> <span class="n">compute_KL_h</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f_far</span><span class="p">,</span> <span class="n">g_far</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KL散度（远距离）：</span><span class="se">\n</span><span class="s2">KL(f,g)=</span><span class="si">{</span><span class="n">Kf_g</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, KL(g,f)=</span><span class="si">{</span><span class="n">Kg_f</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KL(h,f)=</span><span class="si">{</span><span class="n">Kf_h</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, KL(h,g)=</span><span class="si">{</span><span class="n">Kg_h</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>我们发现在第一种情况下，<span class="math notranslate nohighlight">\(KL(f,g) \approx KL(g,f)\)</span> 且两者都相对较小，所以尽管个体1或个体2最终会消耗所有资源，但在顶部前两个面板中显示的收敛是相当缓慢的。</p>
<p>在底部的前两个面板中，我们看到收敛发生得更快（如黑色虚线所示），这是因为差异度 <span class="math notranslate nohighlight">\(KL(f, g)\)</span> 和 <span class="math notranslate nohighlight">\(KL(g, f)\)</span> 更大。</p>
<p>由于 <span class="math notranslate nohighlight">\(KL(f,g) &gt; KL(g,f)\)</span>，我们看到当自然选择 <span class="math notranslate nohighlight">\(f\)</span> 时，底部第一个面板的收敛比自然选择 <span class="math notranslate nohighlight">\(g\)</span> 时的第二个面板更快。</p>
<p>这与<a class="reference internal" href="likelihood_ratio_process.html#equation-eq-kl-likelihood-link">(22.1)</a>很好地联系在一起。</p>
</section>
<section id="id16">
<h2><a class="toc-backref" href="#id29" role="doc-backlink"><span class="section-number">23.10. </span>相关讲座</a><a class="headerlink" href="#id16" title="Link to this heading">#</a></h2>
<p>具有同质信念的完全市场模型，这种模型在宏观经济学和金融学中经常使用，在这个quantecon讲座<a class="reference internal" href="ge_arrow.html"><span class="doc">带有阿罗证券的竞争均衡</span></a>中有研究。</p>
<p><span id="id17">[<a class="reference internal" href="zreferences.html#id3" title="Lawrence E Blume, Timothy Cogley, David A Easley, Thomas J Sargent, and Viktor Tsyrennikov. A case for incomplete markets. Journal of Economic Theory, 178:191–221, 2018.">Blume <em>et al.</em>, 2018</a>]</span>讨论了反对完全市场的家长式论点。他们的分析假设社会规划者应该忽视个人偏好，即应该忽视其偏好中的主观信念成分。</p>
<p>似然过程在贝叶斯学习中扮演重要角色，这在<a class="reference internal" href="likelihood_bayes.html"><span class="doc">似然比过程和贝叶斯学习</span></a>中有描述，并在<a class="reference internal" href="odu.html"><span class="doc">工作搜寻 VII: 带学习的搜索</span></a>中有应用。</p>
<p>似然比过程在<a class="reference external" href="https://python-advanced.quantecon.org/additive_functionals.html" title="（在 Project name not set）"><span>Additive and Multiplicative Functionals</span></a>中再次出现。</p>
</section>
<section id="id18">
<h2><a class="toc-backref" href="#id30" role="doc-backlink"><span class="section-number">23.11. </span>练习</a><a class="headerlink" href="#id18" title="Link to this heading">#</a></h2>
<div class="exercise admonition" id="lr_ex3">

<p class="admonition-title"><span class="caption-number">练习 23.1 </span></p>
<section id="exercise-content">
<p>从<a class="reference internal" href="#equation-eq-priceequation1">(23.7)</a>开始，证明竞争均衡价格可以表示为</p>
<div class="math notranslate nohighlight">
\[p_t(s^t) = \frac{\delta^t}{\lambda(1-\lambda)} \pi_t^2(s^t) \bigl[1 - \lambda + \lambda l_t(s^t)\bigr]
\]</div>
</section>
</div>
<div class="solution dropdown admonition" id="likelihood_ratio_process_2-solution-1">

<p class="admonition-title">解答<a class="reference internal" href="#lr_ex3"> 练习 23.1</a></p>
<section id="solution-content">
<p>从以下式子开始</p>
<div class="math notranslate nohighlight">
\[
p_t(s^t) = \frac{\delta^t \pi_t^i(s^t)}{\mu_i c_t^i(s^t)}, \qquad i=1,2.
\]</div>
<p>由于两个表达式等于相同的价格,我们可以令它们相等</p>
<div class="math notranslate nohighlight">
\[
\frac{\pi_t^1(s^t)}{\mu_1 c_t^1(s^t)} = \frac{\pi_t^2(s^t)}{\mu_2 c_t^2(s^t)}
\]</div>
<p>重新整理得到</p>
<div class="math notranslate nohighlight">
\[
\frac{c_t^1(s^t)}{c_t^2(s^t)} = \frac{\mu_2}{\mu_1} l_t(s^t)
\]</div>
<p>其中 <span class="math notranslate nohighlight">\(l_t(s^t) \equiv \pi_t^1(s^t)/\pi_t^2(s^t)\)</span> 是似然比过程。</p>
<p>使用 <span class="math notranslate nohighlight">\(c_t^2(s^t) = 1 - c_t^1(s^t)\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\frac{c_t^1(s^t)}{1 - c_t^1(s^t)} = \frac{\mu_2}{\mu_1} l_t(s^t)
\]</div>
<p>求解 <span class="math notranslate nohighlight">\(c_t^1(s^t)\)</span></p>
<div class="math notranslate nohighlight">
\[
c_t^1(s^t) = \frac{\mu_2 l_t(s^t)}{\mu_1 + \mu_2 l_t(s^t)}
\]</div>
<p>规划者的解给出</p>
<div class="math notranslate nohighlight">
\[
c_t^1(s^t) = \frac{\lambda l_t(s^t)}{1 - \lambda + \lambda l_t(s^t)}
\]</div>
<p>为了使个体1在竞争均衡中的选择与规划者为个体1做出的选择相匹配,必须满足以下等式</p>
<div class="math notranslate nohighlight">
\[
\frac{\mu_2}{\mu_1} = \frac{\lambda}{1 - \lambda}
\]</div>
<p>因此我们有</p>
<div class="math notranslate nohighlight">
\[
\mu_1 = 1 - \lambda, \qquad \mu_2 = \lambda
\]</div>
<p>当 <span class="math notranslate nohighlight">\(\mu_1 = 1-\lambda\)</span> 且 <span class="math notranslate nohighlight">\(c_t^1(s^t) = \frac{\lambda l_t(s^t)}{1-\lambda+\lambda l_t(s^t)}\)</span> 时,
我们有</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\begin{split}
\begin{aligned}
p_t(s^t) &amp;= \frac{\delta^t \pi_t^1(s^t)}{(1-\lambda) c_t^1(s^t)} \\
&amp;= \frac{\delta^t \pi_t^1(s^t)}{(1-\lambda)} \cdot \frac{1 - \lambda + \lambda l_t(s^t)}{\lambda l_t(s^t)} \\\end{split}\\&amp;= \frac{\delta^t \pi_t^1(s^t)}{(1-\lambda)\lambda l_t(s^t)} \bigl[1 - \lambda + \lambda l_t(s^t)\bigr].
\end{aligned}
\end{aligned}\end{align} \]</div>
<p>由于 <span class="math notranslate nohighlight">\(\pi_t^1(s^t) = l_t(s^t) \pi_t^2(s^t)\)</span>，我们有</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
p_t(s^t) &amp;= \frac{\delta^t l_t(s^t) \pi_t^2(s^t)}{(1-\lambda)\lambda l_t(s^t)} \bigl[1 - \lambda + \lambda l_t(s^t)\bigr] \\
&amp;= \frac{\delta^t \pi_t^2(s^t)}{(1-\lambda)\lambda} \bigl[1 - \lambda + \lambda l_t(s^t)\bigr] \\
&amp;= \frac{\delta^t}{\lambda(1-\lambda)} \pi_t^2(s^t) \bigl[1 - \lambda + \lambda l_t(s^t)\bigr].
\end{aligned}
\end{split}\]</div>
</section>
</div>
<div class="exercise admonition" id="lr_ex4">

<p class="admonition-title"><span class="caption-number">练习 23.2 </span></p>
<section id="exercise-content">
<p>在这个练习中，我们将研究两个主体，每个主体在数据到达时都会更新其后验概率。</p>
<ul class="simple">
<li><p>每个主体都按照<a class="reference internal" href="likelihood_bayes.html"><span class="doc">似然比过程和贝叶斯学习</span></a>中研究的方式应用贝叶斯法则。</p></li>
</ul>
<p>以下是两个待考虑的模型</p>
<div class="math notranslate nohighlight">
\[
f(s^t) = f(s_1) f(s_2) \cdots f(s_t) 
\]</div>
<p>和</p>
<div class="math notranslate nohighlight">
\[
g(s^t) = g(s_1) g(s_2) \cdots g(s_t)  
\]</div>
<p>以及相关的似然比过程</p>
<div class="math notranslate nohighlight">
\[
L(s^t) = \frac{f(s^t)}{g(s^t)} .
\]</div>
<p>令 <span class="math notranslate nohighlight">\(\pi_0 \in (0,1)\)</span> 为先验概率，且</p>
<div class="math notranslate nohighlight">
\[
\pi_t = \frac{ \pi_0 L(s^t)}{ \pi_0 L(s^t) + (1-\pi_0) } .
\]</div>
<p>我们的两个主体各自使用混合模型的自己的版本</p>
<div class="math notranslate nohighlight" id="equation-eq-be-mix-model">
<span class="eqno">(23.10)<a class="headerlink" href="#equation-eq-be-mix-model" title="Link to this equation">#</a></span>\[
m(s^t) = \pi_t f(s^t) + (1- \pi_t) g(s^t)
\]</div>
<p>我们将为每种类型的消费者配备模型<a class="reference internal" href="#equation-eq-be-mix-model">(23.10)</a>。</p>
<ul class="simple">
<li><p>两个主体共享相同的 <span class="math notranslate nohighlight">\(f\)</span> 和 <span class="math notranslate nohighlight">\(g\)</span>，但是</p></li>
<li><p>他们有不同的初始先验概率，即 <span class="math notranslate nohighlight">\(\pi_0^1\)</span> 和 <span class="math notranslate nohighlight">\(\pi_0^2\)</span></p></li>
</ul>
<p>因此，消费者 <span class="math notranslate nohighlight">\(i\)</span> 的概率模型是</p>
<div class="math notranslate nohighlight" id="equation-eq-prob-model">
<span class="eqno">(23.11)<a class="headerlink" href="#equation-eq-prob-model" title="Link to this equation">#</a></span>\[m^i(s^t) = \pi^i_t f(s^t) + (1- \pi^i_t) g(s^t)
\]</div>
<p>现在我们将概率模型<a class="reference internal" href="#equation-eq-prob-model">(23.11)</a>（其中i=1,2）交给社会规划者。</p>
<p>我们想要推导分配<span class="math notranslate nohighlight">\(c^i(s^t), i = 1,2\)</span>，并观察当以下情况发生时会发生什么：</p>
<ul class="simple">
<li><p>自然的模型是<span class="math notranslate nohighlight">\(f\)</span></p></li>
<li><p>自然的模型是<span class="math notranslate nohighlight">\(g\)</span></p></li>
</ul>
<p>我们预期消费者最终会学习到”真相”，但其中一个人会学习得更快。</p>
<p>为了探索这些问题，请设定<span class="math notranslate nohighlight">\(f \sim \text{Beta}(1.5, 1)\)</span>和<span class="math notranslate nohighlight">\(g \sim \text{Beta}(1, 1.5)\)</span>。</p>
<p>请编写Python代码回答以下问题：</p>
<ul class="simple">
<li><p>消费份额如何演变？</p></li>
<li><p>当自然遵循<span class="math notranslate nohighlight">\(f\)</span>时，哪个代理学习得更快？</p></li>
<li><p>当自然遵循<span class="math notranslate nohighlight">\(g\)</span>时，哪个代理学习得更快？</p></li>
<li><p>初始先验<span class="math notranslate nohighlight">\(\pi_0^1\)</span>和<span class="math notranslate nohighlight">\(\pi_0^2\)</span>的差异如何影响收敛速度？</p></li>
</ul>
</section>
</div>
<div class="solution dropdown admonition" id="likelihood_ratio_process_2-solution-3">

<p class="admonition-title">解答<a class="reference internal" href="#lr_ex4"> 练习 23.2</a></p>
<section id="solution-content">
<p>首先，让我们编写辅助函数来计算模型组件，包括每个代理的主观信念函数。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">bayesian_update</span><span class="p">(</span><span class="n">π_0</span><span class="p">,</span> <span class="n">L_t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    给定似然比的贝叶斯信念概率更新。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">π_0</span> <span class="o">*</span> <span class="n">L_t</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">π_0</span> <span class="o">*</span> <span class="n">L_t</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">π_0</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mixture_density_belief</span><span class="p">(</span><span class="n">s_seq</span><span class="p">,</span> <span class="n">f_func</span><span class="p">,</span> <span class="n">g_func</span><span class="p">,</span> <span class="n">π_seq</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    计算代理i的混合密度信念m^i(s^t)。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f_vals</span> <span class="o">=</span> <span class="n">f_func</span><span class="p">(</span><span class="n">s_seq</span><span class="p">)</span>
    <span class="n">g_vals</span> <span class="o">=</span> <span class="n">g_func</span><span class="p">(</span><span class="n">s_seq</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">π_seq</span> <span class="o">*</span> <span class="n">f_vals</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">π_seq</span><span class="p">)</span> <span class="o">*</span> <span class="n">g_vals</span>
</pre></div>
</div>
</div>
</div>
<p>现在让我们编写代码来模拟包含两个个体的Blume-Easley模型。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">simulate_learning_blume_easley</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">f_belief</span><span class="p">,</span> <span class="n">g_belief</span><span class="p">,</span> 
                                        <span class="n">π_0_1</span><span class="p">,</span> <span class="n">π_0_2</span><span class="p">,</span> <span class="n">λ</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    模拟包含学习个体的Blume-Easley模型。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">sequences</span><span class="o">.</span><span class="n">shape</span>
    
    <span class="c1"># 初始化存储结果的数组</span>
    <span class="n">π_1_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">π_2_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">c1_share</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">l_agents_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="n">π_1_seq</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_0_1</span>
    <span class="n">π_2_seq</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_0_2</span>
    
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="c1"># 初始化信念的累积似然比</span>
        <span class="n">L_cumul</span> <span class="o">=</span> <span class="mf">1.0</span>
        
        <span class="c1"># 初始化个体密度之间的似然比</span>
        <span class="n">l_agents_cumul</span> <span class="o">=</span> <span class="mf">1.0</span>
        
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
            <span class="n">s_t</span> <span class="o">=</span> <span class="n">sequences</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>
            
            <span class="c1"># 计算此观测的似然比</span>
            <span class="n">l_t</span> <span class="o">=</span> <span class="n">f_belief</span><span class="p">(</span><span class="n">s_t</span><span class="p">)</span> <span class="o">/</span> <span class="n">g_belief</span><span class="p">(</span><span class="n">s_t</span><span class="p">)</span>
            
            <span class="c1"># 更新累积似然比</span>
            <span class="n">L_cumul</span> <span class="o">*=</span> <span class="n">l_t</span>
            
            <span class="c1"># 贝叶斯更新信念</span>
            <span class="n">π_1_t</span> <span class="o">=</span> <span class="n">bayesian_update</span><span class="p">(</span><span class="n">π_0_1</span><span class="p">,</span> <span class="n">L_cumul</span><span class="p">)</span>
            <span class="n">π_2_t</span> <span class="o">=</span> <span class="n">bayesian_update</span><span class="p">(</span><span class="n">π_0_2</span><span class="p">,</span> <span class="n">L_cumul</span><span class="p">)</span>
            
            <span class="c1"># 存储信念</span>
            <span class="n">π_1_seq</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_1_t</span>
            <span class="n">π_2_seq</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_2_t</span>
            
            <span class="c1"># 计算每个个体的混合密度</span>
            <span class="n">m1_t</span> <span class="o">=</span> <span class="n">π_1_t</span> <span class="o">*</span> <span class="n">f_belief</span><span class="p">(</span><span class="n">s_t</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">π_1_t</span><span class="p">)</span> <span class="o">*</span> <span class="n">g_belief</span><span class="p">(</span><span class="n">s_t</span><span class="p">)</span>
            <span class="n">m2_t</span> <span class="o">=</span> <span class="n">π_2_t</span> <span class="o">*</span> <span class="n">f_belief</span><span class="p">(</span><span class="n">s_t</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">π_2_t</span><span class="p">)</span> <span class="o">*</span> <span class="n">g_belief</span><span class="p">(</span><span class="n">s_t</span><span class="p">)</span>
            
            <span class="c1"># 更新个体之间的累积似然比</span>
            <span class="n">l_agents_cumul</span> <span class="o">*=</span> <span class="p">(</span><span class="n">m1_t</span> <span class="o">/</span> <span class="n">m2_t</span><span class="p">)</span>
            <span class="n">l_agents_seq</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">l_agents_cumul</span>
            
            <span class="c1"># c_t^1(s^t) = λ * l_t(s^t) / (1 - λ + λ * l_t(s^t))</span>
            <span class="c1"># 其中l_t(s^t)是个体之间的累积似然比</span>
            <span class="n">c1_share</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">λ</span> <span class="o">*</span> <span class="n">l_agents_cumul</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">λ</span> <span class="o">+</span> <span class="n">λ</span> <span class="o">*</span> <span class="n">l_agents_cumul</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;π_1&#39;</span><span class="p">:</span> <span class="n">π_1_seq</span><span class="p">,</span>
        <span class="s1">&#39;π_2&#39;</span><span class="p">:</span> <span class="n">π_2_seq</span><span class="p">,</span> 
        <span class="s1">&#39;c1_share&#39;</span><span class="p">:</span> <span class="n">c1_share</span><span class="p">,</span>
        <span class="s1">&#39;l_agents&#39;</span><span class="p">:</span> <span class="n">l_agents_seq</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>让我们运行不同场景的模拟。</p>
<p>我们使用 <span class="math notranslate nohighlight">\(\lambda = 0.5\)</span>，<span class="math notranslate nohighlight">\(T=40\)</span>，以及 <span class="math notranslate nohighlight">\(N=1000\)</span>。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">λ</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">))</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>我们将从不同的初始先验概率 <span class="math notranslate nohighlight">\(\pi^i_0 \in (0, 1)\)</span> 开始，并扩大它们之间的差距。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 不同的初始先验概率</span>
<span class="n">π_0_scenarios</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>现在我们可以为不同场景运行模拟</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 自然遵循 f</span>
<span class="n">s_seq_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>

<span class="c1"># 自然遵循 g</span>
<span class="n">s_seq_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span> 

<span class="n">results_f</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">results_g</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">π_0_1</span><span class="p">,</span> <span class="n">π_0_2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">π_0_scenarios</span><span class="p">):</span>
    <span class="c1"># 当自然遵循 f 时</span>
    <span class="n">results_f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">simulate_learning_blume_easley</span><span class="p">(</span>
            <span class="n">s_seq_f</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">π_0_1</span><span class="p">,</span> <span class="n">π_0_2</span><span class="p">,</span> <span class="n">λ</span><span class="p">)</span>
    <span class="c1"># 当自然遵循 g 时  </span>
    <span class="n">results_g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">simulate_learning_blume_easley</span><span class="p">(</span>
            <span class="n">s_seq_g</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">π_0_1</span><span class="p">,</span> <span class="n">π_0_2</span><span class="p">,</span> <span class="n">λ</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>让我们可视化结果</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_learning_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">π_0_scenarios</span><span class="p">,</span> <span class="n">nature_type</span><span class="p">,</span> <span class="n">truth_value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    绘制学习智能体的信念和消费份额。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
    
    <span class="n">scenario_labels</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">rf</span><span class="s1">&#39;$\pi_0^1 = </span><span class="si">{</span><span class="n">π_0_1</span><span class="si">}</span><span class="s1">, \pi_0^2 = </span><span class="si">{</span><span class="n">π_0_2</span><span class="si">}</span><span class="s1">$&#39;</span>
        <span class="k">for</span> <span class="n">π_0_1</span><span class="p">,</span> <span class="n">π_0_2</span> <span class="ow">in</span> <span class="n">π_0_scenarios</span>
    <span class="p">]</span>
    
    <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="p">(</span><span class="n">scenario_idx</span><span class="p">,</span> <span class="n">scenario_label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">scenario_labels</span><span class="p">)):</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">scenario_idx</span><span class="p">]</span>
        
        <span class="c1"># 绘制信念</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">π_1_med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;π_1&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">π_2_med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;π_2&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">π_1_med</span><span class="p">,</span> <span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;智能体1&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">π_2_med</span><span class="p">,</span> <span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;智能体2&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">truth_value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> 
                   <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;真值(</span><span class="si">{</span><span class="n">nature_type</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;当自然状态 = </span><span class="si">{</span><span class="n">nature_type</span><span class="si">}</span><span class="s1">时的信念</span><span class="se">\n</span><span class="si">{</span><span class="n">scenario_label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;中位数 $\pi_i^t$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        
        <span class="c1"># 绘制消费份额</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">c1_med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">&#39;c1_share&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c1_med</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;中位数&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> 
                   <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;智能体1的消费份额(自然状态 = </span><span class="si">{</span><span class="n">nature_type</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;消费份额&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        
        <span class="c1"># 添加x轴标签</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span>
</pre></div>
</div>
</div>
</div>
<p>现在我们将绘制当自然遵循 f 时的结果：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_f</span><span class="p">,</span> <span class="n">axes_f</span> <span class="o">=</span> <span class="n">plot_learning_results</span><span class="p">(</span>
                <span class="n">results_f</span><span class="p">,</span> <span class="n">π_0_scenarios</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>我们可以看到，具有更准确信念的个体获得更高的消费份额。</p>
<p>此外，初始信念差异越大，消费比率收敛所需的时间就越长。</p>
<p>“不太准确”的个体学习时间越长，其最终消费份额就越低。</p>
<p>现在让我们绘制当自然遵循g时的结果：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_g</span><span class="p">,</span> <span class="n">axes_g</span> <span class="o">=</span> <span class="n">plot_learning_results</span><span class="p">(</span><span class="n">results_g</span><span class="p">,</span> <span class="n">π_0_scenarios</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>我们观察到对称的结果。</p>
</section>
</div>
<div class="exercise admonition" id="lr_ex5">

<p class="admonition-title"><span class="caption-number">练习 23.3 </span></p>
<section id="exercise-content">
<p>在前面的练习中,我们故意将两个 beta 分布设置得相对接近。</p>
<p>这使得区分这些分布变得具有挑战性。</p>
<p>现在让我们研究当这些分布相距更远时的结果。</p>
<p>让我们设置 <span class="math notranslate nohighlight">\(f \sim \text{Beta}(2, 5)\)</span> 和 <span class="math notranslate nohighlight">\(g \sim \text{Beta}(5, 2)\)</span>。</p>
<p>请使用你已经编写的 Python 代码来研究结果。</p>
</section>
</div>
<div class="solution dropdown admonition" id="likelihood_ratio_process_2-solution-5">

<p class="admonition-title">解答<a class="reference internal" href="#lr_ex5"> 练习 23.3</a></p>
<section id="solution-content">
<p>这是一个解决方案</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">λ</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span>
<span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">))</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">))</span>

<span class="n">π_0_scenarios</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">s_seq_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
<span class="n">s_seq_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span> 

<span class="n">results_f</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">results_g</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">π_0_1</span><span class="p">,</span> <span class="n">π_0_2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">π_0_scenarios</span><span class="p">):</span>
    <span class="c1"># 当自然遵循 f 时</span>
    <span class="n">results_f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">simulate_learning_blume_easley</span><span class="p">(</span>
            <span class="n">s_seq_f</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">π_0_1</span><span class="p">,</span> <span class="n">π_0_2</span><span class="p">,</span> <span class="n">λ</span><span class="p">)</span>
    <span class="c1"># 当自然遵循 g 时  </span>
    <span class="n">results_g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">simulate_learning_blume_easley</span><span class="p">(</span>
            <span class="n">s_seq_g</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">π_0_1</span><span class="p">,</span> <span class="n">π_0_2</span><span class="p">,</span> <span class="n">λ</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>现在让我们将结果可视化</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_f</span><span class="p">,</span> <span class="n">axes_f</span> <span class="o">=</span> <span class="n">plot_learning_results</span><span class="p">(</span><span class="n">results_f</span><span class="p">,</span> <span class="n">π_0_scenarios</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_g</span><span class="p">,</span> <span class="n">axes_g</span> <span class="o">=</span> <span class="n">plot_learning_results</span><span class="p">(</span><span class="n">results_g</span><span class="p">,</span> <span class="n">π_0_scenarios</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>显然，由于两个分布之间的距离更远，更容易区分它们。</p>
<p>因此学习发生得更快。</p>
<p>消费份额也是如此。</p>
</section>
</div>
<div class="exercise admonition" id="lr_ex6">

<p class="admonition-title"><span class="caption-number">练习 23.4 </span></p>
<section id="exercise-content">
<p>两个代理对三个可能的模型有不同的信念。</p>
<p>假设对于 <span class="math notranslate nohighlight">\(x \in X\)</span>，<span class="math notranslate nohighlight">\(f(x) \geq 0\)</span>，<span class="math notranslate nohighlight">\(g(x) \geq 0\)</span>，且 <span class="math notranslate nohighlight">\(h(x) \geq 0\)</span>，并且：</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\int_X f(x) dx = 1\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\int_X g(x) dx = 1\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\int_X h(x) dx = 1\)</span></p></li>
</ul>
<p>我们将考虑两个代理：</p>
<ul class="simple">
<li><p>代理1：<span class="math notranslate nohighlight">\(\pi^g_0 = 1 - \pi^f_0\)</span>，<span class="math notranslate nohighlight">\(\pi^f_0 \in (0,1)\)</span>，<span class="math notranslate nohighlight">\(\pi^h_0 = 0\)</span>
（仅对模型 <span class="math notranslate nohighlight">\(f\)</span> 和 <span class="math notranslate nohighlight">\(g\)</span> 赋予正概率）</p></li>
<li><p>代理2：<span class="math notranslate nohighlight">\(\pi^g_0 = \pi^f_0 = 1/3\)</span>，<span class="math notranslate nohighlight">\(\pi^h_0 = 1/3\)</span>
（对所有三个模型赋予相等权重）</p></li>
</ul>
<p>令 <span class="math notranslate nohighlight">\(f\)</span> 和 <span class="math notranslate nohighlight">\(g\)</span> 为两个贝塔分布，其中 <span class="math notranslate nohighlight">\(f \sim \text{Beta}(3, 2)\)</span> 且
<span class="math notranslate nohighlight">\(g \sim \text{Beta}(2, 3)\)</span>，并且
设 <span class="math notranslate nohighlight">\(h = \pi^f_0 f + (1-\pi^f_0) g\)</span>，其中 <span class="math notranslate nohighlight">\(\pi^f_0 = 0.5\)</span>。</p>
<p>贝叶斯法则告诉我们，模型 <span class="math notranslate nohighlight">\(f\)</span> 和 <span class="math notranslate nohighlight">\(g\)</span> 的后验概率按如下方式演变：</p>
<div class="math notranslate nohighlight">
\[
\pi^f(s^t) := \frac{\pi^f_0 f(s^t)}{\pi^f_0 f(s^t) 
+ \pi^g_0 g(s^t) + (1 - \pi^f_0 - \pi^g_0) h(s^t)}
\]</div>
<p>和</p>
<div class="math notranslate nohighlight">
\[
\pi^g(s^t) := \frac{\pi^g_0 g(s^t)}{\pi^f_0 f(s^t) 
+ \pi^g_0 g(s^t) + (1 - \pi^f_0 - \pi^g_0) h(s^t)}
\]</div>
<p>请模拟并可视化以下情况下的后验概率和消费分配的演变：</p>
<ul class="simple">
<li><p>自然永久从 <span class="math notranslate nohighlight">\(f\)</span> 中抽取</p></li>
<li><p>自然永久从 <span class="math notranslate nohighlight">\(g\)</span> 中抽取</p></li>
</ul>
</section>
</div>
<div class="solution dropdown admonition" id="likelihood_ratio_process_2-solution-7">

<p class="admonition-title">解答<a class="reference internal" href="#lr_ex6"> 练习 23.4</a></p>
<section id="solution-content">
<p>让我们实现这个具有两个代理的三模型案例。</p>
<p>让我们定义相距较远的函数<span class="math notranslate nohighlight">\(f\)</span>和<span class="math notranslate nohighlight">\(g\)</span>，并让<span class="math notranslate nohighlight">\(h\)</span>作为<span class="math notranslate nohighlight">\(f\)</span>和<span class="math notranslate nohighlight">\(g\)</span>的混合。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span>
<span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
<span class="n">λ</span> <span class="o">=</span> <span class="mf">0.5</span> 
<span class="n">π_f_0</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">))</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">))</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">π_f_0</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">π_f_0</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>现在我们可以为模型定义信念更新</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@jit</span><span class="p">(</span><span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_posterior_three_models</span><span class="p">(</span>
    <span class="n">s_seq</span><span class="p">,</span> <span class="n">f_func</span><span class="p">,</span> <span class="n">g_func</span><span class="p">,</span> <span class="n">h_func</span><span class="p">,</span> <span class="n">π_f_0</span><span class="p">,</span> <span class="n">π_g_0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    计算三个模型的后验概率。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">s_seq</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">π_h_0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">π_f_0</span> <span class="o">-</span> <span class="n">π_g_0</span>
    
    <span class="n">π_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    <span class="n">π_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    <span class="n">π_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="c1"># 用先验概率初始化</span>
        <span class="n">π_f</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_f_0</span>
        <span class="n">π_g</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_g_0</span>
        <span class="n">π_h</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_h_0</span>
        
        <span class="c1"># 计算累积似然</span>
        <span class="n">f_cumul</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">g_cumul</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">h_cumul</span> <span class="o">=</span> <span class="mf">1.0</span>
        
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
            <span class="n">s_t</span> <span class="o">=</span> <span class="n">s_seq</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>
            
            <span class="c1"># 更新累积似然</span>
            <span class="n">f_cumul</span> <span class="o">*=</span> <span class="n">f_func</span><span class="p">(</span><span class="n">s_t</span><span class="p">)</span>
            <span class="n">g_cumul</span> <span class="o">*=</span> <span class="n">g_func</span><span class="p">(</span><span class="n">s_t</span><span class="p">)</span>
            <span class="n">h_cumul</span> <span class="o">*=</span> <span class="n">h_func</span><span class="p">(</span><span class="n">s_t</span><span class="p">)</span>
            
            <span class="c1"># 使用贝叶斯法则计算后验概率</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">π_f_0</span> <span class="o">*</span> <span class="n">f_cumul</span> <span class="o">+</span> <span class="n">π_g_0</span> <span class="o">*</span> <span class="n">g_cumul</span> <span class="o">+</span> <span class="n">π_h_0</span> <span class="o">*</span> <span class="n">h_cumul</span>
            
            <span class="n">π_f</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_f_0</span> <span class="o">*</span> <span class="n">f_cumul</span> <span class="o">/</span> <span class="n">denominator</span>
            <span class="n">π_g</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_g_0</span> <span class="o">*</span> <span class="n">g_cumul</span> <span class="o">/</span> <span class="n">denominator</span>
            <span class="n">π_h</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_h_0</span> <span class="o">*</span> <span class="n">h_cumul</span> <span class="o">/</span> <span class="n">denominator</span>
    
    <span class="k">return</span> <span class="n">π_f</span><span class="p">,</span> <span class="n">π_g</span><span class="p">,</span> <span class="n">π_h</span>
</pre></div>
</div>
</div>
</div>
<p>让我们也写一些类似之前练习的模拟代码</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">bayesian_update_three_models</span><span class="p">(</span><span class="n">π_f_0</span><span class="p">,</span> <span class="n">π_g_0</span><span class="p">,</span> <span class="n">L_f</span><span class="p">,</span> <span class="n">L_g</span><span class="p">,</span> <span class="n">L_h</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;三个模型的贝叶斯更新。&quot;&quot;&quot;</span>
    <span class="n">π_h_0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">π_f_0</span> <span class="o">-</span> <span class="n">π_g_0</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="n">π_f_0</span> <span class="o">*</span> <span class="n">L_f</span> <span class="o">+</span> <span class="n">π_g_0</span> <span class="o">*</span> <span class="n">L_g</span> <span class="o">+</span> <span class="n">π_h_0</span> <span class="o">*</span> <span class="n">L_h</span>
    <span class="k">return</span> <span class="n">π_f_0</span> <span class="o">*</span> <span class="n">L_f</span> <span class="o">/</span> <span class="n">denom</span><span class="p">,</span> <span class="n">π_g_0</span> <span class="o">*</span> <span class="n">L_g</span> <span class="o">/</span> <span class="n">denom</span><span class="p">,</span> <span class="n">π_h_0</span> <span class="o">*</span> <span class="n">L_h</span> <span class="o">/</span> <span class="n">denom</span>

<span class="nd">@jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_mixture_density</span><span class="p">(</span><span class="n">π_f</span><span class="p">,</span> <span class="n">π_g</span><span class="p">,</span> <span class="n">π_h</span><span class="p">,</span> <span class="n">f_val</span><span class="p">,</span> <span class="n">g_val</span><span class="p">,</span> <span class="n">h_val</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;计算代理的混合密度。&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">π_f</span> <span class="o">*</span> <span class="n">f_val</span> <span class="o">+</span> <span class="n">π_g</span> <span class="o">*</span> <span class="n">g_val</span> <span class="o">+</span> <span class="n">π_h</span> <span class="o">*</span> <span class="n">h_val</span>

<span class="nd">@jit</span><span class="p">(</span><span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">simulate_three_model_allocation</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">f_func</span><span class="p">,</span> <span class="n">g_func</span><span class="p">,</span> <span class="n">h_func</span><span class="p">,</span>
                                     <span class="n">π_f_0_1</span><span class="p">,</span> <span class="n">π_g_0_1</span><span class="p">,</span> <span class="n">π_f_0_2</span><span class="p">,</span> <span class="n">π_g_0_2</span><span class="p">,</span> <span class="n">λ</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    模拟具有学习代理和三个模型的Blume-Easley模型。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">sequences</span><span class="o">.</span><span class="n">shape</span>
    
    <span class="c1"># 初始化数组以存储结果</span>
    <span class="n">beliefs_1</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;π_f&#39;</span><span class="p">,</span> <span class="s1">&#39;π_g&#39;</span><span class="p">,</span> <span class="s1">&#39;π_h&#39;</span><span class="p">]}</span>
    <span class="n">beliefs_2</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;π_f&#39;</span><span class="p">,</span> <span class="s1">&#39;π_g&#39;</span><span class="p">,</span> <span class="s1">&#39;π_h&#39;</span><span class="p">]}</span>
    <span class="n">c1_share</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">l_agents_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    
    <span class="c1"># 设置初始信念</span>
    <span class="n">beliefs_1</span><span class="p">[</span><span class="s1">&#39;π_f&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_f_0_1</span>
    <span class="n">beliefs_1</span><span class="p">[</span><span class="s1">&#39;π_g&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_g_0_1</span>
    <span class="n">beliefs_1</span><span class="p">[</span><span class="s1">&#39;π_h&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">π_f_0_1</span> <span class="o">-</span> <span class="n">π_g_0_1</span>
    <span class="n">beliefs_2</span><span class="p">[</span><span class="s1">&#39;π_f&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_f_0_2</span>
    <span class="n">beliefs_2</span><span class="p">[</span><span class="s1">&#39;π_g&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_g_0_2</span>
    <span class="n">beliefs_2</span><span class="p">[</span><span class="s1">&#39;π_h&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">π_f_0_2</span> <span class="o">-</span> <span class="n">π_g_0_2</span>
    
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="c1"># 初始化累积似然</span>
        <span class="n">L_cumul</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>
        <span class="n">l_agents_cumul</span> <span class="o">=</span> <span class="mf">1.0</span>
        
        <span class="c1"># 计算t=0时的初始消费份额</span>
        <span class="n">l_agents_seq</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">c1_share</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">λ</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">λ</span> <span class="o">+</span> <span class="n">λ</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># 等于λ</span>
        
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
            <span class="n">s_t</span> <span class="o">=</span> <span class="n">sequences</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span>
            
            <span class="c1"># 计算当前观察的密度</span>
            <span class="n">densities</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="n">f_func</span><span class="p">(</span><span class="n">s_t</span><span class="p">),</span>
                <span class="s1">&#39;g&#39;</span><span class="p">:</span> <span class="n">g_func</span><span class="p">(</span><span class="n">s_t</span><span class="p">),</span>
                <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="n">h_func</span><span class="p">(</span><span class="n">s_t</span><span class="p">)</span>
            <span class="p">}</span>
            
            <span class="c1"># 更新累积似然</span>
            <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">L_cumul</span><span class="p">:</span>
                <span class="n">L_cumul</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">*=</span> <span class="n">densities</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
            
            <span class="c1"># 两个代理的贝叶斯更新</span>
            <span class="n">π_f_1</span><span class="p">,</span> <span class="n">π_g_1</span><span class="p">,</span> <span class="n">π_h_1</span> <span class="o">=</span> <span class="n">bayesian_update_three_models</span><span class="p">(</span>
                <span class="n">π_f_0_1</span><span class="p">,</span> <span class="n">π_g_0_1</span><span class="p">,</span> <span class="n">L_cumul</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">],</span> <span class="n">L_cumul</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">],</span> <span class="n">L_cumul</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">])</span>
            <span class="n">π_f_2</span><span class="p">,</span> <span class="n">π_g_2</span><span class="p">,</span> <span class="n">π_h_2</span> <span class="o">=</span> <span class="n">bayesian_update_three_models</span><span class="p">(</span>
                <span class="n">π_f_0_2</span><span class="p">,</span> <span class="n">π_g_0_2</span><span class="p">,</span> <span class="n">L_cumul</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">],</span> <span class="n">L_cumul</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">],</span> <span class="n">L_cumul</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">])</span>
            
            <span class="c1"># 存储信念</span>
            <span class="n">beliefs_1</span><span class="p">[</span><span class="s1">&#39;π_f&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_f_1</span>
            <span class="n">beliefs_1</span><span class="p">[</span><span class="s1">&#39;π_g&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_g_1</span>
            <span class="n">beliefs_1</span><span class="p">[</span><span class="s1">&#39;π_h&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_h_1</span>
            <span class="n">beliefs_2</span><span class="p">[</span><span class="s1">&#39;π_f&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_f_2</span>
            <span class="n">beliefs_2</span><span class="p">[</span><span class="s1">&#39;π_g&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_g_2</span>
            <span class="n">beliefs_2</span><span class="p">[</span><span class="s1">&#39;π_h&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">π_h_2</span>
            
            <span class="c1"># 计算混合密度</span>
            <span class="n">m1_t</span> <span class="o">=</span> <span class="n">compute_mixture_density</span><span class="p">(</span>
                <span class="n">π_f_1</span><span class="p">,</span> <span class="n">π_g_1</span><span class="p">,</span> <span class="n">π_h_1</span><span class="p">,</span> <span class="n">densities</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">],</span> 
                <span class="n">densities</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">],</span> <span class="n">densities</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">])</span>
            <span class="n">m2_t</span> <span class="o">=</span> <span class="n">compute_mixture_density</span><span class="p">(</span>
                <span class="n">π_f_2</span><span class="p">,</span> <span class="n">π_g_2</span><span class="p">,</span> <span class="n">π_h_2</span><span class="p">,</span> <span class="n">densities</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">],</span> 
                <span class="n">densities</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">],</span> <span class="n">densities</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">])</span>
            
            <span class="c1"># 更新代理之间的累积似然比</span>
            <span class="n">l_agents_cumul</span> <span class="o">*=</span> <span class="p">(</span><span class="n">m1_t</span> <span class="o">/</span> <span class="n">m2_t</span><span class="p">)</span>
            <span class="n">l_agents_seq</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">l_agents_cumul</span>
            
            <span class="c1"># 代理1的消费份额</span>
            <span class="n">c1_share</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">λ</span> <span class="o">*</span> <span class="n">l_agents_cumul</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">λ</span> <span class="o">+</span> <span class="n">λ</span> <span class="o">*</span> <span class="n">l_agents_cumul</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;π_f_1&#39;</span><span class="p">:</span> <span class="n">beliefs_1</span><span class="p">[</span><span class="s1">&#39;π_f&#39;</span><span class="p">],</span>
        <span class="s1">&#39;π_g_1&#39;</span><span class="p">:</span> <span class="n">beliefs_1</span><span class="p">[</span><span class="s1">&#39;π_g&#39;</span><span class="p">],</span>
        <span class="s1">&#39;π_h_1&#39;</span><span class="p">:</span> <span class="n">beliefs_1</span><span class="p">[</span><span class="s1">&#39;π_h&#39;</span><span class="p">],</span>
        <span class="s1">&#39;π_f_2&#39;</span><span class="p">:</span> <span class="n">beliefs_2</span><span class="p">[</span><span class="s1">&#39;π_f&#39;</span><span class="p">],</span>
        <span class="s1">&#39;π_g_2&#39;</span><span class="p">:</span> <span class="n">beliefs_2</span><span class="p">[</span><span class="s1">&#39;π_g&#39;</span><span class="p">],</span>
        <span class="s1">&#39;π_h_2&#39;</span><span class="p">:</span> <span class="n">beliefs_2</span><span class="p">[</span><span class="s1">&#39;π_h&#39;</span><span class="p">],</span>
        <span class="s1">&#39;c1_share&#39;</span><span class="p">:</span> <span class="n">c1_share</span><span class="p">,</span>
        <span class="s1">&#39;l_agents&#39;</span><span class="p">:</span> <span class="n">l_agents_seq</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>以下代码单元定义了一个绘图函数，用于显示信念和消费比例的演变</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_belief_evolution</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">nature</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    创建显示三个模型(f, g, h)信念演变的图表。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    
    <span class="n">model_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">]</span>
    <span class="n">belief_keys</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;π_f_1&#39;</span><span class="p">,</span> <span class="s1">&#39;π_f_2&#39;</span><span class="p">),</span> 
                   <span class="p">(</span><span class="s1">&#39;π_g_1&#39;</span><span class="p">,</span> <span class="s1">&#39;π_g_2&#39;</span><span class="p">),</span> 
                   <span class="p">(</span><span class="s1">&#39;π_h_1&#39;</span><span class="p">,</span> <span class="s1">&#39;π_h_2&#39;</span><span class="p">)]</span>
    
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">))</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                        <span class="nb">zip</span><span class="p">(</span><span class="n">model_names</span><span class="p">,</span> <span class="n">belief_keys</span><span class="p">)):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        
        <span class="c1"># 绘制个体信念</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">key1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;C0-&#39;</span><span class="p">,</span> 
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;个体1&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">key2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;C1-&#39;</span><span class="p">,</span> 
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;个体2&#39;</span><span class="p">)</span>
        
        <span class="c1"># 真实值指示器</span>
        <span class="k">if</span> <span class="n">model_name</span> <span class="o">==</span> <span class="n">nature</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> 
                      <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;真实值&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> 
                      <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;真实值&#39;</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;π(</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">) 当自然状态 = </span><span class="si">{</span><span class="n">nature</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;中位数 π(</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_consumption_dynamics</span><span class="p">(</span><span class="n">results_f</span><span class="p">,</span> <span class="n">results_g</span><span class="p">,</span> <span class="n">λ</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    创建显示个体1消费份额动态的图表。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    
    <span class="n">results_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">results_f</span><span class="p">,</span> <span class="n">results_g</span><span class="p">]</span>
    <span class="n">nature_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">]</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">nature_label</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                    <span class="nb">zip</span><span class="p">(</span><span class="n">results_list</span><span class="p">,</span> <span class="n">nature_labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">)):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;c1_share&#39;</span><span class="p">]</span>
        <span class="n">c1_med</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># 绘制中位数和百分位数</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c1_med</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;中位数&quot;</span><span class="p">)</span>
        
        <span class="c1"># 添加百分位区间带</span>
        <span class="n">c1_25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">c1_75</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c1_med</span><span class="p">)),</span> <span class="n">c1_25</span><span class="p">,</span> <span class="n">c1_75</span><span class="p">,</span> 
                        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;25-75百分位&quot;</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> 
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;等份&#39;</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;个体1消费份额(自然状态 = </span><span class="si">{</span><span class="n">nature_label</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;消费份额&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>现在让我们运行模拟。</p>
<p>在下面的模拟中，个体1只对<span class="math notranslate nohighlight">\(f\)</span>和<span class="math notranslate nohighlight">\(g\)</span>分配正概率，而个体2对所有三个模型赋予相等的权重。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># 为自然状态f和g生成序列</span>
<span class="n">s_seq_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
<span class="n">s_seq_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>

<span class="c1"># 运行模拟</span>
<span class="n">results_f</span> <span class="o">=</span> <span class="n">simulate_three_model_allocation</span><span class="p">(</span><span class="n">s_seq_f</span><span class="p">,</span> 
                        <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">π_f_0</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">π_f_0</span><span class="p">,</span> 
                        <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">λ</span><span class="p">)</span>
<span class="n">results_g</span> <span class="o">=</span> <span class="n">simulate_three_model_allocation</span><span class="p">(</span><span class="n">s_seq_g</span><span class="p">,</span> 
                        <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">π_f_0</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">π_f_0</span><span class="p">,</span> 
                        <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">λ</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>下面的图表分别展示了每个模型（f、g、h）的信念演变。</p>
<p>首先我们展示当自然选择<span class="math notranslate nohighlight">\(f\)</span>时的图表</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_belief_evolution</span><span class="p">(</span><span class="n">results_f</span><span class="p">,</span> <span class="n">nature</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>智能体1的后验信念用蓝色表示，智能体2的后验信念用橙色表示。</p>
<p>显然，当自然选择<span class="math notranslate nohighlight">\(f\)</span>时，智能体1比智能体2学习得更快，这是因为智能体2（与智能体1不同）对模型<span class="math notranslate nohighlight">\(h\)</span>赋予了正的先验概率：</p>
<ul class="simple">
<li><p>在最左边的面板中，两个智能体对<span class="math notranslate nohighlight">\(\pi(f)\)</span>的信念都逐渐收敛到1（真实值）</p></li>
<li><p>智能体2对模型<span class="math notranslate nohighlight">\(h\)</span>的信念（最右边的面板）在初期上升后逐渐收敛到0</p></li>
</ul>
<p>现在让我们绘制当自然选择<span class="math notranslate nohighlight">\(g\)</span>时的信念演化：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_belief_evolution</span><span class="p">(</span><span class="n">results_g</span><span class="p">,</span> <span class="n">nature</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>再次可以看到，智能体1比智能体2学习得更快。</p>
<p>在查看下一张图之前，请猜测消费份额是如何变化的。</p>
<p>请记住，智能体1比智能体2更快地达到正确的模型。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_consumption_dynamics</span><span class="p">(</span><span class="n">results_f</span><span class="p">,</span> <span class="n">results_g</span><span class="p">,</span> <span class="n">λ</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>正如我们所预期的，个体1比个体2有更高的消费份额。</p>
<p>在这个练习中，”真实情况”是两个个体模型中可能的结果之一。</p>
<p>个体2的模型”更一般化”，因为它允许一种个体1的模型中不包含的可能性——即自然从<span class="math notranslate nohighlight">\(h\)</span>中抽取。</p>
<p>个体1学习得更快是因为他使用了一个更简单的模型。</p>
</section>
</div>
<div class="exercise admonition" id="lr_ex7">

<p class="admonition-title"><span class="caption-number">练习 23.5 </span></p>
<section id="exercise-content">
<p>现在考虑两个对三个模型有极端先验的个体。</p>
<p>考虑与前一个练习相同的设置，但现在：</p>
<ul class="simple">
<li><p>个体1：<span class="math notranslate nohighlight">\(\pi^g_0 = \pi^f_0 = \frac{\epsilon}{2} &gt; 0\)</span>，其中<span class="math notranslate nohighlight">\(\epsilon\)</span>接近<span class="math notranslate nohighlight">\(0\)</span>（例如，<span class="math notranslate nohighlight">\(\epsilon = 0.01\)</span>）</p></li>
<li><p>个体2：<span class="math notranslate nohighlight">\(\pi^g_0 = \pi^f_0 = 0\)</span>（对模型<span class="math notranslate nohighlight">\(h\)</span>的刚性信念）</p></li>
</ul>
<p>选择<span class="math notranslate nohighlight">\(h\)</span>使其在KL散度度量下接近但不等于<span class="math notranslate nohighlight">\(f\)</span>或<span class="math notranslate nohighlight">\(g\)</span>。
例如，设置<span class="math notranslate nohighlight">\(h \sim \text{Beta}(1.2, 1.1)\)</span>且<span class="math notranslate nohighlight">\(f \sim \text{Beta}(1, 1)\)</span>。</p>
<p>请模拟并可视化以下情况下的后验概率和消费分配的演变：</p>
<ul class="simple">
<li><p>自然永久从<span class="math notranslate nohighlight">\(f\)</span>中抽取</p></li>
<li><p>自然永久从<span class="math notranslate nohighlight">\(g\)</span>中抽取</p></li>
</ul>
</section>
</div>
<div class="solution dropdown admonition" id="likelihood_ratio_process_2-solution-9">

<p class="admonition-title">解答<a class="reference internal" href="#lr_ex7"> 练习 23.5</a></p>
<section id="solution-content">
<p>为了探索这个练习，我们将<span class="math notranslate nohighlight">\(T\)</span>增加到1000。</p>
<p>让我们指定<span class="math notranslate nohighlight">\(f\)</span>、<span class="math notranslate nohighlight">\(g\)</span>和<span class="math notranslate nohighlight">\(h\)</span>，并验证<span class="math notranslate nohighlight">\(h\)</span>和<span class="math notranslate nohighlight">\(f\)</span>比<span class="math notranslate nohighlight">\(h\)</span>和<span class="math notranslate nohighlight">\(g\)</span>更接近</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">1.2</span>
<span class="n">H_a</span><span class="p">,</span> <span class="n">H_b</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.1</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">))</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">))</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">H_a</span><span class="p">,</span> <span class="n">H_b</span><span class="p">))</span>

<span class="n">Kh_f</span> <span class="o">=</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<span class="n">Kh_g</span> <span class="o">=</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
<span class="n">Kf_h</span> <span class="o">=</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<span class="n">Kg_h</span> <span class="o">=</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KL散度：&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KL(h,f) = </span><span class="si">{</span><span class="n">Kh_f</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, KL(h,g) = </span><span class="si">{</span><span class="n">Kh_g</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KL(f,h) = </span><span class="si">{</span><span class="n">Kf_h</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, KL(g,h) = </span><span class="si">{</span><span class="n">Kg_h</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>现在我们可以为两个智能体设置信念模型</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ε</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">λ</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="c1"># 智能体1: π_f = ε/2, π_g = ε/2, π_h = 1-ε </span>
<span class="c1"># (对h几乎完全坚信)</span>
<span class="n">π_f_1</span> <span class="o">=</span> <span class="n">ε</span><span class="o">/</span><span class="mi">2</span>
<span class="n">π_g_1</span> <span class="o">=</span> <span class="n">ε</span><span class="o">/</span><span class="mi">2</span>

<span class="c1"># 智能体2: π_f = 0, π_g = 0, π_h = 1 </span>
<span class="c1"># (对h完全坚信)</span>
<span class="n">π_f_2</span> <span class="o">=</span> <span class="mf">1e-10</span>
<span class="n">π_g_2</span> <span class="o">=</span> <span class="mf">1e-10</span>
</pre></div>
</div>
</div>
</div>
<p>现在我们可以运行模拟</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># 为不同的自然情景生成序列</span>
<span class="n">s_seq_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">F_a</span><span class="p">,</span> <span class="n">F_b</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
<span class="n">s_seq_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">G_a</span><span class="p">,</span> <span class="n">G_b</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>

<span class="c1"># 为两种情景运行模拟</span>
<span class="n">results_f</span> <span class="o">=</span> <span class="n">simulate_three_model_allocation</span><span class="p">(</span>
                                <span class="n">s_seq_f</span><span class="p">,</span> 
                                <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> 
                                <span class="n">π_f_1</span><span class="p">,</span> <span class="n">π_g_1</span><span class="p">,</span> <span class="n">π_f_2</span><span class="p">,</span> <span class="n">π_g_2</span><span class="p">,</span> <span class="n">λ</span><span class="p">)</span>
<span class="n">results_g</span> <span class="o">=</span> <span class="n">simulate_three_model_allocation</span><span class="p">(</span>
                                <span class="n">s_seq_g</span><span class="p">,</span> 
                                <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> 
                                <span class="n">π_f_1</span><span class="p">,</span> <span class="n">π_g_1</span><span class="p">,</span> <span class="n">π_f_2</span><span class="p">,</span> <span class="n">π_g_2</span><span class="p">,</span> <span class="n">λ</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>让我们绘制当自然选择<span class="math notranslate nohighlight">\(f\)</span>时的信念演变</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_belief_evolution</span><span class="p">(</span><span class="n">results_f</span><span class="p">,</span> <span class="n">nature</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>观察最左侧面板中<span class="math notranslate nohighlight">\(\pi(f)\)</span>显示的个体1如何缓慢地学习真相。</p>
<p>还要注意个体2没有更新。</p>
<p>这是因为我们已经指定<span class="math notranslate nohighlight">\(f\)</span>很难与<span class="math notranslate nohighlight">\(h\)</span>区分，这是通过<span class="math notranslate nohighlight">\(KL(f, h)\)</span>来衡量的。</p>
<p>对<span class="math notranslate nohighlight">\(h\)</span>的刚性阻止了个体2在观察到非常相似的模型<span class="math notranslate nohighlight">\(f\)</span>时更新其信念。</p>
<p>现在让我们绘制当自然选择<span class="math notranslate nohighlight">\(g\)</span>时的信念演变</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_belief_evolution</span><span class="p">(</span><span class="n">results_g</span><span class="p">,</span> <span class="n">nature</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>当自然从<span class="math notranslate nohighlight">\(g\)</span>中抽取时，它与<span class="math notranslate nohighlight">\(h\)</span>的距离更远，这是通过KL散度来衡量的。</p>
<p>这有助于两个个体更快地学习真相。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_consumption_dynamics</span><span class="p">(</span><span class="n">results_f</span><span class="p">,</span> <span class="n">results_g</span><span class="p">,</span> 
                               <span class="n">λ</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>在消费动态图中，注意到无论自然是永久从<span class="math notranslate nohighlight">\(f\)</span>中抽取还是永久从<span class="math notranslate nohighlight">\(g\)</span>中抽取，个体1的消费份额都收敛到1。</p>
</section>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                    <p>A theme by <a href="https://quantecon.org">QuantEcon</a></p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  基础工具
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="sir_model.html">
   1. 新冠病毒建模
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_algebra.html">
   2. 线性代数
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="qr_decomp.html">
   3. QR分解
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="eig_circulant.html">
   4. 循环矩阵
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="svd_intro.html">
   5. 奇异值分解
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="var_dmd.html">
   6. 向量自回归和动态模态分解
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="newton_method.html">
   7. 使用牛顿法求解经济模型
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  基础统计学
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="prob_matrix.html">
   8. 基础概率论与矩阵
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stats_examples.html">
   9. 一些概率分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lln_clt.html">
   10. 大数定律 和 中心极限定理
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="prob_meaning.html">
   11. 概率的两种含义
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multi_hyper.html">
   12. 多元超几何分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multivariate_normal.html">
   13. 多元正态分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hoist_failure.html">
   14. 故障树不确定性
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="back_prop.html">
   15. 人工神经网络简介
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rand_resp.html">
   16. 随机化回应调查
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="util_rand_resp.html">
   17. 随机回答的期望效用
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  贝叶斯定律
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="bayes_nonconj.html">
   18. 非共轭先验
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_bayes.html">
   19. AR(1)参数的后验分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_turningpts.html">
   20. 预测 AR(1) 过程
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  统计与信息论
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="divergence_measures.html">
   21. 统计散度度量
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_ratio_process.html">
   22. 似然比过程
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   23. 异质信念与金融市场
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_var.html">
   24. VAR模型的似然过程
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="imp_sample.html">
   25. 似然比过程的均值
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wald_friedman.html">
   26. 让弥尔顿·弗里德曼困惑的问题
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wald_friedman_2.html">
   27. 用贝叶斯方法解决弗里德曼和瓦尔德问题
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exchangeable.html">
   28. 可交换性和贝叶斯更新
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_bayes.html">
   29. 似然比过程和贝叶斯学习
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mix_model.html">
   30. 错误模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="navy_captain.html">
   31. 贝叶斯与频率主义决策规则的比较
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  线性规划
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="opt_transport.html">
   32. 最优传输
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="von_neumann_model.html">
   33. 冯·诺依曼增长模型（及其推广）
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  动态系统导论
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="finite_markov.html">
   34. 有限马尔可夫链
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="inventory_dynamics.html">
   35. 库存动态
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_models.html">
   36. 线性状态空间模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="samuelson.html">
   37. 萨缪尔森乘数-加速器模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kesten_processes.html">
   38. Kesten过程与企业动态
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wealth_dynamics.html">
   39. 财富分布动态
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman.html">
   40. 初见卡尔曼滤波器
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman_2.html">
   41. 卡尔曼滤波器进阶
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  搜索
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model.html">
   42. 工作搜寻 I: McCall搜寻模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model_with_separation.html">
   43. 工作搜寻 II：搜寻与离职
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_fitted_vfi.html">
   44. 工作搜寻 III: 拟合值函数迭代
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_correlated.html">
   45. 工作搜寻 IV：相关工资报价
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="career.html">
   46. 工作搜寻 V：职业选择建模
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="jv.html">
   47. 工作搜寻 VI：在职搜索
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_q.html">
   48. 工作搜寻 VII：McCall劳动者的Q学习
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="odu.html">
   49. 工作搜寻 VII: 带学习的搜索
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  消费、储蓄与资本
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_1.html">
   50. Cass-Koopmans模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_2.html">
   51. Cass-Koopmans竞争均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_fiscal.html">
   52. 带扭曲性税收的Cass-Koopmans模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_fiscal_2.html">
   53. 带扭曲性税收的双国模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ak2.html">
   54. 代际交叠模型中的转型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_problem.html">
   55. 吃蛋糕问题 I：最优储蓄导论
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_numerical.html">
   56. 吃蛋糕问题 II：数值方法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth.html">
   57. 最优增长 I：随机最优增长模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth_fast.html">
   58. 最优增长 II：使用Numba加速代码
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coleman_policy_iter.html">
   59. 最优增长 III：时间迭代
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="egm_policy_iter.html">
   60. 最优增长 IV：内生网格法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp.html">
   61. 收入波动问题 I：基本模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp_advanced.html">
   62. 收入波动问题 II：资产随机收益
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  LQ控制
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lqcontrol.html">
   63. LQ控制：基础
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lagrangian_lqdp.html">
   64. LQ控制的拉格朗日方法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cross_product_trick.html">
   65. 消除交叉项
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income.html">
   66. 永久收入模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income_cons.html">
   67. 永久收入 II：线性二次方法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lq_inventories.html">
   68. 通过库存实现生产平滑
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  多主体模型
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lake_model.html">
   69. 就业与失业的湖泊模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rational_expectations.html">
   70. 理性预期均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="re_with_feedback.html">
   71. 线性理性预期模型中的稳定性
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_perf.html">
   72. 马尔可夫完美均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="uncertainty_traps.html">
   73. 不确定性陷阱
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="aiyagari.html">
   74. 艾亚加里模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ak_aiyagari.html">
   75. 长寿、异质性个体、世代交叠模型
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  资产定价与金融
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="markov_asset.html">
   76. 资产定价：有限状态模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ge_arrow.html">
   77. 带有阿罗证券的竞争均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="harrison_kreps.html">
   78. 异质信念与泡沫
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  数据与实证
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="pandas_panel.html">
   79. 用Pandas处理面板数据
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ols.html">
   80. Python线性回归
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mle.html">
   81. 最大似然估计
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  拍卖
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="two_auctions.html">
   82. 一价和二价拍卖
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="house_auction.html">
   83. 多种商品分配机制
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  其他
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   84. 故障排除
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   85. 参考文献
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   86. 执行统计
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                </ul>

                <ul class="qe-toolbar__links">
                    <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off" accesskey="k">
                            <i data-feather="search" id="search-icon"></i>
                        </form>
                    </li>
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/likelihood_ratio_process_2.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li data-tippy-content="Download PDF" onClick="window.print()"><i data-feather="file"></i></li>
                    <!--
                    # Enable if looking for link to specific document hosted on GitHub
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst/likelihood_ratio_process_2.md" download><i data-feather="github"></i></a></li>
                    -->
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://colab.research.google.com/github/QuantEcon/lecture-python.zh-cn.notebooks/blob/main/likelihood_ratio_process_2.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-python.zh-cn.notebooks" data-urlpath="tree/lecture-python.zh-cn.notebooks/likelihood_ratio_process_2.ipynb" data-branch=main>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://colab.research.google.com/github/QuantEcon/lecture-python.zh-cn.notebooks/blob/main/likelihood_ratio_process_2.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "likelihood_ratio_process_2";
                const repoURL = "https://github.com/QuantEcon/lecture-python.zh-cn.notebooks";
                const urlPath = "tree/lecture-python.zh-cn.notebooks/likelihood_ratio_process_2.ipynb";
                const branch = "main"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>