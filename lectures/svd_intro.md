---
jupytext:
  text_representation:
    extension: .md
    format_name: myst
    format_version: 0.13
    jupytext_version: 1.10.3
kernelspec:
  display_name: Python 3
  language: python
  name: python3
---

# å¥‡å¼‚å€¼åˆ†è§£ï¼ˆSVDï¼‰

## æ¦‚è¿°

**å¥‡å¼‚å€¼åˆ†è§£**ï¼ˆSVDï¼‰æ˜¯æœ€å°äºŒä¹˜æŠ•å½±åº”ç”¨ä¸­çš„é‡è¦å·¥å…·ï¼Œå®ƒæ„æˆäº†è®¸å¤šç»Ÿè®¡å’Œæœºå™¨å­¦ä¹ æ–¹æ³•çš„åŸºç¡€ã€‚

åœ¨å®šä¹‰SVDä¹‹åï¼Œæˆ‘ä»¬å°†æè¿°å®ƒä¸ä»¥ä¸‹å†…å®¹çš„è”ç³»ï¼š

* çº¿æ€§ä»£æ•°ä¸­çš„**å››ä¸ªåŸºæœ¬ç©ºé—´**
* æ¬ å®šå’Œè¶…å®šçš„**æœ€å°äºŒä¹˜å›å½’**
* **ä¸»æˆåˆ†åˆ†æ**ï¼ˆPCAï¼‰

ä¸ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰ç±»ä¼¼ï¼ŒDMDå¯ä»¥è¢«è§†ä¸ºä¸€ç§æ•°æ®é™ç»´ç¨‹åºï¼Œé€šè¿‡å°†æ•°æ®æŠ•å½±åˆ°æœ‰é™çš„å› å­é›†ä¸Šæ¥è¡¨ç¤ºæ˜¾è‘—çš„æ¨¡å¼ã€‚

åœ¨è¿™ä¸ªå…³äº{doc}`åŠ¨æ€æ¨¡å¼åˆ†è§£<var_dmd>`çš„åç»­è®²åº§ä¸­ï¼Œæˆ‘ä»¬å°†æè¿°å¦‚ä½•ä½¿ç”¨SVDå¿«é€Ÿè®¡ç®—ä¸€é˜¶å‘é‡è‡ªå›å½’ï¼ˆVARsï¼‰çš„é™é˜¶è¿‘ä¼¼ã€‚

## åŸºæœ¬è®¾å®š

è®¾$X$æ˜¯ä¸€ä¸ªç§©ä¸º$p$çš„$m \times n$çŸ©é˜µã€‚

å¿…ç„¶åœ°ï¼Œ$p \leq \min(m,n)$ã€‚

åœ¨æœ¬è®²åº§çš„å¤§éƒ¨åˆ†å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠ$X$è§†ä¸ºä¸€ä¸ª**æ•°æ®**çŸ©é˜µï¼Œå…¶ä¸­ï¼š

* æ¯ä¸€åˆ—æ˜¯ä¸€ä¸ª**ä¸ªä½“**â€”â€”æ ¹æ®åº”ç”¨åœºæ™¯å¯ä»¥æ˜¯æ—¶é—´æ®µæˆ–ä¸ªäºº

* æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ª**éšæœºå˜é‡**ï¼Œæè¿°æ—¶é—´æ®µæˆ–ä¸ªäººçš„æŸä¸ªå±æ€§ï¼Œå…·ä½“å–å†³äºåº”ç”¨åœºæ™¯


æˆ‘ä»¬å°†å…³æ³¨ä¸¤ç§æƒ…å†µï¼š

* **çŸ®èƒ–**æƒ…å†µï¼Œå³$m << n$ï¼Œè¡¨ç¤ºåˆ—æ•°ï¼ˆä¸ªä½“ï¼‰è¿œå¤šäºè¡Œæ•°ï¼ˆå±æ€§ï¼‰ã€‚

* **é«˜ç˜¦**æƒ…å†µï¼Œå³$m >> n$ï¼Œè¡¨ç¤ºè¡Œæ•°ï¼ˆå±æ€§ï¼‰è¿œå¤šäºåˆ—æ•°ï¼ˆä¸ªä½“ï¼‰ã€‚


æˆ‘ä»¬å°†åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹å¯¹$X$è¿›è¡Œ**å¥‡å¼‚å€¼åˆ†è§£**ã€‚

åœ¨ $m << n$ çš„æƒ…å†µä¸‹ï¼Œå³ä¸ªä½“æ•°é‡ $n$ è¿œå¤§äºå±æ€§æ•°é‡ $m$ æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹è§‚æµ‹å€¼å‡½æ•°å–å¹³å‡æ¥è®¡ç®—è”åˆåˆ†å¸ƒçš„æ ·æœ¬çŸ©ã€‚

åœ¨è¿™ç§ $m << n$ çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨**å¥‡å¼‚å€¼åˆ†è§£**æ¥è¿›è¡Œ**ä¸»æˆåˆ†åˆ†æ**(PCA)ä»¥å¯»æ‰¾**æ¨¡å¼**ã€‚

åœ¨ $m >> n$ çš„æƒ…å†µä¸‹ï¼Œå³å±æ€§æ•°é‡ $m$ è¿œå¤§äºä¸ªä½“æ•°é‡ $n$ï¼Œä¸”åœ¨æ—¶é—´åºåˆ—ç¯å¢ƒä¸­ $n$ ç­‰äºæ•°æ®é›† $X$ ä¸­æ‰€è¦†ç›–çš„æ—¶é—´æ®µæ•°é‡æ—¶ï¼Œæˆ‘ä»¬å°†é‡‡ç”¨ä¸åŒçš„æ–¹æ³•ã€‚

æˆ‘ä»¬å°†å†æ¬¡ä½¿ç”¨**å¥‡å¼‚å€¼åˆ†è§£**ï¼Œä½†è¿™æ¬¡æ˜¯ç”¨æ¥æ„å»º**åŠ¨æ€æ¨¡æ€åˆ†è§£**(DMD)ã€‚

## å¥‡å¼‚å€¼åˆ†è§£

ä¸€ä¸ªç§©ä¸º $p \leq \min(m,n)$ çš„ $m \times n$ çŸ©é˜µ $X$ çš„**å¥‡å¼‚å€¼åˆ†è§£**ä¸ºï¼š

$$
X  = U \Sigma V^\top
$$ (eq:SVD101)

å…¶ä¸­ï¼š

$$
\begin{aligned}
UU^\top  &  = I  &  \quad U^\top  U = I \cr

VV^\top  & = I & \quad V^\top  V = I
\end{aligned}
$$

ä¸”

* $U$ æ˜¯ $X$ çš„ $m \times m$ æ­£äº¤çŸ©é˜µï¼Œç”±**å·¦å¥‡å¼‚å‘é‡**ç»„æˆ
* $U$ çš„åˆ—æ˜¯ $X X^\top $ çš„ç‰¹å¾å‘é‡
* $V$ æ˜¯ $X$ çš„ $n \times n$ æ­£äº¤çŸ©é˜µï¼Œç”±**å³å¥‡å¼‚å‘é‡**ç»„æˆ
* $V$ çš„åˆ—æ˜¯ $X^\top  X$ çš„ç‰¹å¾å‘é‡
* $\Sigma$ æ˜¯ä¸€ä¸ª $m \times n$ çŸ©é˜µï¼Œå…¶ä¸»å¯¹è§’çº¿ä¸Šçš„å‰ $p$ ä¸ªä½ç½®æ˜¯æ­£æ•° $\sigma_1, \sigma_2, \ldots, \sigma_p$ï¼Œç§°ä¸º**å¥‡å¼‚å€¼**ï¼›$\Sigma$ çš„å…¶ä½™å…ƒç´ éƒ½ä¸ºé›¶

* è¿™ $p$ ä¸ªå¥‡å¼‚å€¼æ˜¯ $m \times m$ çŸ©é˜µ $X X^\top $ ä»¥åŠ $n \times n$ çŸ©é˜µ $X^\top  X$ çš„ç‰¹å¾å€¼çš„æ­£å¹³æ–¹æ ¹

* æˆ‘ä»¬çº¦å®šï¼Œå½“ $U$ æ˜¯å¤å€¼çŸ©é˜µæ—¶ï¼Œ$U^\top $ è¡¨ç¤º $U$ çš„**å…±è½­è½¬ç½®**æˆ–**å„ç±³ç‰¹è½¬ç½®**ï¼Œå³ $U_{ij}^\top $ æ˜¯ $U_{ji}$ çš„å¤å…±è½­ã€‚

* ç±»ä¼¼åœ°ï¼Œå½“ $V$ æ˜¯å¤å€¼çŸ©é˜µæ—¶ï¼Œ$V^\top$ è¡¨ç¤º $V$ çš„**å…±è½­è½¬ç½®**æˆ–**å„ç±³ç‰¹è½¬ç½®**

çŸ©é˜µ $U,\Sigma,V$ é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯¹å‘é‡è¿›è¡Œçº¿æ€§å˜æ¢ï¼š

* ç”¨é…‰çŸ©é˜µ $U$ å’Œ $V$ ä¹˜ä»¥å‘é‡ä¼šä½¿å…¶**æ—‹è½¬**ï¼Œä½†ä¿æŒ**å‘é‡ä¹‹é—´çš„è§’åº¦**å’Œ**å‘é‡çš„é•¿åº¦**ä¸å˜ã€‚
* ç”¨å¯¹è§’çŸ©é˜µ $\Sigma$ ä¹˜ä»¥å‘é‡ä¼šä¿æŒ**å‘é‡ä¹‹é—´çš„è§’åº¦**ä¸å˜ï¼Œä½†ä¼š**é‡æ–°ç¼©æ”¾**å‘é‡ã€‚

å› æ­¤ï¼Œè¡¨ç¤ºå¼ {eq}`eq:SVD101` è¡¨æ˜ï¼Œç”¨ $m \times n$ çŸ©é˜µ $X$ ä¹˜ä»¥ $n \times 1$ å‘é‡ $y$ ç›¸å½“äºæŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹ä¸‰ä¸ªä¹˜æ³•è¿ç®—ï¼š

* é€šè¿‡è®¡ç®— $V^\top y$ æ¥**æ—‹è½¬** $y$
* é€šè¿‡ä¹˜ä»¥ $\Sigma$ æ¥**é‡æ–°ç¼©æ”¾** $V^\top y$
* é€šè¿‡ä¹˜ä»¥ $U$ æ¥**æ—‹è½¬** $\Sigma V^\top y$

$m \times n$ çŸ©é˜µ $X$ çš„è¿™ç§ç»“æ„ä¸ºæ„å»ºç³»ç»Ÿå¼€å¯äº†å¤§é—¨

æ•°æ®**ç¼–ç å™¨**å’Œ**è§£ç å™¨**ã€‚

å› æ­¤ï¼Œ

* $V^\top y$ æ˜¯ä¸€ä¸ªç¼–ç å™¨
* $\Sigma$ æ˜¯ä¸€ä¸ªåº”ç”¨äºç¼–ç æ•°æ®çš„è¿ç®—ç¬¦
* $U$ æ˜¯ä¸€ä¸ªè§£ç å™¨ï¼Œç”¨äºå¤„ç†å°†è¿ç®—ç¬¦ $\Sigma$ åº”ç”¨äºç¼–ç æ•°æ®åçš„è¾“å‡º

æˆ‘ä»¬å°†åœ¨æœ¬è®²ç¨åç ”ç©¶åŠ¨æ€æ¨¡æ€åˆ†è§£æ—¶åº”ç”¨è¿™äº›æ¦‚å¿µã€‚

**æœªæ¥è·¯çº¿**

æˆ‘ä»¬ä¸Šé¢æè¿°çš„æ˜¯æ‰€è°“çš„**å®Œå…¨** SVDã€‚

åœ¨**å®Œå…¨** SVDä¸­ï¼Œ$U$ã€$\Sigma$ å’Œ $V$ çš„å½¢çŠ¶åˆ†åˆ«ä¸º $\left(m, m\right)$ã€$\left(m, n\right)$ã€$\left(n, n\right)$ã€‚

ç¨åæˆ‘ä»¬è¿˜å°†æè¿°**ç»æµå‹**æˆ–**ç®€åŒ–** SVDã€‚

åœ¨ç ”ç©¶**ç®€åŒ–** SVDä¹‹å‰ï¼Œæˆ‘ä»¬å°†è¿›ä¸€æ­¥è®¨è®º**å®Œå…¨** SVDçš„æ€§è´¨ã€‚

## å››ä¸ªåŸºæœ¬å­ç©ºé—´

è®© ${\mathcal C}$ è¡¨ç¤ºåˆ—ç©ºé—´ï¼Œ${\mathcal N}$ è¡¨ç¤ºé›¶ç©ºé—´ï¼Œ${\mathcal R}$ è¡¨ç¤ºè¡Œç©ºé—´ã€‚

è®©æˆ‘ä»¬é¦–å…ˆå›é¡¾ä¸€ä¸‹ç§©ä¸º $p$ çš„ $m \times n$ çŸ©é˜µ $X$ çš„å››ä¸ªåŸºæœ¬å­ç©ºé—´ã€‚

* **åˆ—ç©ºé—´**$X$ï¼Œè®°ä½œ${\mathcal C}(X)$ï¼Œæ˜¯$X$çš„åˆ—å‘é‡çš„å¼ æˆç©ºé—´ï¼Œå³æ‰€æœ‰å¯ä»¥å†™æˆ$X$çš„åˆ—å‘é‡çš„çº¿æ€§ç»„åˆçš„å‘é‡$y$ã€‚å…¶ç»´æ•°ä¸º$p$ã€‚
* **é›¶ç©ºé—´**$X$ï¼Œè®°ä½œ${\mathcal N}(X)$ï¼ŒåŒ…å«æ‰€æœ‰æ»¡è¶³$Xy=0$çš„å‘é‡$y$ã€‚å…¶ç»´æ•°ä¸º$n-p$ã€‚
* **è¡Œç©ºé—´**$X$ï¼Œè®°ä½œ${\mathcal R}(X)$ï¼Œæ˜¯$X^\top$çš„åˆ—ç©ºé—´ã€‚å®ƒåŒ…å«æ‰€æœ‰å¯ä»¥å†™æˆ$X$çš„è¡Œå‘é‡çš„çº¿æ€§ç»„åˆçš„å‘é‡$z$ã€‚å…¶ç»´æ•°ä¸º$p$ã€‚
* **å·¦é›¶ç©ºé—´**$X$ï¼Œè®°ä½œ${\mathcal N}(X^\top)$ï¼ŒåŒ…å«æ‰€æœ‰æ»¡è¶³$X^\top z=0$çš„å‘é‡$z$ã€‚å…¶ç»´æ•°ä¸º$m-p$ã€‚

å¯¹äºçŸ©é˜µ$X$çš„å®Œå…¨å¥‡å¼‚å€¼åˆ†è§£ï¼Œå·¦å¥‡å¼‚å‘é‡çŸ©é˜µ$U$å’Œå³å¥‡å¼‚å‘é‡çŸ©é˜µ$V$åŒ…å«äº†æ‰€æœ‰å››ä¸ªå­ç©ºé—´çš„æ­£äº¤åŸºã€‚

å®ƒä»¬å½¢æˆä¸¤å¯¹æ­£äº¤å­ç©ºé—´ï¼Œæˆ‘ä»¬ç°åœ¨æ¥æè¿°ã€‚

ä»¤$u_i, i = 1, \ldots, m$ä¸º$U$çš„$m$ä¸ªåˆ—å‘é‡ï¼Œä»¤

è®¾ $v_i, i = 1, \ldots, n$ ä¸º $V$ çš„ $n$ ä¸ªåˆ—å‘é‡ã€‚

è®©æˆ‘ä»¬å°† X çš„å®Œæ•´å¥‡å¼‚å€¼åˆ†è§£å†™ä½œ

$$
X = \begin{bmatrix} U_L & U_R \end{bmatrix} \begin{bmatrix} \Sigma_p & 0 \cr 0 & 0 \end{bmatrix}
     \begin{bmatrix} V_L & V_R \end{bmatrix}^\top
$$ (eq:fullSVDpartition)

å…¶ä¸­ $\Sigma_p$ æ˜¯ä¸€ä¸ª $p \times p$ å¯¹è§’çŸ©é˜µï¼Œå¯¹è§’çº¿ä¸Šæ˜¯ $p$ ä¸ªå¥‡å¼‚å€¼ï¼Œä¸”

$$
\begin{aligned}
U_L & = \begin{bmatrix}u_1 & \cdots  & u_p \end{bmatrix},  \quad U_R  = \begin{bmatrix}u_{p+1} & \cdots u_m \end{bmatrix}  \cr
V_L & = \begin{bmatrix}v_1 & \cdots  & v_p \end{bmatrix} , \quad U_R  = \begin{bmatrix}v_{p+1} & \cdots u_n \end{bmatrix}
\end{aligned}
$$

è¡¨ç¤ºå¼ {eq}`eq:fullSVDpartition` æ„å‘³ç€

$$
X \begin{bmatrix} V_L & V_R \end{bmatrix} = \begin{bmatrix} U_L & U_R \end{bmatrix} \begin{bmatrix} \Sigma_p & 0 \cr 0 & 0 \end{bmatrix}
$$

æˆ–

$$
\begin{aligned}
X V_L & = U_L \Sigma_p \cr
X V_R & = 0
\end{aligned}
$$ (eq:Xfour1a)

æˆ–

$$
\begin{aligned}

X v_i & = \sigma_i u_i , \quad i = 1, \ldots, p \cr
X v_i & = 0 ,  \quad i = p+1, \ldots, n
\end{aligned}
$$ (eq:orthoortho1)

æ–¹ç¨‹ {eq}`eq:orthoortho1` è¯´æ˜äº†å˜æ¢ $X$ å¦‚ä½•å°†ä¸€å¯¹æ­£äº¤å•ä½å‘é‡ $v_i, v_j$ï¼ˆå…¶ä¸­ $i$ å’Œ $j$ éƒ½å°äºæˆ–ç­‰äº $X$ çš„ç§© $p$ï¼‰æ˜ å°„åˆ°ä¸€å¯¹æ­£äº¤å•ä½å‘é‡ $u_i, u_j$ã€‚

æ–¹ç¨‹ {eq}`eq:Xfour1a` è¡¨æ˜

$$
\begin{aligned}
{\mathcal C}(X) & = {\mathcal C}(U_L) \cr
{\mathcal N}(X) & = {\mathcal C} (V_R)
\end{aligned}
$$

å¯¹è¡¨ç¤ºå¼ {eq}`eq:fullSVDpartition` ä¸¤è¾¹å–è½¬ç½®å¾—åˆ°

$$
X^\top  \begin{bmatrix} U_L & U_R \end{bmatrix} = \begin{bmatrix} V_L & V_R \end{bmatrix} \begin{bmatrix} \Sigma_p & 0 \cr 0 & 0 \end{bmatrix}
$$

æˆ–

$$
\begin{aligned}
X^\top  U_L & = V_L \Sigma_p \cr
X^\top  U_R & = 0
\end{aligned}
$$  (eq:Xfour1b)

æˆ–

$$
\begin{aligned}
X^\top  u_i & = \sigma_i v_i, \quad i=1, \ldots, p \cr
X^\top  u_i & = 0 \quad i= p+1, \ldots, m
\end{aligned}

$$ (eq:orthoortho2)

æ³¨æ„æ–¹ç¨‹ {eq}`eq:orthoortho2` è¡¨æ˜å˜æ¢ $X^\top$ å°†ä¸€å¯¹ä¸åŒçš„æ­£äº¤å•ä½å‘é‡ $u_i, u_j$ï¼ˆå…¶ä¸­ $i$ å’Œ $j$ éƒ½å°äºæˆ–ç­‰äº $X$ çš„ç§© $p$ï¼‰æ˜ å°„åˆ°ä¸€å¯¹ä¸åŒçš„æ­£äº¤å•ä½å‘é‡ $v_i, v_j$ã€‚

æ–¹ç¨‹ {eq}`eq:Xfour1b` è¡¨æ˜ï¼š

$$
\begin{aligned}
{\mathcal R}(X) & \equiv  {\mathcal C}(X^\top ) = {\mathcal C} (V_L) \cr
{\mathcal N}(X^\top ) & = {\mathcal C}(U_R)
\end{aligned}
$$

å› æ­¤ï¼Œæ–¹ç¨‹ç»„ {eq}`eq:Xfour1a` å’Œ {eq}`eq:Xfour1b` å…±åŒæè¿°äº† $X$ çš„å››ä¸ªåŸºæœ¬å­ç©ºé—´ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

$$
\begin{aligned}
{\mathcal C}(X) & = {\mathcal C}(U_L) \cr
{\mathcal N}(X^\top ) & = {\mathcal C}(U_R) \cr
{\mathcal R}(X) & \equiv  {\mathcal C}(X^\top ) = {\mathcal C} (V_L) \cr
{\mathcal N}(X) & = {\mathcal C} (V_R) \cr

\end{aligned}
$$ (eq:fourspaceSVD)

ç”±äº $U$ å’Œ $V$ éƒ½æ˜¯æ­£äº¤çŸ©é˜µï¼Œé›†åˆ {eq}`eq:fourspaceSVD` è¡¨æ˜

* $U_L$ æ˜¯ $X$ åˆ—ç©ºé—´çš„æ ‡å‡†æ­£äº¤åŸº
* $U_R$ æ˜¯ $X^\top$ é›¶ç©ºé—´çš„æ ‡å‡†æ­£äº¤åŸº
* $V_L$ æ˜¯ $X$ è¡Œç©ºé—´çš„æ ‡å‡†æ­£äº¤åŸº
* $V_R$ æ˜¯ $X$ é›¶ç©ºé—´çš„æ ‡å‡†æ­£äº¤åŸº

æˆ‘ä»¬é€šè¿‡æ‰§è¡Œ{eq}`eq:fullSVDpartition`å³ä¾§è¦æ±‚çš„ä¹˜æ³•å¹¶è¯»å–ç»“æœï¼Œå·²ç»éªŒè¯äº†{eq}`eq:fourspaceSVD`ä¸­çš„å››ä¸ªå£°æ˜ã€‚

{eq}`eq:fourspaceSVD`ä¸­çš„å£°æ˜ä»¥åŠ$U$å’Œ$V$éƒ½æ˜¯é…‰çŸ©é˜µï¼ˆå³æ­£äº¤çŸ©é˜µï¼‰è¿™ä¸€äº‹å®æ„å‘³ç€ï¼š

* $X$çš„åˆ—ç©ºé—´ä¸$X^\top$çš„é›¶ç©ºé—´æ­£äº¤
* $X$çš„é›¶ç©ºé—´ä¸$X$çš„è¡Œç©ºé—´æ­£äº¤

è¿™äº›æ€§è´¨æœ‰æ—¶ç”¨ä»¥ä¸‹ä¸¤å¯¹æ­£äº¤è¡¥ç©ºé—´æ¥æè¿°ï¼š

* ${\mathcal C}(X)$æ˜¯${\mathcal N}(X^\top)$çš„æ­£äº¤è¡¥
* ${\mathcal R}(X)$æ˜¯${\mathcal N}(X)$çš„æ­£äº¤è¡¥

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚

```{code-cell} ipython3
import numpy as np
import numpy.linalg as LA
import matplotlib.pyplot as plt
```

å¯¼å…¥è¿™äº›æ¨¡å—åï¼Œè®©æˆ‘ä»¬æ¥çœ‹ç¤ºä¾‹ã€‚

```{code-cell} ipython3
np.set_printoptions(precision=2)

# å®šä¹‰çŸ©é˜µ
A = np.array([[1, 2, 3, 4, 5],
              [2, 3, 4, 5, 6],
              [3, 4, 5, 6, 7],
              [4, 5, 6, 7, 8],
              [5, 6, 7, 8, 9]])

# è®¡ç®—çŸ©é˜µçš„å¥‡å¼‚å€¼åˆ†è§£
U, S, V = np.linalg.svd(A,full_matrices=True)

# è®¡ç®—çŸ©é˜µçš„ç§©
rank = np.linalg.matrix_rank(A)

# æ‰“å°çŸ©é˜µçš„ç§©
print("çŸ©é˜µçš„ç§©:\n", rank)
print("S: \n", S)

# è®¡ç®—å››ä¸ªåŸºæœ¬å­ç©ºé—´
row_space = U[:, :rank]
col_space = V[:, :rank]
null_space = V[:, rank:]
left_null_space = U[:, rank:]


print("U:\n", U)
print("åˆ—ç©ºé—´:\n", col_space)
print("å·¦é›¶ç©ºé—´:\n", left_null_space)
print("V.T:\n", V.T)
print("è¡Œç©ºé—´:\n", row_space.T)
print("å³é›¶ç©ºé—´:\n", null_space.T)
```

## Eckart-Youngå®šç†

å‡è®¾æˆ‘ä»¬è¦æ„é€ ä¸€ä¸ª$m \times n$çŸ©é˜µ$X$çš„æœ€ä½³ç§©$r$è¿‘ä¼¼ã€‚

è¿™é‡Œçš„æœ€ä½³ï¼ŒæŒ‡çš„æ˜¯åœ¨æ‰€æœ‰ç§©ä¸º$r < p$çš„çŸ©é˜µä¸­ï¼Œæ‰¾åˆ°ä¸€ä¸ªçŸ©é˜µ$X_r$ä½¿å¾—ä»¥ä¸‹èŒƒæ•°æœ€å°ï¼š

$$ 
|| X - X_r || 
$$

å…¶ä¸­$|| \cdot ||$è¡¨ç¤ºçŸ©é˜µ$X$çš„èŒƒæ•°ï¼Œä¸”$X_r$å±äºæ‰€æœ‰ç»´åº¦ä¸º$m \times n$çš„ç§©$r$çŸ©é˜µç©ºé—´ã€‚

ä¸€ä¸ª$m \times n$çŸ©é˜µ$X$çš„ä¸‰ç§å¸¸ç”¨**çŸ©é˜µèŒƒæ•°**å¯ä»¥ç”¨$X$çš„å¥‡å¼‚å€¼è¡¨ç¤ºï¼š

* **è°±èŒƒæ•°**æˆ–$l^2$èŒƒæ•° $|| X ||_2 = \max_{||y|| \neq 0} \frac{||X y ||}{||y||} = \sigma_1$
* **FrobeniusèŒƒæ•°** $||X ||_F = \sqrt{\sigma_1^2 + \cdots + \sigma_p^2}$
* **æ ¸èŒƒæ•°** $ || X ||_N = \sigma_1 + \cdots + \sigma_p $

Eckart-Youngå®šç†æŒ‡å‡ºï¼Œå¯¹äºè¿™ä¸‰ç§èŒƒæ•°ï¼Œæœ€ä½³çš„ç§©$r$çŸ©é˜µæ˜¯ç›¸åŒçš„ï¼Œç­‰äºï¼š

$$
\hat X_r = \sigma_1 U_1 V_1^\top  + \sigma_2 U_2 V_2^\top  + \cdots + \sigma_r U_r V_r^\top
$$ (eq:Ekart)

è¿™æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å®šç†ï¼Œå®ƒè¡¨æ˜æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªéæ»¡ç§©çš„ $m \times n$ çŸ©é˜µ $X$ é€šè¿‡SVDåˆ†è§£ï¼Œç”¨ä¸€ä¸ªæ»¡ç§©çš„ $p \times p$ çŸ©é˜µæ¥æœ€ä½³è¿‘ä¼¼ã€‚

æ­¤å¤–ï¼Œå¦‚æœè¿™äº› $p$ ä¸ªå¥‡å¼‚å€¼ä¸­æœ‰äº›æºå¸¦çš„ä¿¡æ¯æ¯”å…¶ä»–çš„æ›´å¤šï¼Œè€Œæˆ‘ä»¬æƒ³ç”¨æœ€å°‘çš„æ•°æ®è·å¾—æœ€å¤šçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å–æŒ‰å¤§å°æ’åºçš„ $r$ ä¸ªä¸»è¦å¥‡å¼‚å€¼ã€‚

åœ¨ä»‹ç»ä¸»æˆåˆ†åˆ†ææ—¶ï¼Œæˆ‘ä»¬ä¼šå¯¹æ­¤è¿›è¡Œæ›´è¯¦ç»†çš„è®¨è®ºã€‚

ä½ å¯ä»¥åœ¨[è¿™é‡Œ](https://en.wikipedia.org/wiki/Low-rank_approximation)é˜…è¯»å…³äºEckart-Youngå®šç†åŠå…¶åº”ç”¨çš„å†…å®¹ã€‚

åœ¨è®¨è®ºä¸»æˆåˆ†åˆ†æ(PCA)å’ŒåŠ¨æ€æ¨¡æ€åˆ†è§£(DMD)æ—¶ï¼Œæˆ‘ä»¬å°†ä¼šç”¨åˆ°è¿™ä¸ªå®šç†ã€‚

## å®Œå…¨SVDå’Œç®€åŒ–SVD

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æè¿°çš„æ˜¯**å®Œå…¨**SVDçš„æ€§è´¨ï¼Œå…¶ä¸­ $U$ã€$\Sigma$ å’Œ $V$ çš„å½¢çŠ¶åˆ†åˆ«ä¸º $\left(m, m\right)$ã€$\left(m, n\right)$ã€$\left(n, n\right)$ã€‚

æœ‰ä¸€ç§æ›¿ä»£æ€§çš„çŸ©é˜µåˆ†è§£è®°æ³•ï¼Œç§°ä¸º**ç»æµå‹**æˆ–**ç®€åŒ–å‹** SVDï¼Œå…¶ä¸­ $U, \Sigma$ å’Œ $V$ çš„å½¢çŠ¶ä¸å®Œå…¨SVDä¸­çš„ä¸åŒã€‚

æ³¨æ„ï¼Œå› ä¸ºæˆ‘ä»¬å‡è®¾ $X$ çš„ç§©ä¸º $p$ï¼Œæ‰€ä»¥åªæœ‰ $p$ ä¸ªéé›¶å¥‡å¼‚å€¼ï¼Œå…¶ä¸­ $p=\textrm{rank}(X)\leq\min\left(m, n\right)$ã€‚

**ç®€åŒ–å‹** SVDåˆ©ç”¨è¿™ä¸€äº‹å®ï¼Œå°† $U$ã€$\Sigma$ å’Œ $V$ è¡¨ç¤ºä¸ºå½¢çŠ¶åˆ†åˆ«ä¸º $\left(m, p\right)$ã€$\left(p, p\right)$ã€$\left(n, p\right)$ çš„çŸ©é˜µã€‚

ä½ å¯ä»¥åœ¨è¿™é‡Œäº†è§£ç®€åŒ–å‹å’Œå®Œå…¨å‹SVD
<https://numpy.org/doc/stable/reference/generated/numpy.linalg.svd.html>

å¯¹äºå®Œå…¨å‹SVDï¼Œ

$$
\begin{aligned}
UU^\top  &  = I  &  \quad U^\top  U = I \cr
VV^\top  & = I & \quad V^\top  V = I
\end{aligned}
$$

ä½†è¿™äº›æ€§è´¨å¹¶ééƒ½é€‚ç”¨äº**ç®€åŒ–å‹** SVDã€‚

å“ªäº›æ€§è´¨æˆç«‹å–å†³äºæˆ‘ä»¬å¤„ç†çš„æ˜¯**é«˜ç˜¦å‹**çŸ©é˜µè¿˜æ˜¯**çŸ®èƒ–å‹**çŸ©é˜µã€‚

* åœ¨**é«˜ç˜¦å‹**æƒ…å†µä¸‹ï¼Œå³ $m > > n$ï¼Œå¯¹äº**ç®€åŒ–å‹** SVD

$$
\begin{aligned}

UU^\top  &  \neq I  &  \quad U^\top  U = I \cr
VV^\top  & = I & \quad V^\top  V = I
\end{aligned}
$$

* åœ¨**çŸ­èƒ–**æƒ…å†µä¸‹(å³ $m < < n$),å¯¹äº**ç®€åŒ–**SVD

$$
\begin{aligned}
UU^\top  &  = I  &  \quad U^\top  U = I \cr
VV^\top  & = I & \quad V^\top  V \neq I
\end{aligned}
$$

å½“æˆ‘ä»¬ç ”ç©¶åŠ¨æ€æ¨¡æ€åˆ†è§£æ—¶,æˆ‘ä»¬éœ€è¦è®°ä½è¿™äº›æ€§è´¨,å› ä¸ºæˆ‘ä»¬ä¼šä½¿ç”¨ç®€åŒ–SVDæ¥è®¡ç®—ä¸€äº›DMDè¡¨ç¤ºã€‚

è®©æˆ‘ä»¬åšä¸€ä¸ªç»ƒä¹ æ¥æ¯”è¾ƒ**å®Œå…¨**å’Œ**ç®€åŒ–**SVDã€‚

å›é¡¾ä¸€ä¸‹,

* åœ¨**å®Œå…¨**SVDä¸­

  - $U$ æ˜¯ $m \times m$ ç»´
  - $\Sigma$ æ˜¯ $m \times n$ ç»´
  - $V$ æ˜¯ $n \times n$ ç»´

* åœ¨**ç®€åŒ–**SVDä¸­

  - $U$ æ˜¯ $m \times p$ ç»´
  - $\Sigma$ æ˜¯ $p \times p$ ç»´
  - $V$ æ˜¯ $n \times p$ ç»´

é¦–å…ˆ,è®©æˆ‘ä»¬ç ”ç©¶ä¸€ä¸ª $m = 5 > n = 2$ çš„æƒ…å†µã€‚

(è¿™æ˜¯æˆ‘ä»¬åœ¨ç ”ç©¶**åŠ¨æ€æ¨¡æ€åˆ†è§£**æ—¶ä¼šé‡åˆ°çš„**é«˜ç˜¦**æƒ…å†µçš„ä¸€ä¸ªå°ä¾‹å­ã€‚)

```{code-cell} ipython3
import numpy as np
X = np.random.rand(5,2)
U, S, V = np.linalg.svd(X,full_matrices=True)  # å®Œå…¨SVD
Uhat, Shat, Vhat = np.linalg.svd(X,full_matrices=False) # ç»æµSVD
print('U, S, V =')
U, S, V
```

```{code-cell} ipython3
print('Uhat, Shat, Vhat = ')
Uhat, Shat, Vhat
```

```{code-cell} ipython3
rr = np.linalg.matrix_rank(X)
print(f'Xçš„ç§© = {rr}')
```

**æ€§è´¨ï¼š**

* å½“$U$é€šè¿‡å®Œå…¨SVDæ„é€ æ—¶ï¼Œ$U^\top U = I_{m\times m}$ ä¸” $U U^\top = I_{m \times m}$
* å½“$\hat U$é€šè¿‡ç®€åŒ–SVDæ„é€ æ—¶ï¼Œè™½ç„¶$\hat U^\top \hat U = I_{p\times p}$ï¼Œä½†$\hat U \hat U^\top \neq I_{m \times m}$

æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹ä»£ç å•å…ƒæ¥è¯´æ˜è¿™äº›æ€§è´¨ã€‚

```{code-cell} ipython3
UTU = U.T@U
UUT = U@U.T
print('UUT, UTU = ')
UUT, UTU
```

```{code-cell} ipython3
UhatUhatT = Uhat@Uhat.T
UhatTUhat = Uhat.T@Uhat
print('UhatUhatT, UhatTUhat= ')
UhatUhatT, UhatTUhat
```

**æ³¨é‡Šï¼š**

ä¸Šè¿°å•å…ƒæ ¼å±•ç¤ºäº† `full_matrices=True` å’Œ `full_matrices=False` é€‰é¡¹çš„åº”ç”¨ã€‚
ä½¿ç”¨ `full_matrices=False` ä¼šè¿”å›ä¸€ä¸ªç®€åŒ–çš„å¥‡å¼‚å€¼åˆ†è§£ã€‚

**å®Œæ•´**å’Œ**ç®€åŒ–**çš„å¥‡å¼‚å€¼åˆ†è§£éƒ½èƒ½å‡†ç¡®åœ°åˆ†è§£ä¸€ä¸ª $m \times n$ çŸ©é˜µ $X$

å½“æˆ‘ä»¬åœ¨åé¢å­¦ä¹ åŠ¨æ€æ¨¡æ€åˆ†è§£æ—¶ï¼Œè®°ä½åœ¨è¿™ç§é«˜ç˜¦çŸ©é˜µæƒ…å†µä¸‹å®Œæ•´å’Œç®€åŒ–å¥‡å¼‚å€¼åˆ†è§£çš„ä¸Šè¿°æ€§è´¨å°†å¾ˆé‡è¦ã€‚





ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªçŸ®èƒ–çŸ©é˜µçš„æƒ…å†µã€‚

ä¸ºäº†è¯´æ˜è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°†è®¾ç½® $m = 2 < 5 = n$ï¼Œå¹¶è®¡ç®—å®Œæ•´å’Œç®€åŒ–çš„å¥‡å¼‚å€¼åˆ†è§£ã€‚

```{code-cell} ipython3
import numpy as np
X = np.random.rand(2,5)
U, S, V = np.linalg.svd(X,full_matrices=True)  # å®Œæ•´SVD
Uhat, Shat, Vhat = np.linalg.svd(X,full_matrices=False) # ç»æµSVD
print('U, S, V = ')
U, S, V
```

```{code-cell} ipython3
print('Uhat, Shat, Vhat = ')
Uhat, Shat, Vhat
```

è®©æˆ‘ä»¬éªŒè¯æˆ‘ä»¬çš„ç®€åŒ–SVDæ˜¯å¦å‡†ç¡®è¡¨ç¤º$X$

```{code-cell} ipython3
SShat=np.diag(Shat)
np.allclose(X, Uhat@SShat@Vhat)
```

## æåˆ†è§£

çŸ©é˜µ $X$ çš„**ç®€åŒ–**å¥‡å¼‚å€¼åˆ†è§£(SVD)ä¸å…¶**æåˆ†è§£**ç›¸å…³

$$
X = SQ
$$

å…¶ä¸­

$$
\begin{aligned}
S & = U\Sigma U^\top \cr
Q & = UV^\top
\end{aligned}
$$

è¿™é‡Œ

* $S$ æ˜¯ä¸€ä¸ª $m \times m$ **å¯¹ç§°**çŸ©é˜µ
* $Q$ æ˜¯ä¸€ä¸ª $m \times n$ **æ­£äº¤**çŸ©é˜µ

åœ¨æˆ‘ä»¬çš„ç®€åŒ–SVDä¸­

* $U$ æ˜¯ä¸€ä¸ª $m \times p$ æ­£äº¤çŸ©é˜µ
* $\Sigma$ æ˜¯ä¸€ä¸ª $p \times p$ å¯¹è§’çŸ©é˜µ
* $V$ æ˜¯ä¸€ä¸ª $n \times p$ æ­£äº¤çŸ©é˜µ

## åº”ç”¨ï¼šä¸»æˆåˆ†åˆ†æ(PCA)

è®©æˆ‘ä»¬ä» $n >> m$ çš„æƒ…å†µå¼€å§‹ï¼Œå³ä¸ªä½“æ•°é‡ $n$ è¿œå¤§äºå±æ€§æ•°é‡ $m$ çš„æƒ…å†µã€‚

åœ¨ $n >> m$ çš„æƒ…å†µä¸‹ï¼ŒçŸ©é˜µ $X$ æ˜¯**çŸ®èƒ–å‹**çš„ï¼Œè¿™ä¸åé¢è¦è®¨è®ºçš„ $m >> n$ æƒ…å†µä¸‹çš„**é«˜ç˜¦å‹**ç›¸å¯¹ã€‚

æˆ‘ä»¬å°† $X$ è§†ä¸ºä¸€ä¸ª $m \times n$ çš„**æ•°æ®**çŸ©é˜µï¼š

$$
X = \begin{bmatrix} X_1 \mid X_2 \mid \cdots \mid X_n\end{bmatrix}
$$

å…¶ä¸­å¯¹äº $j = 1, \ldots, n$ï¼Œåˆ—å‘é‡ $X_j = \begin{bmatrix}x_{1j}\\x_{2j}\\\vdots\\x_{mj}\end{bmatrix}$ æ˜¯å˜é‡ $\begin{bmatrix}X_1\\X_2\\\vdots\\X_m\end{bmatrix}$ çš„è§‚æµ‹å€¼å‘é‡ã€‚

åœ¨**æ—¶é—´åºåˆ—**è®¾ç½®ä¸­ï¼Œæˆ‘ä»¬å°†åˆ— $j$ è§†ä¸ºè§‚æµ‹éšæœºå˜é‡çš„ä¸åŒ__æ—¶é—´__ç‚¹çš„ç´¢å¼•ï¼Œè€Œè¡Œåˆ™ç´¢å¼•ä¸åŒçš„éšæœºå˜é‡ã€‚

åœ¨**æ¨ªæˆªé¢**è®¾ç½®ä¸­ï¼Œæˆ‘ä»¬å°†åˆ— $j$ è§†ä¸ºè§‚æµ‹éšæœºå˜é‡çš„ä¸åŒ__ä¸ªä½“__çš„ç´¢å¼•ï¼Œè€Œè¡Œåˆ™ç´¢å¼•ä¸åŒçš„**å±æ€§**ã€‚

å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€è§ï¼ŒSVDæ˜¯å°†çŸ©é˜µåˆ†è§£ä¸ºæœ‰ç”¨ç»„ä»¶çš„ä¸€ç§æ–¹æ³•ï¼Œå°±åƒæåˆ†è§£ã€ç‰¹å¾åˆ†è§£å’Œè®¸å¤šå…¶ä»–æ–¹æ³•ä¸€æ ·ã€‚

å¦ä¸€æ–¹é¢ï¼ŒPCAæ˜¯ä¸€ç§åŸºäºSVDæ¥åˆ†ææ•°æ®çš„æ–¹æ³•ã€‚å…¶ç›®æ ‡æ˜¯åº”ç”¨ç‰¹å®šæ­¥éª¤ï¼Œä½¿ç”¨ç»Ÿè®¡å·¥å…·æ•æ‰æ•°æ®ä¸­æœ€é‡è¦çš„æ¨¡å¼ï¼Œä»¥å¸®åŠ©æ›´å¥½åœ°å¯è§†åŒ–æ•°æ®ä¸­çš„æ¨¡å¼ã€‚

**ç¬¬1æ­¥ï¼šæ ‡å‡†åŒ–æ•°æ®ï¼š**

ç”±äºæˆ‘ä»¬çš„æ•°æ®çŸ©é˜µå¯èƒ½åŒ…å«ä¸åŒå•ä½å’Œå°ºåº¦çš„å˜é‡ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å¯¹æ•°æ®è¿›è¡Œæ ‡å‡†åŒ–ã€‚

é¦–å…ˆè®¡ç®— $X$ çš„æ¯ä¸€è¡Œçš„å¹³å‡å€¼ã€‚

$$
\bar{X_i}= \frac{1}{n} \sum_{j = 1}^{n} x_{ij}
$$

ç„¶åç”¨è¿™äº›å¹³å‡å€¼åˆ›å»ºä¸€ä¸ªå¹³å‡å€¼çŸ©é˜µï¼š

$$
\bar{X} =  \begin{bmatrix} \bar{X_1} \\ \bar{X_2} \\ \ldots \\ \bar{X_m}\end{bmatrix}\begin{bmatrix}1 \mid 1 \mid \cdots \mid 1 \end{bmatrix}
$$

ä»åŸå§‹çŸ©é˜µä¸­å‡å»å¹³å‡å€¼çŸ©é˜µä»¥åˆ›å»ºä¸€ä¸ªå‡å€¼ä¸­å¿ƒåŒ–çŸ©é˜µï¼š

$$
B = X - \bar{X}
$$

**æ­¥éª¤2ï¼šè®¡ç®—åæ–¹å·®çŸ©é˜µï¼š**

ç„¶åå› ä¸ºæˆ‘ä»¬æƒ³è¦æå–å˜é‡ä¹‹é—´çš„å…³ç³»è€Œä¸æ˜¯ä»…ä»…å®ƒä»¬çš„å¤§å°ï¼Œæ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“å®ƒä»¬å¦‚ä½•ç›¸äº’è§£é‡Šï¼Œæˆ‘ä»¬è®¡ç®— $B$ çš„åæ–¹å·®çŸ©é˜µã€‚

$$
C = \frac{1}{n} BB^{\top}
$$

**æ­¥éª¤3ï¼šåˆ†è§£åæ–¹å·®çŸ©é˜µå¹¶æ’åˆ—å¥‡å¼‚å€¼ï¼š**

ç”±äºçŸ©é˜µ$C$æ˜¯æ­£å®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œç‰¹å¾å€¼åˆ†è§£ï¼Œæ‰¾å‡ºå…¶ç‰¹å¾å€¼ï¼Œå¹¶æŒ‰é™åºé‡æ–°æ’åˆ—ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡çŸ©é˜µã€‚

$C$çš„ç‰¹å¾å€¼åˆ†è§£å¯ä»¥é€šè¿‡åˆ†è§£$B$æ¥å¾—åˆ°ã€‚ç”±äº$B$ä¸æ˜¯æ–¹é˜µï¼Œæˆ‘ä»¬å¯¹$B$è¿›è¡ŒSVDåˆ†è§£ï¼š

$$
\begin{aligned}
B B^\top &= U \Sigma V^\top (U \Sigma V^{\top})^{\top}\\
&= U \Sigma V^\top V \Sigma^\top U^\top\\
&= U \Sigma \Sigma^\top U^\top
\end{aligned}
$$

$$
C = \frac{1}{n} U \Sigma \Sigma^\top U^\top
$$

ç„¶åæˆ‘ä»¬å¯ä»¥é‡æ–°æ’åˆ—çŸ©é˜µ$U$å’Œ$\Sigma$ä¸­çš„åˆ—ï¼Œä½¿å¥‡å¼‚å€¼æŒ‰é™åºæ’åˆ—ã€‚

**ç¬¬4æ­¥ï¼šé€‰æ‹©å¥‡å¼‚å€¼ï¼Œï¼ˆå¯é€‰ï¼‰æˆªæ–­å…¶ä½™éƒ¨åˆ†ï¼š**

æˆ‘ä»¬ç°åœ¨å¯ä»¥æ ¹æ®æƒ³è¦ä¿ç•™çš„æ–¹å·®é‡æ¥å†³å®šé€‰æ‹©å¤šå°‘ä¸ªå¥‡å¼‚å€¼ï¼ˆä¾‹å¦‚ï¼Œä¿ç•™95%çš„æ€»æ–¹å·®ï¼‰ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¡ç®—å‰$r$ä¸ªå› å­åŒ…å«çš„æ–¹å·®é™¤ä»¥æ€»æ–¹å·®æ¥è·å¾—ç™¾åˆ†æ¯”ï¼š

$$

\frac{\sum_{i = 1}^{r} \sigma^2_{i}}{\sum_{i = 1}^{p} \sigma^2_{i}}
$$

**ç¬¬5æ­¥ï¼šåˆ›å»ºå¾—åˆ†çŸ©é˜µï¼š**

$$
\begin{aligned}
T&= BV \cr
&= U\Sigma V^\top V \cr
&= U\Sigma
\end{aligned}
$$


## PCAä¸SVDçš„å…³ç³»

è¦å°†SVDä¸æ•°æ®é›†$X$çš„PCAè”ç³»èµ·æ¥ï¼Œé¦–å…ˆæ„å»ºæ•°æ®çŸ©é˜µ$X$çš„SVDï¼š

è®©æˆ‘ä»¬å‡è®¾æ‰€æœ‰å˜é‡çš„æ ·æœ¬å‡å€¼ä¸ºé›¶ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦æ ‡å‡†åŒ–çŸ©é˜µã€‚

$$
X = U \Sigma V^\top  = \sigma_1 U_1 V_1^\top  + \sigma_2 U_2 V_2^\top  + \cdots + \sigma_p U_p V_p^\top
$$ (eq:PCA1)

å…¶ä¸­

$$
U=\begin{bmatrix}U_1|U_2|\ldots|U_m\end{bmatrix}
$$

$$
V^\top  = \begin{bmatrix}V_1^\top \\V_2^\top \\\ldots\\V_n^\top \end{bmatrix}
$$

åœ¨æ–¹ç¨‹{eq}`eq:PCA1`ä¸­ï¼Œæ¯ä¸ª$m \times n$çŸ©é˜µ$U_{j}V_{j}^\top $æ˜¾ç„¶æ˜¯ç§©1çš„ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬æœ‰

$$

X = \sigma_1 \begin{pmatrix}U_{11}V_{1}^\top \\U_{21}V_{1}^\top \\\cdots\\U_{m1}V_{1}^\top \\\end{pmatrix} + \sigma_2\begin{pmatrix}U_{12}V_{2}^\top \\U_{22}V_{2}^\top \\\cdots\\U_{m2}V_{2}^\top \\\end{pmatrix}+\ldots + \sigma_p\begin{pmatrix}U_{1p}V_{p}^\top \\U_{2p}V_{p}^\top \\\cdots\\U_{mp}V_{p}^\top \\\end{pmatrix}
$$ (eq:PCA2)

ä»¥ä¸‹æ˜¯æˆ‘ä»¬å¦‚ä½•åœ¨æ—¶é—´åºåˆ—ä¸Šä¸‹æ–‡ä¸­è§£é‡ŠçŸ©é˜µæ–¹ç¨‹{eq}`eq:PCA2`ä¸­çš„å¯¹è±¡ï¼š

* $ \textrm{å¯¹äºæ¯ä¸ª} \ k=1, \ldots, n $ï¼Œå¯¹è±¡ $\lbrace V_{kj} \rbrace_{j=1}^n$ æ˜¯ç¬¬$k$ä¸ª**ä¸»æˆåˆ†**çš„æ—¶é—´åºåˆ—

* $U_j = \begin{bmatrix}U_{1k}\\U_{2k}\\\ldots\\U_{mk}\end{bmatrix} \ k=1, \ldots, m$
æ˜¯å˜é‡$X_i$åœ¨ç¬¬$k$ä¸ªä¸»æˆåˆ†ä¸Šçš„**è½½è·**å‘é‡ï¼Œå…¶ä¸­$i=1, \ldots, m$

* å¯¹äºæ¯ä¸ª$k=1, \ldots, p$ï¼Œ$\sigma_k$æ˜¯ç¬¬$k$ä¸ª**ä¸»æˆåˆ†**çš„å¼ºåº¦ï¼Œè¿™é‡Œçš„å¼ºåº¦æŒ‡çš„æ˜¯å¯¹$X$çš„æ•´ä½“åæ–¹å·®çš„è´¡çŒ®ã€‚

## åŸºäºç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡çš„PCA

ç°åœ¨æˆ‘ä»¬ä½¿ç”¨æ ·æœ¬åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾åˆ†è§£æ¥è¿›è¡ŒPCAã€‚

è®¾$X_{m \times n}$ä¸ºæˆ‘ä»¬çš„$m \times n$æ•°æ®çŸ©é˜µã€‚

å‡è®¾æ‰€æœ‰å˜é‡çš„æ ·æœ¬å‡å€¼éƒ½ä¸ºé›¶ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡å‡å»æ ·æœ¬å‡å€¼çš„**é¢„å¤„ç†**æ¥ç¡®ä¿è¿™ä¸€ç‚¹ã€‚

å®šä¹‰æ ·æœ¬åæ–¹å·®çŸ©é˜µ$\Omega$ä¸º

$$
\Omega = XX^\top
$$

ç„¶åä½¿ç”¨ç‰¹å¾åˆ†è§£å°†$\Omega$è¡¨ç¤ºå¦‚ä¸‹ï¼š

$$
\Omega =P\Lambda P^\top
$$

è¿™é‡Œ

* $P$æ˜¯$\Omega$çš„$mÃ—m$ç‰¹å¾å‘é‡çŸ©é˜µ

* $\Lambda$æ˜¯$\Omega$çš„ç‰¹å¾å€¼å¯¹è§’çŸ©é˜µ

æˆ‘ä»¬å¯ä»¥å°†$X$è¡¨ç¤ºä¸º

$$
X=P\epsilon
$$

å…¶ä¸­

$$
\epsilon = P^{-1} X
$$

ä¸”

$$
\epsilon\epsilon^\top =\Lambda .
$$

æˆ‘ä»¬å¯ä»¥éªŒè¯

$$
XX^\top =P\Lambda P^\top  .
$$ (eq:XXo)

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®çŸ©é˜µ$X$è¡¨ç¤ºä¸º

\begin{equation*}
X=\begin{bmatrix}X_1|X_2|\ldots|X_m\end{bmatrix} =\begin{bmatrix}P_1|P_2|\ldots|P_m\end{bmatrix}
\begin{bmatrix}\epsilon_1\\\epsilon_2\\\ldots\\\epsilon_m\end{bmatrix}

= P_1\epsilon_1+P_2\epsilon_2+\ldots+P_m\epsilon_m
\end{equation*}

ä¸ºäº†å°†å‰é¢çš„è¡¨ç¤ºä¸æˆ‘ä»¬ä¹‹å‰é€šè¿‡SVDè·å¾—çš„PCAç›¸åè°ƒï¼Œæˆ‘ä»¬é¦–å…ˆæ³¨æ„åˆ°$\epsilon_j^2=\lambda_j\equiv\sigma^2_j$ã€‚

ç°å®šä¹‰$\tilde{\epsilon_j} = \frac{\epsilon_j}{\sqrt{\lambda_j}}$ï¼Œ
è¿™æ„å‘³ç€$\tilde{\epsilon}_j\tilde{\epsilon}_j^\top =1$ã€‚

å› æ­¤

$$
\begin{aligned}
X&=\sqrt{\lambda_1}P_1\tilde{\epsilon_1}+\sqrt{\lambda_2}P_2\tilde{\epsilon_2}+\ldots+\sqrt{\lambda_m}P_m\tilde{\epsilon_m}\\
&=\sigma_1P_1\tilde{\epsilon_2}+\sigma_2P_2\tilde{\epsilon_2}+\ldots+\sigma_mP_m\tilde{\epsilon_m} ,
\end{aligned}
$$

è¿™ä¸ä¸‹å¼ä¸€è‡´

$$
X=\sigma_1U_1{V_1}^{T}+\sigma_2 U_2{V_2}^{T}+\ldots+\sigma_{r} U_{r}{V_{r}}^{T}
$$

åªè¦æˆ‘ä»¬è®¾å®š

* $U_j=P_j$ï¼ˆå˜é‡åœ¨ç¬¬jä¸ªä¸»æˆåˆ†ä¸Šçš„è½½è·å‘é‡ï¼‰

* ${V_k}^{T}=\tilde{\epsilon_k}$ï¼ˆç¬¬kä¸ªä¸»æˆåˆ†ï¼‰

ç”±äºè®¡ç®—æ•°æ®çŸ©é˜µ$X$çš„$P$å’Œ$U$æœ‰ä¸åŒçš„ç®—æ³•ï¼Œæ ¹æ®æ‰€ä½¿ç”¨çš„ç®—æ³•ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¾—åˆ°ç¬¦å·å·®å¼‚æˆ–ç‰¹å¾å‘é‡é¡ºåºçš„ä¸åŒã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³å…³äº$U$å’Œ$P$çš„è¿™äº›æ­§ä¹‰ï¼š

1. å°†ç‰¹å¾å€¼å’Œå¥‡å¼‚å€¼æŒ‰é™åºæ’åˆ—
2. åœ¨$P$å’Œ$U$ä¸­å¼ºåˆ¶ä½¿å¯¹è§’çº¿ä¸ºæ­£ï¼Œå¹¶ç›¸åº”åœ°è°ƒæ•´$V^\top$ä¸­çš„ç¬¦å·

## è”ç³»

ä¸ºäº†å°†è¿™äº›å†…å®¹è”ç³»èµ·æ¥ï¼ŒæŠŠä¸Šé¢æåˆ°çš„ä¸€äº›å…¬å¼ç»„åˆå¹¶æ¯”è¾ƒæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚

é¦–å…ˆï¼Œè€ƒè™‘ä¸€ä¸ª$m \times n$çŸ©é˜µçš„SVDï¼š

$$
X = U\Sigma V^\top
$$

è®¡ç®—ï¼š

$$
\begin{aligned}
XX^\top &=U\Sigma V^\top V\Sigma^\top  U^\top \cr
&\equiv U\Sigma\Sigma^\top U^\top \cr
&\equiv U\Lambda U^\top
\end{aligned}
$$  (eq:XXcompare)

å°†è¡¨ç¤ºå¼{eq}`eq:XXcompare`ä¸ä¸Šé¢çš„æ–¹ç¨‹{eq}`eq:XXo`è¿›è¡Œæ¯”è¾ƒã€‚

æ˜¾ç„¶ï¼ŒSVDä¸­çš„$U$å°±æ˜¯$XX^\top$çš„ç‰¹å¾å‘é‡çŸ©é˜µ$P$ï¼Œè€Œ$\Sigma \Sigma^\top$å°±æ˜¯ç‰¹å¾å€¼çŸ©é˜µ$\Lambda$ã€‚

å…¶æ¬¡ï¼Œè®©æˆ‘ä»¬è®¡ç®—

$$
\begin{aligned}
X^\top X &=V\Sigma^\top  U^\top U\Sigma V^\top \\
&=V\Sigma^\top {\Sigma}V^\top
\end{aligned}
$$

å› æ­¤ï¼ŒSVDä¸­çš„çŸ©é˜µ$V$æ˜¯$X^\top X$çš„ç‰¹å¾å‘é‡çŸ©é˜µã€‚

æ€»ç»“å¹¶å°†å„éƒ¨åˆ†ç»„åˆåœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬å¾—åˆ°æ ·æœ¬åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾åˆ†è§£

$$
X X^\top  = P \Lambda P^\top
$$

å…¶ä¸­$P$æ˜¯ä¸€ä¸ªæ­£äº¤çŸ©é˜µã€‚

æ­¤å¤–ï¼Œä»$X$çš„SVDåˆ†è§£ï¼Œæˆ‘ä»¬çŸ¥é“

$$
X X^\top  = U \Sigma \Sigma^\top  U^\top
$$

å…¶ä¸­$U$æ˜¯ä¸€ä¸ªæ­£äº¤çŸ©é˜µã€‚

å› æ­¤ï¼Œ$P = U$ï¼Œæˆ‘ä»¬å¾—åˆ°$X$çš„è¡¨ç¤º

$$
X = P \epsilon = U \Sigma V^\top
$$

ç”±æ­¤å¯å¾—

$$
U^\top  X = \Sigma V^\top  = \epsilon
$$

æ³¨æ„ä¸Šè¿°æ¨å¯¼æ„å‘³ç€

$$
\epsilon \epsilon^\top  = \Sigma V^\top  V \Sigma^\top  = \Sigma \Sigma^\top  = \Lambda ,
$$

è¿™æ ·æ‰€æœ‰éƒ¨åˆ†éƒ½å®Œç¾å¥‘åˆã€‚

ä¸‹é¢æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª`DecomAnalysis`ç±»ï¼Œç”¨äºå¯¹ç»™å®šçš„æ•°æ®çŸ©é˜µ`X`è¿›è¡ŒPCAå’ŒSVDåˆ†æã€‚

```{code-cell} ipython3
class DecomAnalysis:
    """
    ç”¨äºè¿›è¡ŒPCAå’ŒSVDåˆ†æçš„ç±»ã€‚
    X: æ•°æ®çŸ©é˜µ
    r_component: æœ€ä½³è¿‘ä¼¼æ‰€é€‰æ‹©çš„ç§©
    """

    def __init__(self, X, r_component=None):

        self.X = X

        self.Î© = (X @ X.T)

        self.m, self.n = X.shape
        self.r = LA.matrix_rank(X)

        if r_component:
            self.r_component = r_component
        else:
            self.r_component = self.m

    def pca(self):

        ğœ†, P = LA.eigh(self.Î©)    # Pçš„åˆ—æ˜¯ç‰¹å¾å‘é‡

        ind = sorted(range(ğœ†.size), key=lambda x: ğœ†[x], reverse=True)

        # æŒ‰ç‰¹å¾å€¼æ’åº
        self.ğœ† = ğœ†[ind]
        P = P[:, ind]
        self.P = P @ diag_sign(P)

        self.Î› = np.diag(self.ğœ†)

        self.explained_ratio_pca = np.cumsum(self.ğœ†) / self.ğœ†.sum()

        # è®¡ç®—Nä¹˜Tçš„ä¸»æˆåˆ†çŸ©é˜µ
        self.ğœ– = self.P.T @ self.X

        P = self.P[:, :self.r_component]
        ğœ– = self.ğœ–[:self.r_component, :]

        # è½¬æ¢æ•°æ®
        self.X_pca = P @ ğœ–

    def svd(self):

        U, ğœ, VT = LA.svd(self.X)

        ind = sorted(range(ğœ.size), key=lambda x: ğœ[x], reverse=True)

        # æŒ‰ç‰¹å¾å€¼æ’åº
        d = min(self.m, self.n)

        self.ğœ = ğœ[ind]
        U = U[:, ind]
        D = diag_sign(U)
        self.U = U @ D
        VT[:d, :] = D @ VT[ind, :]
        self.VT = VT

        self.Î£ = np.zeros((self.m, self.n))
        self.Î£[:d, :d] = np.diag(self.ğœ)

        ğœ_sq = self.ğœ ** 2
        self.explained_ratio_svd = np.cumsum(ğœ_sq) / ğœ_sq.sum()

        # æŒ‰ä½¿ç”¨çš„æˆåˆ†æ•°é‡åˆ‡ç‰‡çŸ©é˜µ
        U = self.U[:, :self.r_component]
        Î£ = self.Î£[:self.r_component, :self.r_component]
        VT = self.VT[:self.r_component, :]

        # è½¬æ¢æ•°æ®
        self.X_svd = U @ Î£ @ VT

    def fit(self, r_component):

        # pca
        P = self.P[:, :r_component]
        ğœ– = self.ğœ–[:r_component, :]

        # è½¬æ¢æ•°æ®
        self.X_pca = P @ ğœ–

        # svd
        U = self.U[:, :r_component]
        Î£ = self.Î£[:r_component, :r_component]
        VT = self.VT[:r_component, :]

        # è½¬æ¢æ•°æ®
        self.X_svd = U @ Î£ @ VT

def diag_sign(A):
    "è®¡ç®—çŸ©é˜µAå¯¹è§’çº¿å…ƒç´ çš„ç¬¦å·"

    D = np.diag(np.sign(np.diag(A)))

    return D
```

æˆ‘ä»¬è¿˜å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥æ‰“å°ä¿¡æ¯ï¼Œä»¥ä¾¿æ¯”è¾ƒä¸åŒç®—æ³•å¾—åˆ°çš„åˆ†è§£ç»“æœã€‚

```{code-cell} ipython3
def compare_pca_svd(da):
    """
    æ¯”è¾ƒPCAå’ŒSVDçš„ç»“æœã€‚
    """

    da.pca()
    da.svd()

    print('ç‰¹å¾å€¼å’Œå¥‡å¼‚å€¼\n')
    print(f'Î» = {da.Î»}\n')
    print(f'Ïƒ^2 = {da.Ïƒ**2}\n')
    print('\n')

    # è½½è·çŸ©é˜µ
    fig, axs = plt.subplots(1, 2, figsize=(14, 5))
    plt.suptitle('è½½è·')
    axs[0].plot(da.P.T)
    axs[0].set_title('P')
    axs[0].set_xlabel('m')
    axs[1].plot(da.U.T)
    axs[1].set_title('U')
    axs[1].set_xlabel('m')
    plt.show()

    # ä¸»æˆåˆ†
    fig, axs = plt.subplots(1, 2, figsize=(14, 5))
    plt.suptitle('ä¸»æˆåˆ†')
    axs[0].plot(da.Îµ.T)
    axs[0].set_title('Îµ')
    axs[0].set_xlabel('n')
    axs[1].plot(da.VT[:da.r, :].T * np.sqrt(da.Î»))
    axs[1].set_title('$V^\top *\sqrt{\lambda}$')
    axs[1].set_xlabel('n')
    plt.show()
```

## ç»ƒä¹ 

```{exercise}
:label: svd_ex1

åœ¨æ™®é€šæœ€å°äºŒä¹˜æ³•(OLS)ä¸­ï¼Œæˆ‘ä»¬å­¦ä¼šè®¡ç®— $ \hat{\beta} = (X^\top X)^{-1} X^\top y $ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬é‡åˆ°å…±çº¿æ€§æˆ–æ¬ å®šç³»ç»Ÿæ—¶ï¼šå³**çŸ­è€Œå®½**çš„çŸ©é˜µã€‚

åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œ$ (X^\top X) $çŸ©é˜µä¸å¯é€†ï¼ˆå…¶è¡Œåˆ—å¼ä¸ºé›¶ï¼‰æˆ–ç—…æ€ï¼ˆå…¶è¡Œåˆ—å¼éå¸¸æ¥è¿‘é›¶ï¼‰ã€‚

æˆ‘ä»¬å¯ä»¥æ”¹ç”¨æ‰€è°“çš„[ä¼ªé€†](https://en.wikipedia.org/wiki/Moore%E2%80%93Penrose_inverse)ï¼Œå³åˆ›å»ºä¸€ä¸ªæ»¡ç§©çš„é€†çŸ©é˜µè¿‘ä¼¼ï¼Œä»¥æ­¤æ¥è®¡ç®— $ \hat{\beta} $ã€‚

æ ¹æ®Eckart-Youngå®šç†ï¼Œæ„å»ºä¼ªé€†çŸ©é˜µ $ X^{+} $ å¹¶ç”¨å®ƒæ¥è®¡ç®— $ \hat{\beta} $ã€‚

```

```{solution-start} svd_ex1
:class: dropdown
```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨SVDæ¥è®¡ç®—ä¼ªé€†ï¼š

$$
X  = U \Sigma V^\top
$$

å¯¹Xæ±‚é€†ï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š

$$
X^{+}  = V \Sigma^{+} U^\top
$$

å…¶ä¸­ï¼š

$$
\Sigma^{+} = \begin{bmatrix}

\frac{1}{\sigma_1} & 0 & \cdots & 0 & 0 \\
0 & \frac{1}{\sigma_2} & \cdots & 0 & 0 \\
\vdots & \vdots & \ddots & \vdots & \vdots \\
0 & 0 & \cdots & \frac{1}{\sigma_p} & 0 \\
0 & 0 & \cdots & 0 & 0 \\
\end{bmatrix}
$$

æœ€åï¼š

$$
\hat{\beta} = X^{+}y = V \Sigma^{+} U^\top y 
$$

```{solution-end}
```

å…³äºPCAåº”ç”¨äºåˆ†ææ™ºåŠ›æµ‹è¯•ç»“æ„çš„ç¤ºä¾‹ï¼Œè¯·å‚è§æœ¬è®²åº§ {doc}`å¤šå…ƒæ­£æ€åˆ†å¸ƒ <multivariate_normal>`ã€‚

æŸ¥çœ‹è¯¥è®²åº§ä¸­æè¿°å’Œè¯´æ˜ç»å…¸å› å­åˆ†ææ¨¡å‹çš„éƒ¨åˆ†ã€‚

å¦‚å‰æ‰€è¿°ï¼Œåœ¨åç»­å…³äº {doc}`åŠ¨æ€æ¨¡æ€åˆ†è§£ <var_dmd>` çš„è®²åº§ä¸­ï¼Œæˆ‘ä»¬å°†æè¿°SVDå¦‚ä½•æä¾›å¿«é€Ÿè®¡ç®—ä¸€é˜¶å‘é‡è‡ªå›å½’(VARs)çš„é™é˜¶è¿‘ä¼¼çš„æ–¹æ³•ã€‚

