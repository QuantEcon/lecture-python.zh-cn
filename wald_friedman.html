
<!DOCTYPE html>


<html lang="zh-CN" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>26. 让弥尔顿·弗里德曼困惑的问题 &#8212; Python中级数量经济学</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" href="_static/styles/quantecon-book-theme.css?digest=3bd9fcddbe64f63e07c8604843d1cc622a07b430" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css?v=982b99e0" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css?v=b4b7a797" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>


    <script src="_static/documentation_options.js?v=946197a6"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="_static/scripts/quantecon-book-theme.js?digest=30f7c850c5b005eca2ad6e48893cd350a6c6c4c2"></script>
    <script src="_static/scripts/jquery.js?v=5d32c60e"></script>
    <script src="_static/scripts/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="_static/translations.js?v=beaddf03"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-J0SMYR4SG3"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-J0SMYR4SG3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-J0SMYR4SG3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"tex": {"macros": {"argmax": "arg\\,max", "argmin": "arg\\,min"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'wald_friedman';</script>
    <link rel="canonical" href="https://python.quantecon-zh-cn.org/wald_friedman.html" />
    <link rel="icon" href="_static/lectures-favicon.ico"/>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" />
    <link rel="next" title="27. 用贝叶斯方法解决弗里德曼和瓦尔德问题" href="wald_friedman_2.html" />
    <link rel="prev" title="25. 似然比过程的均值" href="imp_sample.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和编写的数量经济建模讲座。 />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="让弥尔顿·弗里德曼困惑的问题"/>
<meta name="twitter:description" content="本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和编写的数量经济建模讲座。">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="让弥尔顿·弗里德曼困惑的问题" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://python.quantecon-zh-cn.org/wald_friedman.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="本课程是由托马斯·萨金特（Thomas J. Sargent）和约翰·斯塔胡斯基（John Stachurski）设计和编写的数量经济建模讲座。" />
<meta property="og:site_name" content="Python中级数量经济学" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>

<!-- Override QuantEcon theme colors -->

    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=wald_friedman>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">26.1. 概述</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">26.2. 问题的来源</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#neyman-pearson">26.3. Neyman-Pearson公式</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">26.4. 瓦尔德的序贯表述</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">26.4.1. 第一类错误和第二类错误</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">26.4.2. 选择</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-b-alpha-beta">26.5. <span class="math notranslate nohighlight">\(A,B\)</span>与<span class="math notranslate nohighlight">\(\alpha, \beta\)</span>之间的联系</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">26.6. 模拟</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">26.7. 相关讲座</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">26.8. 练习</a></li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo-large.png" class="logo logo-img" alt="logo"></a>
                                    
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/en/stable/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">Python中级数量经济学</a></p>

                        <p class="qe-page__header-subheading">让弥尔顿·弗里德曼困惑的问题</p>

                    </div>
                    <!-- length 2, since its a string and empty dict has length 2 - {} -->
                        <p class="qe-page__header-authors" font-size="18">
                            
                                
                                    <a href="http://www.tomsargent.com/" target="_blank"><span>托马斯·萨金特（Thomas J. Sargent）</span></a>
                                
                            
                                
                                    and <a href="https://johnstachurski.net/" target="_blank"><span>约翰·斯塔胡斯基（John Stachurski）</span></a>
                                
                            
                        </p>


                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1><a class="toc-backref" href="#id20" role="doc-backlink"><span class="section-number">26. </span><span class="target" id="index-0"></span>让弥尔顿·弗里德曼困惑的问题</a><a class="headerlink" href="#id1" title="Link to this heading">#</a></h1>
<p>(而亚伯拉罕·瓦尔德通过发明序贯分析解决了这个问题)</p>
<nav class="contents" id="id2">
<span id="index-1"></span><p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id1" id="id20">让弥尔顿·弗里德曼困惑的问题</a></p>
<ul>
<li><p><a class="reference internal" href="#id3" id="id21">概述</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id22">问题的来源</a></p></li>
<li><p><a class="reference internal" href="#neyman-pearson" id="id23">Neyman-Pearson公式</a></p></li>
<li><p><a class="reference internal" href="#id12" id="id24">瓦尔德的序贯表述</a></p></li>
<li><p><a class="reference internal" href="#a-b-alpha-beta" id="id25"><span class="math notranslate nohighlight">\(A,B\)</span>与<span class="math notranslate nohighlight">\(\alpha, \beta\)</span>之间的联系</a></p></li>
<li><p><a class="reference internal" href="#id16" id="id26">模拟</a></p></li>
<li><p><a class="reference internal" href="#id18" id="id27">相关讲座</a></p></li>
<li><p><a class="reference internal" href="#id19" id="id28">练习</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="id3">
<h2><a class="toc-backref" href="#id21" role="doc-backlink"><span class="section-number">26.1. </span>概述</a><a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<p>这是关于一个统计决策问题的两个讲座中的第一个。这个问题是二战期间，当弥尔顿·弗里德曼和W·艾伦·沃利斯在哥伦比亚大学的美国政府统计研究组担任分析师时，一位美国海军上尉向他们提出的。</p>
<p>这个问题促使亚伯拉罕·瓦尔德<span id="id4">[<a class="reference internal" href="zreferences.html#id120" title="Abraham Wald. Sequential Analysis. John Wiley and Sons, New York, 1947.">Wald, 1947</a>]</span>提出了<strong>序贯分析</strong>，这是一种与动态规划密切相关的统计决策问题处理方法。</p>
<p>本讲座及其<a class="reference internal" href="wald_friedman_2.html"><span class="doc">续篇</span></a>延续了<a class="reference internal" href="prob_meaning.html"><span class="doc">之前讲座</span></a>的精神，从频率主义和贝叶斯两个不同的角度来处理这个问题。</p>
<p>在本讲中，我们从一位统计学家的角度描述Wald的问题表述，这位统计学家遵循Neyman-Pearson的频率派统计学传统，关注假设检验，并因此使用大数定律来研究在给定<strong>假设</strong>下特定统计量的极限性质，即，一个<strong>参数</strong>向量确定了统计学家感兴趣的统计模型簇中的某个特定成员。</p>
<ul class="simple">
<li><p>从<a class="reference internal" href="prob_meaning.html"><span class="doc">这节关于频率派和贝叶斯统计的讲座</span></a>中，请记住频率派统计学家经常计算随机变量序列的函数，以参数向量为条件。</p></li>
</ul>
<p>在<a class="reference internal" href="wald_friedman_2.html"><span class="doc">这个相关讲座</span></a>中，我们将讨论另一种表述方法，它采用<strong>贝叶斯统计学家</strong>的视角，将参数视为与他所关心的可观测变量共同分布的随机变量。</p>
<p>因为我们采用的是关注在不同参数值（即不同<strong>假设</strong>）条件下相对频率的频率派视角，本讲的关键概念包括：</p>
<ul class="simple">
<li><p>第一类和第二类统计错误</p>
<ul>
<li><p>第一类错误是指在原假设为真时拒绝原假设</p></li>
<li><p>第二类错误是指在原假设为假时接受原假设</p></li>
</ul>
</li>
<li><p>频率派统计检验的<strong>检验效能</strong></p></li>
<li><p>频率派统计检验的<strong>显著性水平</strong></p></li>
<li><p>统计检验的<strong>临界区域</strong></p></li>
<li><p><strong>一致最优检验</strong></p></li>
<li><p>大数定律(LLN)在解释频率统计检验的<strong>功效</strong>和<strong>规模</strong>中的作用</p></li>
<li><p>亚伯拉罕·瓦尔德的<strong>序贯概率比检验</strong></p></li>
</ul>
<p>我们先导入一些包：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="n">FONTPATH</span> <span class="o">=</span> <span class="s2">&quot;fonts/SourceHanSerifSC-SemiBold.otf&quot;</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">fontManager</span><span class="o">.</span><span class="n">addfont</span><span class="p">(</span><span class="n">FONTPATH</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Source Han Serif SC&#39;</span><span class="p">]</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">numba</span><span class="w"> </span><span class="kn">import</span> <span class="n">njit</span><span class="p">,</span> <span class="n">prange</span><span class="p">,</span> <span class="n">vectorize</span><span class="p">,</span> <span class="n">jit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numba.experimental</span><span class="w"> </span><span class="kn">import</span> <span class="n">jitclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">gamma</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">quad</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">beta</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
</pre></div>
</div>
</div>
</div>
<p>本讲座运用了<a class="reference internal" href="likelihood_ratio_process.html"><span class="doc">似然比过程讲座</span></a>和<a class="reference internal" href="likelihood_bayes.html"><span class="doc">贝叶斯学习讲座</span></a>中研究的概念。</p>
</section>
<section id="id5">
<h2><a class="toc-backref" href="#id22" role="doc-backlink"><span class="section-number">26.2. </span>问题的来源</a><a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<p>在米尔顿·弗里德曼与罗斯·弗里德曼1998年合著的《两个幸运儿》一书的137-139页<span id="id6">[<a class="reference internal" href="zreferences.html#id115" title="Milton Friedman and Rose D Friedman. Two Lucky People. University of Chicago Press, 1998.">Friedman and Friedman, 1998</a>]</span>中，米尔顿·弗里德曼描述了二战期间他和艾伦·沃利斯在哥伦比亚大学美国政府统计研究组工作时遇到的一个问题。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>参见艾伦·沃利斯1980年发表的文章<span id="id7">[<a class="reference internal" href="zreferences.html#id12" title="W Allen Wallis. The statistical research group, 1942–1945. Journal of the American Statistical Association, 75(370):320–330, 1980.">Wallis, 1980</a>]</span>第25和26页，其中讲述了二战期间在哥伦比亚大学统计研究组的这段经历，以及哈罗德·霍特林对问题形成所作出的重要贡献。另见珍妮弗·伯恩斯关于米尔顿·弗里德曼的著作<span id="id8">[<a class="reference internal" href="zreferences.html#id13" title="Jennifer Burns. Milton Friedman: The Last Conservative. Farrar, Straus, and Giroux, New York, 2023.">Burns, 2023</a>]</span>第5章。</p>
</div>
<p>让我们听听米尔顿·弗里德曼是如何讲述这件事的：</p>
<blockquote>
<div><p>要理解这个故事，需要先了解一个简单的统计问题及其标准处理程序。序贯分析由此产生的实际问题就很合适。海军有两种备选的炮弹设计（比如说A和B），想要确定哪一个更好。为此，海军进行了一系列成对的试射。每一轮中，如果A的表现优于B，则给A记1分，B记0分；反之，如果A的表现不如B，则给A记0分，B记1分。海军请统计学家</p>
</div></blockquote>
<blockquote>
<div><p>如何进行测试以及如何分析结果。</p>
</div></blockquote>
<blockquote>
<div><p>标准的统计答案是指定发射次数(比如1,000次)和一对百分比(例如53%和47%),并告诉客户如果A在超过53%的发射中获得1分,就可以认为A更优;如果在少于47%的发射中获得1分,则可以认为B更优;如果百分比在47%到53%之间,则两者都不能被认为更优。</p>
</div></blockquote>
<blockquote>
<div><p>当Allen Wallis与(海军)Garret L. Schuyler上尉讨论这个问题时,上尉反对这样的测试,引用Allen的说法,这可能会造成浪费。如果像Schuyler这样明智且经验丰富的军需官在现场,他在前几千发甚至前几百发[弹药]后就会发现实验不需要完成,要么是因为新方法明显较差,要么是因为它明显优于预期<span class="math notranslate nohighlight">\(\ldots\)</span>。</p>
</div></blockquote>
<p>Friedman和Wallis研究了这个问题一段时间但没有完全解决它。</p>
<p>意识到这一点后,他们把这个问题告诉了Abraham Wald。</p>
<p>这让Wald走上了一条创造<em>序贯分析</em><span id="id9">[<a class="reference internal" href="zreferences.html#id120" title="Abraham Wald. Sequential Analysis. John Wiley and Sons, New York, 1947.">Wald, 1947</a>]</span>的道路。</p>
</section>
<section id="neyman-pearson">
<h2><a class="toc-backref" href="#id23" role="doc-backlink"><span class="section-number">26.3. </span>Neyman-Pearson公式</a><a class="headerlink" href="#neyman-pearson" title="Link to this heading">#</a></h2>
<p>从描述美国海军告诉G. S. Schuyler上尉使用的测试背后的理论开始会很有帮助。</p>
<p>Schuyler上尉的疑虑促使他向Milton Friedman和Allen Wallis表达了他的推测,即存在更好的实践程序。</p>
<p>显然，海军当时要求Schuyler上校使用当时最先进的Neyman-Pearson假设检验。</p>
<p>我们将依据Abraham Wald的<span id="id10">[<a class="reference internal" href="zreferences.html#id120" title="Abraham Wald. Sequential Analysis. John Wiley and Sons, New York, 1947.">Wald, 1947</a>]</span>对Neyman-Pearson理论的优雅总结。</p>
<p>请注意以下设置特点：</p>
<ul class="simple">
<li><p>假定<em>固定</em>样本量<span class="math notranslate nohighlight">\(n\)</span></p></li>
<li><p>应用大数定律（在不同概率模型条件下）来解释Neyman-Pearson理论中定义的第一类错误和第二类错误的概率<span class="math notranslate nohighlight">\(\alpha\)</span>和<span class="math notranslate nohighlight">\(\beta\)</span></p></li>
</ul>
<p>在<strong>序贯分析</strong><span id="id11">[<a class="reference internal" href="zreferences.html#id120" title="Abraham Wald. Sequential Analysis. John Wiley and Sons, New York, 1947.">Wald, 1947</a>]</span>第一章中，Abraham Wald总结了Neyman-Pearson的假设检验方法。</p>
<p>Wald将问题框定为对部分已知的概率分布做出决策。</p>
<p>（你必须假设<em>某些</em>内容是已知的，才能提出一个明确的问题 – 通常，<em>某些</em>意味着<em>很多</em>）</p>
<p>通过限制未知部分，Wald使用以下简单结构来说明主要思想：</p>
<ul class="simple">
<li><p>决策者想要决定两个分布<span class="math notranslate nohighlight">\(f_0\)</span>、<span class="math notranslate nohighlight">\(f_1\)</span>中哪一个支配独立同分布随机变量<span class="math notranslate nohighlight">\(z\)</span>。</p></li>
<li><p>原假设<span class="math notranslate nohighlight">\(H_0\)</span>是指<span class="math notranslate nohighlight">\(f_0\)</span>支配数据的陈述。</p></li>
<li><p>备择假设<span class="math notranslate nohighlight">\(H_1\)</span>是指<span class="math notranslate nohighlight">\(f_1\)</span>支配数据的陈述。</p></li>
<li><p>问题是基于固定数量<span class="math notranslate nohighlight">\(n\)</span>个独立观测值<span class="math notranslate nohighlight">\(z_1, z_2, \ldots, z_n\)</span>设计并分析一个检验原假设<span class="math notranslate nohighlight">\(H_0\)</span>对备择假设<span class="math notranslate nohighlight">\(H_1\)</span>的检验。</p></li>
</ul>
<p>引用Abraham Wald的话：</p>
<blockquote>
<div><p>导致接受或拒绝[零]假设的检验程序，简单来说就是一个规则，它为每个可能的样本量
<span class="math notranslate nohighlight">\(n\)</span>规定是否应该基于该样本接受或拒绝[零]假设。这也可以表述如下：检验程序
就是将所有可能的样本量<span class="math notranslate nohighlight">\(n\)</span>的总体划分为两个互斥的部分，比如说第1部分和第2部分，
同时应用这样的规则：如果观察到的样本包含在第2部分中，则接受[零]假设。第1部分
也被称为临界区域。由于第2部分是所有不包含在第1部分中的样本量<span class="math notranslate nohighlight">\(n\)</span>的总体，
第2部分由第1部分唯一确定。因此，选择检验程序等同于确定临界区域。</p>
</div></blockquote>
<p>让我们继续听Wald的话：</p>
<blockquote>
<div><p>Neyman和Pearson提出了以下选择临界区域的考虑因素：在接受或拒绝<span class="math notranslate nohighlight">\(H_0\)</span>时，
我们可能犯两种错误。当<span class="math notranslate nohighlight">\(H_0\)</span>为真而我们拒绝它时，我们犯第一类错误；当
<span class="math notranslate nohighlight">\(H_1\)</span>为真而我们接受<span class="math notranslate nohighlight">\(H_0\)</span>时，我们犯第二类错误。在选定特定的临界区域
<span class="math notranslate nohighlight">\(W\)</span>之后，犯第一类错误的概率以及犯第二类错误的概率</p>
</div></blockquote>
<blockquote>
<div><p>第一类错误是唯一确定的。第一类错误的概率等于在假设<span class="math notranslate nohighlight">\(H_0\)</span>为真的条件下，观察到的样本落入临界区域<span class="math notranslate nohighlight">\(W\)</span>的概率。第二类错误的概率等于在假设<span class="math notranslate nohighlight">\(H_1\)</span>为真的条件下，概率落在临界区域<span class="math notranslate nohighlight">\(W\)</span>之外的概率。对于任何给定的临界区域<span class="math notranslate nohighlight">\(W\)</span>，我们用<span class="math notranslate nohighlight">\(\alpha\)</span>表示第一类错误的概率，用<span class="math notranslate nohighlight">\(\beta\)</span>表示第二类错误的概率。</p>
</div></blockquote>
<p>让我们仔细听听Wald如何运用大数定律来解释<span class="math notranslate nohighlight">\(\alpha\)</span>和<span class="math notranslate nohighlight">\(\beta\)</span>：</p>
<blockquote>
<div><p>概率<span class="math notranslate nohighlight">\(\alpha\)</span>和<span class="math notranslate nohighlight">\(\beta\)</span>有以下重要的实际解释：假设我们抽取大量规模为<span class="math notranslate nohighlight">\(n\)</span>的样本。设<span class="math notranslate nohighlight">\(M\)</span>为抽取的样本数。假设对于这<span class="math notranslate nohighlight">\(M\)</span>个样本中的每一个，如果样本落入<span class="math notranslate nohighlight">\(W\)</span>则拒绝<span class="math notranslate nohighlight">\(H_0\)</span>，如果样本落在<span class="math notranslate nohighlight">\(W\)</span>之外则接受<span class="math notranslate nohighlight">\(H_0\)</span>。通过这种方式，我们做出<span class="math notranslate nohighlight">\(M\)</span>个拒绝或接受的判断。这些判断中的一些通常会是错误的。如果<span class="math notranslate nohighlight">\(H_0\)</span>为真且<span class="math notranslate nohighlight">\(M\)</span>很大，则错误判断的比例（即错误判断数除以<span class="math notranslate nohighlight">\(M\)</span>）约为<span class="math notranslate nohighlight">\(\alpha\)</span>的概率接近于<span class="math notranslate nohighlight">\(1\)</span>（即几乎可以确定）。如果<span class="math notranslate nohighlight">\(H_1\)</span>为真，则错误判断的比例约为</p>
</div></blockquote>
<blockquote>
<div><p>错误陈述的比例将大约为<span class="math notranslate nohighlight">\(\beta\)</span>。
因此，我们可以说从长远来看[这里Wald应用大数定律，让<span class="math notranslate nohighlight">\(M \rightarrow \infty\)</span>（这是我们的注释，不是Wald的）]，如果<span class="math notranslate nohighlight">\(H_0\)</span>为真，错误陈述的比例将是<span class="math notranslate nohighlight">\(\alpha\)</span>，如果<span class="math notranslate nohighlight">\(H_1\)</span>为真，则为<span class="math notranslate nohighlight">\(\beta\)</span>。</p>
</div></blockquote>
<p>量<span class="math notranslate nohighlight">\(\alpha\)</span>被称为临界区域的<em>大小</em>，而量<span class="math notranslate nohighlight">\(1-\beta\)</span>被称为临界区域的<em>检验力</em>。</p>
<p>Wald指出</p>
<blockquote>
<div><p>如果一个临界区域<span class="math notranslate nohighlight">\(W\)</span>具有较小的<span class="math notranslate nohighlight">\(\alpha\)</span>和<span class="math notranslate nohighlight">\(\beta\)</span>值，那么它比另一个更可取。虽然通过适当选择临界区域<span class="math notranslate nohighlight">\(W\)</span>，可以使<span class="math notranslate nohighlight">\(\alpha\)</span>或<span class="math notranslate nohighlight">\(\beta\)</span>任意小，但对于固定的<span class="math notranslate nohighlight">\(n\)</span>值（即固定的样本量），不可能同时使<span class="math notranslate nohighlight">\(\alpha\)</span>和<span class="math notranslate nohighlight">\(\beta\)</span>都任意小。</p>
</div></blockquote>
<p>Wald总结了Neyman和Pearson的设置如下：</p>
<blockquote>
<div><p>Neyman和Pearson表明，由满足以下不等式的所有样本<span class="math notranslate nohighlight">\((z_1, z_2, \ldots, z_n)\)</span>组成的区域</p>
<div class="math notranslate nohighlight">
\[
  \frac{ f_1(z_1) \cdots f_1(z_n)}{f_0(z_1) \cdots f_0(z_n)} \geq k
 \]</div>
<p>是检验假设<span class="math notranslate nohighlight">\(H_0\)</span>对抗备择假设<span class="math notranslate nohighlight">\(H_1\)</span>的最优势检验区域。右边的项<span class="math notranslate nohighlight">\(k\)</span>是一个常数，选择它使得该区域具有所需的大小<span class="math notranslate nohighlight">\(\alpha\)</span>。</p>
</div></blockquote>
<p>Wald继续讨论了Neyman和Pearson的<em>一致最优势</em>检验的概念。</p>
<p>以下是Wald如何引入序贯检验的概念</p>
<blockquote>
<div><p>在实验的任何阶段（对于每个整数值<span class="math notranslate nohighlight">\(m\)</span>的第<span class="math notranslate nohighlight">\(m\)</span>次试验），都给出一个规则来做出以下三个决定之一：
(1)接受假设<span class="math notranslate nohighlight">\(H\)</span>，(2)拒绝假设<span class="math notranslate nohighlight">\(H\)</span>，(3)通过进行额外的观察来继续实验。因此，
这样的检验程序是按顺序进行的。基于第一次观察，做出上述决定之一。如果做出
第一个或第二个决定，过程就终止。如果做出第三个决定，就进行第二次试验。
同样，基于前两次观察，做出三个决定之一。如果做出第三个决定，就进行第三次
试验，依此类推。这个过程持续进行，直到做出第一个或第二个决定为止。这种
检验程序所需的观察次数<span class="math notranslate nohighlight">\(n\)</span>是一个随机变量，因为<span class="math notranslate nohighlight">\(n\)</span>的值取决于观察的结果。</p>
</div></blockquote>
</section>
<section id="id12">
<h2><a class="toc-backref" href="#id24" role="doc-backlink"><span class="section-number">26.4. </span>瓦尔德的序贯表述</a><a class="headerlink" href="#id12" title="Link to this heading">#</a></h2>
<p>与奈曼-皮尔逊问题表述的对比，在瓦尔德的表述中：</p>
<ul class="simple">
<li><p>样本量<span class="math notranslate nohighlight">\(n\)</span>不是固定的，而是一个随机变量。</p></li>
<li><p>两个参数<span class="math notranslate nohighlight">\(A\)</span>和<span class="math notranslate nohighlight">\(B\)</span>与奈曼-皮尔逊的<span class="math notranslate nohighlight">\(\alpha\)</span>和<span class="math notranslate nohighlight">\(\beta\)</span>相关但不同；
<span class="math notranslate nohighlight">\(A\)</span>和<span class="math notranslate nohighlight">\(B\)</span>表征了瓦尔德用来确定随机变量<span class="math notranslate nohighlight">\(n\)</span>作为随机结果函数的截止规则。</p></li>
</ul>
<p>以下是瓦尔德如何设置这个问题。</p>
<p>决策者可以观察一个随机变量 <span class="math notranslate nohighlight">\(z\)</span> 的一系列抽样。</p>
<p>他（或她）想要知道是哪一个概率分布 <span class="math notranslate nohighlight">\(f_0\)</span> 或 <span class="math notranslate nohighlight">\(f_1\)</span> 支配着 <span class="math notranslate nohighlight">\(z\)</span>。</p>
<p>我们使用贝塔分布作为例子。</p>
<p>我们还将使用在 <a class="reference internal" href="divergence_measures.html"><span class="doc">统计散度度量</span></a> 中介绍的 Jensen-Shannon 散度。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@vectorize</span>
<span class="k">def</span><span class="w"> </span><span class="nf">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;贝塔分布密度函数。&quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">r</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_beta_density</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;创建具有指定参数的贝塔密度函数。&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jit</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compute_KL</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;计算KL散度 KL(f, g)&quot;&quot;&quot;</span>
    <span class="n">integrand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">g</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="n">val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="mf">1e-5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compute_JS</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;计算Jensen-Shannon散度&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">m</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">+</span> <span class="n">g</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    
    <span class="n">js_div</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">compute_KL</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">js_div</span>
</pre></div>
</div>
</div>
</div>
<p>下图显示了两个贝塔分布</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f0</span> <span class="o">=</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">f0</span><span class="p">(</span><span class="n">grid</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$f_0$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">f1</span><span class="p">(</span><span class="n">grid</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$f_1$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;$z$ 值&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;$z_k$ 的概率&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/654cbc55951ac4f37eb65cd0e457815adcaef6afd282cdbbb252a78ffaccca84.png" src="_images/654cbc55951ac4f37eb65cd0e457815adcaef6afd282cdbbb252a78ffaccca84.png" />
</div>
</div>
<p>在已知连续观测值来自分布<span class="math notranslate nohighlight">\(f_0\)</span>的条件下，这个随机变量序列是独立同分布的(IID)。</p>
<p>在已知连续观测值来自分布<span class="math notranslate nohighlight">\(f_1\)</span>的条件下，这个随机变量序列也是独立同分布的(IID)。</p>
<p>但是观察者并不知道序列是由这两个分布中的哪一个生成的。</p>
<p>由<a class="reference external" href="https://python.quantecon.org/exchangeable.html">可交换性和贝叶斯更新</a>中解释的原因，这意味着观察者认为该序列不是IID的。</p>
<p>因此，观察者有需要学习的内容，即观测值是来自<span class="math notranslate nohighlight">\(f_0\)</span>还是来自<span class="math notranslate nohighlight">\(f_1\)</span>。</p>
<p>决策者想要确定是哪一个分布在生成结果。</p>
<section id="id13">
<h3><span class="section-number">26.4.1. </span>第一类错误和第二类错误<a class="headerlink" href="#id13" title="Link to this heading">#</a></h3>
<p>如果我们将<span class="math notranslate nohighlight">\(f=f_0\)</span>视为零假设，将<span class="math notranslate nohighlight">\(f=f_1\)</span>视为备择假设，那么：</p>
<ul class="simple">
<li><p>第一类错误是错误地拒绝了真的零假设（“假阳性”）</p></li>
<li><p>第二类错误是未能拒绝假的零假设（“假阴性”）</p></li>
</ul>
<p>重申一下：</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\alpha\)</span>是第一类错误的概率</p></li>
<li><p><span class="math notranslate nohighlight">\(\beta\)</span>是第二类错误的概率</p></li>
</ul>
</section>
<section id="id14">
<h3><span class="section-number">26.4.2. </span>选择<a class="headerlink" href="#id14" title="Link to this heading">#</a></h3>
<p>在观察到<span class="math notranslate nohighlight">\(z_k, z_{k-1}, \ldots, z_1\)</span>后，决策者可以在三个不同的行动中选择：</p>
<ul class="simple">
<li><p>他决定<span class="math notranslate nohighlight">\(f = f_0\)</span>并停止获取更多的<span class="math notranslate nohighlight">\(z\)</span>值</p></li>
<li><p>他决定<span class="math notranslate nohighlight">\(f = f_1\)</span>并停止获取更多的<span class="math notranslate nohighlight">\(z\)</span>值</p></li>
<li><p>他推迟做决定，转而选择抽取
<span class="math notranslate nohighlight">\(z_{k+1}\)</span></p></li>
</ul>
<p>Wald定义</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(p_{0m} = f_0(z_1) \cdots f_0(z_m)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(p_{1m} = f_1(z_1) \cdots f_1(z_m)\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(L_{m} = \frac{p_{1m}}{p_{0m}}\)</span></p></li>
</ul>
<p>这里<span class="math notranslate nohighlight">\(\{L_m\}_{m=0}^\infty\)</span>是一个<strong>似然比过程</strong>。</p>
<p>Wald的序贯决策规则由实数<span class="math notranslate nohighlight">\(B &lt; A\)</span>参数化。</p>
<p>对于给定的一对<span class="math notranslate nohighlight">\(A, B\)</span>，决策规则是</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\textrm { 接受 } f=f_1 \textrm{ 如果 } L_m \geq A \\
\textrm { 接受 } f=f_0 \textrm{ 如果 } L_m \leq B \\
\textrm { 再抽取一个 }  z \textrm{ 如果 }  B &lt; L_m &lt; A
\end{aligned}
\end{split}\]</div>
<p>下图说明了Wald程序的各个方面。</p>
<figure class="align-default">
<img alt="_images/wald_dec_rule.png" src="_images/wald_dec_rule.png" />
</figure>
</section>
</section>
<section id="a-b-alpha-beta">
<h2><a class="toc-backref" href="#id25" role="doc-backlink"><span class="section-number">26.5. </span><span class="math notranslate nohighlight">\(A,B\)</span>与<span class="math notranslate nohighlight">\(\alpha, \beta\)</span>之间的联系</a><a class="headerlink" href="#a-b-alpha-beta" title="Link to this heading">#</a></h2>
<p>在<strong>序贯分析</strong><span id="id15">[<a class="reference internal" href="zreferences.html#id120" title="Abraham Wald. Sequential Analysis. John Wiley and Sons, New York, 1947.">Wald, 1947</a>]</span>第3章中，Wald建立了以下不等式</p>
<div class="math notranslate nohighlight">
\[\begin{split} 
\begin{aligned} 
 \frac{\alpha}{1 -\beta} &amp; \leq \frac{1}{A} \\
 \frac{\beta}{1 - \alpha} &amp; \leq B 
\end{aligned}
\end{split}\]</div>
<p>他对这些不等式的分析导致Wald推荐以下近似作为设置<span class="math notranslate nohighlight">\(A\)</span>和<span class="math notranslate nohighlight">\(B\)</span>的规则，这些规则接近于达到决策者对第I类错误概率<span class="math notranslate nohighlight">\(\alpha\)</span>和第II类错误概率<span class="math notranslate nohighlight">\(\beta\)</span>的目标值：</p>
<div class="math notranslate nohighlight" id="equation-eq-waldrule">
<span class="eqno">(26.1)<a class="headerlink" href="#equation-eq-waldrule" title="Link to this equation">#</a></span>\[\begin{split}
\begin{aligned}
A \approx a(\alpha,\beta) &amp; \equiv \frac{1-\beta}{\alpha} \\
B \approx b(\alpha,\beta)  &amp; \equiv \frac{\beta}{1-\alpha} 
\end{aligned} 
\end{split}\]</div>
<p>对于较小的 <span class="math notranslate nohighlight">\(\alpha\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span> 值，Wald表明近似式 <a class="reference internal" href="#equation-eq-waldrule">(26.1)</a> 提供了一个设定 <span class="math notranslate nohighlight">\(A\)</span> 和 <span class="math notranslate nohighlight">\(B\)</span> 的良好方法。</p>
<p>特别地，Wald构建了一个数学论证，使他得出结论：使用近似式 <a class="reference internal" href="#equation-eq-waldrule">(26.1)</a> 而不是真实函数 <span class="math notranslate nohighlight">\(A (\alpha, \beta), B(\alpha,\beta)\)</span> 来设定 <span class="math notranslate nohighlight">\(A\)</span> 和 <span class="math notranslate nohighlight">\(B\)</span></p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(\ldots\)</span> 不会导致 <span class="math notranslate nohighlight">\(\alpha\)</span> 或 <span class="math notranslate nohighlight">\(\beta\)</span> 的值有任何显著增加。换句话说，
就实际目的而言，对应于 <span class="math notranslate nohighlight">\(A = a(\alpha, \beta), B = b(\alpha,\beta)\)</span> 的检验
至少提供了与对应于 <span class="math notranslate nohighlight">\(A = A(\alpha, \beta)\)</span> 和
<span class="math notranslate nohighlight">\(B = b(\alpha, \beta)\)</span> 的检验相同的防错决策保护。</p>
</div></blockquote>
<blockquote>
<div><p>因此，使用 <span class="math notranslate nohighlight">\( a(\alpha, \beta),  b(\alpha,\beta)\)</span> 而不是
<span class="math notranslate nohighlight">\( A(\alpha, \beta),  B(\alpha,\beta)\)</span> 可能产生的唯一缺点是，
这可能会导致检验所需的观测数量显著增加。</p>
</div></blockquote>
<p>我们将编写一些Python代码来帮助我们说明Wald关于 <span class="math notranslate nohighlight">\(\alpha\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span> 如何与表征其序贯概率比检验的参数 <span class="math notranslate nohighlight">\(A\)</span> 和 <span class="math notranslate nohighlight">\(B\)</span> 相关的论断。</p>
</section>
<section id="id16">
<h2><a class="toc-backref" href="#id26" role="doc-backlink"><span class="section-number">26.6. </span>模拟</a><a class="headerlink" href="#id16" title="Link to this heading">#</a></h2>
<p>我们尝试不同的分布 <span class="math notranslate nohighlight">\(f_0\)</span> 和 <span class="math notranslate nohighlight">\(f_1\)</span> 来研究Wald检验在各种条件下的表现。</p>
<p>进行这些模拟的目的是为了理解Wald的<strong>序贯概率比检验</strong>在决策速度和准确性之间的权衡。</p>
<p>具体来说，我们将观察：</p>
<ul class="simple">
<li><p>决策阈值 <span class="math notranslate nohighlight">\(A\)</span> 和 <span class="math notranslate nohighlight">\(B\)</span> (或等效的目标错误率 <span class="math notranslate nohighlight">\(\alpha\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span>) 如何影响平均停止时间</p></li>
<li><p>分布 <span class="math notranslate nohighlight">\(f_0\)</span> 和 <span class="math notranslate nohighlight">\(f_1\)</span> 之间的差异如何影响平均停止时间</p></li>
</ul>
<p>我们将重点关注 <span class="math notranslate nohighlight">\(f_0\)</span> 和 <span class="math notranslate nohighlight">\(f_1\)</span> 为贝塔分布的情况，因为通过调整其形状参数可以轻松控制两个密度的重叠区域。</p>
<p>首先，我们定义一个命名元组来存储我们进行模拟研究所需的所有参数。</p>
<p>我们还根据目标第一类和第二类错误 <span class="math notranslate nohighlight">\(\alpha\)</span> 和 <span class="math notranslate nohighlight">\(\beta\)</span> 计算Wald推荐的阈值 <span class="math notranslate nohighlight">\(A\)</span> 和 <span class="math notranslate nohighlight">\(B\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SPRTParams</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;SPRTParams&#39;</span><span class="p">,</span> 
                <span class="p">[</span><span class="s1">&#39;α&#39;</span><span class="p">,</span> <span class="s1">&#39;β&#39;</span><span class="p">,</span>  <span class="c1"># 目标第一类和第二类错误</span>
                <span class="s1">&#39;a0&#39;</span><span class="p">,</span> <span class="s1">&#39;b0&#39;</span><span class="p">,</span> <span class="c1"># f_0的形状参数</span>
                <span class="s1">&#39;a1&#39;</span><span class="p">,</span> <span class="s1">&#39;b1&#39;</span><span class="p">,</span> <span class="c1"># f_1的形状参数</span>
                <span class="s1">&#39;N&#39;</span><span class="p">,</span>        <span class="c1"># 模拟次数</span>
                <span class="s1">&#39;seed&#39;</span><span class="p">])</span>

<span class="nd">@njit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_wald_thresholds</span><span class="p">(</span><span class="n">α</span><span class="p">,</span> <span class="n">β</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;计算Wald推荐的阈值。&quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">β</span><span class="p">)</span> <span class="o">/</span> <span class="n">α</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">β</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">α</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>现在我们可以按照Wald的建议运行模拟。</p>
<p>我们将对数似然比与阈值的对数 <span class="math notranslate nohighlight">\(\log(A)\)</span> 和 <span class="math notranslate nohighlight">\(\log(B)\)</span> 进行比较。</p>
<p>以下算法是我们模拟的基础。</p>
<ol class="arabic simple">
<li><p>计算阈值 <span class="math notranslate nohighlight">\(A = \frac{1-\beta}{\alpha}\)</span>, <span class="math notranslate nohighlight">\(B = \frac{\beta}{1-\alpha}\)</span> 并使用 <span class="math notranslate nohighlight">\(\log A\)</span>, <span class="math notranslate nohighlight">\(\log B\)</span>。</p></li>
<li><p>给定真实分布(要么是 <span class="math notranslate nohighlight">\(f_0\)</span> 或 <span class="math notranslate nohighlight">\(f_1\)</span>):</p>
<ul class="simple">
<li><p>初始化对数似然比 <span class="math notranslate nohighlight">\(\log L_0 = 0\)</span></p></li>
<li><p>重复:</p>
<ul>
<li><p>从真实分布中抽取观测值 <span class="math notranslate nohighlight">\(z\)</span></p></li>
<li><p>更新: <span class="math notranslate nohighlight">\(\log L_{n+1} \leftarrow \log L_n + (\log f_1(z) - \log f_0(z))\)</span></p></li>
<li><p>如果 <span class="math notranslate nohighlight">\(\log L_{n+1} \geq \log A\)</span>: 停止，拒绝 <span class="math notranslate nohighlight">\(H_0\)</span></p></li>
<li><p>如果 <span class="math notranslate nohighlight">\(\log L_{n+1} \leq \log B\)</span>: 停止，接受 <span class="math notranslate nohighlight">\(H_0\)</span></p></li>
</ul>
</li>
</ul>
</li>
<li><p>对每个分布重复步骤2进行 <span class="math notranslate nohighlight">\(N/2\)</span> 次重复，总共 <span class="math notranslate nohighlight">\(N\)</span> 次重复，计算经验第一类错误 <span class="math notranslate nohighlight">\(\hat{\alpha}\)</span> 和第二类错误 <span class="math notranslate nohighlight">\(\hat{\beta}\)</span>:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
\hat{\alpha} = \frac{\text{当 } f_0 \text{ 为真时拒绝 } H_0 \text{ 的次数}}{\text{以 } f_0 \text{ 为真的重复次数}}
\]</div>
<div class="math notranslate nohighlight">
\[
\hat{\beta} = \frac{\text{当 } f_1 \text{ 为真时接受 } H_0 \text{ 的次数}}{\text{以 } f_1 \text{ 为真的重复次数}}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@njit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sprt_single_run</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">,</span> <span class="n">true_f0</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;运行单次SPRT直到达到决策。&quot;&quot;&quot;</span>
    <span class="n">log_L</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span> <span class="k">if</span> <span class="n">true_f0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># 更新对数似然比</span>
        <span class="n">log_L</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">))</span>
        
        <span class="c1"># 检查停止条件</span>
        <span class="k">if</span> <span class="n">log_L</span> <span class="o">&gt;=</span> <span class="n">logA</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="kc">False</span>  <span class="c1"># 拒绝H0</span>
        <span class="k">elif</span> <span class="n">log_L</span> <span class="o">&lt;=</span> <span class="n">logB</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="kc">True</span>   <span class="c1"># 接受H0</span>

<span class="nd">@njit</span><span class="p">(</span><span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">run_sprt_simulation</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">α</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;SPRT模拟。&quot;&quot;&quot;</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span> <span class="o">=</span> <span class="n">compute_wald_thresholds</span><span class="p">(</span><span class="n">α</span><span class="p">,</span> <span class="n">β</span><span class="p">)</span>
    
    <span class="n">stopping_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">decisions_h0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
    <span class="n">truth_h0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">true_f0</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">truth_h0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">true_f0</span>
        
        <span class="n">n</span><span class="p">,</span> <span class="n">accept_f0</span> <span class="o">=</span> <span class="n">sprt_single_run</span><span class="p">(</span>
                        <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> 
                        <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">,</span> 
                        <span class="n">true_f0</span><span class="p">,</span> <span class="n">seed</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">stopping_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">decisions_h0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">accept_f0</span>
    
    <span class="k">return</span> <span class="n">stopping_times</span><span class="p">,</span> <span class="n">decisions_h0</span><span class="p">,</span> <span class="n">truth_h0</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_sprt</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;使用给定参数运行SPRT模拟。&quot;&quot;&quot;</span>
    <span class="n">stopping_times</span><span class="p">,</span> <span class="n">decisions_h0</span><span class="p">,</span> <span class="n">truth_h0</span> <span class="o">=</span> <span class="n">run_sprt_simulation</span><span class="p">(</span>
        <span class="n">params</span><span class="o">.</span><span class="n">a0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">a1</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b1</span><span class="p">,</span> 
        <span class="n">params</span><span class="o">.</span><span class="n">α</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">seed</span>
    <span class="p">)</span>
    
    <span class="c1"># 计算错误率</span>
    <span class="n">truth_h0_bool</span> <span class="o">=</span> <span class="n">truth_h0</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">decisions_h0_bool</span> <span class="o">=</span> <span class="n">decisions_h0</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    
    <span class="n">type_I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth_h0_bool</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">decisions_h0_bool</span><span class="p">)</span> \
            <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth_h0_bool</span><span class="p">)</span>
    <span class="n">type_II</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">truth_h0_bool</span> <span class="o">&amp;</span> <span class="n">decisions_h0_bool</span><span class="p">)</span> \
            <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">truth_h0_bool</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;stopping_times&#39;</span><span class="p">:</span> <span class="n">stopping_times</span><span class="p">,</span>
        <span class="s1">&#39;decisions_h0&#39;</span><span class="p">:</span> <span class="n">decisions_h0_bool</span><span class="p">,</span>
        <span class="s1">&#39;truth_h0&#39;</span><span class="p">:</span> <span class="n">truth_h0_bool</span><span class="p">,</span>
        <span class="s1">&#39;type_I&#39;</span><span class="p">:</span> <span class="n">type_I</span><span class="p">,</span>
        <span class="s1">&#39;type_II&#39;</span><span class="p">:</span> <span class="n">type_II</span>
    <span class="p">}</span>

<span class="c1"># 运行模拟</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">SPRTParams</span><span class="p">(</span><span class="n">α</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">b1</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">run_sprt</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;平均停止时间: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;经验第一类错误: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;type_I&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> (目标 = </span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">α</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;经验第二类错误: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;type_II&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> (目标 = </span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">β</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>平均停止时间: 1.59
经验第一类错误: 0.012 (目标 = 0.05)
经验第二类错误: 0.022 (目标 = 0.1)
</pre></div>
</div>
</div>
</div>
<p>正如在上文中 Wald 讨论近似式 <a class="reference internal" href="#equation-eq-waldrule">(26.1)</a> 中给出的 <span class="math notranslate nohighlight">\(a(\alpha, \beta), b(\alpha, \beta)\)</span> 的质量时所预期的那样，我们发现该算法实际上给出了比目标值<strong>更低</strong>的第一类和第二类错误率。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>关于近似式 <a class="reference internal" href="#equation-eq-waldrule">(26.1)</a> 质量的最新研究，请参见 <span id="id17">[<a class="reference internal" href="zreferences.html#id270" title="Lasse Fischer and Aaditya Ramdas. Improving the (approximate) sequential probability ratio test by avoiding overshoot. arXiv preprint arXiv:2410.16076, 2024.">Fischer and Ramdas, 2024</a>]</span>。</p>
</div>
<p>以下代码创建了几个图表来展示我们的模拟结果。</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@njit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_wald_thresholds</span><span class="p">(</span><span class="n">α</span><span class="p">,</span> <span class="n">β</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;计算 Wald 推荐的阈值。&quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">β</span><span class="p">)</span> <span class="o">/</span> <span class="n">α</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">β</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">α</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_sprt_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;绘制 SPRT 结果。&quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    
    <span class="c1"># 分布图</span>
    <span class="n">z_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">a0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b0</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">a1</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b1</span><span class="p">)</span>
    
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z_grid</span><span class="p">,</span> <span class="n">f0</span><span class="p">(</span><span class="n">z_grid</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;$f_0 = </span><span class="se">\\</span><span class="s1">text</span><span class="se">{{</span><span class="s1">Beta</span><span class="se">}}</span><span class="s1">(</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">a0</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">b0</span><span class="si">}</span><span class="s1">)$&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z_grid</span><span class="p">,</span> <span class="n">f1</span><span class="p">(</span><span class="n">z_grid</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;$f_1 = </span><span class="se">\\</span><span class="s1">text</span><span class="se">{{</span><span class="s1">Beta</span><span class="se">}}</span><span class="s1">(</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">a1</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">b1</span><span class="si">}</span><span class="s1">)$&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">z_grid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
                        <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">f0</span><span class="p">(</span><span class="n">z_grid</span><span class="p">),</span> <span class="n">f1</span><span class="p">(</span><span class="n">z_grid</span><span class="p">)),</span> 
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;overlap&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    
    <span class="c1"># 停止时间</span>
    <span class="n">max_n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">101</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_n</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s2">&quot;steelblue&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;stopping times (μ=</span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;stopping_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> 
                      <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    
    <span class="c1"># 混淆矩阵</span>
    <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_confusion_matrix</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;绘制 SPRT 结果的混淆矩阵。&quot;&quot;&quot;</span>
    <span class="n">f0_correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;truth_h0&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;decisions_h0&#39;</span><span class="p">])</span>
    <span class="n">f0_incorrect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;truth_h0&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;decisions_h0&#39;</span><span class="p">]))</span>
    <span class="n">f1_correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="o">~</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;truth_h0&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;decisions_h0&#39;</span><span class="p">]))</span>
    <span class="n">f1_incorrect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="o">~</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;truth_h0&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;decisions_h0&#39;</span><span class="p">])</span>
    
    <span class="n">confusion_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">f0_correct</span><span class="p">,</span> <span class="n">f0_incorrect</span><span class="p">],</span> 
                              <span class="p">[</span><span class="n">f1_incorrect</span><span class="p">,</span> <span class="n">f1_correct</span><span class="p">]])</span>
    <span class="n">row_totals</span> <span class="o">=</span> <span class="n">confusion_data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">confusion_data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;errors: I=</span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;type_I&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> II=</span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;type_II&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> 
                 <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;accept $H_0$&#39;</span><span class="p">,</span> <span class="s1">&#39;reject $H_0$&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">&#39;true $f_0$&#39;</span><span class="p">,</span> <span class="s1">&#39;true $f_1$&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">percent</span> <span class="o">=</span> <span class="n">confusion_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">row_totals</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> \
                        <span class="k">if</span> <span class="n">row_totals</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span> <span class="k">if</span> <span class="n">confusion_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">confusion_data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.5</span> \
                    <span class="k">else</span> <span class="s1">&#39;black&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">confusion_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">(</span><span class="si">{</span><span class="n">percent</span><span class="si">:</span><span class="s1">.1%</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
                   <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> 
                   <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>让我们绘制模拟的结果</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_sprt_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b1d58734390faf997833dffdafa90c5531c5bdff37ffe0d70e4b1c6f9f85d69d.png" src="_images/b1d58734390faf997833dffdafa90c5531c5bdff37ffe0d70e4b1c6f9f85d69d.png" />
</div>
</div>
<p>在这个例子中，停止时间保持在10以下。</p>
<p>我们可以构建一个<span class="math notranslate nohighlight">\(2 \times 2\)</span>的”混淆矩阵”，其对角线元素统计了Wald决策规则正确接受和正确拒绝原假设的次数。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;混淆矩阵数据：&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;第一类错误：</span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;type_I&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;第二类错误：</span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;type_II&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>混淆矩阵数据：
第一类错误：0.012
第二类错误：0.022
</pre></div>
</div>
</div>
</div>
<p>接下来我们使用代码研究三对不同的 <span class="math notranslate nohighlight">\(f_0, f_1\)</span> 分布，它们之间有不同程度的差异。</p>
<p>我们为每对分布绘制与上面相同的三种图表</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">params_1</span> <span class="o">=</span> <span class="n">SPRTParams</span><span class="p">(</span><span class="n">α</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">b1</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">results_1</span> <span class="o">=</span> <span class="n">run_sprt</span><span class="p">(</span><span class="n">params_1</span><span class="p">)</span>

<span class="n">params_2</span> <span class="o">=</span> <span class="n">SPRTParams</span><span class="p">(</span><span class="n">α</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">b1</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">results_2</span> <span class="o">=</span> <span class="n">run_sprt</span><span class="p">(</span><span class="n">params_2</span><span class="p">)</span>

<span class="n">params_3</span> <span class="o">=</span> <span class="n">SPRTParams</span><span class="p">(</span><span class="n">α</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> 
                      <span class="n">b1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">results_3</span> <span class="o">=</span> <span class="n">run_sprt</span><span class="p">(</span><span class="n">params_3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_sprt_results</span><span class="p">(</span><span class="n">results_1</span><span class="p">,</span> <span class="n">params_1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d77e02236af4ded95bc34d003ee59d4e2e111e80eeb9938335def342f87676ad.png" src="_images/d77e02236af4ded95bc34d003ee59d4e2e111e80eeb9938335def342f87676ad.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_sprt_results</span><span class="p">(</span><span class="n">results_2</span><span class="p">,</span> <span class="n">params_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6953111aca85dcd7260d3ba0476ef3c1fed0e4c01639365a88b2f77e51ac125a.png" src="_images/6953111aca85dcd7260d3ba0476ef3c1fed0e4c01639365a88b2f77e51ac125a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_sprt_results</span><span class="p">(</span><span class="n">results_3</span><span class="p">,</span> <span class="n">params_3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e0b1eb4377b98696e38ed3921ad28901388e27b2a036e13deff66a67bfbcba77.png" src="_images/e0b1eb4377b98696e38ed3921ad28901388e27b2a036e13deff66a67bfbcba77.png" />
</div>
</div>
<p>请注意，当两个分布相距较远时，停止时间会更短。</p>
<p>这是很合理的。</p>
<p>当两个分布”相距较远”时，判断哪个分布在产生数据不应该需要太长时间。</p>
<p>当两个分布”相近”时，判断哪个分布在产生数据应该需要更长时间。</p>
<p>我们很容易想到将这种模式与我们在<a class="reference internal" href="likelihood_ratio_process.html"><span class="doc">似然比过程</span></a>中讨论的<a class="reference internal" href="divergence_measures.html#rel-entropy"><span class="std std-ref">Kullback–Leibler散度</span></a>联系起来。</p>
<p>虽然当两个分布差异更大时KL散度更大，但KL散度并不是对称的，这意味着分布<span class="math notranslate nohighlight">\(f\)</span>相对于分布<span class="math notranslate nohighlight">\(g\)</span>的KL散度不一定等于<span class="math notranslate nohighlight">\(g\)</span>相对于<span class="math notranslate nohighlight">\(f\)</span>的KL散度。</p>
<p>如果我们想要一个真正具有度量性质的对称散度，我们可以使用<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.distance.jensenshannon.html">Jensen-Shannon距离</a>。</p>
<p>这就是我们现在要做的。</p>
<p>我们将计算Jensen-Shannon距离，并绘制它与平均停止时间的关系图。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">js_dist</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Jensen–Shannon距离&quot;&quot;&quot;</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>

    <span class="c1"># 混合</span>
    <span class="n">m</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">f0</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">+</span> <span class="n">f1</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">compute_KL</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">f0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">compute_KL</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">f1</span><span class="p">))</span>
    
<span class="k">def</span><span class="w"> </span><span class="nf">generate_β_pairs</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">d_min</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">d_max</span><span class="o">=</span><span class="mf">9.5</span><span class="p">):</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">d_min</span><span class="p">,</span> <span class="n">d_max</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">ds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">ds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a0</span><span class="p">))</span>

<span class="n">param_comb</span> <span class="o">=</span> <span class="n">generate_β_pairs</span><span class="p">()</span>

<span class="c1"># 为每个参数组合运行模拟</span>
<span class="n">js_dists</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mean_stopping_times</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">param_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span> <span class="ow">in</span> <span class="n">param_comb</span><span class="p">:</span>
    <span class="c1"># 计算KL散度</span>
    <span class="n">js_div</span> <span class="o">=</span> <span class="n">js_dist</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span>
    
    <span class="c1"># 用固定参数集运行SPRT模拟</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">SPRTParams</span><span class="p">(</span><span class="n">α</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="n">b0</span><span class="p">,</span> 
                        <span class="n">a1</span><span class="o">=</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="o">=</span><span class="n">b1</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">run_sprt</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    
    <span class="n">js_dists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">js_div</span><span class="p">)</span>
    <span class="n">mean_stopping_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">param_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">))</span>

<span class="c1"># 创建图表</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">js_dists</span><span class="p">,</span> <span class="n">mean_stopping_times</span><span class="p">,</span> 
                    <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Jensen–Shannon距离&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;平均停止时间&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3bc998c5b5d5ede26513722932de794bb7dd2022d2ad78e308a40fc5e5e991e6.png" src="_images/3bc998c5b5d5ede26513722932de794bb7dd2022d2ad78e308a40fc5e5e991e6.png" />
</div>
</div>
<p>该图显示了相对熵与平均停止时间之间存在明显的负相关关系。</p>
<p>随着Jensen-Shannon散度的增加（分布之间的差异增大），平均停止时间呈指数下降。</p>
<p>以下是我们上述实验的采样示例</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_beta_distributions_grid</span><span class="p">(</span><span class="n">param_list</span><span class="p">,</span> <span class="n">js_dists</span><span class="p">,</span> <span class="n">mean_stopping_times</span><span class="p">,</span> 
                                <span class="n">selected_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;绘制贝塔分布网格，包含JS距离和停止时间。&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">selected_indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">selected_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_list</span><span class="p">)</span><span class="o">//</span><span class="mi">6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_list</span><span class="p">)</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> 
                          <span class="nb">len</span><span class="p">(</span><span class="n">param_list</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">param_list</span><span class="p">)</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">z_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">selected_indices</span><span class="p">):</span>
        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span>
        <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">param_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        
        <span class="n">f0</span> <span class="o">=</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
        
        <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z_grid</span><span class="p">,</span> <span class="n">f0</span><span class="p">(</span><span class="n">z_grid</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$f_0$&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z_grid</span><span class="p">,</span> <span class="n">f1</span><span class="p">(</span><span class="n">z_grid</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$f_1$&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">z_grid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
                                  <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">f0</span><span class="p">(</span><span class="n">z_grid</span><span class="p">),</span> <span class="n">f1</span><span class="p">(</span><span class="n">z_grid</span><span class="p">)),</span> 
                                  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
        
        <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;JS距离: </span><span class="si">{</span><span class="n">js_dists</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>
                               <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">平均时间: </span><span class="si">{</span><span class="n">mean_stopping_times</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> 
                               <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;密度&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_beta_distributions_grid</span><span class="p">(</span><span class="n">param_list</span><span class="p">,</span> <span class="n">js_dists</span><span class="p">,</span> <span class="n">mean_stopping_times</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4f643c01d1334462b5cd4d2709b0e94300f2d5ff2f5eb0108ca06df1f03a9bfe.png" src="_images/4f643c01d1334462b5cd4d2709b0e94300f2d5ff2f5eb0108ca06df1f03a9bfe.png" />
</div>
</div>
<p>再次发现，当分布之间的差异越大（用Jensen-Shannon距离衡量），停止时间就越短。</p>
<p>让我们可视化单个似然比过程，看看它们是如何向决策边界演变的。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_likelihood_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">n_highlight</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_background</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;可视化似然比路径。&quot;&quot;&quot;</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span> <span class="o">=</span> <span class="n">compute_wald_thresholds</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">α</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">β</span><span class="p">)</span>
    <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ab</span><span class="p">:</span> <span class="n">create_beta_density</span><span class="p">(</span><span class="o">*</span><span class="n">ab</span><span class="p">),</span>
             <span class="p">[(</span><span class="n">params</span><span class="o">.</span><span class="n">a0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b0</span><span class="p">),</span> 
              <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">a1</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b1</span><span class="p">)])</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">dist_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">true_f0</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span>
        <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;真实分布: $f_0$&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;真实分布: $f_1$&#39;</span><span class="p">)</span>
    <span class="p">]):</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span> <span class="o">+</span> <span class="n">dist_idx</span><span class="p">)</span>
        <span class="n">paths_data</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># 生成路径</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_background</span> <span class="o">+</span> <span class="n">n_highlight</span><span class="p">):</span>
            <span class="n">log_L_path</span><span class="p">,</span> <span class="n">log_L</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">0</span>
            
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">a0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b0</span><span class="p">)</span> <span class="k">if</span> <span class="n">true_f0</span> \
                    <span class="k">else</span> <span class="n">rng</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">a1</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b1</span><span class="p">)</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">log_L</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="n">z</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f0</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
                <span class="n">log_L_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">log_L</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">log_L</span> <span class="o">&gt;=</span> <span class="n">logA</span> <span class="ow">or</span> <span class="n">log_L</span> <span class="o">&lt;=</span> <span class="n">logB</span><span class="p">:</span>
                    <span class="n">paths_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">log_L_path</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">log_L</span> <span class="o">&gt;=</span> <span class="n">logA</span><span class="p">))</span>
                    <span class="k">break</span>
        
        <span class="c1"># 绘制背景路径</span>
        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">decision</span> <span class="ow">in</span> <span class="n">paths_data</span><span class="p">[:</span><span class="n">n_background</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)),</span> <span class="n">path</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span> <span class="k">if</span> <span class="n">decision</span> <span class="k">else</span> <span class="s1">&#39;C0&#39;</span><span class="p">,</span> 
                   <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        
        <span class="c1"># 绘制高亮路径及标签</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">decision</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">paths_data</span><span class="p">[</span><span class="n">n_background</span><span class="p">:]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)),</span> <span class="n">path</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span> <span class="k">if</span> <span class="n">decision</span> <span class="k">else</span> <span class="s1">&#39;C0&#39;</span><span class="p">,</span> 
                   <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;拒绝 $H_0$&#39;</span> <span class="k">if</span> <span class="n">decision</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span>
                         <span class="s1">&#39;接受 $H_0$&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">decision</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        
        <span class="c1"># 添加阈值线和格式化</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">logA</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                  <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">log A = </span><span class="si">{</span><span class="n">logA</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">logB</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
                  <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">log B = </span><span class="si">{</span><span class="n">logB</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$n$&#39;</span><span class="p">)</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log(L_n)$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">)</span>
        
        <span class="n">y_margin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">logA</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">logB</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.2</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">logB</span> <span class="o">-</span> <span class="n">y_margin</span><span class="p">,</span> <span class="n">logA</span> <span class="o">+</span> <span class="n">y_margin</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_likelihood_paths</span><span class="p">(</span><span class="n">params_3</span><span class="p">,</span> <span class="n">n_highlight</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_background</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/42630c254700ff8dd14eb24f0528f66f18feb3506175fc2c0003e02125464085.png" src="_images/42630c254700ff8dd14eb24f0528f66f18feb3506175fc2c0003e02125464085.png" />
</div>
</div>
<p>接下来，让我们调整决策阈值 <span class="math notranslate nohighlight">\(A\)</span> 和 <span class="math notranslate nohighlight">\(B\)</span>，并观察平均停止时间以及第一类和第二类错误率的变化。</p>
<p>在下面的代码中，我们通过调整因子 <span class="math notranslate nohighlight">\(A_f\)</span> 和 <span class="math notranslate nohighlight">\(B_f\)</span> 来调整 Wald 规则的阈值。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@njit</span><span class="p">(</span><span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
<span class="k">def</span><span class="w"> </span><span class="nf">run_adjusted_thresholds</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">α</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">A_f</span><span class="p">,</span> <span class="n">B_f</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;带有调整阈值的 SPRT 模拟。&quot;&quot;&quot;</span>
    
    <span class="c1"># 计算原始阈值  </span>
    <span class="n">A_original</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">β</span><span class="p">)</span> <span class="o">/</span> <span class="n">α</span>
    <span class="n">B_original</span> <span class="o">=</span> <span class="n">β</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">α</span><span class="p">)</span>
    
    <span class="c1"># 应用调整因子</span>
    <span class="n">A_adj</span> <span class="o">=</span> <span class="n">A_original</span> <span class="o">*</span> <span class="n">A_f</span>
    <span class="n">B_adj</span> <span class="o">=</span> <span class="n">B_original</span> <span class="o">*</span> <span class="n">B_f</span>
    <span class="n">logA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">A_adj</span><span class="p">)</span>
    <span class="n">logB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">B_adj</span><span class="p">)</span>
    
    <span class="c1"># 预分配数组</span>
    <span class="n">stopping_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">decisions_h0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
    <span class="n">truth_h0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
    
    <span class="c1"># 并行运行模拟</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">true_f0</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">truth_h0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">true_f0</span>
        
        <span class="n">n</span><span class="p">,</span> <span class="n">accept_f0</span> <span class="o">=</span> <span class="n">sprt_single_run</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> 
                        <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">,</span> <span class="n">true_f0</span><span class="p">,</span> <span class="n">seed</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">stopping_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">decisions_h0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">accept_f0</span>
    
    <span class="k">return</span> <span class="n">stopping_times</span><span class="p">,</span> <span class="n">decisions_h0</span><span class="p">,</span> <span class="n">truth_h0</span><span class="p">,</span> <span class="n">A_adj</span><span class="p">,</span> <span class="n">B_adj</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_adjusted</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">A_f</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">B_f</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;运行带有调整 A 和 B 阈值的 SPRT 的包装函数。&quot;&quot;&quot;</span>
    
    <span class="n">stopping_times</span><span class="p">,</span> <span class="n">decisions_h0</span><span class="p">,</span> <span class="n">truth_h0</span><span class="p">,</span> <span class="n">A_adj</span><span class="p">,</span> <span class="n">B_adj</span> <span class="o">=</span> <span class="n">run_adjusted_thresholds</span><span class="p">(</span>
        <span class="n">params</span><span class="o">.</span><span class="n">a0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">a1</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">b1</span><span class="p">,</span> 
        <span class="n">params</span><span class="o">.</span><span class="n">α</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">seed</span><span class="p">,</span> <span class="n">A_f</span><span class="p">,</span> <span class="n">B_f</span>
    <span class="p">)</span>
    <span class="n">truth_h0_bool</span> <span class="o">=</span> <span class="n">truth_h0</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">decisions_h0_bool</span> <span class="o">=</span> <span class="n">decisions_h0</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    
    <span class="c1"># 计算错误率</span>
    <span class="n">type_I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth_h0_bool</span> 
                    <span class="o">&amp;</span> <span class="o">~</span><span class="n">decisions_h0_bool</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth_h0_bool</span><span class="p">)</span>
    <span class="n">type_II</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">truth_h0_bool</span> 
                    <span class="o">&amp;</span> <span class="n">decisions_h0_bool</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">truth_h0_bool</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;stopping_times&#39;</span><span class="p">:</span> <span class="n">stopping_times</span><span class="p">,</span>
        <span class="s1">&#39;type_I&#39;</span><span class="p">:</span> <span class="n">type_I</span><span class="p">,</span>
        <span class="s1">&#39;type_II&#39;</span><span class="p">:</span> <span class="n">type_II</span><span class="p">,</span>
        <span class="s1">&#39;A_used&#39;</span><span class="p">:</span> <span class="n">A_adj</span><span class="p">,</span>
        <span class="s1">&#39;B_used&#39;</span><span class="p">:</span> <span class="n">B_adj</span>
    <span class="p">}</span>

<span class="n">adjustments</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> 
    <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>    
    <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span>    
    <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span>    
    <span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">),</span>   
<span class="p">]</span>

<span class="n">results_table</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">A_f</span><span class="p">,</span> <span class="n">B_f</span> <span class="ow">in</span> <span class="n">adjustments</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">run_adjusted</span><span class="p">(</span><span class="n">params_2</span><span class="p">,</span> <span class="n">A_f</span><span class="p">,</span> <span class="n">B_f</span><span class="p">)</span>
    <span class="n">results_table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
        <span class="n">A_f</span><span class="p">,</span> <span class="n">B_f</span><span class="p">,</span> 
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;type_I&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;type_II&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">])</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_table</span><span class="p">,</span> 
                 <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A_f&quot;</span><span class="p">,</span> <span class="s2">&quot;B_f&quot;</span><span class="p">,</span> <span class="s2">&quot;平均停止时间&quot;</span><span class="p">,</span> 
                          <span class="s2">&quot;第一类错误&quot;</span><span class="p">,</span> <span class="s2">&quot;第二类错误&quot;</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;A_f&quot;</span><span class="p">,</span> <span class="s2">&quot;B_f&quot;</span><span class="p">])</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>平均停止时间</th>
      <th>第一类错误</th>
      <th>第二类错误</th>
    </tr>
    <tr>
      <th>A_f</th>
      <th>B_f</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5.00</th>
      <th>0.5</th>
      <td>16.1</td>
      <td>0.006</td>
      <td>0.036</td>
    </tr>
    <tr>
      <th>1.00</th>
      <th>1.0</th>
      <td>11.1</td>
      <td>0.033</td>
      <td>0.070</td>
    </tr>
    <tr>
      <th>0.30</th>
      <th>3.0</th>
      <td>5.5</td>
      <td>0.086</td>
      <td>0.195</td>
    </tr>
    <tr>
      <th>0.20</th>
      <th>5.0</th>
      <td>3.4</td>
      <td>0.120</td>
      <td>0.304</td>
    </tr>
    <tr>
      <th>0.15</th>
      <th>7.0</th>
      <td>2.2</td>
      <td>0.146</td>
      <td>0.410</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>让我们通过回顾<a class="reference internal" href="#equation-eq-waldrule">(26.1)</a>来更仔细地思考这个表格。</p>
<p>回想一下<span class="math notranslate nohighlight">\(A = \frac{1-\beta}{\alpha}\)</span>和<span class="math notranslate nohighlight">\(B = \frac{\beta}{1-\alpha}\)</span>。</p>
<p>当我们用小于1的因子乘以<span class="math notranslate nohighlight">\(A\)</span>（使<span class="math notranslate nohighlight">\(A\)</span>变小）时，我们实际上是在使拒绝原假设<span class="math notranslate nohighlight">\(H_0\)</span>变得更容易。</p>
<p>这增加了第一类错误的概率。</p>
<p>当我们用大于1的因子乘以<span class="math notranslate nohighlight">\(B\)</span>（使<span class="math notranslate nohighlight">\(B\)</span>变大）时，我们是在使接受原假设<span class="math notranslate nohighlight">\(H_0\)</span>变得更容易。</p>
<p>这增加了第二类错误的概率。</p>
<p>表格证实了这种直觉：当<span class="math notranslate nohighlight">\(A\)</span>减小且<span class="math notranslate nohighlight">\(B\)</span>增加超出其最优Wald值时，第一类和第二类错误率都会增加，而平均停止时间会减少。</p>
</section>
<section id="id18">
<h2><a class="toc-backref" href="#id27" role="doc-backlink"><span class="section-number">26.7. </span>相关讲座</a><a class="headerlink" href="#id18" title="Link to this heading">#</a></h2>
<p>我们将在以下早期和后续讲座中深入探讨这里使用的一些概念：</p>
<ul class="simple">
<li><p>在<a class="reference internal" href="wald_friedman_2.html"><span class="doc">这个续篇</span></a>中，我们从<strong>贝叶斯统计学家</strong>的角度重新阐述了这个问题，他们将参数视为与他们关心的可观察量共同分布的随机变量向量。</p></li>
<li><p><strong>可交换性</strong>的概念是统计学习的基础，在我们的<a class="reference internal" href="exchangeable.html"><span class="doc">可交换随机变量讲座</span></a>中有深入探讨。</p></li>
<li><p>要深入理解似然比过程及其在频率派和贝叶斯统计理论中的作用，请参见<a class="reference internal" href="likelihood_ratio_process.html"><span class="doc">似然比过程</span></a>。</p></li>
<li><p>在此基础上，<a class="reference internal" href="likelihood_bayes.html"><span class="doc">似然比过程和贝叶斯学习</span></a>探讨了似然比过程在<strong>贝叶斯学习</strong>中的作用。</p></li>
<li><p>最后，<a class="reference internal" href="navy_captain.html"><span class="doc">这个后续讲座</span></a>重新审视了这里讨论的主题，并探讨了海军命令船长使用的频率主义决策规则是否会比Abraham Wald的序贯决策规则表现得更好或更差。</p></li>
</ul>
</section>
<section id="id19">
<h2><a class="toc-backref" href="#id28" role="doc-backlink"><span class="section-number">26.8. </span>练习</a><a class="headerlink" href="#id19" title="Link to this heading">#</a></h2>
<p>在下面的两个练习中，请尝试重写本讲座中的整个SPRT套件。</p>
<div class="exercise admonition" id="wald_friedman_ex1">

<p class="admonition-title"><span class="caption-number">Exercise 26.1 </span></p>
<section id="exercise-content">
<p>在第一个练习中，我们将序贯概率比检验应用于区分由3状态马尔可夫链生成的两个模型</p>
<p>（关于马尔可夫链似然比过程的回顾，请参见<a class="reference internal" href="likelihood_ratio_process.html#lrp-markov"><span class="std std-ref">本节</span></a>。）</p>
<p>考虑使用Wald的序贯概率比检验来区分两个3状态马尔可夫链模型。</p>
<p>你有关于转移概率的竞争假设：</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(H_0\)</span>：链遵循转移矩阵 <span class="math notranslate nohighlight">\(P^{(0)}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(H_1\)</span>：链遵循转移矩阵 <span class="math notranslate nohighlight">\(P^{(1)}\)</span></p></li>
</ul>
<p>给定转移矩阵：</p>
<div class="math notranslate nohighlight">
\[\begin{split}
P^{(0)} = \begin{bmatrix}
0.7 &amp; 0.2 &amp; 0.1 \\
0.3 &amp; 0.5 &amp; 0.2 \\
0.1 &amp; 0.3 &amp; 0.6
\end{bmatrix}, \quad
P^{(1)} = \begin{bmatrix}
0.5 &amp; 0.3 &amp; 0.2 \\
0.2 &amp; 0.6 &amp; 0.2 \\
0.2 &amp; 0.2 &amp; 0.6
\end{bmatrix}
\end{split}\]</div>
<p>对于观测序列<span class="math notranslate nohighlight">\((x_0, x_1, \ldots, x_t)\)</span>，似然比为：</p>
<div class="math notranslate nohighlight">
\[
\Lambda_t = \frac{\pi_{x_0}^{(1)}}{\pi_{x_0}^{(0)}} \prod_{s=1}^t \frac{P_{x_{s-1},x_s}^{(1)}}{P_{x_{s-1},x_s}^{(0)}}
\]</div>
<p>其中<span class="math notranslate nohighlight">\(\pi^{(i)}\)</span>是假设<span class="math notranslate nohighlight">\(i\)</span>下的平稳分布。</p>
<p>任务:</p>
<ol class="arabic simple">
<li><p>实现马尔可夫链的似然比计算</p></li>
<li><p>实现Wald序贯检验,I类错误<span class="math notranslate nohighlight">\(\alpha = 0.05\)</span>和II类错误<span class="math notranslate nohighlight">\(\beta = 0.10\)</span></p></li>
<li><p>在每个假设下运行1000次模拟并计算经验错误率</p></li>
<li><p>分析停止时间的分布</p></li>
</ol>
<p>检验在以下情况停止:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\Lambda_t \geq A = \frac{1-\beta}{\alpha} = 18\)</span>: 拒绝<span class="math notranslate nohighlight">\(H_0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\Lambda_t \leq B = \frac{\beta}{1-\alpha} = 0.105\)</span>: 接受<span class="math notranslate nohighlight">\(H_0\)</span></p></li>
</ul>
</section>
</div>
<div class="solution dropdown admonition" id="wald_friedman-solution-1">

<p class="admonition-title">Solution to<a class="reference internal" href="#wald_friedman_ex1"> Exercise 26.1</a></p>
<section id="solution-content">
<p>以下是该练习的一个解决方案。</p>
<p>在讲座中,我们更详细地编写代码以清晰地说明概念。</p>
<p>在下面的代码中,我们简化了一些代码结构以便更简短地呈现。</p>
<p>首先我们定义马尔可夫链SPRT的参数</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MarkovSPRTParams</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;MarkovSPRTParams&#39;</span><span class="p">,</span> 
            <span class="p">[</span><span class="s1">&#39;α&#39;</span><span class="p">,</span> <span class="s1">&#39;β&#39;</span><span class="p">,</span> <span class="s1">&#39;P_0&#39;</span><span class="p">,</span> <span class="s1">&#39;P_1&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;seed&#39;</span><span class="p">])</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compute_stationary_distribution</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;计算转移矩阵P的平稳分布。&quot;&quot;&quot;</span>
    <span class="n">eigenvalues</span><span class="p">,</span> <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eigenvalues</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">eigenvectors</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">pi</span> <span class="o">/</span> <span class="n">pi</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="nd">@njit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">simulate_markov_chain</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">pi_0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;模拟马尔可夫链路径。&quot;&quot;&quot;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    
    <span class="n">cumsum_pi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pi_0</span><span class="p">)</span>
    <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">cumsum_pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">())</span>
    
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
        <span class="n">cumsum_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">path</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">cumsum_row</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">())</span>
    
    <span class="k">return</span> <span class="n">path</span>
</pre></div>
</div>
</div>
</div>
<p>这里我们定义了用于马尔可夫链的 SPRT 运行函数</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@njit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">markov_sprt_single_run</span><span class="p">(</span><span class="n">P_0</span><span class="p">,</span> <span class="n">P_1</span><span class="p">,</span> <span class="n">π_0</span><span class="p">,</span> <span class="n">π_1</span><span class="p">,</span> 
                <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">,</span> <span class="n">true_P</span><span class="p">,</span> <span class="n">true_π</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;运行单次马尔可夫链 SPRT。&quot;&quot;&quot;</span>
    <span class="n">max_n</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">simulate_markov_chain</span><span class="p">(</span><span class="n">true_P</span><span class="p">,</span> <span class="n">true_π</span><span class="p">,</span> <span class="n">max_n</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
    
    <span class="n">log_L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">π_1</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">/</span> <span class="n">π_0</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="k">if</span> <span class="n">log_L</span> <span class="o">&gt;=</span> <span class="n">logA</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">log_L</span> <span class="o">&lt;=</span> <span class="n">logB</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span>
    
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_n</span><span class="p">):</span>
        <span class="n">prev_state</span><span class="p">,</span> <span class="n">curr_state</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">path</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">p_1</span><span class="p">,</span> <span class="n">p_0</span> <span class="o">=</span> <span class="n">P_1</span><span class="p">[</span><span class="n">prev_state</span><span class="p">,</span> <span class="n">curr_state</span><span class="p">],</span> <span class="n">P_0</span><span class="p">[</span><span class="n">prev_state</span><span class="p">,</span> <span class="n">curr_state</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">p_0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log_L</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p_1</span> <span class="o">/</span> <span class="n">p_0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p_1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log_L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            
        <span class="k">if</span> <span class="n">log_L</span> <span class="o">&gt;=</span> <span class="n">logA</span><span class="p">:</span> <span class="k">return</span> <span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">log_L</span> <span class="o">&lt;=</span> <span class="n">logB</span><span class="p">:</span> <span class="k">return</span> <span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="kc">True</span>
    
    <span class="k">return</span> <span class="n">max_n</span><span class="p">,</span> <span class="n">log_L</span> <span class="o">&lt;</span> <span class="mi">0</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_markov_sprt</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;运行马尔可夫链 SPRT。&quot;&quot;&quot;</span>
    <span class="n">π_0</span> <span class="o">=</span> <span class="n">compute_stationary_distribution</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">P_0</span><span class="p">)</span>
    <span class="n">π_1</span> <span class="o">=</span> <span class="n">compute_stationary_distribution</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">P_1</span><span class="p">)</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span> <span class="o">=</span> <span class="n">compute_wald_thresholds</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">α</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">β</span><span class="p">)</span>
    
    <span class="n">stopping_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">decisions_h0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">truth_h0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
        <span class="n">true_P</span><span class="p">,</span> <span class="n">true_π</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">P_0</span><span class="p">,</span> <span class="n">π_0</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">P_1</span><span class="p">,</span> <span class="n">π_1</span><span class="p">)</span>
        <span class="n">truth_h0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
        
        <span class="n">n</span><span class="p">,</span> <span class="n">accept_h0</span> <span class="o">=</span> <span class="n">markov_sprt_single_run</span><span class="p">(</span>
            <span class="n">params</span><span class="o">.</span><span class="n">P_0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">P_1</span><span class="p">,</span> <span class="n">π_0</span><span class="p">,</span> <span class="n">π_1</span><span class="p">,</span> <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">,</span> 
            <span class="n">true_P</span><span class="p">,</span> <span class="n">true_π</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">seed</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
        
        <span class="n">stopping_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">decisions_h0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">accept_h0</span>
    
    <span class="n">type_I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth_h0</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">decisions_h0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth_h0</span><span class="p">)</span>
    <span class="n">type_II</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">truth_h0</span> <span class="o">&amp;</span> <span class="n">decisions_h0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">truth_h0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;stopping_times&#39;</span><span class="p">:</span> <span class="n">stopping_times</span><span class="p">,</span> <span class="s1">&#39;decisions_h0&#39;</span><span class="p">:</span> <span class="n">decisions_h0</span><span class="p">,</span>
        <span class="s1">&#39;truth_h0&#39;</span><span class="p">:</span> <span class="n">truth_h0</span><span class="p">,</span> <span class="s1">&#39;type_I&#39;</span><span class="p">:</span> <span class="n">type_I</span><span class="p">,</span> <span class="s1">&#39;type_II&#39;</span><span class="p">:</span> <span class="n">type_II</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>现在我们可以运行马尔可夫链的SPRT并可视化结果</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 运行马尔可夫链SPRT</span>
<span class="n">P_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> 
                <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> 
                <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]])</span>

<span class="n">P_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> 
                <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> 
                <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]])</span>

<span class="n">params_markov</span> <span class="o">=</span> <span class="n">MarkovSPRTParams</span><span class="p">(</span><span class="n">α</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> 
                        <span class="n">P_0</span><span class="o">=</span><span class="n">P_0</span><span class="p">,</span> <span class="n">P_1</span><span class="o">=</span><span class="n">P_1</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">results_markov</span> <span class="o">=</span> <span class="n">run_markov_sprt</span><span class="p">(</span><span class="n">params_markov</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">results_markov</span><span class="p">[</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">],</span> 
            <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;steelblue&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;停止时间&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;频率&quot;</span><span class="p">)</span>

<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">results_markov</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4692c52dc6e8f4f848537c554fb9fd06b56188b8bc316e09951fe169aa8d5a35.png" src="_images/4692c52dc6e8f4f848537c554fb9fd06b56188b8bc316e09951fe169aa8d5a35.png" />
</div>
</div>
</section>
</div>
<div class="exercise admonition" id="wald_friedman_ex2">

<p class="admonition-title"><span class="caption-number">Exercise 26.2 </span></p>
<section id="exercise-content">
<p>在本练习中，将Wald的序贯检验应用于区分具有不同动态和噪声结构的两个VAR(1)模型。</p>
<p>关于VAR模型的似然比过程的回顾，请参见<a class="reference internal" href="likelihood_var.html"><span class="doc">VAR模型的似然过程</span></a>。</p>
<p>给定每个假设下的VAR模型:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(H_0\)</span>: <span class="math notranslate nohighlight">\(x_{t+1} = A^{(0)} x_t + C^{(0)} w_{t+1}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(H_1\)</span>: <span class="math notranslate nohighlight">\(x_{t+1} = A^{(1)} x_t + C^{(1)} w_{t+1}\)</span></p></li>
</ul>
<p>其中 <span class="math notranslate nohighlight">\(w_t \sim \mathcal{N}(0, I)\)</span> 且:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
A^{(0)} = \begin{bmatrix} 0.8 &amp; 0.1 \\ 0.2 &amp; 0.7 \end{bmatrix}, \quad
C^{(0)} = \begin{bmatrix} 0.3 &amp; 0.1 \\ 0.1 &amp; 0.3 \end{bmatrix}
\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}
A^{(1)} = \begin{bmatrix} 0.6 &amp; 0.2 \\ 0.3 &amp; 0.5 \end{bmatrix}, \quad
C^{(1)} = \begin{bmatrix} 0.4 &amp; 0 \\ 0 &amp; 0.4 \end{bmatrix}
\end{split}\]</div>
<p>任务:</p>
<ol class="arabic simple">
<li><p>使用VAR讲座中的函数实现VAR似然比</p></li>
<li><p>实现Wald的序贯检验，其中 <span class="math notranslate nohighlight">\(\alpha = 0.05\)</span> 且 <span class="math notranslate nohighlight">\(\beta = 0.10\)</span></p></li>
<li><p>分析在两个假设下以及模型错误设定情况下的表现</p></li>
<li><p>在停止时间和准确性方面与马尔可夫链情况进行比较</p></li>
</ol>
</section>
</div>
<div class="solution dropdown admonition" id="wald_friedman-solution-3">

<p class="admonition-title">Solution to<a class="reference internal" href="#wald_friedman_ex2"> Exercise 26.2</a></p>
<section id="solution-content">
<p>以下是该练习的一个解决方案。</p>
<p>首先我们定义VAR模型和模拟器的参数</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">VARSPRTParams</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;VARSPRTParams&#39;</span><span class="p">,</span> 
            <span class="p">[</span><span class="s1">&#39;α&#39;</span><span class="p">,</span> <span class="s1">&#39;β&#39;</span><span class="p">,</span> <span class="s1">&#39;A_0&#39;</span><span class="p">,</span> <span class="s1">&#39;C_0&#39;</span><span class="p">,</span> <span class="s1">&#39;A_1&#39;</span><span class="p">,</span> <span class="s1">&#39;C_1&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;seed&#39;</span><span class="p">])</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_var_model</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;创建VAR模型。&quot;&quot;&quot;</span>
    <span class="n">μ_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">CC</span> <span class="o">=</span> <span class="n">C</span> <span class="o">@</span> <span class="n">C</span><span class="o">.</span><span class="n">T</span>
    <span class="n">Σ_0</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve_discrete_lyapunov</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">CC</span><span class="p">)</span>
    
    <span class="n">CC_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">CC</span> <span class="o">+</span> <span class="mf">1e-10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">CC</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">Σ_0_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Σ_0</span> <span class="o">+</span> <span class="mf">1e-10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">Σ_0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">A</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="s1">&#39;μ_0&#39;</span><span class="p">:</span> <span class="n">μ_0</span><span class="p">,</span> <span class="s1">&#39;Σ_0&#39;</span><span class="p">:</span> <span class="n">Σ_0</span><span class="p">,</span>
        <span class="s1">&#39;CC_inv&#39;</span><span class="p">:</span> <span class="n">CC_inv</span><span class="p">,</span> <span class="s1">&#39;Σ_0_inv&#39;</span><span class="p">:</span> <span class="n">Σ_0_inv</span><span class="p">,</span>
        <span class="s1">&#39;log_det_CC&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">CC</span> <span class="o">+</span> <span class="mf">1e-10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">CC</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))),</span>
        <span class="s1">&#39;log_det_Σ_0&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">Σ_0</span> <span class="o">+</span> <span class="mf">1e-10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">Σ_0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>现在我们为VAR模型定义似然比和SPRT函数，类似于马尔可夫链的情况</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">var_log_likelihood</span><span class="p">(</span><span class="n">x_curr</span><span class="p">,</span> <span class="n">x_prev</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;计算VAR对数似然。&quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_curr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">initial</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">x_curr</span> <span class="o">-</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;μ_0&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;log_det_Σ_0&#39;</span><span class="p">]</span> <span class="o">+</span> 
                      <span class="n">diff</span> <span class="o">@</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;Σ_0_inv&#39;</span><span class="p">]</span> <span class="o">@</span> <span class="n">diff</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">x_curr</span> <span class="o">-</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">@</span> <span class="n">x_prev</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;log_det_CC&#39;</span><span class="p">]</span> <span class="o">+</span> 
                      <span class="n">diff</span> <span class="o">@</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;CC_inv&#39;</span><span class="p">]</span> <span class="o">@</span> <span class="n">diff</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">var_sprt_single_run</span><span class="p">(</span><span class="n">model_0</span><span class="p">,</span> <span class="n">model_1</span><span class="p">,</span> <span class="n">model_true</span><span class="p">,</span> 
                        <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;单次VAR SPRT运行。&quot;&quot;&quot;</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">max_T</span> <span class="o">=</span> <span class="mi">500</span>
    
    <span class="c1"># 生成VAR路径</span>
    <span class="n">Σ_chol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">model_true</span><span class="p">[</span><span class="s1">&#39;Σ_0&#39;</span><span class="p">])</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">model_true</span><span class="p">[</span><span class="s1">&#39;μ_0&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">Σ_chol</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">model_true</span><span class="p">[</span><span class="s1">&#39;μ_0&#39;</span><span class="p">]))</span>
    
    <span class="c1"># 初始似然比</span>
    <span class="n">log_L</span> <span class="o">=</span> <span class="p">(</span><span class="n">var_log_likelihood</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">model_1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-</span> 
             <span class="n">var_log_likelihood</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">model_0</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">log_L</span> <span class="o">&gt;=</span> <span class="n">logA</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">log_L</span> <span class="o">&lt;=</span> <span class="n">logB</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span>
    
    <span class="c1"># 序贯更新</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_T</span><span class="p">):</span>
        <span class="n">x_prev</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">model_true</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">model_true</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">@</span> <span class="n">x</span> <span class="o">+</span> <span class="n">model_true</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">@</span> <span class="n">w</span>
        
        <span class="n">log_L</span> <span class="o">+=</span> <span class="p">(</span><span class="n">var_log_likelihood</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_prev</span><span class="p">,</span> <span class="n">model_1</span><span class="p">)</span> <span class="o">-</span> 
                 <span class="n">var_log_likelihood</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_prev</span><span class="p">,</span> <span class="n">model_0</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">log_L</span> <span class="o">&gt;=</span> <span class="n">logA</span><span class="p">:</span> <span class="k">return</span> <span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">log_L</span> <span class="o">&lt;=</span> <span class="n">logB</span><span class="p">:</span> <span class="k">return</span> <span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="kc">True</span>
    
    <span class="k">return</span> <span class="n">max_T</span><span class="p">,</span> <span class="n">log_L</span> <span class="o">&lt;</span> <span class="mi">0</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_var_sprt</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;运行VAR SPRT。&quot;&quot;&quot;</span>

    <span class="n">model_0</span> <span class="o">=</span> <span class="n">create_var_model</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">A_0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">C_0</span><span class="p">)</span>
    <span class="n">model_1</span> <span class="o">=</span> <span class="n">create_var_model</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">A_1</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">C_1</span><span class="p">)</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span> <span class="o">=</span> <span class="n">compute_wald_thresholds</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">α</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">β</span><span class="p">)</span>
    
    <span class="n">stopping_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
    <span class="n">decisions_h0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">truth_h0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
        <span class="n">model_true</span> <span class="o">=</span> <span class="n">model_0</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">model_1</span>
        <span class="n">truth_h0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
        
        <span class="n">n</span><span class="p">,</span> <span class="n">accept_h0</span> <span class="o">=</span> <span class="n">var_sprt_single_run</span><span class="p">(</span><span class="n">model_0</span><span class="p">,</span> <span class="n">model_1</span><span class="p">,</span> <span class="n">model_true</span><span class="p">,</span> 
                                          <span class="n">logA</span><span class="p">,</span> <span class="n">logB</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">seed</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">stopping_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">decisions_h0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">accept_h0</span>
    
    <span class="n">type_I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth_h0</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">decisions_h0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">truth_h0</span><span class="p">)</span>
    <span class="n">type_II</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">truth_h0</span> <span class="o">&amp;</span> <span class="n">decisions_h0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">truth_h0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">:</span> <span class="n">stopping_times</span><span class="p">,</span> 
            <span class="s1">&#39;decisions_h0&#39;</span><span class="p">:</span> <span class="n">decisions_h0</span><span class="p">,</span>
            <span class="s1">&#39;truth_h0&#39;</span><span class="p">:</span> <span class="n">truth_h0</span><span class="p">,</span> 
            <span class="s1">&#39;type_I&#39;</span><span class="p">:</span> <span class="n">type_I</span><span class="p">,</span> <span class="s1">&#39;type_II&#39;</span><span class="p">:</span> <span class="n">type_II</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>让我们运行SPRT并可视化结果</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 运行 VAR SPRT</span>
<span class="n">A_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> 
                <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">]])</span>
<span class="n">C_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> 
                <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]])</span>
<span class="n">A_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> 
                <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>
<span class="n">C_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
                <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]])</span>

<span class="n">params_var</span> <span class="o">=</span> <span class="n">VARSPRTParams</span><span class="p">(</span><span class="n">α</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> 
                <span class="n">A_0</span><span class="o">=</span><span class="n">A_0</span><span class="p">,</span> <span class="n">C_0</span><span class="o">=</span><span class="n">C_0</span><span class="p">,</span> <span class="n">A_1</span><span class="o">=</span><span class="n">A_1</span><span class="p">,</span> <span class="n">C_1</span><span class="o">=</span><span class="n">C_1</span><span class="p">,</span> 
                <span class="n">N</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">results_var</span> <span class="o">=</span> <span class="n">run_var_sprt</span><span class="p">(</span><span class="n">params_var</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">boxplot</span><span class="p">([</span><span class="n">results_markov</span><span class="p">[</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">],</span> 
             <span class="n">results_var</span><span class="p">[</span><span class="s1">&#39;stopping_times&#39;</span><span class="p">]],</span> 
           <span class="n">tick_labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;马尔可夫链&#39;</span><span class="p">,</span> <span class="s1">&#39;VAR(1)&#39;</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;停止时间&#39;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">,</span> <span class="p">[</span><span class="n">results_markov</span><span class="p">[</span><span class="s1">&#39;type_I&#39;</span><span class="p">],</span> <span class="n">results_var</span><span class="p">[</span><span class="s1">&#39;type_I&#39;</span><span class="p">]],</span> 
        <span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;第一类错误&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="p">[</span><span class="n">results_markov</span><span class="p">[</span><span class="s1">&#39;type_II&#39;</span><span class="p">],</span> <span class="n">results_var</span><span class="p">[</span><span class="s1">&#39;type_II&#39;</span><span class="p">]],</span> 
        <span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;第二类错误&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;马尔可夫&#39;</span><span class="p">,</span> <span class="s1">&#39;VAR&#39;</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c52c6f7254997b87d93a8932670909381377da998114bacb6a8079a4fdcad5d3.png" src="_images/c52c6f7254997b87d93a8932670909381377da998114bacb6a8079a4fdcad5d3.png" />
</div>
</div>
</section>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                    <p>A theme by <a href="https://quantecon.org">QuantEcon</a></p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  基础工具
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="sir_model.html">
   1. 新冠病毒建模
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_algebra.html">
   2. 线性代数
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="qr_decomp.html">
   3. QR分解
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="eig_circulant.html">
   4. 循环矩阵
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="svd_intro.html">
   5. 奇异值分解
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="var_dmd.html">
   6. 向量自回归和动态模态分解
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="newton_method.html">
   7. 使用牛顿法求解经济模型
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  基础统计学
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="prob_matrix.html">
   8. 基础概率论与矩阵
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stats_examples.html">
   9. 一些概率分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lln_clt.html">
   10. 大数定律 和 中心极限定理
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="prob_meaning.html">
   11. 概率的两种含义
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multi_hyper.html">
   12. 多元超几何分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multivariate_normal.html">
   13. 多元正态分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hoist_failure.html">
   14. 故障树不确定性
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="back_prop.html">
   15. 人工神经网络简介
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rand_resp.html">
   16. 随机化回应调查
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="util_rand_resp.html">
   17. 随机回答的期望效用
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  贝叶斯定律
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="bayes_nonconj.html">
   18. 非共轭先验
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_bayes.html">
   19. AR(1)参数的后验分布
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ar1_turningpts.html">
   20. 预测 AR(1) 过程
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  统计与信息论
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="divergence_measures.html">
   21. 统计散度度量
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_ratio_process.html">
   22. 似然比过程
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_ratio_process_2.html">
   23. 异质信念与金融市场
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_var.html">
   24. VAR模型的似然过程
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="imp_sample.html">
   25. 似然比过程的均值
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   26. 让弥尔顿·弗里德曼困惑的问题
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wald_friedman_2.html">
   27. 用贝叶斯方法解决弗里德曼和瓦尔德问题
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exchangeable.html">
   28. 可交换性和贝叶斯更新
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="likelihood_bayes.html">
   29. 似然比过程和贝叶斯学习
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mix_model.html">
   30. 错误模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="navy_captain.html">
   31. 贝叶斯与频率主义决策规则的比较
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  线性规划
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="opt_transport.html">
   32. 最优传输
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="von_neumann_model.html">
   33. 冯·诺依曼增长模型（及其推广）
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  动态系统导论
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="finite_markov.html">
   34. 有限马尔可夫链
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="inventory_dynamics.html">
   35. 库存动态
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="linear_models.html">
   36. 线性状态空间模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="samuelson.html">
   37. 萨缪尔森乘数-加速器模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kesten_processes.html">
   38. Kesten过程与企业动态
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wealth_dynamics.html">
   39. 财富分布动态
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman.html">
   40. 初见卡尔曼滤波器
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="kalman_2.html">
   41. 卡尔曼滤波器进阶
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  搜索
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model.html">
   42. 工作搜寻 I: McCall搜寻模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_model_with_separation.html">
   43. 工作搜寻 II：搜寻与离职
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_fitted_vfi.html">
   44. 工作搜寻 III: 拟合值函数迭代
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_correlated.html">
   45. 工作搜寻 IV：相关工资报价
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="career.html">
   46. 工作搜寻 V：职业选择建模
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="jv.html">
   47. 工作搜寻 VI：在职搜索
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mccall_q.html">
   48. 工作搜寻 VII：McCall劳动者的Q学习
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="odu.html">
   49. 工作搜寻 VII: 带学习的搜索
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  消费、储蓄与资本
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_1.html">
   50. Cass-Koopmans模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_koopmans_2.html">
   51. Cass-Koopmans竞争均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_fiscal.html">
   52. 带扭曲性税收的Cass-Koopmans模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cass_fiscal_2.html">
   53. 带扭曲性税收的双国模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ak2.html">
   54. 代际交叠模型中的转型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_problem.html">
   55. 吃蛋糕问题 I：最优储蓄导论
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cake_eating_numerical.html">
   56. 吃蛋糕问题 II：数值方法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth.html">
   57. 最优增长 I：随机最优增长模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="optgrowth_fast.html">
   58. 最优增长 II：使用Numba加速代码
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coleman_policy_iter.html">
   59. 最优增长 III：时间迭代
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="egm_policy_iter.html">
   60. 最优增长 IV：内生网格法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp.html">
   61. 收入波动问题 I：基本模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ifp_advanced.html">
   62. 收入波动问题 II：资产随机收益
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  LQ控制
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lqcontrol.html">
   63. LQ控制：基础
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lagrangian_lqdp.html">
   64. LQ控制的拉格朗日方法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cross_product_trick.html">
   65. 消除交叉项
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income.html">
   66. 永久收入模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="perm_income_cons.html">
   67. 永久收入 II：线性二次方法
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lq_inventories.html">
   68. 通过库存实现生产平滑
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  多主体模型
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lake_model.html">
   69. 就业与失业的湖泊模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rational_expectations.html">
   70. 理性预期均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="re_with_feedback.html">
   71. 线性理性预期模型中的稳定性
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_perf.html">
   72. 马尔可夫完美均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="uncertainty_traps.html">
   73. 不确定性陷阱
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="aiyagari.html">
   74. 艾亚加里模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ak_aiyagari.html">
   75. 长寿、异质性个体、世代交叠模型
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  资产定价与金融
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="markov_asset.html">
   76. 资产定价：有限状态模型
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ge_arrow.html">
   77. 带有阿罗证券的竞争均衡
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="harrison_kreps.html">
   78. 异质信念与泡沫
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  数据与实证
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="pandas_panel.html">
   79. 用Pandas处理面板数据
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ols.html">
   80. Python线性回归
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mle.html">
   81. 最大似然估计
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  拍卖
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="two_auctions.html">
   82. 一价和二价拍卖
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="house_auction.html">
   83. 多种商品分配机制
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  其他
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   84. 故障排除
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   85. 参考文献
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   86. 执行统计
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                </ul>

                <ul class="qe-toolbar__links">
                    <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off" accesskey="k">
                            <i data-feather="search" id="search-icon"></i>
                        </form>
                    </li>
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/wald_friedman.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li data-tippy-content="Download PDF" onClick="window.print()"><i data-feather="file"></i></li>
                    <!--
                    # Enable if looking for link to specific document hosted on GitHub
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst/wald_friedman.md" download><i data-feather="github"></i></a></li>
                    -->
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python.myst" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://colab.research.google.com/github/QuantEcon/lecture-python.zh-cn.notebooks/blob/main/wald_friedman.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-python.zh-cn.notebooks" data-urlpath="tree/lecture-python.zh-cn.notebooks/wald_friedman.ipynb" data-branch=main>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://colab.research.google.com/github/QuantEcon/lecture-python.zh-cn.notebooks/blob/main/wald_friedman.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "wald_friedman";
                const repoURL = "https://github.com/QuantEcon/lecture-python.zh-cn.notebooks";
                const urlPath = "tree/lecture-python.zh-cn.notebooks/wald_friedman.ipynb";
                const branch = "main"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>